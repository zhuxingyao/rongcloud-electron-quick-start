!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.match.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.join.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/web.timers.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.string.pad-start.js"),require("core-js/modules/es.regexp.constructor.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.array-buffer.slice.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.typed-array.uint8-array.js"),require("core-js/modules/es.typed-array.copy-within.js"),require("core-js/modules/es.typed-array.every.js"),require("core-js/modules/es.typed-array.fill.js"),require("core-js/modules/es.typed-array.filter.js"),require("core-js/modules/es.typed-array.find.js"),require("core-js/modules/es.typed-array.find-index.js"),require("core-js/modules/es.typed-array.for-each.js"),require("core-js/modules/es.typed-array.includes.js"),require("core-js/modules/es.typed-array.index-of.js"),require("core-js/modules/es.typed-array.iterator.js"),require("core-js/modules/es.typed-array.join.js"),require("core-js/modules/es.typed-array.last-index-of.js"),require("core-js/modules/es.typed-array.map.js"),require("core-js/modules/es.typed-array.reduce.js"),require("core-js/modules/es.typed-array.reduce-right.js"),require("core-js/modules/es.typed-array.reverse.js"),require("core-js/modules/es.typed-array.set.js"),require("core-js/modules/es.typed-array.slice.js"),require("core-js/modules/es.typed-array.some.js"),require("core-js/modules/es.typed-array.sort.js"),require("core-js/modules/es.typed-array.subarray.js"),require("core-js/modules/es.typed-array.to-locale-string.js"),require("core-js/modules/es.typed-array.to-string.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.typed-array.int8-array.js"),require("core-js/modules/es.array.fill.js"),require("core-js/modules/es.array-buffer.constructor.js"),require("core-js/modules/es.string.sub.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.object.values.js"),require("core-js/modules/es.set.js"),require("core-js/modules/web.url.js"),require("core-js/modules/es.array.from.js"),require("core-js/modules/es.map.js")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es.regexp.exec.js","core-js/modules/es.string.match.js","core-js/modules/es.array.concat.js","core-js/modules/es.array.filter.js","core-js/modules/es.array.join.js","core-js/modules/es.array.map.js","core-js/modules/es.array.slice.js","core-js/modules/es.object.keys.js","core-js/modules/es.string.replace.js","core-js/modules/es.array.includes.js","core-js/modules/es.function.name.js","core-js/modules/web.timers.js","core-js/modules/es.object.to-string.js","core-js/modules/es.promise.js","core-js/modules/es.regexp.to-string.js","core-js/modules/es.string.split.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.array.splice.js","core-js/modules/es.string.pad-start.js","core-js/modules/es.regexp.constructor.js","core-js/modules/es.array.iterator.js","core-js/modules/es.array-buffer.slice.js","core-js/modules/es.number.constructor.js","core-js/modules/es.object.assign.js","core-js/modules/es.string.includes.js","core-js/modules/es.typed-array.uint8-array.js","core-js/modules/es.typed-array.copy-within.js","core-js/modules/es.typed-array.every.js","core-js/modules/es.typed-array.fill.js","core-js/modules/es.typed-array.filter.js","core-js/modules/es.typed-array.find.js","core-js/modules/es.typed-array.find-index.js","core-js/modules/es.typed-array.for-each.js","core-js/modules/es.typed-array.includes.js","core-js/modules/es.typed-array.index-of.js","core-js/modules/es.typed-array.iterator.js","core-js/modules/es.typed-array.join.js","core-js/modules/es.typed-array.last-index-of.js","core-js/modules/es.typed-array.map.js","core-js/modules/es.typed-array.reduce.js","core-js/modules/es.typed-array.reduce-right.js","core-js/modules/es.typed-array.reverse.js","core-js/modules/es.typed-array.set.js","core-js/modules/es.typed-array.slice.js","core-js/modules/es.typed-array.some.js","core-js/modules/es.typed-array.sort.js","core-js/modules/es.typed-array.subarray.js","core-js/modules/es.typed-array.to-locale-string.js","core-js/modules/es.typed-array.to-string.js","core-js/modules/web.dom-collections.iterator.js","core-js/modules/es.typed-array.int8-array.js","core-js/modules/es.array.fill.js","core-js/modules/es.array-buffer.constructor.js","core-js/modules/es.string.sub.js","core-js/modules/es.array.sort.js","core-js/modules/es.string.iterator.js","core-js/modules/es.array.find.js","core-js/modules/es.array.find-index.js","core-js/modules/es.object.values.js","core-js/modules/es.set.js","core-js/modules/web.url.js","core-js/modules/es.array.from.js","core-js/modules/es.map.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).RongIMLib={})}(this,(function(e){"use strict";var t;!function(e){e[e.READ=1]="READ",e[e.LISTENED=2]="LISTENED",e[e.DOWNLOADED=4]="DOWNLOADED",e[e.RETRIEVED=8]="RETRIEVED",e[e.UNREAD=0]="UNREAD"}(t||(t={}));var n=t;function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var i,o,s=72e5,a=5e3,c=["https://nav.cn.ronghub.com","https://nav2-cn.ronghub.com"],u=["wsproxy.cn.ronghub.com","wsap-cn.ronghub.com"],d=["cometproxy-cn.ronghub.com","mini-cn.ronghub.com"],l=3e4,h=131072,f="RCV4-",p={"RC:TxtMsg":{isCounted:!0,isPersited:!0},"RC:ImgMsg":{isCounted:!0,isPersited:!0},"RC:VcMsg":{isCounted:!0,isPersited:!0},"RC:ImgTextMsg":{isCounted:!0,isPersited:!0},"RC:FileMsg":{isCounted:!0,isPersited:!0},"RC:HQVCMsg":{isCounted:!0,isPersited:!0},"RC:LBSMsg":{isCounted:!0,isPersited:!0},"RC:PSImgTxtMsg":{isCounted:!0,isPersited:!0},"RC:PSMultiImgTxtMsg":{isCounted:!0,isPersited:!0},"RCJrmf:RpMsg":{isCounted:!0,isPersited:!0},"RCJrmf:RpOpendMsg":{isCounted:!0,isPersited:!0},"RC:CombineMsg":{isCounted:!0,isPersited:!0},"RC:ReferenceMsg":{isCounted:!0,isPersited:!0},"RC:SightMsg":{isCounted:!0,isPersited:!0},"RC:GIFMsg":{isCounted:!0,isPersited:!0},"RC:InfoNtf":{isCounted:!1,isPersited:!0},"RC:ContactNtf":{isCounted:!1,isPersited:!0},"RC:ProfileNtf":{isCounted:!1,isPersited:!0},"RC:CmdNtf":{isCounted:!1,isPersited:!0},"RC:GrpNtf":{isCounted:!1,isPersited:!0},"RC:RcCmd":{isCounted:!1,isPersited:!0},"RC:CmdMsg":{isCounted:!1,isPersited:!1},"RC:TypSts":{isCounted:!1,isPersited:!1},"RC:PSCmd":{isCounted:!1,isPersited:!1},"RC:SRSMsg":{isCounted:!1,isPersited:!1},"RC:RRReqMsg":{isCounted:!1,isPersited:!1},"RC:RRRspMsg":{isCounted:!1,isPersited:!1},"RC:CsChaR":{isCounted:!1,isPersited:!1},"RC:CSCha":{isCounted:!1,isPersited:!1},"RC:CsEva":{isCounted:!1,isPersited:!1},"RC:CsContact":{isCounted:!1,isPersited:!1},"RC:CsHs":{isCounted:!1,isPersited:!1},"RC:CsHsR":{isCounted:!1,isPersited:!1},"RC:CsSp":{isCounted:!1,isPersited:!1},"RC:CsEnd":{isCounted:!1,isPersited:!1},"RC:CsUpdate":{isCounted:!1,isPersited:!1},"RC:ReadNtf":{isCounted:!1,isPersited:!1},"RC:chrmKVNotiMsg":{isCounted:!1,isPersited:!1},"RC:VCAccept":{isCounted:!1,isPersited:!1},"RC:VCRinging":{isCounted:!1,isPersited:!1},"RC:VCSummary":{isCounted:!1,isPersited:!1},"RC:VCHangup":{isCounted:!1,isPersited:!1},"RC:VCInvite":{isCounted:!1,isPersited:!1},"RC:VCModifyMedia":{isCounted:!1,isPersited:!1},"RC:VCModifyMem":{isCounted:!1,isPersited:!1},"RC:MsgExMsg":{isCounted:!1,isPersited:!1},"RC:RRMsg":{isCounted:!1,isPersited:!1},"RC:LogCmdMsg":{isCounted:!1,isPersited:!1},"RC:InterceptMsg":{isCounted:!1,isPersited:!1}},m=["RC:TypSts","RC:InterceptMsg"];!function(e){e.WEBSOCKET="websocket",e.COMET="comet"}(i||(i={}));var v=function(e){return o||(o={set:function(t,n){e.localStorage.setItem(t,JSON.stringify(n))},get:function(t){var n;try{n=JSON.parse(e.localStorage.getItem(t))}catch(e){n=null}return n},remove:function(t){return e.localStorage.removeItem(t)},getKeys:function(){var t=[];for(var n in e.localStorage)t.push(n);return t}}),o},_=function(){function e(e){this._caches={},e&&(this._caches=e)}return e.prototype.set=function(e,t){this._caches[e]=t},e.prototype.remove=function(e){var t=this.get(e);return delete this._caches[e],t},e.prototype.get=function(e){return this._caches[e]},e.prototype.getKeys=function(){var e=[];for(var t in this._caches)e.push(t);return e},e}(),y=function(){function e(e,t){var n,r=t?"".concat(f).concat(t):f;this._rootStorage=v(e);var i=this._rootStorage.get(r)||{};this._cache=new _(((n={})[r]=i,n)),this._storageKey=r}return e.prototype._get=function(){var e=this._storageKey;return this._cache.get(e)||{}},e.prototype._set=function(e){var t=this._storageKey;e=e||{},this._cache.set(t,e),this._rootStorage.set(t,e)},e.prototype.set=function(e,t){var n=this._get();n[e]=t,this._set(n)},e.prototype.remove=function(e){var t=this._get();delete t[e],this._set(t)},e.prototype.clear=function(){var e=this._storageKey;this._rootStorage.remove(e),this._cache.remove(e)},e.prototype.get=function(e){return this._get()[e]},e.prototype.getKeys=function(){var e=this._get(),t=[];for(var n in e)t.push(n);return t},e.prototype.getValues=function(){return this._get()||{}},e}(),E=function(e,t){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},E(e,t)};function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}E(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var I=function(){return I=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},I.apply(this,arguments)};function C(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function S(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function R(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var N=function(e){function t(t){return e.call(this,"TODO => ".concat(t))||this}return T(t,e),t}(Error),O=function(e,t,n){if(void 0===t||void 0===n)return e.toUpperCase();var r=e.slice(t,n);return e=e.replace(r,(function(e){return e.toUpperCase()}))},M=function(e,t){void 0===t&&(t="utf-8");var n,r=0;if("utf-16"===t)for(var i=0,o=e.length;i<o;i++)r+=(n=e.charCodeAt(i))<=65535?2:4;else for(i=0,o=e.length;i<o;i++)r+=(n=e.charCodeAt(i))<127?1:n<=2047?2:n<=65535?3:4;return r},U=function(e,t){if(e=e.replace(/\?$/,""),!t)return e;var n=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).filter((function(e){return!!e}));return n.length?[e,n.join("&")].join("?"):e},w=function(e){return e.match(/\d+(\.\d+){2}/)[0]},A=function(e){if("browser"!==e.tag)return{type:e.tag,version:"UnKonw"};var t,n,r=navigator.userAgent,i={IE:/rv:([\d.]+)\) like Gecko|MSIE ([\d.]+)/,Edge:/Edge\/([\d.]+)/,Firefox:/Firefox\/([\d.]+)/,Opera:/(?:OPERA|OPR).([\d.]+)/,WeChat:/MicroMessenger\/([\d.]+)/,QQBrowser:/QQBrowser\/([\d.]+)/,Chrome:/Chrome\/([\d.]+)/,Safari:/Version\/([\d.]+).*Safari/,iOSChrome:/Mobile\/([\d.]+).*Safari/};for(var o in i)if(i.hasOwnProperty(o)){var s=r.match(i[o]);if(s){n=o,t=s[1]||s[2];break}}return{type:n||"UnKonw",version:t||"UnKonw"}},b=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},L=function(){var e=b();if(e=e.replace(/-/g,"")+"a",(e=function(e){var t="0123456789abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZa0".split(""),n=t.length+1,r=+e,i=[];do{var o=r%n;r=(r-o)/n,i.unshift(t[o])}while(r);return i.join("")}(e=parseInt(e,16))).length>22&&(e=e.slice(0,22)),e.length<22)for(var t=22-e.length,n=0;n<t;n++)e+="0";return e},P=function(e){var t="RCDeviceId",n=v(e),r="",i=n.get(t);return i?r=i:(r=L(),n.set(t,r)),r},D="RC_Logs";function x(e){var t=e.target.result;1===e.oldVersion&&t.deleteObjectStore(D),function(e,t,n){var r;if(!e.objectStoreNames.contains(t)){var i=I({},n.objectStoreParams);r=e.createObjectStore(t,i),n.indexs&&n.indexs.length>0&&n.indexs.forEach((function(e){r.createIndex(e.indexName,e.key,{unique:e.unique})}))}}(t,D,{indexs:[{indexName:"time",key:"time",unique:!1}],objectStoreParams:{autoIncrement:!0}})}var V,k,B,G,j,q=function(){function e(){}return e.init=function(){if("undefined"!=typeof window&&window&&window.indexedDB){var t=window.indexedDB.open("RC_ENGINE_DB",2);t.onerror=function(e){console.warn("open indexDB request failed "+e.target.error)},t.onsuccess=function(t){e._db=t.target.result,e._db&&(e._db.onclose=function(t){var n;console.warn("The database ".concat(null===(n=e._db)||void 0===n?void 0:n.name," has unexpectedly closed."),t),e._db=null,window.__RCIndexDBInstance=null},e._db.onerror=function(t){var n;console.warn("The database ".concat(null===(n=e._db)||void 0===n?void 0:n.name," has opening error."),t),e._db=null,window.__RCIndexDBInstance=null},e._db.onabort=function(t){var n;console.warn("The database ".concat(null===(n=e._db)||void 0===n?void 0:n.name," has opening aborted."),t),e._db=null,window.__RCIndexDBInstance=null}),window.__RCIndexDBInstance=new e},t.onupgradeneeded=function(t){e._db=t.target.result,x(t)}}else console.debug("IndexDB is not currently supported in the environment!")},e.getInstance=function(){return window&&window.__RCIndexDBInstance?window.__RCIndexDBInstance:null},e.prototype.addList=function(t,n){return new Promise((function(r){if(e._db){var i=e._db.transaction([t],"readwrite"),o=i.objectStore(t);n.forEach((function(e){null==o||o.add(e)})),i.oncomplete=function(e){r(!0)},i.onerror=function(e){r(!1)}}else r(!1)}))},e.prototype.getRangeData=function(t,n,r,i){return new Promise((function(o){if(e._db){var s=e._db.transaction([t],"readwrite").objectStore(t),a=IDBKeyRange.bound(r,i),c=s.index(n),u=[],d=c.openCursor(a);d.onsuccess=function(e){var t=e.target.result;t?(u.push(t.value),t.continue()):o(u)},d.onerror=function(e){console.error(e),o([])}}else o([])}))},e.prototype.getCount=function(t,n){return new Promise((function(n){if(e._db){var r=e._db.transaction([t],"readonly").objectStore(t).count();r.onsuccess=function(){n(r.result)},r.onerror=function(e){console.error(e),n(0)}}else n(0)}))},e.prototype.removeFirstData=function(t,n,r){return new Promise((function(n){if(e._db){var i=e._db.transaction([t],"readwrite").objectStore(t),o=i.getAllKeys(IDBKeyRange.lowerBound(0),r);o.onsuccess=function(){var e=o.result;e.length>0&&(i.delete(IDBKeyRange.bound(e[0],e[e.length-1])).onsuccess=function(){n(!0)})}}else n(!1)}))},e._db=null,e}(),F=function(){function e(){}return e.compress=function(e){for(var t=this,n={},r=0;r<e.length-1;r++){var i=e.charAt(r)+e.charAt(r+1);n.hasOwnProperty(i)?n[i].push(r):n[i]=[r]}for(var o=[],s=[],a=function(){if(s.length>0){var e=s.join("");if(s=[],e.length>26){var n=t.numberEncode(e.length),r=String.fromCharCode(t.dataType.NormalExt|n.length);o.push(r+n)}else{var i=String.fromCharCode(t.dataType.Normal|e.length);o.push(i)}o.push(e)}},c=0;c<e.length;){var u=t.indexOf(n,e,c);if(u.length<2)s.push(e.charAt(c++));else if(u.length<4)s.push(e.substr(c,u.length)),c+=u.length;else{var d=t.numberEncode(c-u.offset),l=t.numberEncode(u.length);if(d.length+l.length>=u.length)s.push(e.substr(c,u.length)),c+=u.length;else{a();var h=String.fromCharCode(t.dataType.Compressed|d.length<<2|l.length);o.push(h+d+l),c+=u.length}}}a();var f=t.numberEncode(e.length),g=String.fromCharCode(t.dataType.Tail|f.length);return o.push(g+f),o.join("")},e.uncompress=function(e){var t=this,n=0,r="";e:do{var i=e.charCodeAt(n++),o=i&t.dataType.Mark,s=15&i,a=void 0;switch(o){case t.dataType.Compressed:var c=s>>2,u=3&s;if(0===c||0===u)throw new Error("Data parsing error,at "+n);var d=t.numberDecode(e.substr(n,c)),l=t.numberDecode(e.substr(n+=c,u));if((d=r.length-d)+l>r.length)throw new Error("Data parsing error,at "+n);n+=u,r+=r.substr(d,l);break;case t.dataType.Tail:if((a=t.numberDecode(e.substr(n,s)))!==r.length)throw console.log(r.length),console.log(a),new Error("Data parsing error,at "+n);n+=s;break e;case t.dataType.NormalExt:a=t.numberDecode(e.substr(n,s)),r+=e.substr(n+=s,a),n+=a;break;case t.dataType.Normal:r+=e.substr(n,s),n+=s;break;case t.dataType.Mark:if(s>10)throw new Error("Data parsing error,at "+n);r+=e.substr(n,16+s),n+=16+s;break;default:throw new Error("Data parsing error,at "+n+" header:"+o)}}while(n<e.length);return r},e.indexOf=function(e,t,n){var r={length:0,offset:-1};if(t.length,n>=t.length-1)return r;var i=e[t.charAt(n)+t.charAt(n+1)];if(i[0]===n)return r;for(var o=t.length-n,s=0,a=i.length;s<a;s++){var c=i[s],u=n-c;if(!(u>this.max)){var d=Math.min(o,u);if(d<=r.length)break;if(!(r.length>2&&t.charAt(c+r.length-1)!==t.charAt(n+r.length-1))){for(var l=2,h=l;h<d&&t.charAt(c+h)===t.charAt(n+h);h++)l++;l>=r.length&&(r.length=l,r.offset=c)}}}return r},e.numberEncode=function(e){var t=this,n=[],r=0;do{r=e%t.scale,n.push(t.chars.charAt(r)),e=(e-r)/t.scale}while(e>0);return n.join("")},e.numberDecode=function(e){for(var t=0,n=0,r=e.length-1;r>=0;r--){if(-1===(n=this.chars.indexOf(e.charAt(r))))throw new Error('decode number error, data is "'+e+'"');t=t*this.scale+n}return t},e.dataType={Tail:48,Compressed:64,NormalExt:80,Normal:96,Mark:112},e.chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",e.scale=e.chars.length,e.max=238327,e}(),H=function(){function e(e){this.info=e,this.logUrl="logcollection.ronghub.com",this.level=1,this.itv=30,this.times=5,this.deviceId="",this.deviceInfo="",this.logSwitch=0,this.logUrl=e.logPolicy.url||this.logUrl,this.level=e.logPolicy.level||this.level,this.itv=e.logPolicy.itv||this.itv,this.times=e.logPolicy.times||this.times,this.deviceId=P(e.runtime),this.logSwitch=e.logSwitch;var t=A(e.runtime);this.deviceInfo="".concat(t.type,"|").concat(t.version,"|").concat(null==e?void 0:e.sessionId)}return e.prototype.updateUploadLogAttr=function(e){var t=e.logPolicy,n=e.logSwitch,r=e.runtime,i=e.sessionId,o=void 0===i?"":i,s=e.userId;if(t){var a=t.url,c=t.level,u=t.itv,d=t.times;this.logUrl=a||this.logUrl,this.level=c||this.level,this.itv=u||this.itv,this.times=d||this.times}if(n&&(this.logSwitch=n),r){this.deviceId=P(r);var l=A(r);this.deviceInfo="".concat(l.type,"|").concat(l.version,"|").concat(o)}s&&(this.info.userId=s)},e.init=function(t){return e.reportSwitch=!0,e._instance||(e._instance=new e(t)),e._instance},e.getInstance=function(){return e._instance},e.prototype.reportRealtimeLog=function(t){var n=this;if(0===t.length||!this.logUrl)return Promise.resolve();var r=F.compress(t.map((function(e){return e.content})).join("")),i=oe(this.logUrl)?"":"https://",o="".concat(i).concat(this.logUrl,"?version=").concat(this.info.version,"&appkey=").concat(this.info.appkey,"&userId=").concat(this.info.userId,"&deviceId=").concat(this.deviceId,"&deviceInfo=").concat(this.deviceInfo,"&platform=Web");return this.info.runtime.httpReq({method:"POST",url:o,body:r}).then((function(t){var r=t.data;r&&(r=JSON.parse(r),n.itv=r.nextTime,n.level=r.level,n.logSwitch=r.logSwitch,e.currentRTTimes=1)}))},e.prototype.reportFullLog=function(t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l,h=this;return S(this,(function(f){switch(f.label){case 0:return n=t.startTime,r=t.endTime,i=t.platform,o=t.logId,s=t.uri,a=q.getInstance(),"web"===i.toLowerCase()&&a?n>r?[2]:[4,a.getRangeData(D,"time",n,r)]:[2];case 1:return c=(c=f.sent()).filter((function(e){return!e.userId||e.userId===h.info.userId})),u=F.compress(c.map((function(e){return e.content})).join("")||"no data"),5e3,d=1,[2,(l=function(){if(d>3||!e.reportSwitch)return Promise.resolve();var t=s||h.logUrl,n=oe(t)?"":"https://",r="".concat(n).concat(t,"?version=").concat(h.info.version,"&appkey=").concat(h.info.appkey,"&userId=").concat(h.info.userId,"&logId=").concat(o,"&deviceId=").concat(h.deviceId,"&deviceInfo=").concat(h.deviceInfo,"&platform=Web"),i=5e3*(d-1);return d++,new Promise((function(t,n){setTimeout((function(){e.reportSwitch&&h.info.runtime.httpReq({url:r,method:"POST",body:u}).then((function(){t()})).catch((function(e){n(e),l()}))}),i)}))})()]}}))}))},e.prototype.distroy=function(){e.currentRTTimes=1,e.reportSwitch=!1},e.currentRTTimes=1,e.reportSwitch=!1,e}();e.LogLevel=void 0,(V=e.LogLevel||(e.LogLevel={}))[V.LOG=0]="LOG",V[V.DEBUG=0]="DEBUG",V[V.INFO=1]="INFO",V[V.WARN=2]="WARN",V[V.ERROR=3]="ERROR",V[V.FATAL=4]="FATAL",V[V.STATISTICS=6]="STATISTICS",V[V.NONE=1e3]="NONE",function(e){e.IM="IM",e.RTC="RTC"}(k||(k={})),function(e){e[e.PRIVATE=1]="PRIVATE",e[e.OPEN=0]="OPEN"}(B||(B={})),function(e){e[e.NAVI=1]="NAVI",e[e.TCP=2]="TCP",e[e.WS=3]="WS"}(G||(G={})),function(e){e[e.NONE=0]="NONE",e[e.PRIVATE=1]="PRIVATE",e[e.DISCUSSION=2]="DISCUSSION",e[e.GROUP=3]="GROUP",e[e.CHATROOM=4]="CHATROOM",e[e.CUSTOMER_SERVICE=5]="CUSTOMER_SERVICE",e[e.SYSTEM=6]="SYSTEM",e[e.APP_PUBLIC_SERVICE=7]="APP_PUBLIC_SERVICE",e[e.PUBLIC_SERVICE=8]="PUBLIC_SERVICE",e[e.ULTRA_GROUP=10]="ULTRA_GROUP",e[e.RTC_ROOM=12]="RTC_ROOM"}(j||(j={}));var K,Y=j;!function(e){e[e.IMAGE=1]="IMAGE",e[e.AUDIO=2]="AUDIO",e[e.VIDEO=3]="VIDEO",e[e.FILE=4]="FILE",e[e.SIGHT=5]="SIGHT",e[e.COMBINE_HTML=6]="COMBINE_HTML"}(K||(K={}));var Q,W=K,J=function(e){return"string"==typeof e},z=function(e){return"boolean"==typeof e},X=function(e){return"number"==typeof e&&!isNaN(e)},Z=function(e){return-1!==Object.prototype.toString.call(e).indexOf("Array")},$=function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)},ee=function(e){return J(e)&&e.length>0},te=function(e){return"[object Object]"===Object.prototype.toString.call(e)},ne=function(e){return"[object Function]"===Object.prototype.toString.call(e)},re=function(e){return void 0===e||"[object Undefined]"===Object.prototype.toString.call(e)},ie=function(e){return"[object Null]"===Object.prototype.toString.call(e)},oe=function(e){return J(e)&&/https?:\/\//.test(e)},se=function(e){for(var t in e)return!0;return!1},ae=function(e){return X(e)&&Object.prototype.hasOwnProperty.call(Y,e)},ce=function(e){return X(e)&&Object.prototype.hasOwnProperty.call(W,e)},ue=function(e){var t=!1,n=!1,r=!1;if(te(e)){var i=Object.keys(e).length;for(var o in t=i>20,e)if(n||(n=J(o)&&!/^[A-Za-z0-9_=+-]+$/.test(o)),!r){var s=e[o];r=o.length>32||s.length>4096}}return{isExceedLimit:t,isIllgalEx:n,isExKeyOrValLengthExceedLimit:r}},de={};console&&((Q={})[e.LogLevel.DEBUG]=console.debug.bind(console),Q[e.LogLevel.INFO]=console.info.bind(console),Q[e.LogLevel.WARN]=console.warn.bind(console),Q[e.LogLevel.ERROR]=console.error.bind(console),Q[e.LogLevel.FATAL]=console.log.bind(console),de=Q);var le,he=function(e){return J(e)||X(e)||re(e)||z(e)?e:e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},fe=function(){function t(t,n,r){this.tag=t,this.type=n,this.initiator=r,this._outLevel=e.LogLevel.WARN,this.debug=this.log.bind(this,e.LogLevel.DEBUG),this.info=this.log.bind(this,e.LogLevel.INFO),this.warn=this.log.bind(this,e.LogLevel.WARN),this.error=this.log.bind(this,e.LogLevel.ERROR),this.fatal=this.log.bind(this,e.LogLevel.FATAL),this.statisticsCaches={},this.baseStatisData={sdkPrivate:B.OPEN,serverPrivate:B.OPEN,bundleId:"lib-next"}}return t.init=function(e){t.userId=e},t.reset=function(){t.userId=""},t.prototype._defaultStdout=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];de[e]&&de[e].apply(de,R(["".concat(t,":")],n,!1))},t.prototype.__pushLocalLog=function(n,r,i){var o;o=this.type?this.type:["RCRTCLog","RCCall","RCRTC","RTC-A"].includes(this.tag)?k.RTC:k.IM;var s=Date.now();M(r)>=1e3&&(r=function(e,t,n){if(void 0===n&&(n="utf-8"),!e||!t)return"";var r="utf-8"===n?3:2,i=0,o=0,s="";for(o=0;o<e.length;o++){if(e.charCodeAt(o)>255?i+=r:i++,i>t)return s;s+=e.charAt(o)}return e}(r,1e3));var a=JSON.stringify({message:r,userId:t.userId}).replace(/"/g,'""'),c=/^[\w]+-[\w]+-[\w]+?/.test(i)?i:"".concat(this.initiator||"L","-").concat(i,"-O"),u={sessionId:t.sessionId,time:s,level:4-n,content:"".concat(t.sessionId,",").concat(Date.now(),",").concat(o,",").concat(4-n,",").concat(c,',"').concat(a,'"\n'),userId:t.userId};t.databaseLogList.push(u),(t.databaseLogList.length>=100||n===e.LogLevel.FATAL)&&this.__insertLogIntoDatabase()},t.prototype.__insertLogIntoDatabase=function(){return C(this,void 0,void 0,(function(){var e,n,r;return S(this,(function(i){switch(i.label){case 0:return e=R([],t.databaseLogList,!0),t.databaseLogList=[],(n=q.getInstance())?[4,n.addList(D,e)]:[3,3];case 1:return r=i.sent(),[4,n.getCount(D,"time")];case 2:return i.sent()>1e5&&n.removeFirstData(D,"time",2e3),[2,r];case 3:return[2,!1]}}))}))},t.prototype.setLogLevel=function(t){this._outLevel="number"!=typeof t?e.LogLevel.WARN:t},t.prototype.setLogStdout=function(e){this._logStdout=e},t.prototype.log=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t>e.LogLevel.DEBUG&&this.__pushLocalLog(t,n.map(he).join(" "),this.tag),!(t<this._outLevel)){var i="".concat((new Date).toISOString(),"[").concat(this.tag,"][").concat(e.LogLevel[t],"]"),o="".concat(i," - ").concat(n.map(he).join(" "));this._logStdout?this._logStdout(t,o):this._stdout?this._stdout(t,o):this._defaultStdout.apply(this,R([t,i],n,!1))}},t.prototype.reportLog=function(e,n,r){this.__pushLocalLog(4-e,r,n);var i=JSON.stringify({message:r}).replace(/"/g,'""');i='"'.concat(i,'"');var o={level:e,content:[t.sessionId,Date.now(),this.type,e,n,i].join()+"\n"};t.realTimeLogList.push(o),t.realTimeLogList.length>=600&&(t.realTimeLogList=t.realTimeLogList.slice(-500))},t.prototype.set=function(e,t){this.warn("logger.set has being deprecated!")},t.prototype.setStdout=function(e){this._stdout=e},t.prototype.__clearRealTimeLog=function(){t.realTimeLogList=[]},t.prototype.initReportLog=function(e){t._reportLog=H.init(I(I({},e),{sessionId:t.sessionId})),this.startReport()},t.prototype.updateUploadLogAttr=function(e){t._reportLog&&t._reportLog.updateUploadLogAttr(e)},t.prototype.startReport=function(){var e=this;if(t._reportLog&&t._reportLog.logSwitch&&H.reportSwitch){var n=t._reportLog.itv*Math.pow(2,H.currentRTTimes-1);H.currentRTTimes<t._reportLog.times&&H.currentRTTimes++,setTimeout((function(){var n=t.realTimeLogList.filter((function(e){return e.level<=t._reportLog.level}));0===n.length?e.startReport():t._reportLog.reportRealtimeLog(n).then((function(){e.__clearRealTimeLog(),e.debug("report real-time log success"),e.startReport()})).catch((function(t){e.debug("report real-time log error -> "+t),e.startReport()}))}),1e3*n)}},t.prototype.reportStatisticsLog=function(n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u=this;return S(this,(function(d){return n&&t._reportLog?(r=te(r)?JSON.stringify(r):r,i=4-e.LogLevel.STATISTICS,this.__pushLocalLog(i,String(r),n),o=JSON.stringify({message:r}).replace(/"/g,'""'),o='"'.concat(o,'"'),s=this.type,this.type||(s=["RCRTCLog","RCCall","RCRTC","RTC-A"].includes(this.tag)?k.RTC:k.IM),a={level:i,content:[t.sessionId,Date.now(),s,i,n,o].join()+"\n"},t.realTimeLogList.push(a),c=t.realTimeLogList.filter((function(e){return e.level<=t._reportLog.level})),this.__clearRealTimeLog(),t._reportLog.reportRealtimeLog(c).then((function(){u.debug("report real-time log success")})).catch((function(e){u.debug("report real-time log error -> "+e)})),[2]):[2]}))}))},t.prototype.updateStatisticsBaseData=function(e){this.baseStatisData.sdkPrivate=e.sdkPrivate===B.PRIVATE?B.PRIVATE:B.OPEN,this.baseStatisData.serverPrivate=e.serverPrivate===B.PRIVATE?B.PRIVATE:B.OPEN,e.bundleId&&(this.baseStatisData.bundleId=e.bundleId)},t.prototype.getStatisticsBaseData=function(){return this.baseStatisData},t.prototype.setStatisticsData=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1),te(t)&&e&&(this.statisticsCaches[e]&&!n||(this.statisticsCaches[e]={}),this.statisticsCaches[e]=I(I({},this.statisticsCaches[e]),t))},t.prototype.getStatisticsData=function(e){return this.statisticsCaches[e]||{}},t.databaseLogList=[],t.realTimeLogList=[],t.sessionId=L(),t.userId="",t}(),ge=new fe("RCLog"),pe=function(){function e(){this._map={}}return e.prototype.on=function(e,t,n){var r=this._map[e]||(this._map[e]=[]);r.some((function(e){return e.listener===t&&e.target===n}))||r.push({listener:t,target:n})},e.prototype.once=function(e,t,n){var r=this._map[e]||(this._map[e]=[]);r.some((function(e){return e.listener===t&&e.target===n}))||r.push({listener:t,target:n,once:!0})},e.prototype.off=function(e,t,n){var r=this._map[e];r&&((r=r.filter((function(e){return e.listener!==t||e.target!==n}))).length?this._map[e]=r:delete this._map[e])},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this._map[e];if(r)for(var i=r.length-1;i>=0;i-=1){var o=r[i],s=o.target,a=o.once,c=o.listener;a&&r.splice(i,1);try{c.call.apply(c,R([s],t,!1))}catch(e){ge.error(e)}}},e.prototype.removeAll=function(e){delete this._map[e]},e.prototype.clear=function(){Object.keys(this._map).forEach(this.removeAll,this)},e}();!function(e){e[e.SEND=1]="SEND",e[e.RECEIVE=2]="RECEIVE"}(le||(le={}));var me,ve=le;!function(e){e[e.TIMEOUT=-1]="TIMEOUT",e[e.UNKNOWN=-2]="UNKNOWN",e[e.PARAMETER_ERROR=-3]="PARAMETER_ERROR",e[e.EXTRA_METHOD_UNDEFINED=-4]="EXTRA_METHOD_UNDEFINED",e[e.MAIN_PROCESS_ERROR=-5]="MAIN_PROCESS_ERROR",e[e.PARAMETER_CHANGED=-6]="PARAMETER_CHANGED",e[e.SUCCESS=0]="SUCCESS",e[e.RC_MSG_UNAUTHORIZED=20406]="RC_MSG_UNAUTHORIZED",e[e.RC_DISCUSSION_GROUP_ID_INVALID=20407]="RC_DISCUSSION_GROUP_ID_INVALID",e[e.SEND_FREQUENCY_TOO_FAST=20604]="SEND_FREQUENCY_TOO_FAST",e[e.NOT_IN_DISCUSSION=21406]="NOT_IN_DISCUSSION",e[e.FORBIDDEN_IN_GROUP=22408]="FORBIDDEN_IN_GROUP",e[e.RECALL_MESSAGE=25101]="RECALL_MESSAGE",e[e.NOT_IN_GROUP=22406]="NOT_IN_GROUP",e[e.NOT_IN_CHATROOM=23406]="NOT_IN_CHATROOM",e[e.FORBIDDEN_IN_CHATROOM=23408]="FORBIDDEN_IN_CHATROOM",e[e.RC_CHATROOM_USER_KICKED=23409]="RC_CHATROOM_USER_KICKED",e[e.RC_CHATROOM_NOT_EXIST=23410]="RC_CHATROOM_NOT_EXIST",e[e.RC_CHATROOM_IS_FULL=23411]="RC_CHATROOM_IS_FULL",e[e.RC_CHATROOM_PATAMETER_INVALID=23412]="RC_CHATROOM_PATAMETER_INVALID",e[e.CHATROOM_GET_HISTORYMSG_ERROR=23413]="CHATROOM_GET_HISTORYMSG_ERROR",e[e.CHATROOM_NOT_OPEN_HISTORYMSG_STORE=23414]="CHATROOM_NOT_OPEN_HISTORYMSG_STORE",e[e.CHATROOM_KV_EXCEED=23423]="CHATROOM_KV_EXCEED",e[e.CHATROOM_KV_OVERWRITE_INVALID=23424]="CHATROOM_KV_OVERWRITE_INVALID",e[e.CHATROOM_KV_STORE_NOT_OPEN=23426]="CHATROOM_KV_STORE_NOT_OPEN",e[e.CHATROOM_KEY_NOT_EXIST=23427]="CHATROOM_KEY_NOT_EXIST",e[e.CHATROOM_KV_SET_ERROR=23431]="CHATROOM_KV_SET_ERROR",e[e.SENSITIVE_SHIELD=21501]="SENSITIVE_SHIELD",e[e.SENSITIVE_REPLACE=21502]="SENSITIVE_REPLACE",e[e.JOIN_IN_DISCUSSION=21407]="JOIN_IN_DISCUSSION",e[e.CREATE_DISCUSSION=21408]="CREATE_DISCUSSION",e[e.INVITE_DICUSSION=21409]="INVITE_DICUSSION",e[e.GET_USERINFO_ERROR=23407]="GET_USERINFO_ERROR",e[e.REJECTED_BY_BLACKLIST=405]="REJECTED_BY_BLACKLIST",e[e.RC_NET_CHANNEL_INVALID=30001]="RC_NET_CHANNEL_INVALID",e[e.RC_NET_UNAVAILABLE=30002]="RC_NET_UNAVAILABLE",e[e.RC_MSG_RESP_TIMEOUT=30003]="RC_MSG_RESP_TIMEOUT",e[e.RC_HTTP_SEND_FAIL=30004]="RC_HTTP_SEND_FAIL",e[e.RC_HTTP_REQ_TIMEOUT=30005]="RC_HTTP_REQ_TIMEOUT",e[e.RC_HTTP_RECV_FAIL=30006]="RC_HTTP_RECV_FAIL",e[e.RC_NAVI_RESOURCE_ERROR=30007]="RC_NAVI_RESOURCE_ERROR",e[e.RC_NODE_NOT_FOUND=30008]="RC_NODE_NOT_FOUND",e[e.RC_DOMAIN_NOT_RESOLVE=30009]="RC_DOMAIN_NOT_RESOLVE",e[e.RC_SOCKET_NOT_CREATED=30010]="RC_SOCKET_NOT_CREATED",e[e.RC_SOCKET_DISCONNECTED=30011]="RC_SOCKET_DISCONNECTED",e[e.RC_PING_SEND_FAIL=30012]="RC_PING_SEND_FAIL",e[e.RC_PONG_RECV_FAIL=30013]="RC_PONG_RECV_FAIL",e[e.RC_MSG_SEND_FAIL=30014]="RC_MSG_SEND_FAIL",e[e.RC_MSG_CONTENT_EXCEED_LIMIT=30016]="RC_MSG_CONTENT_EXCEED_LIMIT",e[e.RC_CONN_ACK_TIMEOUT=31e3]="RC_CONN_ACK_TIMEOUT",e[e.RC_CONN_PROTO_VERSION_ERROR=31001]="RC_CONN_PROTO_VERSION_ERROR",e[e.RC_CONN_ID_REJECT=31002]="RC_CONN_ID_REJECT",e[e.RC_CONN_SERVER_UNAVAILABLE=31003]="RC_CONN_SERVER_UNAVAILABLE",e[e.RC_CONN_USER_OR_PASSWD_ERROR=31004]="RC_CONN_USER_OR_PASSWD_ERROR",e[e.RC_CONN_NOT_AUTHRORIZED=31005]="RC_CONN_NOT_AUTHRORIZED",e[e.RC_CONN_REDIRECTED=31006]="RC_CONN_REDIRECTED",e[e.RC_CONN_PACKAGE_NAME_INVALID=31007]="RC_CONN_PACKAGE_NAME_INVALID",e[e.RC_CONN_APP_BLOCKED_OR_DELETED=31008]="RC_CONN_APP_BLOCKED_OR_DELETED",e[e.RC_CONN_USER_BLOCKED=31009]="RC_CONN_USER_BLOCKED",e[e.RC_DISCONN_KICK=31010]="RC_DISCONN_KICK",e[e.RC_DISCONN_EXCEPTION=31011]="RC_DISCONN_EXCEPTION",e[e.RC_APP_AUTH_NOT_PASS=31026]="RC_APP_AUTH_NOT_PASS",e[e.RC_OTP_USED=31027]="RC_OTP_USED",e[e.RC_PLATFORM_ERROR=31028]="RC_PLATFORM_ERROR",e[e.RC_QUERY_ACK_NO_DATA=32001]="RC_QUERY_ACK_NO_DATA",e[e.RC_MSG_DATA_INCOMPLETE=32002]="RC_MSG_DATA_INCOMPLETE",e[e.BIZ_ERROR_CLIENT_NOT_INIT=33001]="BIZ_ERROR_CLIENT_NOT_INIT",e[e.BIZ_ERROR_DATABASE_ERROR=33002]="BIZ_ERROR_DATABASE_ERROR",e[e.BIZ_ERROR_INVALID_PARAMETER=33003]="BIZ_ERROR_INVALID_PARAMETER",e[e.BIZ_ERROR_NO_CHANNEL=33004]="BIZ_ERROR_NO_CHANNEL",e[e.BIZ_ERROR_RECONNECT_SUCCESS=33005]="BIZ_ERROR_RECONNECT_SUCCESS",e[e.BIZ_ERROR_CONNECTING=33006]="BIZ_ERROR_CONNECTING",e[e.MSG_ROAMING_SERVICE_UNAVAILABLE=33007]="MSG_ROAMING_SERVICE_UNAVAILABLE",e[e.MSG_INSERT_ERROR=33008]="MSG_INSERT_ERROR",e[e.MSG_DEL_ERROR=33009]="MSG_DEL_ERROR",e[e.TAG_EXISTS=33101]="TAG_EXISTS",e[e.TAG_NOT_EXIST=33100]="TAG_NOT_EXIST",e[e.NO_TAG_IN_CONVER=33102]="NO_TAG_IN_CONVER",e[e.CONVER_REMOVE_ERROR=34001]="CONVER_REMOVE_ERROR",e[e.CONVER_GETLIST_ERROR=34002]="CONVER_GETLIST_ERROR",e[e.CONVER_SETOP_ERROR=34003]="CONVER_SETOP_ERROR",e[e.CONVER_TOTAL_UNREAD_ERROR=34004]="CONVER_TOTAL_UNREAD_ERROR",e[e.CONVER_TYPE_UNREAD_ERROR=34005]="CONVER_TYPE_UNREAD_ERROR",e[e.CONVER_ID_TYPE_UNREAD_ERROR=34006]="CONVER_ID_TYPE_UNREAD_ERROR",e[e.CONVER_CLEAR_ERROR=34007]="CONVER_CLEAR_ERROR",e[e.EXPANSION_LIMIT_EXCEET=34010]="EXPANSION_LIMIT_EXCEET",e[e.MESSAGE_KV_NOT_SUPPORT=34008]="MESSAGE_KV_NOT_SUPPORT",e[e.CLEAR_HIS_TIME_ERROR=34011]="CLEAR_HIS_TIME_ERROR",e[e.CONVER_OUT_LIMIT_ERROR=34013]="CONVER_OUT_LIMIT_ERROR",e[e.CONVER_GET_ERROR=35021]="CONVER_GET_ERROR",e[e.GROUP_SYNC_ERROR=35001]="GROUP_SYNC_ERROR",e[e.GROUP_MATCH_ERROR=35002]="GROUP_MATCH_ERROR",e[e.READ_RECEIPT_ERROR=35003]="READ_RECEIPT_ERROR",e[e.PACKAGE_ENVIRONMENT_ERROR=35006]="PACKAGE_ENVIRONMENT_ERROR",e[e.CAN_NOT_RECONNECT=35007]="CAN_NOT_RECONNECT",e[e.SERVER_UNAVAILABLE=35008]="SERVER_UNAVAILABLE",e[e.HOSTNAME_ERROR=35009]="HOSTNAME_ERROR",e[e.HAS_OHTER_SAME_CLIENT_ON_LINE=35010]="HAS_OHTER_SAME_CLIENT_ON_LINE",e[e.METHOD_NOT_AVAILABLE=35011]="METHOD_NOT_AVAILABLE",e[e.METHOD_NOT_SUPPORT=35012]="METHOD_NOT_SUPPORT",e[e.MSG_LIMIT_ERROR=35013]="MSG_LIMIT_ERROR",e[e.METHOD_ONLY_SUPPORT_ULTRA_GROUP=35014]="METHOD_ONLY_SUPPORT_ULTRA_GROUP",e[e.UPLOAD_FILE_FAILED=35020]="UPLOAD_FILE_FAILED",e[e.CHATROOM_ID_ISNULL=36001]="CHATROOM_ID_ISNULL",e[e.CHARTOOM_JOIN_ERROR=36002]="CHARTOOM_JOIN_ERROR",e[e.CHATROOM_HISMESSAGE_ERROR=36003]="CHATROOM_HISMESSAGE_ERROR",e[e.CHATROOM_KV_NOT_FOUND=36004]="CHATROOM_KV_NOT_FOUND",e[e.BLACK_ADD_ERROR=37001]="BLACK_ADD_ERROR",e[e.BLACK_GETSTATUS_ERROR=37002]="BLACK_GETSTATUS_ERROR",e[e.BLACK_REMOVE_ERROR=37003]="BLACK_REMOVE_ERROR",e[e.DRAF_GET_ERROR=38001]="DRAF_GET_ERROR",e[e.DRAF_SAVE_ERROR=38002]="DRAF_SAVE_ERROR",e[e.DRAF_REMOVE_ERROR=38003]="DRAF_REMOVE_ERROR",e[e.SUBSCRIBE_ERROR=39001]="SUBSCRIBE_ERROR",e[e.NOT_SUPPORT=39002]="NOT_SUPPORT",e[e.QNTKN_FILETYPE_ERROR=41001]="QNTKN_FILETYPE_ERROR",e[e.QNTKN_GET_ERROR=41002]="QNTKN_GET_ERROR",e[e.COOKIE_ENABLE=51001]="COOKIE_ENABLE",e[e.GET_MESSAGE_BY_ID_ERROR=61001]="GET_MESSAGE_BY_ID_ERROR",e[e.HAVNODEVICEID=24001]="HAVNODEVICEID",e[e.DEVICEIDISHAVE=24002]="DEVICEIDISHAVE",e[e.FEILD=24009]="FEILD",e[e.VOIPISNULL=24013]="VOIPISNULL",e[e.NOENGINETYPE=24010]="NOENGINETYPE",e[e.NULLCHANNELNAME=24011]="NULLCHANNELNAME",e[e.VOIPDYANMICERROR=24012]="VOIPDYANMICERROR",e[e.NOVOIP=24014]="NOVOIP",e[e.INTERNALERRROR=24015]="INTERNALERRROR",e[e.VOIPCLOSE=24016]="VOIPCLOSE",e[e.CLOSE_BEFORE_OPEN=51001]="CLOSE_BEFORE_OPEN",e[e.ALREADY_IN_USE=51002]="ALREADY_IN_USE",e[e.INVALID_CHANNEL_NAME=51003]="INVALID_CHANNEL_NAME",e[e.VIDEO_CONTAINER_IS_NULL=51004]="VIDEO_CONTAINER_IS_NULL",e[e.DELETE_MESSAGE_ID_IS_NULL=61001]="DELETE_MESSAGE_ID_IS_NULL",e[e.CANCEL=1]="CANCEL",e[e.REJECT=2]="REJECT",e[e.HANGUP=3]="HANGUP",e[e.BUSYLINE=4]="BUSYLINE",e[e.NO_RESPONSE=5]="NO_RESPONSE",e[e.ENGINE_UN_SUPPORTED=6]="ENGINE_UN_SUPPORTED",e[e.NETWORK_ERROR=7]="NETWORK_ERROR",e[e.REMOTE_CANCEL=11]="REMOTE_CANCEL",e[e.REMOTE_REJECT=12]="REMOTE_REJECT",e[e.REMOTE_HANGUP=13]="REMOTE_HANGUP",e[e.REMOTE_BUSYLINE=14]="REMOTE_BUSYLINE",e[e.REMOTE_NO_RESPONSE=15]="REMOTE_NO_RESPONSE",e[e.REMOTE_ENGINE_UN_SUPPORTED=16]="REMOTE_ENGINE_UN_SUPPORTED",e[e.REMOTE_NETWORK_ERROR=17]="REMOTE_NETWORK_ERROR",e[e.VOIP_NOT_AVALIABLE=18]="VOIP_NOT_AVALIABLE",e[e.CHATROOM_KV_STORE_NOT_ALL_SUCCESS=23428]="CHATROOM_KV_STORE_NOT_ALL_SUCCESS",e[e.CHATROOM_KV_STORE_OUT_LIMIT=23429]="CHATROOM_KV_STORE_OUT_LIMIT"}(me||(me={}));var _e,ye=me;!function(e){e[e.CONNECTED=0]="CONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.DISCONNECTED=2]="DISCONNECTED",e[e.NETWORK_UNAVAILABLE=3]="NETWORK_UNAVAILABLE",e[e.CONNECTION_CLOSED=4]="CONNECTION_CLOSED",e[e.KICKED_OFFLINE_BY_OTHER_CLIENT=6]="KICKED_OFFLINE_BY_OTHER_CLIENT",e[e.WEBSOCKET_UNAVAILABLE=7]="WEBSOCKET_UNAVAILABLE",e[e.WEBSOCKET_ERROR=8]="WEBSOCKET_ERROR",e[e.BLOCKED=9]="BLOCKED",e[e.DOMAIN_INCORRECT=12]="DOMAIN_INCORRECT",e[e.DISCONNECT_BY_SERVER=13]="DISCONNECT_BY_SERVER",e[e.REDIRECT=14]="REDIRECT",e[e.APPKEY_IS_FAKE=20]="APPKEY_IS_FAKE",e[e.ULTRALIMIT=1101]="ULTRALIMIT",e[e.REQUEST_NAVI=201]="REQUEST_NAVI",e[e.RESPONSE_NAVI=202]="RESPONSE_NAVI",e[e.RESPONSE_NAVI_ERROR=203]="RESPONSE_NAVI_ERROR",e[e.RESPONSE_NAVI_TIMEOUT=204]="RESPONSE_NAVI_TIMEOUT"}(_e||(_e={}));var Ee,Te=_e,Ie={ACCEPTED:0,UNACCEPTABLE_PROTOCOL_VERSION:1,IDENTIFIER_REJECTED:2,SERVER_UNAVAILABLE:3,TOKEN_INCORRECT:4,NOT_AUTHORIZED:5,REDIRECT:6,PACKAGE_ERROR:7,APP_BLOCK_OR_DELETE:8,BLOCK:9,TOKEN_EXPIRE:10,DEVICE_ERROR:11,HOSTNAME_ERROR:12,HASOHTERSAMECLIENTONLINE:13,IN_OTHER_CLUSTER:15,APP_AUTH_NOT_PASS:16,OTP_USED:17,PLATFORM_ERROR:18};!function(e){e.TextMessage="RC:TxtMsg",e.VOICE="RC:VcMsg",e.HQ_VOICE="RC:HQVCMsg",e.IMAGE="RC:ImgMsg",e.GIF="RC:GIFMsg",e.RICH_CONTENT="RC:ImgTextMsg",e.LOCATION="RC:LBSMsg",e.FILE="RC:FileMsg",e.SIGHT="RC:SightMsg",e.COMBINE="RC:CombineMsg",e.CHRM_KV_NOTIFY="RC:chrmKVNotiMsg",e.LOG_COMMAND="RC:LogCmdMsg",e.EXPANSION_NOTIFY="RC:MsgExMsg",e.REFERENCE="RC:ReferenceMsg",e.RECALL="RC:RcCmd",e.READ_RECEIPT="RC:ReadNtf",e.READ_RECEIPT_REQUEST="RC:RRReqMsg",e.READ_RECEIPT_RESPONSE="RC:RRRspMsg",e.SYNC_READ_STATUS="RC:SRSMsg",e.GROUP_READ_RECEIPT_REQUEST="RC:RRMsg",e.CHATROOM_JOIN="RC:ChrmJoinNtf",e.CHATROOM_LEFT="RC:ChrmQuitNtf",e.CHATROOM_MERGE_CHANGE="RC:ChrmMemChange",e.TYPING_STATUS="RC:TypSts",e.INTERCEPT="RC:InterceptMsg"}(Ee||(Ee={}));var Ce,Se=Ee;!function(e){e[e.OPEN=1]="OPEN",e[e.CLOSE=2]="CLOSE"}(Ce||(Ce={}));var Re,Ne=Ce;!function(e){e[e.ALL_MESSAGE=-1]="ALL_MESSAGE",e[e.NOT_SET=0]="NOT_SET",e[e.AT_MESSAGE_NOTIFICATION=1]="AT_MESSAGE_NOTIFICATION",e[e.AT_USER_NOTIFICATION=2]="AT_USER_NOTIFICATION",e[e.AT_GROUP_ALL_USER_NOFICATION=4]="AT_GROUP_ALL_USER_NOFICATION",e[e.NOT_MESSAGE_NOTIFICATION=5]="NOT_MESSAGE_NOTIFICATION"}(Re||(Re={}));var Oe,Me=Re;!function(e){e[e.ALL=1]="ALL",e[e.SINGAL=2]="SINGAL"}(Oe||(Oe={}));var Ue,we=Oe;!function(e){e[e.QINIU=1]="QINIU",e[e.ALI=2]="ALI",e[e.AWS=3]="AWS",e[e.STC=4]="STC"}(Ue||(Ue={}));var Ae,be=Ue;!function(e){e[e.UPDATE=1]="UPDATE",e[e.DELETE=2]="DELETE"}(Ae||(Ae={}));var Le,Pe=Ae;!function(e){e[e.QUIT=0]="QUIT",e[e.JOIN=1]="JOIN"}(Le||(Le={}));var De,xe=Le;!function(e){e[e.GLOBAL=1]="GLOBAL",e[e.CUSTOM=2]="CUSTOM",e[e.THIRD_PARTY=3]="THIRD_PARTY"}(De||(De={}));var Ve,ke=De;!function(e){e[e.typing=0]="typing"}(Ve||(Ve={}));var Be,Ge,je,qe=Ve;!function(e){e[e.RTC=0]="RTC",e[e.LIVE=2]="LIVE"}(Be||(Be={})),function(e){e[e.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",e[e.AUDIO=1]="AUDIO"}(Ge||(Ge={})),function(e){e[e.ANCHOR=1]="ANCHOR",e[e.AUDIENCE=2]="AUDIENCE"}(je||(je={}));var Fe,He,Ke,Ye={"RC:VCAccept":"RC:VCAccept","RC:VCRinging":"RC:VCRinging","RC:VCSummary":"RC:VCSummary","RC:VCHangup":"RC:VCHangup","RC:VCInvite":"RC:VCInvite","RC:VCModifyMedia":"RC:VCModifyMedia","RC:VCModifyMem":"RC:VCModifyMem"};!function(e){e[e.ROOM=1]="ROOM",e[e.PERSON=2]="PERSON"}(Fe||(Fe={})),function(e){e[e.AnchorToViewer=1]="AnchorToViewer",e[e.ViewerToAnchor=2]="ViewerToAnchor"}(He||(He={})),function(e){e[e.KICK=0]="KICK",e[e.REFUSE=1]="REFUSE",e[e.COEXIST=2]="COEXIST"}(Ke||(Ke={}));var Qe="undefined"!=typeof window&&window?(window.__RCVersionInfo||(window.__RCVersionInfo={}),window.__RCVersionInfo):{};Qe.engine="5.3.0";var We,Je,ze=function(){function e(){}return e.add=function(e,t){Qe[e]=t},e.validEngine=function(e){var t=e.match(/\d+\.\d+\.\d+/);if(!t)return ge.warn("The validation engine version '".concat(e,"' is invalid!")),!1;var n=t[0].split(".").map((function(e){return e.padStart(3,"0")})).join("");return Qe.engine.match(/\d+\.\d+\.\d+/)[0].split(".").map((function(e){return e.padStart(3,"0")})).join("")>=n},e.getInfo=function(){return Qe},e}();!function(e){e[e.STRING=0]="STRING",e[e.ONLY_STRING=1]="ONLY_STRING",e[e.NUMBER=2]="NUMBER",e[e.BOOLEAN=3]="BOOLEAN",e[e.OBJECT=4]="OBJECT",e[e.ARRAY=5]="ARRAY",e[e.CALLBACK=6]="CALLBACK",e[e.CHANNEL_ID=7]="CHANNEL_ID"}(Je||(Je={}));var Xe,Ze,$e,et,nt,rt=((We={})[Je.STRING]=ee,We[Je.ONLY_STRING]=J,We[Je.NUMBER]=X,We[Je.BOOLEAN]=function(e){return"boolean"==typeof e},We[Je.OBJECT]=te,We[Je.ARRAY]=Z,We[Je.CALLBACK]=function(e){var t=!0;return te(e)||(t=!1),(e=e||{}).onSuccess&&!ne(e.onSuccess)&&(t=!1),e.onError&&!ne(e.onError)&&(t=!1),t},We[Je.CHANNEL_ID]=function(e){var t=!1;return J(e)&&!/_/g.test(e)&&e.length<=20&&(t=!0),t},We),it=function(e){function t(t){var n=e.call(this,t)||this;return n.name="RCAssertError",n}return T(t,e),t}(Error),ot=function(e,t,n,r){if(void 0===r&&(r=!1),!st(e,t,n,r))throw new it("'".concat(e,"' is invalid: ").concat(JSON.stringify(t)))},st=function(e,t,n,r){void 0===r&&(r=!1),n=rt[n]||n;var i=r&&!n(t)||!r&&!(re(t)||null===t||n(t));return i&&ge.error("'".concat(e,"' is invalid: ").concat(JSON.stringify(t))),!i},at=function(e){if(!te(e)||void 0===e.low||void 0===e.high)return e;var t=e.low;return t<0&&(t+=4294967296),t=t.toString(16),parseInt(e.high.toString(16)+"00000000".replace(new RegExp("0{"+t.length+"}$"),t),16)},ct=function(e,t){var n=Math.floor(1e3*Math.random()%1e4),r=b(),i=function(e){e=e||"-";var t=new Date,n=t.getFullYear(),r=t.getMonth()+1,i=t.getDate();return"".concat(n).concat(e).concat(r).concat(e).concat(i)}(),o=(new Date).getTime(),s="";if(t){var a=t.split(".");s="."+a[a.length-1]}return"".concat(e,"__RC-").concat(i,"_").concat(n,"_").concat(o).concat(r).concat(s)},ut=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var n=e.threadId,r=e.apnsCollapseId,i=e.category,o=e.richMediaUri,s=t.channelIdMi,a=t.channelIdHW,c=t.channelIdOPPO,u=t.typeVivo,d=t.googleConfig,l={};l["thread-id"]=n||"",l["apns-collapse-id"]=r||"",l.category=i||"",l.richMediaUri=o||"";var h={};h.collapse_key=null==d?void 0:d.collapseKey,h.imageUrl=null==d?void 0:d.imageUrl;var f=null==d?void 0:d.priority;f&&!["high","normal"].includes(f)&&(f="normal"),h.priority=f;var g=[{HW:{channelId:a||""}},{MI:{channelId:s||""}},{OPPO:{channelId:c||""}},{VIVO:{classification:u||""}},{APNS:l},{FCM:h}];return JSON.stringify(g)},dt=function(e,t){var n={},r={notificationId:t||""};if(!e)return{iOSConfig:n,androidConfig:r};try{var i=JSON.parse(e);null==i||i.forEach((function(e){var t,i,o,s,a=Object.keys(e);if(0!==a.length){var c=a[0];switch(c){case"HW":return void(r.channelIdHW=null===(t=e[c])||void 0===t?void 0:t.channelId);case"MI":return void(r.channelIdMi=null===(i=e[c])||void 0===i?void 0:i.channelId);case"OPPO":return void(r.channelIdOPPO=null===(o=e[c])||void 0===o?void 0:o.channelId);case"VIVO":return void(r.typeVivo=null===(s=e[c])||void 0===s?void 0:s.classification);case"APNS":return n.threadId=e[c]["thread-id"],n.apnsCollapseId=e[c]["apns-collapse-id"],n.category=e[c].category,void(n.richMediaUri=e[c].richMediaUri);case"FCM":r.googleConfig={collapseKey:e[c].collapse_key||"",imageUrl:e[c].imageUrl||"",priority:e[c].priority||""}}}}))}catch(t){ge.error("Wrong format for pushConfigs field! content: "+e)}return{iOSConfig:n,androidConfig:r}},lt=function(e){var t=/^[A-Za-z0-9_=+-]+$/.test(e),n=e.length;return t&&(n<=128&&n>=1)},ht=function(e){var t=e.length;return t<=4096&&t>=1},ft=function(e,t,n){t=t||function(){};var r=(n=n||{}).isReverse;te(e)&&function(){for(var n in e)t(e[n],n,e)}(),(Z(e)||J(e))&&function(){if(r)for(var n=e.length-1;n>=0;n--)t(e[n],n);else for(var i=0,o=e.length;i<o;i++)t(e[i],i)}()},gt=function(e,t){return ft(e,(function(n,r){e[r]=t(n,r)})),e},pt=function(e,t){if(e.indexOf)return e.indexOf(t);var n=-1;return ft(e,(function(e,r){t===e&&(n=r)})),n},mt=function(e,t){var n=[];return ft(e,(function(e){n.push(e)})),-1!==pt(n,t)},vt=function(e){return JSON.parse(JSON.stringify(e))},_t=function(){return"undefined"!=typeof RCCppEngine},yt=function(e){switch(e){case Ie.SERVER_UNAVAILABLE:return ye.SERVER_UNAVAILABLE;case Ie.TOKEN_INCORRECT:return ye.RC_CONN_USER_OR_PASSWD_ERROR;case Ie.REDIRECT:return ye.RC_CONN_REDIRECTED;case Ie.APP_BLOCK_OR_DELETE:return ye.RC_CONN_APP_BLOCKED_OR_DELETED;case Ie.BLOCK:return ye.RC_CONN_USER_BLOCKED;case Ie.TOKEN_EXPIRE:return ye.RC_CONN_USER_OR_PASSWD_ERROR;case Ie.HOSTNAME_ERROR:return ye.HOSTNAME_ERROR;case Ie.HASOHTERSAMECLIENTONLINE:return ye.HAS_OHTER_SAME_CLIENT_ON_LINE;case Ie.APP_AUTH_NOT_PASS:return ye.RC_APP_AUTH_NOT_PASS;case Ie.OTP_USED:return ye.RC_OTP_USED;case Ie.PLATFORM_ERROR:return ye.RC_PLATFORM_ERROR;default:return ye.RC_NET_UNAVAILABLE}},Et=function e(t){var n;if("object"===r(t))if(Array.isArray(t))for(var i in n=[],t)n.push(e(t[i]));else for(var i in n={},t)n[i]=e(t[i]);else n=t;return n},Tt=function(e){var t;try{t=Et(e)}catch(n){ge.error("clone err:",n),t=JSON.parse(JSON.stringify(e))}return t},It=function(e){var t={},n=JSON.parse(e);return ft(n,(function(e,n){t[n]=e.v})),t},Ct={_delayTime:0,setTime:function(e){var t=(new Date).getTime();Ct._delayTime=t-e},getTime:function(){var e=Ct._delayTime;return(new Date).getTime()-e}},St=function(e,t){var n=0;return e.isAutoDelete&&(n|=1),e.isOverwrite&&(n|=2),2===t&&(n|=4),n};!function(e){e[e.AT_MOST_ONCE=0]="AT_MOST_ONCE",e[e.AT_LEAST_ONCE=1]="AT_LEAST_ONCE",e[e.EXACTLY_ONCE=2]="EXACTLY_ONCE",e[e.DEFAULT=3]="DEFAULT"}(Xe||(Xe={})),function(e){e[e.SYMMETRIC=0]="SYMMETRIC",e[e.CONNECT=1]="CONNECT",e[e.CONN_ACK=2]="CONN_ACK",e[e.PUBLISH=3]="PUBLISH",e[e.PUB_ACK=4]="PUB_ACK",e[e.QUERY=5]="QUERY",e[e.QUERY_ACK=6]="QUERY_ACK",e[e.QUERY_CONFIRM=7]="QUERY_CONFIRM",e[e.SUBSCRIBE=8]="SUBSCRIBE",e[e.SUB_ACK=9]="SUB_ACK",e[e.UNSUBSCRIBE=10]="UNSUBSCRIBE",e[e.UNSUB_ACK=11]="UNSUB_ACK",e[e.PING_REQ=12]="PING_REQ",e[e.PING_RESP=13]="PING_RESP",e[e.DISCONNECT=14]="DISCONNECT",e[e.RESERVER2=15]="RESERVER2"}(Ze||(Ze={})),function(e){e.CONN_ACK="ConnAckMessage",e.DISCONNECT="DisconnectMessage",e.PING_REQ="PingReqMessage",e.PING_RESP="PingRespMessage",e.PUBLISH="PublishMessage",e.PUB_ACK="PubAckMessage",e.QUERY="QueryMessage",e.QUERY_CON="QueryConMessage",e.QUERY_ACK="QueryAckMessage"}($e||($e={})),function(e){e.PUB="pub",e.QUERY="qry"}(et||(et={})),function(e){e[e.V4=4]="V4",e[e.V3=3]="V3"}(nt||(nt={}));var Rt,Nt=function(){function e(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=Xe.AT_LEAST_ONCE),void 0===r&&(r=!1),this._retain=!1,this.qos=Xe.AT_LEAST_ONCE,this._dup=!1,this.syncMsg=!1;var i=e>0;e&&i&&1===arguments.length?(this._retain=(1&e)>0,this.qos=(6&e)>>1,this._dup=(8&e)>0,this.type=e>>4&15,this.syncMsg=8==(8&e)):(this.type=e,this._retain=t,this.qos=n,this._dup=r)}return e.prototype.encode=function(){var e=this.type<<4;return e|=this._retain?1:0,e|=this.qos<<1,e|=this._dup?8:0},e}(),Ot=function(){function e(){}return e.writeUTF=function(e,t){var n=[],r=0;if(J(e))for(var i=0,o=e.length;i<o;i++){var s=e.charCodeAt(i);s>=0&&s<=127?(r+=1,n.push(s)):s>=128&&s<=2047?(r+=2,n.push(192|31&s>>6),n.push(128|63&s)):s>=2048&&s<=65535&&(r+=3,n.push(224|15&s>>12),n.push(128|63&s>>6),n.push(128|63&s))}for(i=0,o=n.length;i<o;i++)n[i]>255&&(n[i]&=255);return t?n:r<=255?[0,r].concat(n):[r>>8,255&r].concat(n)},e.readUTF=function(e){for(var t,n,r=[],i=-1,o=e,s="";++i<o.length;){var a=Number(o[i]);if(a===(127&a)||(240==(240&a)?a=(a=(a=(a^=240)<<6|128^o[++i])<<6|128^o[++i])<<6|128^o[++i]:224==(224&a)?a=(a=(a^=224)<<6|128^o[++i])<<6|128^o[++i]:192==(192&a)&&(a=(a^=192)<<6|128^o[++i])),!isFinite(a)||a<0||a>1114111||Math.floor(a)!==a)throw RangeError("Invalid code point: "+a);a<=65535?r.push(a):(t=(a-=65536)>>10|55296,n=a%1024|56320,r.push(t,n)),(i+1===o.length||r.length>16384)&&(s+=String.fromCharCode.apply(null,r),r.length=0)}return s},e}(),Mt=function(){function e(e){this._position=0,this._poolLen=0,this._pool=e,this._poolLen=e.length}return e.prototype.check=function(){return this._position>=this._pool.length},e.prototype.read2Byte=function(){var e=this;if(e.check())return-1;for(var t="",n=0;n<2;n++){var r=e._pool[e._position++].toString(16);1===r.length&&(r="0"+r),t+=r.toString()}return parseInt(t,16)},e.prototype.readInt=function(){var e=this;if(e.check())return-1;for(var t="",n=0;n<4;n++){var r=e._pool[e._position++].toString(16);1===r.length&&(r="0"+r),t+=r.toString()}return parseInt(t,16)},e.prototype.readLong=function(){var e=this;if(e.check())return-1;for(var t="",n=0;n<8;n++){var r=e._pool[e._position++].toString(16);1===r.length&&(r="0"+r),t+=r}return parseInt(t,16)},e.prototype.readByte=function(){if(this.check())return-1;var e=this._pool[this._position++];return e>255&&(e&=255),e},e.prototype.readUTF=function(){if(this.check())return"";var e=this.readByte()<<8|this.readByte(),t=this._pool.subarray(this._position,this._position+=e);return Ot.readUTF(t)},e.prototype.readAll=function(){return this._pool.subarray(this._position,this._poolLen)},e}(),Ut=function(){function e(){this._pool=[],this._position=0,this._writen=0}return e.prototype.write=function(e){return-1!==Object.prototype.toString.call(e).indexOf("Array")?this._pool=this._pool.concat(e):e>=0&&(e>255&&(e&=255),this._pool.push(e),this._writen++),e},e.prototype.writeArr=function(e){return this._pool=this._pool.concat(e),e},e.prototype.writeUTF=function(e){var t=Ot.writeUTF(e);this._pool=this._pool.concat(t),this._writen+=t.length},e.prototype.getBytesArray=function(){return this._pool},e}(),wt="UpStreamMessage",At="PushExtra",bt="DownStreamMessage",Lt="DownStreamMessages",Pt="SessionsAttQryInput",Dt="SessionsAttOutput",xt="SyncRequestMsg",Vt="ChrmPullMsg",kt="NotifyMsg",Bt="HistoryMsgInput",Gt="HistoryMsgOuput",jt="RelationQryInput",qt="RelationsOutput",Ft="DeleteSessionsInput",Ht="SessionInfo",Kt="DeleteSessionsOutput",Yt="RelationsInput",Qt="DeleteMsgInput",Wt="CleanHisMsgInput",Jt="SessionMsgReadInput",zt="ChrmInput",Xt="ChrmOutput",Zt="QueryChatRoomInfoInput",$t="QueryChatRoomInfoOutput",en="RtcInput",tn="RtcUserListOutput",nn="SetUserStatusInput",rn="RtcSetDataInput",on="RtcUserSetDataInput",sn="RtcDataInput",an="RtcSetOutDataInput",cn="MCFollowInput",un="RtcTokenOutput",dn="RtcQryOutput",ln="RtcQryUserOutDataInput",hn="RtcUserOutDataOutput",fn="RtcQueryListInput",gn="RtcRoomInfoOutput",pn="RtcValueInfo",mn="RtcKeyDeleteInput",vn="GetQNupTokenInput",_n="GetQNupTokenOutput",yn="GetQNdownloadUrlInput",En="GetDownloadUrlInput",Tn="GetQNdownloadUrlOutput",In="GetDownloadUrlOutput",Cn="ChrmKVEntity",Sn="SetChrmKV",Rn="SetChrmKVS",Nn="DeleteChrmKVS",On="ChrmKVOutput",Mn="ChrmKVSOutput",Un="ChrmKVSVersionEntity",wn="ChrmKVSOutputEntity",An="QueryChrmKV",bn="SetUserSettingInput",Ln="SetUserSettingOutput",Pn="PullUserSettingInput",Dn="PullUserSettingOutput",xn="UserSettingNotification",Vn="SessionReq",kn="SessionStates",Bn="SessionState",Gn="SessionStateItem",jn="SessionStateModifyReq",qn="SessionStateModifyResp",Fn="GroupUnpushQuery",Hn="GroupUnpushSet",Kn="GroupUnpushResult",Yn="GrpReadReceiptMsg",Qn="GrpReadReceiptQryReq",Wn="GrpReadReceiptQryResp",Jn="GrpMsgReadUser",zn="SessionTagAddInput",Xn="SessionTagItem",Zn="SessionTagDelInput",$n="SessionDisTagReq",er="ReportSDKInput",tr="ReportSDKOutput",nr="UltraGrpPullSes",rr="UltraGrpPullMsg",ir="MsgChangeReq",or="QueryMsgChange",sr="MsgChange",ar="MsgChangeList",cr="MsgQuery",ur="MessageQueryInfo",dr="MsgQueryAck",lr="OperateStatus",hr="OperateStatusNotify",fr="OperateInfo",gr="OperateSummary",pr="RtcNotifyMsg",mr="RtcPullKV",vr="RtcKVOutput",_r="RtcQueryUserJoinedInput",yr="RtcQueryUserJoinedOutput",Er="RtcViewerJoinedOutput",Tr="RtcInviteInput",Ir="RtcCancelInviteInput",Cr="RtcInviteAnswerInput",Sr="RtcEndInviteInput",Rr="SetRtcRoomIdInput",Nr="SetRtcRoomIdOutput",Or=((Rt={})[wt]=["sessionId","classname","content","pushText","userId","configFlag","appData","extraContent","pushExt","busChannel"],Rt[Lt]=["list","syncTime","finished","broadcastSyncTime"],Rt[bt]=["fromUserId","type","groupId","classname","content","dataTime","status","msgId","extraContent","pushContent","configFlag","pushExt","busChannel","extStatus","toUserId","groupUnpush"],Rt[At]=["title","templateIdNoUse","pushId","pushConfigs","templateId"],Rt[Pt]=["nothing"],Rt[Dt]=["inboxTime","sendboxTime","totalUnreadCount"],Rt[xt]=["syncTime","ispolling","isweb","isPullSend","isKeeping","sendBoxSyncTime","broadcastSyncTime"],Rt[Vt]=["syncTime","count"],Rt[kt]=["type","time","chrmId"],Rt[Bt]=["targetId","time","count","order","busChannel"],Rt[Gt]=["list","syncTime","hasMsg"],Rt[jt]=["type","count","startTime","order"],Rt[qt]=["info","isFinished"],Rt[Ft]=["sessions"],Rt[Ht]=["type","channelId","busChannel"],Rt[Kt]=["nothing"],Rt[Yt]=["type","msg","count","busChannel","startTime","endTime"],Rt[Qt]=["type","conversationId","msgs","busChannel"],Rt[Wt]=["targetId","dataTime","conversationType","busChannel"],Rt[Jt]=["type","msgTime","channelId","busChannel"],Rt[zt]=["nothing"],Rt[Xt]=["nothing","sessionId","joinTime"],Rt[Zt]=["count","order"],Rt[$t]=["userTotalNums","userInfos"],Rt[vn]=["type","key","httpMethod","queryString"],Rt[yn]=["type","key","fileName"],Rt[En]=["type","key","fileName"],Rt[_n]=["deadline","token","bosToken","bosDate","path","osskeyId","ossPolicy","ossSign","ossBucketName"],Rt[Tn]=["downloadUrl"],Rt[In]=["downloadUrl"],Rt[Cn]=["key","value","status","timestamp","uid","version"],Rt[Sn]=["entry","bNotify","notification","type"],Rt[Rn]=["entry","bNotify","notification","type"],Rt[Nn]=["entry","bNotify","notification","type"],Rt[On]=["entries","bFullUpdate","syncTime"],Rt[Mn]=["timestamp","errorKeys","keysVersion"],Rt[Un]=["version","key"],Rt[wn]=["key","errorCode"],Rt[An]=["timestamp"],Rt[bn]=["version","value"],Rt[Ln]=["version","reserve"],Rt[Pn]=["version","reserve"],Rt[Dn]=["items","version"],Rt.UserSettingItem=["targetId","type","key","value","version","status","tags"],Rt[Vn]=["time"],Rt[kn]=["version","state"],Rt[Bn]=["type","channelId","time","stateItem","busChannel"],Rt[Gn]=["sessionStateType","value","tags"],Rt[jn]=["version","state"],Rt[qn]=["version"],Rt[Hn]=["busChannel","unpushLevel"],Rt[Fn]=["busChannel"],Rt[Kn]=["groupId","busChannel","unpushLevel"],Rt[Yn]=["msgId","busChannel"],Rt[Qn]=["msgId","busChannel"],Rt[Wn]=["totalMemberNum","list"],Rt[Jn]=["readTime","userId"],Rt[zn]=["version","tags"],Rt[Xn]=["tagId","name","createdTime","isTop"],Rt[Zn]=["version","tags"],Rt[$n]=["tagId"],Rt[xn]=["version","reserve"],Rt[er]=["sdkInfo"],Rt[tr]=["nothing"],Rt[nr]=["syncTime","isEraseMsgContent"],Rt[rr]=["syncTime"],Rt[ir]=["fromUserId","targetId","type","busChannel","msgUID","msgTime","content"],Rt[or]=["syncTime"],Rt[ar]=["list","syncTime","hasNext"],Rt[sr]=["targetId","type","time","changeType","msgUID","msgTime","busChannel","isAdmin","isDel","operatorId"],Rt[cr]=["targetId","type","query"],Rt[ur]=["msgTime","msgUID","busChannel"],Rt[dr]=["list"],Rt[lr]=["targetId","type","opType","busChannel"],Rt[hr]=["type","notifyType","info","summary"],Rt[fr]=["targetId","busChannel","userId","opType","optime"],Rt[gr]=["targetId","busChannel","count","opType"],Rt[en]=["roomType","broadcastType","extraInnerData","needSysChatroom","identityChangeType","joinType"],Rt[tn]=["users","token","sessionId","roomInfo"],Rt[nn]=["status"],Rt[rn]=["interior","target","key","value","objectName","content"],Rt[on]=["valueInfo","objectName","content"],Rt[sn]=["interior","target","key","objectName","content"],Rt[an]=["target","valueInfo","objectName","content"],Rt[cn]=["state"],Rt[un]=["rtcToken"],Rt[dn]=["outInfo"],Rt[ln]=["userId"],Rt[hn]=["user"],Rt[fn]=["order"],Rt[gn]=["roomId","roomData","userCount","list"],Rt[pn]=["key","value"],Rt[mn]=["key"],Rt[pr]=["type","time","roomId"],Rt[mr]=["timestamp","roomId"],Rt[vr]=["entries","bFullUpdate","syncTime"],Rt[_r]=["userId"],Rt[yr]=["info"],Rt[Tr]=["invitedUserId","timeoutTime","invitedRoomId","inviteInfo","inviteSessionId"],Rt[Ir]=["invitedUserId","invitedRoomId","inviteInfo","inviteSessionId"],Rt[Cr]=["inviteUserID","answerCode","inviteRoomId","inviteSessionId","content","key","value"],Rt[Sr]=["inviteRoomId","inviteSessionId","inviteContent","inviteRoomKeys"],Rt[Rr]=["rtcRoomId"],Rt[Nr]=["nothing"],Rt),Mr={},Ur=function(e){var t=Or[e];Mr[e]=function(){for(var e={},n={getArrayData:function(){return e}},r=function(r){var i=t[r],o="set".concat(O(i,0,1));n[o]=function(t){e[i]=t}},i=0;i<t.length;i++)r(i);return n},Mr[e].decode=function(e){var t={};J(e)&&(e=JSON.parse(e));var n=function(n){var r="get".concat(O(n,0,1));t[n]=e[n],t[r]=function(){return e[n]}};for(var r in e)n(r);return t}};for(var wr in Or)Ur(wr);Mr.getModule=function(e){return Mr[e]()};var Ar="\npackage Modules;\nmessage probuf {\n  message ".concat(nn,"\n  {\n    optional int32 status=1;\n  }\n\n  message SetUserStatusOutput\n  {\n    optional int32 nothing=1;\n  }\n\n  message GetUserStatusInput\n  {\n    optional int32 nothing=1;\n  }\n\n  message GetUserStatusOutput\n  {\n    optional string status=1;\n    optional string subUserId=2;\n  }\n\n  message SubUserStatusInput\n  {\n    repeated string userid =1;\n  }\n\n  message SubUserStatusOutput\n  {\n    optional int32 nothing=1;\n  }\n  message VoipDynamicInput\n  {\n    required int32  engineType = 1;\n    required string channelName = 2;\n    optional string channelExtra = 3;\n  }\n\n  message VoipDynamicOutput\n  {\n      required string dynamicKey=1;\n  }\n  message ").concat(kt," {\n    required int32 type = 1;\n    optional int64 time = 2;\n    optional string chrmId=3;\n  }\n  message ").concat(xt," {\n    required int64 syncTime = 1;\n    required bool ispolling = 2;\n    optional bool isweb=3;\n    optional bool isPullSend=4;\n    optional bool isKeeping=5;\n    optional int64 sendBoxSyncTime=6;\n    optional int64 broadcastSyncTime=7;\n  }\n  message ").concat(wt," {\n    required int32 sessionId = 1;\n    required string classname = 2;\n    required bytes content = 3;\n    optional string pushText = 4;\n    optional string appData = 5;\n    repeated string userId = 6;\n    optional int64 delMsgTime = 7;\n    optional string delMsgId = 8;\n    optional int32 configFlag = 9;\n    optional int64 clientUniqueId = 10;\n    optional string extraContent = 11;\n    optional PushExtra pushExt = 12;\n    optional string busChannel = 13; // 该消息所属会话的业务标识\n  }\n  message ").concat(At," {\n    optional string title = 1;\n    optional int32  templateIdNoUse= 2;\n    optional string pushId = 3;\n    optional string pushConfigs = 4;\n    optional string templateId = 5;\n  }\n  message ").concat(Lt," {\n    repeated DownStreamMessage list = 1;\n    required int64 syncTime = 2;\n    optional bool finished = 3;\n    optional int64 broadcastSyncTime = 4;\n  }\n  message ").concat(bt," {\n    required string fromUserId = 1;\n    required ChannelType type = 2;\n    optional string groupId = 3;\n    required string classname = 4;\n    required bytes content = 5;\n    required int64 dataTime = 6;\n    required int64 status = 7;\n    optional int64 extra = 8;\n    optional string msgId = 9;\n    optional int32 direction = 10;\n    optional int32 plantform =11;\n    optional int32 isRemoved = 12;\n    optional string source = 13;\n    optional int64 clientUniqueId = 14;\n    optional string extraContent = 15;\n    optional string pushContent = 16;\n    optional int32 configFlag = 17;\n    optional PushExtra pushExt = 18;\n    optional string busChannel = 19; // 该消息所属会话的业务标识，限制20字符以内\n    optional int64 extStatus = 20; // 消息的扩展标记 第0位,表示送达状态: 0x01 表示已送达;断档: 0x02 表示是否需要执行断档策略; 消息修改: 0x04 拉取历史消息时表示该消息是否修改过\n    repeated string toUserId = 21;  //指定接收者（限定群和讨论组）//增加聊天室定向成员\n    optional int32 groupUnpush = 22; //群聊默认免打扰级别\n  }\n  enum ChannelType {\n    PERSON = 1;\n    PERSONS = 2;\n    GROUP = 3;\n    TEMPGROUP = 4;\n    CUSTOMERSERVICE = 5;\n    NOTIFY = 6;\n    MC=7;\n    MP=8;\n    ULTRAGROUP = 10;\n  }\n  message CreateDiscussionInput {\n    optional string name = 1;\n  }\n  message CreateDiscussionOutput {\n    required string id = 1;\n  }\n  message ChannelInvitationInput {\n    repeated string users = 1;\n  }\n  message LeaveChannelInput {\n    required int32 nothing = 1;\n  }\n  message ChannelEvictionInput {\n    required string user = 1;\n  }\n  message RenameChannelInput {\n    required string name = 1;\n  }\n  message ChannelInfoInput {\n    required int32 nothing = 1;\n  }\n  message ChannelInfoOutput {\n    required ChannelType type = 1;\n    required string channelId = 2;\n    required string channelName = 3;\n    required string adminUserId = 4;\n    repeated string firstTenUserIds = 5;\n    required int32 openStatus = 6;\n  }\n  message ChannelInfosInput {\n    required int32 page = 1;\n    optional int32 number = 2;\n  }\n  message ChannelInfosOutput {\n    repeated ChannelInfoOutput channels = 1;\n    required int32 total = 2;\n  }\n  message MemberInfo {\n    required string userId = 1;\n    required string userName = 2;\n    required string userPortrait = 3;\n    required string extension = 4;\n  }\n  message GroupMembersInput {\n    required int32 page = 1;\n    optional int32 number = 2;\n  }\n  message GroupMembersOutput {\n    repeated MemberInfo members = 1;\n    required int32 total = 2;\n  }\n  message GetUserInfoInput {\n    required int32 nothing = 1;\n  }\n  message GetUserInfoOutput {\n    required string userId = 1;\n    required string userName = 2;\n    required string userPortrait = 3;\n  }\n  message GetSessionIdInput {\n    required int32 nothing = 1;\n  }\n  message GetSessionIdOutput {\n    required int32 sessionId = 1;\n  }\n  enum FileType {\n    image = ").concat(W.IMAGE,";\n    audio = ").concat(W.AUDIO,";\n    video = ").concat(W.VIDEO,";\n    file = ").concat(W.FILE,";\n  }\n  message ").concat(vn," {\n    required FileType type = 1;\n    optional string key = 2;\n    optional string httpMethod = 3;\n    optional string queryString = 4;\n  }\n  message ").concat(yn," {\n    required FileType type = 1;\n    required string key = 2;\n    optional string  fileName = 3;\n  }\n  message ").concat(En," {\n    required FileType type = 1;\n    required string key = 2;\n    optional string fileName = 3;\n   }\n  message ").concat(_n," {\n    required int64 deadline = 1;\n    required string token = 2;\n    optional string bosToken = 3;\n    optional string bosDate = 4;\n    optional string path = 5;\n    optional string osskeyId = 6;\n    optional string ossPolicy = 7;\n    optional string ossSign = 8;\n    optional string ossBucketName = 9;\n    optional string s3Credential = 10;\n    optional string s3Algorithm = 11;\n    optional string s3Date = 12;\n    optional string s3Policy = 13;\n    optional string s3Signature = 14;\n    optional string s3BucketName = 15;\n    optional string stcAuthorization = 16;\n    optional string stcContentSha256 = 17;\n    optional string stcDate = 18;\n    optional string stcBucketName = 19;\n  }\n  message ").concat(Tn," {\n    required string downloadUrl = 1;\n  }\n  message ").concat(In," {\n    required string downloadUrl = 1;\n  }\n  message Add2BlackListInput {\n    required string userId = 1;\n  }\n  message RemoveFromBlackListInput {\n    required string userId = 1;\n  }\n  message QueryBlackListInput {\n    required int32 nothing = 1;\n  }\n  message QueryBlackListOutput {\n    repeated string userIds = 1;\n  }\n  message BlackListStatusInput {\n    required string userId = 1;\n  }\n  message BlockPushInput {\n    required string blockeeId = 1;\n  }\n  message ModifyPermissionInput {\n    required int32 openStatus = 1;\n  }\n  message GroupInput {\n    repeated GroupInfo groupInfo = 1;\n  }\n  message GroupOutput {\n    required int32 nothing = 1;\n  }\n  message GroupInfo {\n    required string id = 1;\n    required string name = 2;\n  }\n  message GroupHashInput {\n    required string userId = 1;\n    required string groupHashCode = 2;\n  }\n  message GroupHashOutput {\n    required GroupHashType result = 1;\n  }\n  enum GroupHashType {\n    group_success = 0x00;\n    group_failure = 0x01;\n  }\n  message ").concat(zt," {\n    required int32 nothing = 1;\n  }\n  message ").concat(Xt," {\n    required int32 nothing = 1;\n    optional string sessionId = 2;\n    optional int64 joinTime = 3;\n  }\n  message ").concat(Vt," {\n    required int64 syncTime = 1;\n    required int32 count = 2;\n  }\n\n  message ChrmPullMsgNew\n  {\n    required int32 count = 1;\n    required int64 syncTime = 2;\n    optional string chrmId=3;\n  }\n  message ").concat(jt,"\n  {\n    optional ChannelType type = 1;\n    optional int32 count = 2;\n    optional int64 startTime = 3;\n    optional int32 order = 4;\n  }\n  message ").concat(Yt,"\n  {\n    required ChannelType type = 1;\n    optional DownStreamMessage msg =2;\n    optional int32 count = 3;\n    repeated string busChannel = 4;\n    optional int64 startTime = 5;\n    optional int64 endTime = 6;\n  }\n  message ").concat(qt,"\n  {\n    repeated RelationInfo info = 1;\n    optional bool isFinished = 2;//是否结束\n  }\n  message RelationInfo\n  {\n    required ChannelType type = 1;\n    required string userId = 2;\n    optional DownStreamMessage msg =3;\n    optional int64 readMsgTime= 4;\n    optional int64 unreadCount= 5;\n    optional string busChannel = 6;//该消息所属会话的业务标识\n    optional int64 versionTime = 7;//会话项变更时间戳，注意:非排序时间戳\n    optional int64 remindCount = 8;//被@的未读数\n  }\n  message RelationInfoReadTime\n  {\n    required ChannelType type = 1;\n    required int64 readMsgTime= 2;\n    required string targetId = 3;\n  }\n  message ").concat(Wt,"\n  {\n      required string targetId = 1;\n      required int64 dataTime = 2;\n      optional int32 conversationType= 3;\n      optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内\n  }\n  message HistoryMessageInput\n  {\n    required string targetId = 1;\n    required int64 dataTime =2;\n    required int32 size  = 3;\n  }\n\n  message HistoryMessagesOuput\n  {\n    repeated DownStreamMessage list = 1;\n    required int64 syncTime = 2;\n    required int32 hasMsg = 3;\n  }\n  message ").concat(Zt,"\n  {\n    required int32 count= 1;\n    optional int32 order= 2;\n  }\n\n  message ").concat($t,"\n  {\n    optional int32 userTotalNums = 1;\n    repeated ChrmMember userInfos = 2;\n  }\n  message ChrmMember\n  {\n    required int64 time = 1;\n    required string id = 2;\n  }\n  message MPFollowInput\n  {\n    required string id = 1;\n  }\n\n  message MPFollowOutput\n  {\n    required int32 nothing = 1;\n    optional MpInfo info =2;\n  }\n\n  message ").concat(cn,"\n  {\n    required string state = 1;\n  }\n\n  message MCFollowOutput\n  {\n    required int32 nothing = 1;\n    optional MpInfo info =2;\n  }\n\n  message MpInfo\n  {\n    required string mpid=1;\n    required string name = 2;\n    required string type = 3;\n    required int64 time=4;\n    optional string portraitUrl=5;\n    optional string extra =6;\n  }\n\n  message SearchMpInput\n  {\n    required int32 type=1;\n    required string id=2;\n  }\n\n  message SearchMpOutput\n  {\n    required int32 nothing=1;\n    repeated MpInfo info = 2;\n  }\n\n  message PullMpInput\n  {\n    required int64 time=1;\n    required string mpid=2;\n  }\n\n  message PullMpOutput\n  {\n    required int32 status=1;\n    repeated MpInfo info = 2;\n  }\n  message ").concat(Bt,"\n  {\n    optional string targetId = 1;\n    optional int64 time = 2;\n    optional int32 count  = 3;\n    optional int32 order = 4;\n    optional string busChannel = 5; //该消息所属会话的业务标识，限制20字符以内\n  }\n\n  message ").concat(Gt,"\n  {\n    repeated DownStreamMessage list=1;\n    required int64 syncTime=2;\n    required int32 hasMsg=3;\n  }\n  message ").concat(fn,"{\n    optional int32 order=1;\n  }\n\n  message ").concat(mn,"{\n    repeated string key=1;\n  }\n\n  message ").concat(pn,"{\n    required string key=1;\n    required string value=2;\n  }\n\n  message RtcUserInfo{\n    required string userId=1;\n    repeated ").concat(pn," userData=2; //用户资源信息\n  }\n\n  message ").concat(tn,"{\n    repeated RtcUserInfo users=1;\n    optional string token=2;\n    optional string sessionId=3;\n    repeated RtcValueInfo roomInfo = 4; //房间key value\n    repeated RtcKVEntity entries = 5;//直播KV属性对象集合\n    optional int64 syncTime = 6;//所有属性的最大时间戳（下次拉取KV时用）。\n    optional int32 offlineKickTime = 7;//server超时踢人时间，默认60s\n  }\n  message RtcRoomInfoOutput{\n    optional string roomId = 1;\n    repeated ").concat(pn," roomData = 2;\n    optional int32 userCount = 3;\n    repeated RtcUserInfo list=4;\n  }\n  message ").concat(en,"{\n    required int32 roomType=1;\n    optional int32 broadcastType=2;\n    optional RtcValueInfo extraInnerData = 3;\n    optional bool needSysChatroom = 4; //是否需要同步聊天室\n    optional IdentityChangeType identityChangeType = 5; //身份变更类型\n    optional JoinType joinType = 6; // 加入房间类型\n    repeated ").concat(pn," innerDatas = 7; //用户内部inner数据，角色或者连麦信息等\n    repeated ").concat(pn," outerDatas = 8; //用户内部outer数据，自定义数据结构RtcInput。\n  }\n  enum JoinType {\n    KICK = 0; //踢前一个设备\n    REFUSE = 1; //当前加入拒绝\n    COEXIST = 2; //两个设备共存\n  }\n  message RtcQryInput{\n    required bool isInterior=1;\n    required targetType target=2;\n    repeated string key=3;\n  }\n  message ").concat(dn,"{\n    repeated ").concat(pn," outInfo=1;\n  }\n  message RtcDelDataInput{\n    repeated string key=1;\n    required bool isInterior=2;\n    required targetType target=3;\n  }\n  message ").concat(sn,"{\n    required bool interior=1;\n    required targetType target=2;\n    repeated string key=3;\n    optional string objectName=4;\n    optional string content=5;\n  }\n  message ").concat(rn,"{\n    required bool interior=1;\n    required targetType target=2;\n    required string key=3;\n    required string value=4;\n    optional string objectName=5;\n    optional string content=6;\n  }\n  message ").concat(on," {\n    repeated ").concat(pn," valueInfo = 1;\n    required string objectName = 2;\n    repeated ").concat(pn," content = 3;\n  }\n  message RtcOutput\n  {\n    optional int32 nothing=1;\n  }\n  message ").concat(un,"{\n    required string rtcToken=1;\n  }\n  enum targetType {\n    ROOM =1 ;\n    PERSON = 2;\n  }\n  message ").concat(an,"{\n    required targetType target=1;\n    repeated ").concat(pn," valueInfo=2;\n    optional string objectName=3;\n    optional string content=4;\n  }\n  message ").concat(ln,"{\n    repeated string userId = 1;\n  }\n  message ").concat(hn,"{\n    repeated RtcUserInfo user = 1;\n  }\n  message ").concat(Pt,"{\n    required int32 nothing = 1;\n  }\n  message ").concat(Dt,"{\n    required int64 inboxTime = 1;\n    required int64 sendboxTime = 2;\n    required int64 totalUnreadCount = 3;\n  }\n  message ").concat(Jt,"\n  {\n    required ChannelType type = 1;\n    required int64 msgTime = 2;\n    required string channelId = 3;\n    optional string busChannel = 4;//该消息所属会话的业务标识\n  }\n  message SessionMsgReadOutput\n  {\n    optional int32 nothing=1;\n  }\n  message ").concat(Ft,"\n  {\n    repeated SessionInfo sessions = 1;\n  }\n  message ").concat(Ht,"\n  {\n    required ChannelType type = 1;\n    required string channelId = 2;\n    optional string busChannel = 3;//所属会话业务标识\n  }\n  message ").concat(Kt,"\n  {\n    optional int32 nothing=1;\n  }\n  message ").concat(Qt,"\n  {\n    optional ChannelType type = 1;\n    optional string conversationId = 2;\n    repeated DeleteMsg msgs = 3;\n    optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内\n  }\n  message DeleteMsg\n  {\n    optional string msgId = 1;\n    optional int64 msgDataTime = 2;\n    optional int32 direct = 3;\n  }\n  message ChrmKVEntity {\n    required string key = 1;\n    required string value = 2;\n    optional int32 status = 3;\n    optional int64 timestamp = 4;\n    optional string uid = 5;\n    optional int64 version = 6;\n  }\n  message ").concat(Sn," {\n    required ChrmKVEntity entry = 1;\n    optional bool bNotify = 2;\n    optional UpStreamMessage notification = 3;\n    optional ChannelType type = 4;\n  }\n  message ").concat(Rn," {\n    repeated ChrmKVEntity entry = 1;\n    optional bool bNotify = 2;\n    optional UpStreamMessage notification = 3;\n    optional ChannelType type = 4;\n  }\n  message ").concat(Nn," {\n    repeated ChrmKVEntity entry = 1;\n    optional bool bNotify = 2;\n    optional UpStreamMessage notification = 3;\n    optional ChannelType type = 4;\n  }\n  message ").concat(On," {\n    repeated ChrmKVEntity entries = 1;\n    optional bool bFullUpdate = 2;\n    optional int64 syncTime = 3;\n  }\n  message ChrmKVSVersionEntity {\n    optional int64 version = 1;\n    optional string key = 2;\n  }\n\n  message ").concat(Mn," {\n    repeated ChrmKVSOutputEntity errorKeys = 1;\n    repeated ChrmKVSVersionEntity keysVersion = 2;\n  }\n  message ").concat(wn,"\n  {\n    optional string key = 1;\n    optional int32 errorCode = 2;\n  }\n  message ").concat(An," {\n    required int64 timestamp = 1;\n  }\n  message ").concat(bn," {\n    required int64 version=1;\n    required string value=2;\n  }\n  message ").concat(Ln," {\n    required int64 version=1;\n    required bool reserve=2;\n  }\n  message ").concat(Pn," {\n    required int64 version=1;\n    optional bool reserve=2;\n  }\n  message ").concat(Dn," {\n    repeated UserSettingItem items = 1;\n    required int64 version=2;\n  }\n  message UserSettingItem {\n    required string targetId= 1;\n    required ChannelType type = 2;\n    required string key = 4;\n    required bytes value = 5;\n    required int64 version=6;\n    required int32 status=7;\n    repeated SessionTagItem tags= 8;\n  }\n  message ").concat(Vn," {\n    required int64 time = 1;\n  }\n  message ").concat(kn," {\n    required int64 version=1;\n    repeated SessionState state= 2;\n  }\n  message ").concat(Bn," {\n    required ChannelType type = 1;\n    required string channelId = 2;\n    optional int64 time = 3;\n    repeated SessionStateItem stateItem = 4;\n    optional string busChannel = 5;//该消息所属会话的业务标识\n  }\n  message ").concat(Gn," {\n    required SessionStateType sessionStateType = 1;\n    required string value = 2;\n    repeated SessionTagItem tags = 3;\n  }\n  enum SessionStateType {\n    IsSilent = 1;\n    IsTop = 2;\n    Tags = 3;\n  }\n  message ").concat(jn," {\n    required int64 version=1;\n    repeated SessionState state= 2;\n  }\n  message ").concat(Fn," {\n    optional string busChannel = 1;\n  }\n  message ").concat(Hn,"{\n    optional string busChannel = 1;\n    required int32 unpushLevel = 2;\n  }\n  message ").concat(Kn," {\n    required string groupId = 1;\n    optional string busChannel = 2;\n    required int32 unpushLevel = 3;\n  }\n  message ").concat(qn," {\n    required int64 version=1;\n  }\n  message ").concat(Yn," {\n    repeated string msgId=1; //已读消息ID\n    optional string channelId = 2; // 该消息所属会话的业务标识\n  }\n  message ").concat(Qn," {\n    repeated string msgId=1; //已读消息ID\n    optional string channelId = 2; // 该消息所属会话的业务标识\n  }\n  message ").concat(Wn," {\n    required int32 totalMemberNum = 1;//群内总人数\n    repeated GrpMsgReadUser list = 2;//已读用户列表（list复类型）\n  }\n  message ").concat(Jn," {\n    required int64 readTime = 1;//已读时间\n    required string userId = 2;//已读用户id\n  }\n  message ").concat(zn," {\n    required int64 version=1;\n    repeated SessionTagItem tags=2;\n  }\n  message ").concat(Xn," {\n    required string tagId=1;\n    optional string name=2;\n    optional int64 createdTime=3;\n    optional bool isTop=4;\n  }\n  message ").concat(Zn," {\n    required int64 version=1;\n    repeated SessionTagItem tags=2;\n  }\n  message ").concat($n," {\n    repeated string tagId=1;\n  }\n  message ").concat(xn," {\n    required int64 version=1;\n    required bool reserve=2;\n  }\n  message ").concat(er,' {\n    required string sdkInfo=1; // 用户集成的 sdk 信息,json 格式 {"web-rtc": "4.0.3.7"}\n  }\n  message ').concat(tr,"\n  {\n    optional int32 nothing=1; //占位\n  }\n  message ").concat(pr," \n  {\n    required int32 type= 1;   //(通知类型 1:rtc房间状态KV变更通知)\n    optional int64 time= 2;   //消息产生时间\n    optional string roomId=3; //主播房间id\n  }\n  message ").concat(mr,"\n  {\n    required int64 timestamp = 1;\n    required string roomId = 2;\n  }\n  message ").concat(vr,"\n  {\n    repeated RtcKVEntity entries = 1;\n    optional bool bFullUpdate = 2;\n    optional int64 syncTime = 3; \n  }\n  message RtcKVEntity \n  {\n    required string key = 1;\n    required string value = 2;\n    optional int32 status = 3;\n    optional int64 timestamp = 4;\n    optional string uid = 5;\n  }\n  enum IdentityChangeType \n  {\n    AnchorToViewer = 1; //1为主播变观众\n    ViewerToAnchor = 2; //2为观众变主播\n  }\n  message ").concat(_r,"\n  {\n    required string userId = 1;\n  }\n  message ").concat(yr,"\n  {\n    repeated RtcJoinedInfo info = 1;\n  }\n  message RtcJoinedInfo\n  {\n    required string deviceId = 1; //设备ID\n    required string roomId = 2;   //加入的房间ID\n    optional int64 joinTime = 3;  //加入的时间\n  }\n  message ").concat(Er,"\n  {\n    required string rtcToken=1;\n    repeated RtcKVEntity entries = 2;//KV属性对象集合\n    optional int64 syncTime = 3;//所有属性的最大时间戳（下次拉取KV时用）。\n  }\n  message ").concat(Tr,"\n  {\n    required string invitedUserId=1;    //被邀请的人的uid\n    optional int32  timeoutTime=2;       //邀请超时时间(秒),默认三十秒\n    required string invitedRoomId=3;    //被邀请的房间\n    required string inviteInfo=4;       //邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传\n    required string inviteSessionId= 5; //客户端保证唯一性(建议roomid_userid_时间戳_随机数)\n  }\n  message ").concat(Ir,"\n  {\n    required string invitedUserId=1;   //被邀请的人的uid\n    required string invitedRoomId=2;   //被邀请的房间\n    required string inviteInfo=3;      //取消邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传\n    required string inviteSessionId=4; //邀请的sessionId,客户端发起邀请时产生\n  }\n  message ").concat(Cr,"\n  {\n    required string inviteUserId=1;    //邀请的人的uid\n    required int32  answerCode=2;      //是否接受连麦邀请.0为拒绝,1为接受\n    required string inviteRoomId=3;    //邀请的房间\n    required string inviteSessionId=4; //邀请的sessionId\n    required string content=5;         //需要转发的content\n    optional string key=6;             //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到\n    optional string value=7;           //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到\n  }\n  message ").concat(Sr,"\n  {\n    required string inviteRoomId=1;    //邀请的房间\n    required string inviteSessionId=2; //邀请的sessionId\n    required string inviteContent=3;   //结束连麦的信息(需要透传给房间内其他人)\n    repeated string inviteRoomKeys=4;  //需要删除连麦的信息的key\n  }\n  message ").concat(nr,"\n  {\n      required int64 syncTime = 1;//同步时间戳\n      optional bool isEraseMsgContent = 2;//拉取会话时，是否屏蔽掉消息内容\n  }\n  message ").concat(rr,"\n  {\n    required int64 syncTime = 1;//同步时间戳\n  }\n  message  ").concat(ir,"\n  {\n    required string fromUserId = 1;//（谁发的）\n    required string targetId = 2;// 目标Id(超级群Id)\n    required ChannelType type = 3;//发送类型如：（P2P,GROUP,ULTRAGROUP）\n    required string msgUID = 4; // 扩展消息的内容体\n    required int64 msgTime = 5; //原始消息时间\n    optional string busChannel = 6; // 该消息所属会话的业务标识，限制20字符以内\n    optional string content = 7; // 即extraContent消息扩展内容,下表格说明\n  }\n  message ").concat(or,"  //查询入参\n  {\n    required int64 syncTime = 1;//同步时间戳\n  }\n  message ").concat(ar,"  //应答结果\n  {\n    repeated MsgChange list = 1; //变更\n    required int64 syncTime = 2; //同步时间(用于下次同步入参)\n    optional bool  hasNext = 3 ;\n  }\n  message MsgChange  //变更详情\n  {\n    required string targetId = 1; //  目标Id(超级群Id)\n    required ChannelType type = 2; //  会话类型\n    required int64 time = 3;  // 变更时间\n    required int32 changeType = 4;  // 消息变更类型（1:扩展,2:修改,3:撤回)\n    required string msgUID  = 5;  // 消息ID\n    required int64 msgTime = 6;  //  消息时间\n    optional string busChannel = 7; // 频道ID\n    optional bool isAdmin = 8; //是否为管理员，默认为 0，设为 1 时，IMKit 收到此条消息后，小灰条默认显示为“管理员 撤回了一条消息”。\n    optional bool isDel = 9; //默认为 0 撤回该条消息同时，用户端将该条消息删除并替换为一条小灰条撤回提示消息；为 1 时，该条消息删除后，不替换为小灰条提示消息。\n    optional string operatorId = 10; // 新加 - 消息变更的操作人Id\n  }\n  message ").concat(cr,"  //请求\n  {\n    required string targetId = 1; //  目标Id(超级群Id)\n    required ChannelType type = 2; //  会话类型\n    repeated MessageQueryInfo query = 3; //\n  }\n  message MessageQueryInfo\n  {\n    required int64 msgTime = 1;  // 消息时间\n    required string msgUID  = 2;  // 消息ID\n    optional string busChannel = 3; // 频道ID\n  }\n  message ").concat(dr,"  //应答\n  {\n    repeated DownStreamMessage list = 1;//消息\n  }\n  message ").concat(lr,"  //客户端发送\n  {\n    optional string targetId =  1;// targetId\n    optional ChannelType type = 2;//发送会话类型如：（P2P,GROUP） \n    optional int32 opType = 3;  //0 , 正在输入, 1 正在XXX  \n    optional string busChannel = 4; // 频道(channelId,可以为空)\n  }\n  message ").concat(hr,"  //服务端发送\n  {\n      optional ChannelType type = 1;//发送会话类型如（P2P,GROUP） \n      optional int64 notifyType = 2; //0x1 表示明细, 0x2 表示汇总 0x3 表示明细+汇总\n      repeated OperateInfo info = 3 ; //明细列表 当notifyType 为 1和3时,有效\n      repeated OperateSummary summary = 4 ; //汇总列表, 当notifyType 为2和3 时,有效\n  }\n  message ").concat(fr," {\n    // XX 正在做什么\n    optional string targetId = 1; // 超级群Id  会话id\n    optional string busChannel = 2; // 频道(channelId,可以为空)\n    optional string userId = 3; // userId\n    optional int32 opType = 4;  //0 , 正在输入, 1 正在XX \n    optional int64 optime = 5;  //服务端收到用户操作的上行时间. \n  }\n      \n  message ").concat(gr," {\n    // 几个人 正在干什么\n    optional string targetId = 1; // 超级群Id  会话id\n    optional string busChannel = 2; // 频道(channelId,可以为空)\n    optional int32 count  = 3; // 操作人数\n    optional int32 opType = 4; //0, 正在输入, 1 正在XX \n  }\n  message ").concat(Rr,"\n  {\n    required string  rtcRoomId= 1;  //rtc房间ID;\n  }\n  message ").concat(Nr,"\n  {\n    required int32 nothing = 1;   //用于占位\n  }\n}\n");var br,Lr,Pr,Dr,xr,Vr,kr,Br=(br=Ar,Lr=function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}function n(e,t){var n,r,o;return t?(o=(e>>>=0)>=0&&e<256)&&(r=c[e])?r:(n=i(e,(0|e)<0?-1:0,!0),o&&(c[e]=n),n):(o=(e|=0)>=-128&&e<128)&&(r=a[e])?r:(n=i(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function r(e,t){if(isNaN(e)||!isFinite(e))return t?p:g;if(t){if(e<0)return p;if(e>=l)return E}else{if(-h>=e)return T;if(e+1>=h)return y}return e<0?r(-e,t).neg():i(0|e%d,0|e/d,t)}function i(t,n,r){return new e(t,n,r)}function o(e,t,n){var i,s,a,c,d,l,h;if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||n>36)throw RangeError("radix");if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return o(e.substring(1),t,n).neg();for(s=r(u(n,8)),a=g,c=0;c<e.length;c+=8)d=Math.min(8,e.length-c),l=parseInt(e.substring(c,c+d),n),d<8?(h=r(u(n,d)),a=a.mul(h).add(r(l))):a=(a=a.mul(s)).add(r(l));return a.unsigned=t,a}function s(t){return t instanceof e?t:"number"==typeof t?r(t):"string"==typeof t?o(t):i(t.low,t.high,t.unsigned)}var a,c,u,d,l,h,f,g,p,m,v,_,y,E,T,I;return e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t,a={},c={},e.fromInt=n,e.fromNumber=r,e.fromBits=i,u=Math.pow,e.fromString=o,e.fromValue=s,h=(l=(d=4294967296)*d)/2,f=n(16777216),g=n(0),e.ZERO=g,p=n(0,!0),e.UZERO=p,m=n(1),e.ONE=m,v=n(1,!0),e.UONE=v,_=n(-1),e.NEG_ONE=_,y=i(-1,2147483647,!1),e.MAX_VALUE=y,E=i(-1,-1,!0),e.MAX_UNSIGNED_VALUE=E,T=i(0,-2147483648,!1),e.MIN_VALUE=T,(I=e.prototype).toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},I.toString=function(e){var t,n,i,o,s,a,c,d;if((e=e||10)<2||e>36)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())return this.eq(T)?(t=r(e),i=(n=this.div(t)).mul(t).sub(this),n.toString(e)+i.toInt().toString(e)):"-"+this.neg().toString(e);for(o=r(u(e,6),this.unsigned),s=this,a="";;){if(c=s.div(o),d=(s.sub(c.mul(o)).toInt()>>>0).toString(e),(s=c).isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){var e,t;if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(e){return t(e)||(e=s(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.compare=function(e){if(t(e)||(e=s(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(m)},I.neg=I.negate,I.add=function(e){var n,r,o,a,c,u,d,l,h,f,g;return t(e)||(e=s(e)),n=this.high>>>16,r=65535&this.high,o=this.low>>>16,a=65535&this.low,c=e.high>>>16,u=65535&e.high,d=e.low>>>16,l=0,h=0,f=0,g=0,f+=(g+=a+(65535&e.low))>>>16,h+=(f+=o+d)>>>16,l+=(h+=r+u)>>>16,l+=n+c,i((f&=65535)<<16|(g&=65535),(l&=65535)<<16|(h&=65535),this.unsigned)},I.subtract=function(e){return t(e)||(e=s(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){var n,o,a,c,u,d,l,h,p,m,v,_;return this.isZero()?g:(t(e)||(e=s(e)),e.isZero()?g:this.eq(T)?e.isOdd()?T:g:e.eq(T)?this.isOdd()?T:g:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(f)&&e.lt(f)?r(this.toNumber()*e.toNumber(),this.unsigned):(n=this.high>>>16,o=65535&this.high,a=this.low>>>16,c=65535&this.low,u=e.high>>>16,d=65535&e.high,l=e.low>>>16,p=0,m=0,v=0,_=0,v+=(_+=c*(h=65535&e.low))>>>16,m+=(v+=a*h)>>>16,v&=65535,m+=(v+=c*l)>>>16,p+=(m+=o*h)>>>16,m&=65535,p+=(m+=a*l)>>>16,m&=65535,p+=(m+=c*d)>>>16,p+=n*h+o*l+a*d+c*u,i((v&=65535)<<16|(_&=65535),(p&=65535)<<16|(m&=65535),this.unsigned)))},I.mul=I.multiply,I.divide=function(e){var n,i,o,a,c,d,l;if(t(e)||(e=s(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return p;if(e.gt(this.shru(1)))return v;o=p}else{if(this.eq(T))return e.eq(m)||e.eq(_)?T:e.eq(T)?m:(n=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?m:_:(i=this.sub(e.mul(n)),o=n.add(i.div(e)));if(e.eq(T))return this.unsigned?p:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=g}for(i=this;i.gte(e);){for(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())),c=(a=Math.ceil(Math.log(n)/Math.LN2))<=48?1:u(2,a-48),l=(d=r(n)).mul(e);l.isNegative()||l.gt(i);)l=(d=r(n-=c,this.unsigned)).mul(e);d.isZero()&&(d=m),o=o.add(d),i=i.sub(l)}return o},I.div=I.divide,I.modulo=function(e){return t(e)||(e=s(e)),this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.not=function(){return i(~this.low,~this.high,this.unsigned)},I.and=function(e){return t(e)||(e=s(e)),i(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return t(e)||(e=s(e)),i(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return t(e)||(e=s(e)),i(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?i(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):i(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?i(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):i(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){var n;return t(e)&&(e=e.toInt()),0==(e&=63)?this:(n=this.high,e<32?i(this.low>>>e|n<<32-e,n>>>e,this.unsigned):i(32===e?n:n>>>e-32,0,this.unsigned))},I.shru=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?i(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:i(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,255&t>>>8,255&t>>>16,255&t>>>24,255&e,255&e>>>8,255&e>>>16,255&e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[255&e>>>24,255&e>>>16,255&e>>>8,255&e,255&t>>>24,255&t>>>16,255&t>>>8,255&t]},e}(),Pr=function(e){function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function n(){var e=[],t=[];return function(){return 0===arguments.length?t.join("")+c.apply(String,e):(e.length+arguments.length>1024&&(t.push(c.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}}function i(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,d=-7,l=n?i-1:0,h=n?-1:1,f=e[t+l];for(l+=h,o=f&(1<<-d)-1,f>>=-d,d+=a;d>0;o=256*o+e[t+l],l+=h,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=256*s+e[t+l],l+=h,d-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=u}return(f?-1:1)*s*Math.pow(2,o-r)}function o(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,d=(1<<u)-1,l=d>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,g=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?h/c:h*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=d?(a=0,s=d):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=g,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+f]=255&s,f+=g,s/=256,u-=8);e[n+f-g]|=128*p}var s,a,c,u,d,l=function e(t,n,r){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===n&&(n=e.DEFAULT_ENDIAN),void 0===r&&(r=e.DEFAULT_NOASSERT),!r){if((t|=0)<0)throw RangeError("Illegal capacity");n=!!n,r=!!r}this.buffer=0===t?a:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=n,this.noAssert=r};return l.VERSION="5.0.1",l.LITTLE_ENDIAN=!0,l.BIG_ENDIAN=!1,l.DEFAULT_CAPACITY=16,l.DEFAULT_ENDIAN=l.BIG_ENDIAN,l.DEFAULT_NOASSERT=!1,l.Long=e||null,(s=l.prototype).__isByteBuffer__,Object.defineProperty(s,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1}),a=new ArrayBuffer(0),c=String.fromCharCode,l.accessor=function(){return Uint8Array},l.allocate=function(e,t,n){return new l(e,t,n)},l.concat=function(e,t,n,r){var i,o,s,a,c,u;for(("boolean"==typeof t||"string"!=typeof t)&&(r=n,n=t,t=void 0),i=0,s=0,a=e.length;a>s;++s)l.isByteBuffer(e[s])||(e[s]=l.wrap(e[s],t)),(o=e[s].limit-e[s].offset)>0&&(i+=o);if(0===i)return new l(0,n,r);for(u=new l(i,n,r),s=0;a>s;)(o=(c=e[s++]).limit-c.offset)<=0||(u.view.set(c.view.subarray(c.offset,c.limit),u.offset),u.offset+=o);return u.limit=u.offset,u.offset=0,u},l.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},l.type=function(){return ArrayBuffer},l.wrap=function(e,t,n,i){var o,a;if("string"!=typeof t&&(i=n,n=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return l.fromBase64(e,n);case"hex":return l.fromHex(e,n);case"binary":return l.fromBinary(e,n);case"utf8":return l.fromUTF8(e,n);case"debug":return l.fromDebug(e,n);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!==r(e))throw TypeError("Illegal buffer");if(l.isByteBuffer(e))return(o=s.clone.call(e)).markedOffset=-1,o;if(e instanceof Uint8Array)o=new l(0,n,i),e.length>0&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.byteLength,o.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)o=new l(0,n,i),e.byteLength>0&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=e.byteLength>0?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");for((o=new l(e.length,n,i)).limit=e.length,a=0;a<e.length;++a)o.view[a]=e[a]}return o},s.writeBitSet=function(e,t){var n,r,i,o,s,a,c=void 0===t;if(c&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}for(r=t,o=(i=e.length)>>3,s=0,t+=this.writeVarint32(i,t);o--;)n=1&!!e[s++]|(1&!!e[s++])<<1|(1&!!e[s++])<<2|(1&!!e[s++])<<3|(1&!!e[s++])<<4|(1&!!e[s++])<<5|(1&!!e[s++])<<6|(1&!!e[s++])<<7,this.writeByte(n,t++);if(i>s){for(a=0,n=0;i>s;)n|=(1&!!e[s++])<<a++;this.writeByte(n,t++)}return c?(this.offset=t,this):t-r},s.readBitSet=function(e){var t,n,r,i,o,s,a,c=void 0===e;for(c&&(e=this.offset),i=(r=(n=this.readVarint32(e)).value)>>3,o=0,s=[],e+=n.length;i--;)t=this.readByte(e++),s[o++]=!!(1&t),s[o++]=!!(2&t),s[o++]=!!(4&t),s[o++]=!!(8&t),s[o++]=!!(16&t),s[o++]=!!(32&t),s[o++]=!!(64&t),s[o++]=!!(128&t);if(r>o)for(a=0,t=this.readByte(e++);r>o;)s[o++]=!!(1&t>>a++);return c&&(this.offset=e),s},s.readBytes=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}return n=this.slice(t,t+e),r&&(this.offset+=e),n},s.writeBytes=s.append,s.writeInt8=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return 128==(128&(t=this.view[e]))&&(t=-(255-t+1)),n&&(this.offset+=1),t},s.readByte=s.readInt8,s.writeUint8=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return t=this.view[e],n&&(this.offset+=1),t},s.readUInt8=s.readUint8,s.writeInt16=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),32768==(32768&t)&&(t=-(65535-t+1)),n&&(this.offset+=2),t},s.readShort=s.readInt16,s.writeUint16=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),n&&(this.offset+=2),t},s.readUInt16=s.readUint16,s.writeInt32=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),t|=0,n&&(this.offset+=4),t},s.readInt=s.readInt32,s.writeUint32=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),n&&(this.offset+=4),t},s.readUInt32=s.readUint32,e&&(s.writeInt64=function(t,n){var r,i,o,s=void 0===n;if(s&&(n=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),(n+=8)>(r=this.buffer.byteLength)&&this.resize((r*=2)>n?r:n),n-=8,i=t.low,o=t.high,this.littleEndian?(this.view[n+3]=255&i>>>24,this.view[n+2]=255&i>>>16,this.view[n+1]=255&i>>>8,this.view[n]=255&i,n+=4,this.view[n+3]=255&o>>>24,this.view[n+2]=255&o>>>16,this.view[n+1]=255&o>>>8,this.view[n]=255&o):(this.view[n]=255&o>>>24,this.view[n+1]=255&o>>>16,this.view[n+2]=255&o>>>8,this.view[n+3]=255&o,n+=4,this.view[n]=255&i>>>24,this.view[n+1]=255&i>>>16,this.view[n+2]=255&i>>>8,this.view[n+3]=255&i),s&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(t){var n,r,i,o=void 0===t;if(o&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}return n=0,r=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),i=new e(n,r,!1),o&&(this.offset+=8),i},s.readLong=s.readInt64,s.writeUint64=function(t,n){var r,i,o,s=void 0===n;if(s&&(n=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),(n+=8)>(r=this.buffer.byteLength)&&this.resize((r*=2)>n?r:n),n-=8,i=t.low,o=t.high,this.littleEndian?(this.view[n+3]=255&i>>>24,this.view[n+2]=255&i>>>16,this.view[n+1]=255&i>>>8,this.view[n]=255&i,n+=4,this.view[n+3]=255&o>>>24,this.view[n+2]=255&o>>>16,this.view[n+1]=255&o>>>8,this.view[n]=255&o):(this.view[n]=255&o>>>24,this.view[n+1]=255&o>>>16,this.view[n+2]=255&o>>>8,this.view[n+3]=255&o,n+=4,this.view[n]=255&i>>>24,this.view[n+1]=255&i>>>16,this.view[n+2]=255&i>>>8,this.view[n+3]=255&i),s&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(t){var n,r,i,o=void 0===t;if(o&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}return n=0,r=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),i=new e(n,r,!0),o&&(this.offset+=8),i},s.readUInt64=s.readUint64),s.writeFloat32=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,o(this.view,e,t,this.littleEndian,23,4),r&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,23,4),n&&(this.offset+=4),t},s.readFloat=s.readFloat32,s.writeFloat64=function(e,t){var n,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return(t+=8)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=8,o(this.view,e,t,this.littleEndian,52,8),r&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,52,8),n&&(this.offset+=8),t},s.readDouble=s.readFloat64,l.MAX_VARINT32_BYTES=5,l.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:1<<21>e?3:1<<28>e?4:5},l.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},l.zigZagDecode32=function(e){return 0|e>>>1^-(1&e)},s.writeVarint32=function(e,t){var n,r,i,o=void 0===t;if(o&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}for((t+=r=l.calculateVarint32(e))>(i=this.buffer.byteLength)&&this.resize((i*=2)>t?i:t),t-=r,e>>>=0;e>=128;)n=128|127&e,this.view[t++]=n,e>>>=7;return this.view[t++]=e,o?(this.offset=t,this):r},s.writeVarint32ZigZag=function(e,t){return this.writeVarint32(l.zigZagEncode32(e),t)},s.readVarint32=function(e){var t,n,r,i,o=void 0===e;if(o&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}n=0,r=0;do{if(!this.noAssert&&e>this.limit)throw(i=Error("Truncated")).truncated=!0,i;t=this.view[e++],n<5&&(r|=(127&t)<<7*n),++n}while(0!=(128&t));return r|=0,o?(this.offset=e,r):{value:r,length:n}},s.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"===r(t)?t.value=l.zigZagDecode32(t.value):t=l.zigZagDecode32(t),t},e&&(l.MAX_VARINT64_BYTES=10,l.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var n=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0,i=t.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==r?n<16384?n<128?1:2:1<<21>n?3:4:r<16384?r<128?5:6:1<<21>r?7:8:i<128?9:10},l.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},l.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(t,n){var r,i,o,s,a,c=void 0===n;if(c&&(n=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}switch("number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),r=l.calculateVarint64(t),i=t.toInt()>>>0,o=t.shiftRightUnsigned(28).toInt()>>>0,s=t.shiftRightUnsigned(56).toInt()>>>0,(n+=r)>(a=this.buffer.byteLength)&&this.resize((a*=2)>n?a:n),n-=r,r){case 10:this.view[n+9]=1&s>>>7;case 9:this.view[n+8]=9!==r?128|s:127&s;case 8:this.view[n+7]=8!==r?128|o>>>21:127&o>>>21;case 7:this.view[n+6]=7!==r?128|o>>>14:127&o>>>14;case 6:this.view[n+5]=6!==r?128|o>>>7:127&o>>>7;case 5:this.view[n+4]=5!==r?128|o:127&o;case 4:this.view[n+3]=4!==r?128|i>>>21:127&i>>>21;case 3:this.view[n+2]=3!==r?128|i>>>14:127&i>>>14;case 2:this.view[n+1]=2!==r?128|i>>>7:127&i>>>7;case 1:this.view[n]=1!==r?128|i:127&i}return c?(this.offset+=r,this):r},s.writeVarint64ZigZag=function(e,t){return this.writeVarint64(l.zigZagEncode64(e),t)},s.readVarint64=function(t){var n,r,i,o,s,a,c=void 0===t;if(c&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}if(n=t,r=0,i=0,o=0,s=0,r=127&(s=this.view[t++]),128&s&&(r|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(r|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(r|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(i=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(o=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[t++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");return a=e.fromBits(r|i<<28,i>>>4|o<<24,!1),c?(this.offset=t,a):{value:a,length:t-n}},s.readVarint64ZigZag=function(t){var n=this.readVarint64(t);return n&&n.value instanceof e?n.value=l.zigZagDecode64(n.value):n=l.zigZagDecode64(n),n}),s.writeCString=function(e,n){var r,i,o,s=void 0===n;if(s&&(n=this.offset),i=e.length,!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(r=0;i>r;++r)if(0===e.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return i=d.calculateUTF16asUTF8(t(e))[1],n+=i+1,o=this.buffer.byteLength,n>o&&this.resize((o*=2)>n?o:n),n-=i+1,d.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),this.view[n++]=0,s?(this.offset=n,this):i},s.readCString=function(e){var t,r,i,o=void 0===e;if(o&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return t=e,i=-1,d.decodeUTF8toUTF16(function(){if(0===i)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(i=this.view[e++])?null:i}.bind(this),r=n(),!0),o?(this.offset=e,r()):{string:r(),length:e-t}},s.writeIString=function(e,n){var r,i,o,s=void 0===n;if(s&&(n=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}if(i=n,r=d.calculateUTF16asUTF8(t(e),this.noAssert)[1],n+=4+r,o=this.buffer.byteLength,n>o&&this.resize((o*=2)>n?o:n),n-=4+r,this.littleEndian?(this.view[n+3]=255&r>>>24,this.view[n+2]=255&r>>>16,this.view[n+1]=255&r>>>8,this.view[n]=255&r):(this.view[n]=255&r>>>24,this.view[n+1]=255&r>>>16,this.view[n+2]=255&r>>>8,this.view[n+3]=255&r),n+=4,d.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==i+4+r)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+4+r));return s?(this.offset=n,this):n-i},s.readIString=function(e){var t,n,r,i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}return t=e,n=this.readUint32(e),r=this.readUTF8String(n,l.METRICS_BYTES,e+=4),e+=r.length,i?(this.offset=e,r.string):{string:r.string,length:e-t}},l.METRICS_CHARS="c",l.METRICS_BYTES="b",s.writeUTF8String=function(e,n){var r,i,o,s=void 0===n;if(s&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return i=n,r=d.calculateUTF16asUTF8(t(e))[1],n+=r,o=this.buffer.byteLength,n>o&&this.resize((o*=2)>n?o:n),n-=r,d.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),s?(this.offset=n,this):n-i},s.writeString=s.writeUTF8String,l.calculateUTF8Chars=function(e){return d.calculateUTF16asUTF8(t(e))[0]},l.calculateString=l.calculateUTF8Bytes=function(e){return d.calculateUTF16asUTF8(t(e))[1]},s.readUTF8String=function(e,t,r){var i,o,s,a,c;if("number"==typeof t&&(r=t,t=void 0),(i=void 0===r)&&(r=this.offset),void 0===t&&(t=l.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}if(s=0,a=r,t===l.METRICS_CHARS){if(o=n(),d.decodeUTF8(function(){return e>s&&r<this.limit?this.view[r++]:null}.bind(this),(function(e){++s,d.UTF8toUTF16(e,o)})),s!==e)throw RangeError("Illegal range: Truncated data, "+s+" == "+e);return i?(this.offset=r,o()):{string:o(),length:r-a}}if(t===l.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}if(c=r+e,d.decodeUTF8toUTF16(function(){return c>r?this.view[r++]:null}.bind(this),o=n(),this.noAssert),r!==c)throw RangeError("Illegal range: Truncated data, "+r+" == "+c);return i?(this.offset=r,o()):{string:o(),length:r-a}}throw TypeError("Unsupported metrics: "+t)},s.readString=s.readUTF8String,s.writeVString=function(e,n){var r,i,o,s,a=void 0===n;if(a&&(n=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}if(o=n,r=d.calculateUTF16asUTF8(t(e),this.noAssert)[1],i=l.calculateVarint32(r),n+=i+r,s=this.buffer.byteLength,n>s&&this.resize((s*=2)>n?s:n),n-=i+r,n+=this.writeVarint32(r,n),d.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==o+r+i)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+r+i));return a?(this.offset=n,this):n-o},s.readVString=function(e){var t,n,r,i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}return t=e,n=this.readVarint32(e),r=this.readUTF8String(n.value,l.METRICS_BYTES,e+=n.length),e+=r.length,i?(this.offset=e,r.string):{string:r.string,length:e-t}},s.append=function(e,t,n){var r,i,o;if(("number"==typeof t||"string"!=typeof t)&&(n=t,t=void 0),(r=void 0===n)&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return e instanceof l||(e=l.wrap(e,t)),(i=e.limit-e.offset)<=0||((n+=i)>(o=this.buffer.byteLength)&&this.resize((o*=2)>n?o:n),n-=i,this.view.set(e.view.subarray(e.offset,e.limit),n),e.offset+=i,r&&(this.offset+=i)),this},s.appendTo=function(e,t){return e.append(this,t),this},s.assert=function(e){return this.noAssert=!e,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(e){var t=new l(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},s.compact=function(e,t){var n,r,i;if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return 0===e&&t===this.buffer.byteLength?this:0==(n=t-e)?(this.buffer=a,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this):(r=new ArrayBuffer(n),(i=new Uint8Array(r)).set(this.view.subarray(e,t)),this.buffer=r,this.view=i,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=n,this)},s.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new l(0,this.littleEndian,this.noAssert);var n=t-e,r=new l(n,this.littleEndian,this.noAssert);return r.offset=0,r.limit=n,r.markedOffset>=0&&(r.markedOffset-=e),this.copyTo(r,0,e,t),r},s.copyTo=function(e,t,n,r){var i,o,s;if(!this.noAssert&&!l.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(o=void 0===t)?e.offset:0|t,n=(i=void 0===n)?this.offset:0|n,r=void 0===r?this.limit:0|r,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(n<0||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+n+" <= "+this.buffer.byteLength);return 0==(s=r-n)?e:(e.ensureCapacity(t+s),e.view.set(this.view.subarray(n,r),t),i&&(this.offset+=s),o&&(e.offset+=s),this)},s.ensureCapacity=function(e){var t=this.buffer.byteLength;return e>t?this.resize((t*=2)>e?t:e):this},s.fill=function(e,t,n){var r=void 0===t;if(r&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(t>=n)return this;for(;n>t;)this.view[t++]=e;return r&&(this.offset=t),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},s.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},s.LE=function(e){return this.littleEndian=void 0===e||!!e,this},s.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},s.prepend=function(e,t,n){var r,i,o,s,a;if(("number"==typeof t||"string"!=typeof t)&&(n=t,t=void 0),(r=void 0===n)&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}return e instanceof l||(e=l.wrap(e,t)),(i=e.limit-e.offset)<=0||((o=i-n)>0?(s=new ArrayBuffer(this.buffer.byteLength+o),(a=new Uint8Array(s)).set(this.view.subarray(n,this.buffer.byteLength),i),this.buffer=s,this.view=a,this.offset+=o,this.markedOffset>=0&&(this.markedOffset+=o),this.limit+=o,n+=o):new Uint8Array(this.buffer),this.view.set(e.view.subarray(e.offset,e.limit),n-i),e.offset=e.limit,r&&(this.offset-=i)),this},s.prependTo=function(e,t){return e.prepend(this,t),this},s.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(e){var t,n;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}return this.buffer.byteLength<e&&(t=new ArrayBuffer(e),(n=new Uint8Array(t)).set(this.view),this.buffer=t,this.view=n),this},s.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},s.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},s.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var n=this.clone();return n.offset=e,n.limit=t,n},s.toBuffer=function(e){var t,n=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: Not an integer");if(n>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,n<0||n>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+n+" <= "+r+" <= "+this.buffer.byteLength)}return e||0!==n||r!==this.buffer.byteLength?n===r?a:(t=new ArrayBuffer(r-n),new Uint8Array(t).set(new Uint8Array(this.buffer).subarray(n,r),0),t):this.buffer},s.toArrayBuffer=s.toBuffer,s.toString=function(e,t,n){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(n=t=e="utf8"),e){case"utf8":return this.toUTF8(t,n);case"base64":return this.toBase64(t,n);case"hex":return this.toHex(t,n);case"binary":return this.toBinary(t,n);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}},u=function(){var e,t,n={},r=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[];for(e=0,t=r.length;t>e;++e)i[r[e]]=e;return n.encode=function(e,t){for(var n,i;null!==(n=e());)t(r[63&n>>2]),i=(3&n)<<4,null!==(n=e())?(t(r[63&((i|=15&n>>4)|15&n>>4)]),i=(15&n)<<2,null!==(n=e())?(t(r[63&(i|3&n>>6)]),t(r[63&n])):(t(r[63&i]),t(61))):(t(r[63&i]),t(61),t(61))},n.decode=function(e,t){function n(e){throw Error("Illegal character code: "+e)}for(var r,o,s;null!==(r=e());)if(void 0===(o=i[r])&&n(r),null!==(r=e())&&(void 0===(s=i[r])&&n(r),t(o<<2>>>0|(48&s)>>4),null!==(r=e()))){if(void 0===(o=i[r])){if(61===r)break;n(r)}if(t((15&s)<<4>>>0|(60&o)>>2),null!==(r=e())){if(void 0===(s=i[r])){if(61===r)break;n(r)}t((3&o)<<6>>>0|s)}}},n.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)},n}(),s.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||e>t)throw RangeError("begin, end");var r;return u.encode(function(){return t>e?this.view[e++]:null}.bind(this),r=n()),r()},l.fromBase64=function(e,n){if("string"!=typeof e)throw TypeError("str");var r=new l(e.length/4*3,n),i=0;return u.decode(t(e),(function(e){r.view[i++]=e})),r.limit=i,r},l.btoa=function(e){return l.fromBinary(e).toBase64()},l.atob=function(e){return l.fromBase64(e).toBinary()},s.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var n=[],r=[];t>e;)n.push(this.view[e++]),n.length>=1024&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},l.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var n,r=0,i=e.length,o=new l(i,t);i>r;){if((n=e.charCodeAt(r))>255)throw RangeError("illegal char code: "+n);o.view[r++]=n}return o.limit=i,o},s.toDebug=function(e){for(var t,n=-1,r=this.buffer.byteLength,i="",o="",s="";r>n;){if(-1!==n&&(i+=(t=this.view[n])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(o+=t>32&&t<127?String.fromCharCode(t):".")),++n,e&&n>0&&n%16==0&&n!==r){for(;i.length<51;)i+=" ";s+=i+o+"\n",i=o=""}i+=n===this.offset&&n===this.limit?n===this.markedOffset?"!":"|":n===this.offset?n===this.markedOffset?"[":"<":n===this.limit?n===this.markedOffset?"]":">":n===this.markedOffset?"'":e||0!==n&&n!==r?" ":""}if(e&&" "!==i){for(;i.length<51;)i+=" ";s+=i+o+"\n"}return e?s:i},l.fromDebug=function(e,t,n){for(var r,i,o=e.length,s=new l(0|(o+1)/3,t,n),a=0,c=0,u=!1,d=!1,h=!1,f=!1,g=!1;o>a;){switch(r=e.charAt(a++)){case"!":if(!n){if(d||h||f){g=!0;break}d=h=f=!0}s.offset=s.markedOffset=s.limit=c,u=!1;break;case"|":if(!n){if(d||f){g=!0;break}d=f=!0}s.offset=s.limit=c,u=!1;break;case"[":if(!n){if(d||h){g=!0;break}d=h=!0}s.offset=s.markedOffset=c,u=!1;break;case"<":if(!n){if(d){g=!0;break}d=!0}s.offset=c,u=!1;break;case"]":if(!n){if(f||h){g=!0;break}f=h=!0}s.limit=s.markedOffset=c,u=!1;break;case">":if(!n){if(f){g=!0;break}f=!0}s.limit=c,u=!1;break;case"'":if(!n){if(h){g=!0;break}h=!0}s.markedOffset=c,u=!1;break;case" ":u=!1;break;default:if(!n&&u){g=!0;break}if(i=parseInt(r+e.charAt(a++),16),!n&&(isNaN(i)||i<0||i>255))throw TypeError("Illegal str: Not a debug encoded string");s.view[c++]=i,u=!0}if(g)throw TypeError("Illegal str: Invalid symbol at "+a)}if(!n){if(!d||!f)throw TypeError("Illegal str: Missing offset or limit");if(c<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+o)}return s},s.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var n,r=new Array(t-e);t>e;)(n=this.view[e++])<16?r.push("0",n.toString(16)):r.push(n.toString(16));return r.join("")},l.fromHex=function(e,t,n){var r,i,o,s,a;if(!n){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(i=e.length,o=new l(0|i/2,t),s=0,a=0;i>s;s+=2){if(r=parseInt(e.substring(s,s+2),16),!n&&(!isFinite(r)||r<0||r>255))throw TypeError("Illegal str: Contains non-hex characters");o.view[a++]=r}return o.limit=a,o},d=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var n=null;for("number"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(192|31&n>>6),t(128|63&n)):n<65536?(t(224|15&n>>12),t(128|63&n>>6),t(128|63&n)):(t(240|7&n>>18),t(128|63&n>>12),t(128|63&n>>6),t(128|63&n)),n=null},decodeUTF8:function(e,t){for(var n,r,i,o,s=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(n=e());)if(0==(128&n))t(n);else if(192==(224&n))null===(r=e())&&s([n,r]),t((31&n)<<6|63&r);else if(224==(240&n))(null===(r=e())||null===(i=e()))&&s([n,r,i]),t((15&n)<<12|(63&r)<<6|63&i);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=e())||null===(i=e())||null===(o=e()))&&s([n,r,i,o]),t((7&n)<<18|(63&r)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(e,t){for(var n,r=null;null!==(n=null!==r?r:e());)n>=55296&&n<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(n-55296)+r-56320+65536),r=null):t(n);null!==r&&t(r)},UTF8toUTF16:function(e,t){var n=null;for("number"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<=65535?t(n):(t(55296+((n-=65536)>>10)),t(n%1024+56320)),n=null},encodeUTF16toUTF8:function(t,n){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,n)}))},decodeUTF8toUTF16:function(t,n){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,n)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,n=0;null!==(t=e());)n+=t<128?1:t<2048?2:t<65536?3:4;return n},calculateUTF16asUTF8:function(t){var n=0,r=0;return e.UTF16toUTF8(t,(function(e){++n,r+=e<128?1:e<2048?2:e<65536?3:4})),[n,r]}};return e}(),s.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r;try{d.decodeUTF8toUTF16(function(){return t>e?this.view[e++]:null}.bind(this),r=n())}catch(n){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return r()},l.fromUTF8=function(e,n,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var i=new l(d.calculateUTF16asUTF8(t(e),!0)[1],n,r),o=0;return d.encodeUTF16toUTF8(t(e),(function(e){i.view[o++]=e})),i.limit=o,i},l}(Lr),Dr=function(e,t){var n,i,o={};return o.ByteBuffer=e,o.c=e,n=e,o.Long=t||null,o.VERSION="5.0.1",o.WIRE_TYPES={},o.WIRE_TYPES.VARINT=0,o.WIRE_TYPES.BITS64=1,o.WIRE_TYPES.LDELIM=2,o.WIRE_TYPES.STARTGROUP=3,o.WIRE_TYPES.ENDGROUP=4,o.WIRE_TYPES.BITS32=5,o.PACKABLE_WIRE_TYPES=[o.WIRE_TYPES.VARINT,o.WIRE_TYPES.BITS64,o.WIRE_TYPES.BITS32],o.TYPES={int32:{name:"int32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.ZERO:void 0},uint64:{name:"uint64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.UZERO:void 0},sint64:{name:"sint64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.ZERO:void 0},bool:{name:"bool",wireType:o.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:o.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:o.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:o.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:o.WIRE_TYPES.BITS64,defaultValue:o.Long?o.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:o.WIRE_TYPES.BITS64,defaultValue:o.Long?o.Long.ZERO:void 0},float:{name:"float",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:o.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:o.WIRE_TYPES.STARTGROUP,defaultValue:null}},o.MAP_KEY_TYPES=[o.TYPES.int32,o.TYPES.sint32,o.TYPES.sfixed32,o.TYPES.uint32,o.TYPES.fixed32,o.TYPES.int64,o.TYPES.sint64,o.TYPES.sfixed64,o.TYPES.uint64,o.TYPES.fixed64,o.TYPES.bool,o.TYPES.string,o.TYPES.bytes],o.ID_MIN=1,o.ID_MAX=536870911,o.convertFieldsToCamelCase=!1,o.populateAccessors=!0,o.populateDefaults=!0,o.Util=function(){var e={};return e.IS_NODE=!("object"!==("undefined"==typeof process?"undefined":r(process))||process+""!="[object process]"||process.browser),e.XHR=function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=null;for(e=0;e<t.length;e++){try{n=t[e]()}catch(e){continue}break}if(!n)throw Error("XMLHttpRequest is not supported");return n},e.fetch=function(t,n){if(n&&"function"!=typeof n&&(n=null),e.IS_NODE)if(n)g.readFile(t,(function(e,t){n(e?null:""+t)}));else try{return g.readFileSync(t)}catch(e){return null}else{var r=e.XHR();if(r.open("GET",t,!!n),r.setRequestHeader("Accept","text/plain"),"function"==typeof r.overrideMimeType&&r.overrideMimeType("text/plain"),!n)return r.send(null),200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null;if(r.onreadystatechange=function(){4==r.readyState&&(200==r.status||0==r.status&&"string"==typeof r.responseText?n(r.responseText):n(null))},4==r.readyState)return;r.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,(function(e,t){return t.toUpperCase()}))},e}(),o.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},o.DotProto=function(e,t){function n(e,n){var r=-1,i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))r=parseInt(e);else if(t.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(i<0?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=0|i*r,!n&&r<0)throw Error("illegal id value: "+(i<0?"-":"")+e);return r}function r(e){var n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return n*parseInt(e,10);if(t.NUMBER_HEX.test(e))return n*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return n*parseInt(e.substring(1),8);if("inf"===e)return 1/0*n;if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return n*parseFloat(e);throw Error("illegal number value: "+(n<0?"-":"")+e)}function i(e,t,n){void 0===e[t]?e[t]=n:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(n))}var o,s,a={},c=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},u=c.prototype;return u._readString=function(){var e,n='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;if(n.lastIndex=this.index-1,!(e=n.exec(this.source)))throw Error("unterminated string");return this.index=n.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,e[1]},u.next=function(){var e,n,r,i,o;if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();do{for(e=!1;t.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;n=r,r=this.source.charAt(this.index)}while("*"!==n||"/"!==r);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(i=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)++i;return('"'===(o=this.source.substring(this.index,this.index=i))||"'"===o)&&(this._stringOpen=o),o},u.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},u.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},u.omit=function(e){return this.peek()===e&&(this.next(),!0)},u.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},a.Tokenizer=c,o=function(e){this.tn=new c(e),this.proto3=!1},(s=o.prototype).parse=function(){var e,n={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},r=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!r||null!==n.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),n.package=e;break;case"import":if(!r)throw Error("unexpected 'import'");"public"===(e=this.tn.peek())&&this.tn.next(),e=this._readString(),this.tn.skip(";"),n.imports.push(e);break;case"syntax":if(!r)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(n.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(n,null),r=!1;break;case"enum":this._parseEnum(n),r=!1;break;case"option":this._parseOption(n);break;case"service":this._parseService(n);break;case"extend":this._parseExtend(n);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete n.name,n},o.parse=function(e){return new o(e).parse()},s._readString=function(){var e,t,n="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);n+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return n},s._readValue=function(e){var n=this.tn.peek();if('"'===n||"'"===n)return this._readString();if(this.tn.next(),t.NUMBER.test(n))return r(n);if(t.BOOL.test(n))return"true"===n.toLowerCase();if(e&&t.TYPEREF.test(n))return n;throw Error("illegal value: "+n)},s._parseOption=function(e,n){var r,i=this.tn.next(),o=!1;if("("===i&&(o=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal option name: "+i);r=i,o&&(this.tn.skip(")"),r="("+r+")",i=this.tn.peek(),t.FQTYPEREF.test(i)&&(r+=i,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,r),n||this.tn.skip(";")},s._parseOptionValue=function(e,n){var r=this.tn.peek();if("{"!==r)i(e.options,n,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!t.NAME.test(r))throw Error("illegal option name: "+n+"."+r);this.tn.omit(":")?i(e.options,n+"."+r,this._readValue(!0)):this._parseOptionValue(e,n+"."+r)}},s._parseService=function(e){var n,r=this.tn.next();if(!t.NAME.test(r))throw Error("illegal service name at line "+this.tn.line+": "+r);for(n={name:r,rpc:{},options:{}},this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(n);else{if("rpc"!==r)throw Error("illegal service token: "+r);this._parseServiceRPC(n)}this.tn.omit(";"),e.services.push(n)},s._parseServiceRPC=function(e){var n,r,i="rpc",o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal rpc service method name: "+o);if(n=o,r={request:null,response:null,request_stream:!1,response_stream:!1,options:{}},this.tn.skip("("),"stream"===(o=this.tn.next()).toLowerCase()&&(r.request_stream=!0,o=this.tn.next()),!t.TYPEREF.test(o))throw Error("illegal rpc service request type: "+o);if(r.request=o,this.tn.skip(")"),"returns"!==(o=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+o);if(this.tn.skip("("),"stream"===(o=this.tn.next()).toLowerCase()&&(r.response_stream=!0,o=this.tn.next()),r.response=o,this.tn.skip(")"),"{"===(o=this.tn.peek())){for(this.tn.next();"}"!==(o=this.tn.next());){if("option"!==o)throw Error("illegal rpc service token: "+o);this._parseOption(r)}this.tn.omit(";")}else this.tn.skip(";");void 0===e[i]&&(e[i]={}),e[i][n]=r},s._parseMessage=function(e,r){var i=!!r,o=this.tn.next(),s={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(o))throw Error("illegal "+(i?"group":"message")+" name: "+o);for(s.name=o,i&&(this.tn.skip("="),r.id=n(this.tn.next()),s.isGroup=!0),"["===(o=this.tn.peek())&&r&&this._parseFieldOptions(r),this.tn.skip("{");"}"!==(o=this.tn.next());)if(t.RULE.test(o))this._parseMessageField(s,o);else if("oneof"===o)this._parseMessageOneOf(s);else if("enum"===o)this._parseEnum(s);else if("message"===o)this._parseMessage(s);else if("option"===o)this._parseOption(s);else if("service"===o)this._parseService(s);else if("extensions"===o)s.extensions=this._parseExtensionRanges();else if("reserved"===o)this._parseIgnored();else if("extend"===o)this._parseExtend(s);else{if(!t.TYPEREF.test(o))throw Error("illegal message token: "+o);if(!this.proto3)throw Error("illegal field rule: "+o);this._parseMessageField(s,"optional",o)}return this.tn.omit(";"),e.messages.push(s),s},s._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},s._parseMessageField=function(e,r,i){var o,s,a;if(!t.RULE.test(r))throw Error("illegal message field rule: "+r);if(o={rule:r,type:"",name:"",options:{},id:0},"map"===r){if(i)throw Error("illegal type: "+i);if(this.tn.skip("<"),s=this.tn.next(),!t.TYPE.test(s)&&!t.TYPEREF.test(s))throw Error("illegal message field type: "+s);if(o.keytype=s,this.tn.skip(","),s=this.tn.next(),!t.TYPE.test(s)&&!t.TYPEREF.test(s))throw Error("illegal message field: "+s);if(o.type=s,this.tn.skip(">"),s=this.tn.next(),!t.NAME.test(s))throw Error("illegal message field name: "+s);o.name=s,this.tn.skip("="),o.id=n(this.tn.next()),"["===(s=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(i=void 0!==i?i:this.tn.next())){if(a=this._parseMessage(e,o),!/^[A-Z]/.test(a.name))throw Error("illegal group name: "+a.name);o.type=a.name,o.name=a.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(i)&&!t.TYPEREF.test(i))throw Error("illegal message field type: "+i);if(o.type=i,s=this.tn.next(),!t.NAME.test(s))throw Error("illegal message field name: "+s);o.name=s,this.tn.skip("="),o.id=n(this.tn.next()),"["===(s=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}return e.fields.push(o),o},s._parseMessageOneOf=function(e){var n,r,i,o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal oneof name: "+o);for(r=o,i=[],this.tn.skip("{");"}"!==(o=this.tn.next());)(n=this._parseMessageField(e,"optional",o)).oneof=r,i.push(n.id);this.tn.omit(";"),e.oneofs[r]=i},s._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},s._parseEnum=function(e){var r,i={name:"",values:[],options:{}},o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal name: "+o);for(i.name=o,this.tn.skip("{");"}"!==(o=this.tn.next());)if("option"===o)this._parseOption(i);else{if(!t.NAME.test(o))throw Error("illegal name: "+o);this.tn.skip("="),r={name:o,id:n(this.tn.next(),!0)},"["===(o=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),i.values.push(r)}this.tn.omit(";"),e.enums.push(i)},s._parseExtensionRanges=function(){var t,n,i,o=[];do{for(n=[];;){switch(t=this.tn.next()){case"min":i=e.ID_MIN;break;case"max":i=e.ID_MAX;break;default:i=r(t)}if(n.push(i),2===n.length)break;if("to"!==this.tn.peek()){n.push(i);break}this.tn.next()}o.push(n)}while(this.tn.omit(","));return this.tn.skip(";"),o},s._parseExtend=function(e){var n,r=this.tn.next();if(!t.TYPEREF.test(r))throw Error("illegal extend reference: "+r);for(n={ref:r,fields:[]},this.tn.skip("{");"}"!==(r=this.tn.next());)if(t.RULE.test(r))this._parseMessageField(n,r);else{if(!t.TYPEREF.test(r))throw Error("illegal extend token: "+r);if(!this.proto3)throw Error("illegal field rule: "+r);this._parseMessageField(n,"optional",r)}return this.tn.omit(";"),e.messages.push(n),n},s.toString=function(){return"Parser at line "+this.tn.line},a.Parser=o,a}(o,o.Lang),o.Reflect=function(t){function i(e,n){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new t.Long(e.low,e.high,void 0===n?e.unsigned:n);if("string"==typeof e)return t.Long.fromString(e,n||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,n||!1);throw Error("not convertible to Long")}function o(e,n){var r=n.readVarint32(),i=7&r,s=r>>>3;switch(i){case t.WIRE_TYPES.VARINT:do{r=n.readUint8()}while(128==(128&r));break;case t.WIRE_TYPES.BITS64:n.offset+=8;break;case t.WIRE_TYPES.LDELIM:r=n.readVarint32(),n.offset+=r;break;case t.WIRE_TYPES.STARTGROUP:o(s,n);break;case t.WIRE_TYPES.ENDGROUP:if(s===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+s+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:n.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+i)}return!0}var s,a,c,u,d,l,h,f,g,p,m,v,_,y,E,T,I={},C=function(e,t,n){this.builder=e,this.parent=t,this.name=n,this.className},S=C.prototype;return S.fqn=function(){for(var e=this.name,t=this;null!=(t=t.parent);)e=t.name+"."+e;return e},S.toString=function(e){return(e?this.className+" ":"")+this.fqn()},S.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},I.T=C,s=function(e,t,n,r,i){C.call(this,e,t,n),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=i||"proto2"},(a=s.prototype=Object.create(C.prototype)).getChildren=function(e){var t,n,r;if(null==(e=e||null))return this.children.slice();for(t=[],n=0,r=this.children.length;r>n;++n)this.children[n]instanceof e&&t.push(this.children[n]);return t},a.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof d.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof d.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},a.getChild=function(e){var t,n,r="number"==typeof e?"id":"name";for(t=0,n=this.children.length;n>t;++t)if(this.children[t][r]===e)return this.children[t];return null},a.resolve=function(e,t){var n,r="string"==typeof e?e.split("."):e,i=this,o=0;if(""===r[o]){for(;null!==i.parent;)i=i.parent;o++}do{do{if(!(i instanceof I.Namespace)){i=null;break}if(!((n=i.getChild(r[o]))&&n instanceof I.T&&(!t||n instanceof I.Namespace))){i=null;break}i=n,o++}while(o<r.length);if(null!=i)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=i);return i},a.qn=function(e){var t,n,r=[],i=e;do{r.unshift(i.name),i=i.parent}while(null!==i);for(t=1;t<=r.length;t++)if(n=r.slice(r.length-t),e===this.resolve(n,e instanceof I.Namespace))return n.join(".");return e.fqn()},a.build=function(){var e,t,n,r={},i=this.children;for(t=0,n=i.length;n>t;++t)(e=i[t])instanceof s&&(r[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(r,"$options",{value:this.buildOpt()}),r},a.buildOpt=function(){var e,t,n,r,i={},o=Object.keys(this.options);for(e=0,t=o.length;t>e;++e)n=o[e],r=this.options[o[e]],i[n]=r;return i},a.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},I.Namespace=s,c=function(e,n,r,i){if(this.type=e,this.resolvedType=n,this.isMapKey=r,this.syntax=i,r&&t.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},u=c.prototype,c.defaultFieldValue=function(e){if("string"==typeof e&&(e=t.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==t.TYPES.bytes?new n(0):e.defaultValue},u.verifyValue=function(n){var o,s,a,c=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof n||n==n&&n%1!=0)&&c(r(n),"not an integer"),n>4294967295?0|n:n;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof n||n==n&&n%1!=0)&&c(r(n),"not an integer"),n<0?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(n,!1)}catch(e){c(r(n),e.message)}else c(r(n),"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(n,!0)}catch(e){c(r(n),e.message)}else c(r(n),"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof n&&c(r(n),"not a boolean"),n;case t.TYPES.float:case t.TYPES.double:return"number"!=typeof n&&c(r(n),"not a number"),n;case t.TYPES.string:return"string"==typeof n||n&&n instanceof String||c(r(n),"not a string"),""+n;case t.TYPES.bytes:return e.isByteBuffer(n)?n:e.wrap(n);case t.TYPES.enum:for(o=this.resolvedType.getChildren(t.Reflect.Enum.Value),a=0;a<o.length;a++){if(o[a].name==n)return o[a].id;if(o[a].id==n)return o[a].id}if("proto3"===this.syntax)return("number"!=typeof n||n==n&&n%1!=0)&&c(r(n),"not an integer"),(n>4294967295||n<0)&&c(r(n),"not in range for uint32"),n;c(n,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(n&&"object"===r(n)||c(r(n),"object expected"),n instanceof this.resolvedType.clazz)return n;if(n instanceof t.Builder.Message){for(a in s={},n)n.hasOwnProperty(a)&&(s[a]=n[a]);n=s}return new this.resolvedType.clazz(n)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+n+" (undefined type "+this.type+")")},u.calculateLength=function(e,r){if(null===r)return 0;var i;switch(this.type){case t.TYPES.int32:return r<0?n.calculateVarint64(r):n.calculateVarint32(r);case t.TYPES.uint32:return n.calculateVarint32(r);case t.TYPES.sint32:return n.calculateVarint32(n.zigZagEncode32(r));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return n.calculateVarint64(r);case t.TYPES.sint64:return n.calculateVarint64(n.zigZagEncode64(r));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return n.calculateVarint32(r);case t.TYPES.double:return 8;case t.TYPES.string:return i=n.calculateUTF8Bytes(r),n.calculateVarint32(i)+i;case t.TYPES.bytes:if(r.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return n.calculateVarint32(r.remaining())+r.remaining();case t.TYPES.message:return i=this.resolvedType.calculate(r),n.calculateVarint32(i)+i;case t.TYPES.group:return(i=this.resolvedType.calculate(r))+n.calculateVarint32(e<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},u.encodeValue=function(e,r,i){var o,s;if(null===r)return i;switch(this.type){case t.TYPES.int32:r<0?i.writeVarint64(r):i.writeVarint32(r);break;case t.TYPES.uint32:i.writeVarint32(r);break;case t.TYPES.sint32:i.writeVarint32ZigZag(r);break;case t.TYPES.fixed32:i.writeUint32(r);break;case t.TYPES.sfixed32:i.writeInt32(r);break;case t.TYPES.int64:case t.TYPES.uint64:i.writeVarint64(r);break;case t.TYPES.sint64:i.writeVarint64ZigZag(r);break;case t.TYPES.fixed64:i.writeUint64(r);break;case t.TYPES.sfixed64:i.writeInt64(r);break;case t.TYPES.bool:"string"==typeof r?i.writeVarint32("false"===r.toLowerCase()?0:!!r):i.writeVarint32(r?1:0);break;case t.TYPES.enum:i.writeVarint32(r);break;case t.TYPES.float:i.writeFloat32(r);break;case t.TYPES.double:i.writeFloat64(r);break;case t.TYPES.string:i.writeVString(r);break;case t.TYPES.bytes:if(r.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");o=r.offset,i.writeVarint32(r.remaining()),i.append(r),r.offset=o;break;case t.TYPES.message:s=(new n).LE(),this.resolvedType.encode(r,s),i.writeVarint32(s.offset),i.append(s.flip());break;case t.TYPES.group:this.resolvedType.encode(r,i),i.writeVarint32(e<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return i},u.decode=function(e,n,r){if(n!=this.type.wireType)throw Error("Unexpected wire type for element");var i,o;switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(o=e.readVarint32(),e.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+e.remaining());return(i=e.clone()).limit=i.offset+o,e.offset+=o,i;case t.TYPES.message:return o=e.readVarint32(),this.resolvedType.decode(e,o);case t.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},u.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(e));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(e);case t.TYPES.bool:return"true"===e;case t.TYPES.string:return this.verifyValue(e);case t.TYPES.bytes:return n.fromBinary(e)}},u.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===t.TYPES.bytes?e.toString("binary"):e.toString()},I.Element=c,d=function(e,t,n,r,i,o){s.call(this,e,t,n,r,o),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!i,this._fields=null,this._fieldsById=null,this._fieldsByName=null},(l=d.prototype=Object.create(s.prototype)).build=function(i){var o,s,a,c;if(this.clazz&&!i)return this.clazz;for(o=function(t,i){function o(e,i,s,a){var c,u,d,l,h,f,g;if(null===e||"object"!==r(e))return a&&a instanceof t.Reflect.Enum&&null!==(c=t.Reflect.Enum.getName(a.object,e))?c:e;if(n.isByteBuffer(e))return i?e.toBase64():e.toBuffer();if(t.Long.isLong(e))return s?e.toString():t.Long.fromValue(e);if(Array.isArray(e))return u=[],e.forEach((function(e,t){u[t]=o(e,i,s,a)})),u;if(u={},e instanceof t.Map){for(l=(d=e.entries()).next();!l.done;l=d.next())u[e.keyElem.valueToString(l.value[0])]=o(l.value[1],i,s,e.valueElem.resolvedType);return u}for(g in h=e.$type,f=void 0,e)e.hasOwnProperty(g)&&(u[g]=h&&(f=h.getChild(g))?o(e[g],i,s,f.resolvedType):o(e[g],i,s));return u}var s,a,c=i.getChildren(t.Reflect.Message.Field),u=i.getChildren(t.Reflect.Message.OneOf),d=function e(o){var s,a,d,l;for(t.Builder.Message.call(this),s=0,a=u.length;a>s;++s)this[u[s].name]=null;for(s=0,a=c.length;a>s;++s)this[(d=c[s]).name]=d.repeated?[]:d.map?new t.Map(d):null,!d.required&&"proto3"!==i.syntax||null===d.defaultValue||(this[d.name]=d.defaultValue);if(arguments.length>0)if(1!==arguments.length||null===o||"object"!==r(o)||!("function"!=typeof o.encode||o instanceof e)||Array.isArray(o)||o instanceof t.Map||n.isByteBuffer(o)||o instanceof ArrayBuffer||t.Long&&o instanceof t.Long)for(s=0,a=arguments.length;a>s;++s)void 0!==(l=arguments[s])&&this.$set(c[s].name,l);else this.$set(o)},l=d.prototype=Object.create(t.Builder.Message.prototype);for(l.add=function(e,n,r){var o=i._fieldsByName[e];if(!r){if(!o)throw Error(this+"#"+e+" is undefined");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));if(!o.repeated)throw Error(this+"#"+e+" is not a repeated field");n=o.verifyValue(n,!0)}return null===this[e]&&(this[e]=[]),this[e].push(n),this},l.$add=l.add,l.set=function(e,n,o){var s,a,c;if(e&&"object"===r(e)){for(s in o=n,e)e.hasOwnProperty(s)&&void 0!==(n=e[s])&&this.$set(s,n,o);return this}if(a=i._fieldsByName[e],o)this[e]=n;else{if(!a)throw Error(this+"#"+e+" is not a field: undefined");if(!(a instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+a.toString(!0));this[a.name]=n=a.verifyValue(n)}return a&&a.oneof&&(c=this[a.oneof.name],null!==n?(null!==c&&c!==a.name&&(this[c]=null),this[a.oneof.name]=a.name):c===e&&(this[a.oneof.name]=null)),this},l.$set=l.set,l.get=function(e,n){if(n)return this[e];var r=i._fieldsByName[e];if(!(r&&r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},l.$get=l.get,s=0;s<c.length;s++)(a=c[s])instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t,n,r,o=e.originalName.replace(/(_[a-zA-Z])/g,(function(e){return e.toUpperCase().replace("_","")}));o=o.substring(0,1).toUpperCase()+o.substring(1),t=e.originalName.replace(/([A-Z])/g,(function(e){return"_"+e})),n=function(t,n){return this[e.name]=n?t:e.verifyValue(t),this},r=function(){return this[e.name]},null===i.getChild("set"+o)&&(l["set"+o]=n),null===i.getChild("set_"+t)&&(l["set_"+t]=n),null===i.getChild("get"+o)&&(l["get"+o]=r),null===i.getChild("get_"+t)&&(l["get_"+t]=r)}(a);return l.encode=function(t,n){var r,o;"boolean"==typeof t&&(n=t,t=void 0),r=!1,t||(t=new e,r=!0),o=t.littleEndian;try{return i.encode(this,t.LE(),n),(r?t.flip():t).LE(o)}catch(e){throw t.LE(o),e}},d.encode=function(e,t,n){return new d(e).encode(t,n)},l.calculate=function(){return i.calculate(this)},l.encodeDelimited=function(e){var t,r=!1;return e||(e=new n,r=!0),t=(new n).LE(),i.encode(this,t).flip(),e.writeVarint32(t.remaining()),e.append(t),r?e.flip():e},l.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},l.toArrayBuffer=l.encodeAB,l.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},l.toBuffer=l.encodeNB,l.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},l.toBase64=l.encode64,l.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},l.toHex=l.encodeHex,l.toRaw=function(e,t){return o(this,!!e,!!t,this.$type)},l.encodeJSON=function(){return JSON.stringify(o(this,!0,!0,this.$type))},d.decode=function(e,t){var r,o;"string"==typeof e&&(e=n.wrap(e,t||"base64")),r=(e=n.isByteBuffer(e)?e:n.wrap(e)).littleEndian;try{return o=i.decode(e.LE()),e.LE(r),o}catch(t){throw e.LE(r),t}},d.decodeDelimited=function(e,t){var r,o,s;if("string"==typeof e&&(e=n.wrap(e,t||"base64")),(e=n.isByteBuffer(e)?e:n.wrap(e)).remaining()<1)return null;if(r=e.offset,o=e.readVarint32(),e.remaining()<o)return e.offset=r,null;try{return s=i.decode(e.slice(e.offset,e.offset+o).LE()),e.offset+=o,s}catch(t){throw e.offset+=o,t}},d.decode64=function(e){return d.decode(e,"base64")},d.decodeHex=function(e){return d.decode(e,"hex")},d.decodeJSON=function(e){return new d(JSON.parse(e))},l.toString=function(){return i.toString()},Object.defineProperty&&(Object.defineProperty(d,"$options",{value:i.buildOpt()}),Object.defineProperty(l,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:i}),Object.defineProperty(l,"$type",{value:i})),d}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={},a=0,c=this.children.length;c>a;a++)if((s=this.children[a])instanceof m||s instanceof d||s instanceof y){if(o.hasOwnProperty(s.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+s.toString(!0)+" cannot override static property '"+s.name+"'");o[s.name]=s.build()}else if(s instanceof d.Field)s.build(),this._fields.push(s),this._fieldsById[s.id]=s,this._fieldsByName[s.name]=s;else if(!(s instanceof d.OneOf||s instanceof _))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[a].toString(!0));return this.clazz=o},l.encode=function(e,t,n){var r,i,o,s,a,c=null;for(o=0,s=this._fields.length;s>o;++o)i=e[(r=this._fields[o]).name],r.required&&null===i?null===c&&(c=r):r.encode(n?i:r.verifyValue(i),t,e);if(null!==c)throw(a=Error("Missing at least one required field for "+this.toString(!0)+": "+c)).encoded=t,a;return t},l.calculate=function(e){for(var t,n,r=0,i=0,o=this._fields.length;o>i;++i){if(n=e[(t=this._fields[i]).name],t.required&&null===n)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(n,e)}return r},l.decode=function(e,n,r){var i,s,a,c,u,d,l,h,f,g,p,m;for(n="number"==typeof n?n:-1,u=e.offset,d=new this.clazz;e.offset<u+n||-1===n&&e.remaining()>0;){if(a=(i=e.readVarint32())>>>3,(s=7&i)===t.WIRE_TYPES.ENDGROUP){if(a!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(r?r+" expected":"not a group")+")");break}if(c=this._fieldsById[a])c.repeated&&!c.options.packed?d[c.name].push(c.decode(s,e)):c.map?(h=c.decode(s,e),d[c.name].set(h[0],h[1])):(d[c.name]=c.decode(s,e),c.oneof&&(null!==(f=d[c.oneof.name])&&f!==c.name&&(d[f]=null),d[c.oneof.name]=c.name));else switch(s){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:l=e.readVarint32(),e.offset+=l;break;case t.WIRE_TYPES.STARTGROUP:for(;o(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+s)}}for(g=0,p=this._fields.length;p>g;++g)if(null===d[(c=this._fields[g]).name])if("proto3"===this.syntax)d[c.name]=c.defaultValue;else{if(c.required)throw(m=Error("Missing at least one required field for "+this.toString(!0)+": "+c.name)).decoded=d,m;t.populateDefaults&&null!==c.defaultValue&&(d[c.name]=c.defaultValue)}return d},I.Message=d,h=function(e,n,r,i,o,s,a,c,u,l){C.call(this,e,n,s),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=i||null,this.type=o,this.resolvedType=null,this.id=a,this.options=c||{},this.defaultValue=null,this.oneof=u||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof d.ExtensionField||(this.name=t.Util.toCamelCase(this.name))},(f=h.prototype=Object.create(C.prototype)).build=function(){this.element=new c(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new c(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=c.defaultFieldValue(this.type)},f.verifyValue=function(e,n){var i,o,s;if(n=n||!1,i=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this),null===e)return this.required&&i(r(e),"required"),"proto3"===this.syntax&&this.type!==t.TYPES.message&&i(r(e),"proto3 field without field presence cannot be null"),null;if(this.repeated&&!n){for(Array.isArray(e)||(e=[e]),s=[],o=0;o<e.length;o++)s.push(this.element.verifyValue(e[o]));return s}return this.map&&!n?e instanceof t.Map?e:(e instanceof Object||i(r(e),"expected ProtoBuf.Map or raw object for map field"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&i(r(e),"no array expected"),this.element.verifyValue(e))},f.hasWirePresence=function(e,n){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&n[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return e.length>0;case t.TYPES.bytes:return e.remaining()>0;case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},f.encode=function(e,i,o){var s,a,c,u,d;if(null===this.type||"object"!==r(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return i;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.ensureCapacity(i.offset+=1),a=i.offset,s=0;s<e.length;s++)this.element.encodeValue(this.id,e[s],i);c=i.offset-a,(u=n.calculateVarint32(c))>1&&(d=i.slice(a,i.offset),a+=u-1,i.offset=a,i.append(d)),i.writeVarint32(c,a-u)}else for(s=0;s<e.length;s++)i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e[s],i);else this.map?e.forEach((function(e,r){var o=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.writeVarint32(o),i.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,r,i),i.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,i)}),this):this.hasWirePresence(e,o)&&(i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e,i))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return i},f.calculate=function(e,i){var o,s,a;if(e=this.verifyValue(e),null===this.type||"object"!==r(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return 0;o=0;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(o+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),a=0,s=0;s<e.length;s++)a+=this.element.calculateLength(this.id,e[s]);o+=n.calculateVarint32(a),o+=a}else for(s=0;s<e.length;s++)o+=n.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,e[s]);else this.map?e.forEach((function(e,r){var i=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),o+=n.calculateVarint32(i),o+=i}),this):this.hasWirePresence(e,i)&&(o+=n.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,e))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return o},f.decode=function(e,n,r){var i,o,s,a,u,d,l;if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!r){for(o=n.readVarint32(),o=n.offset+o,s=[];n.offset<o;)s.push(this.decode(this.type.wireType,n,!0));return s}if(this.map){if(a=c.defaultFieldValue(this.keyType),i=c.defaultFieldValue(this.type),o=n.readVarint32(),n.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+n.remaining());for((u=n.clone()).limit=u.offset+o,n.offset+=o;u.remaining()>0;)if(e=7&(d=u.readVarint32()),1==(l=d>>>3))a=this.keyElement.decode(u,e,l);else{if(2!==l)throw Error("Unexpected tag in map field key/value submessage");i=this.element.decode(u,e,l)}return[a,i]}return this.element.decode(n,e,this.id)},I.Message.Field=h,g=function(e,t,n,r,i,o,s){h.call(this,e,t,n,null,r,i,o,s),this.extension},g.prototype=Object.create(h.prototype),I.Message.ExtensionField=g,p=function(e,t,n){C.call(this,e,t,n),this.fields=[]},I.Message.OneOf=p,m=function(e,t,n,r,i){s.call(this,e,t,n,r,i),this.className="Enum",this.object=null},m.getName=function(e,t){var n,r,i=Object.keys(e);for(r=0;r<i.length;++r)if(e[n=i[r]]===t)return n;return null},(m.prototype=Object.create(s.prototype)).build=function(e){var n,r,i,o;if(this.object&&!e)return this.object;for(n=new t.Builder.Enum,i=0,o=(r=this.getChildren(m.Value)).length;o>i;++i)n[r[i].name]=r[i].id;return Object.defineProperty&&Object.defineProperty(n,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=n},I.Enum=m,v=function(e,t,n,r){C.call(this,e,t,n),this.className="Enum.Value",this.id=r},v.prototype=Object.create(C.prototype),I.Enum.Value=v,_=function(e,t,n,r){C.call(this,e,t,n),this.field=r},_.prototype=Object.create(C.prototype),I.Extension=_,y=function(e,t,n,r){s.call(this,e,t,n,r),this.className="Service",this.clazz=null},(y.prototype=Object.create(s.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){var i,o=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,n){setTimeout(n.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},s=o.prototype=Object.create(e.Builder.Service.prototype),a=t.getChildren(e.Reflect.Service.RPCMethod);for(i=0;i<a.length;i++)!function(e){s[e.name]=function(i,o){try{try{i=e.resolvedRequestType.clazz.decode(n.wrap(i))}catch(e){if(!(e instanceof TypeError))throw e}if(null===i||"object"!==r(i))throw Error("Illegal arguments");i instanceof e.resolvedRequestType.clazz||(i=new e.resolvedRequestType.clazz(i)),this.rpcImpl(e.fqn(),i,(function(n,r){if(!n){try{r=e.resolvedResponseType.clazz.decode(r)}catch(e){}return r&&r instanceof e.resolvedResponseType.clazz?void o(null,r):void o(Error("Illegal response type received in service method "+t.name+"#"+e.name))}o(n)}))}catch(e){setTimeout(o.bind(this,e),0)}},o[e.name]=function(t,n,r){new o(t)[e.name](n,r)},Object.defineProperty&&(Object.defineProperty(o[e.name],"$options",{value:e.buildOpt()}),Object.defineProperty(s[e.name],"$options",{value:o[e.name].$options}))}(a[i]);return Object.defineProperty&&(Object.defineProperty(o,"$options",{value:t.buildOpt()}),Object.defineProperty(s,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:t}),Object.defineProperty(s,"$type",{value:t})),o}(t,this)},I.Service=y,E=function(e,t,n,r){C.call(this,e,t,n),this.className="Service.Method",this.options=r||{}},(E.prototype=Object.create(C.prototype)).buildOpt=a.buildOpt,I.Service.Method=E,T=function(e,t,n,r,i,o,s,a){E.call(this,e,t,n,a),this.className="Service.RPCMethod",this.requestName=r,this.responseName=i,this.requestStream=o,this.responseStream=s,this.resolvedRequestType=null,this.resolvedResponseType=null},T.prototype=Object.create(E.prototype),I.Service.RPCMethod=T,I}(o),o.Builder=function(e,t,n){function i(e){e.messages&&e.messages.forEach((function(t){t.syntax=e.syntax,i(t)})),e.enums&&e.enums.forEach((function(t){t.syntax=e.syntax}))}var o=function(e){this.ns=new n.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},s=o.prototype;return o.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},o.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},o.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},o.isService=function(e){return!("string"!=typeof e.name||"object"!==r(e.rpc)||!e.rpc)},o.isExtend=function(e){return"string"==typeof e.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach((function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new n.Namespace(this,this.ptr,e)),this.ptr=t}),this),this},s.create=function(t){var i,s,a,c,u;if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(i=[t];i.length>0;){if(t=i.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;t.length>0;){if(s=t.shift(),o.isMessage(s)){if(a=new n.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),c={},s.oneofs&&Object.keys(s.oneofs).forEach((function(e){a.addChild(c[e]=new n.Message.OneOf(this,a,e))}),this),s.fields&&s.fields.forEach((function(e){if(null!==a.getChild(0|e.id))throw Error("duplicate or invalid field id in "+a.name+": "+e.id);if(e.options&&"object"!==r(e.options))throw Error("illegal field options in "+a.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=c[e.oneof]))throw Error("illegal oneof in "+a.name+"#"+e.name+": "+e.oneof);e=new n.Message.Field(this,a,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,s.syntax),t&&t.fields.push(e),a.addChild(e)}),this),u=[],s.enums&&s.enums.forEach((function(e){u.push(e)})),s.messages&&s.messages.forEach((function(e){u.push(e)})),s.services&&s.services.forEach((function(e){u.push(e)})),s.extensions&&(a.extensions="number"==typeof s.extensions[0]?[s.extensions]:s.extensions),this.ptr.addChild(a),u.length>0){i.push(t),t=u,u=null,this.ptr=a,a=null;continue}u=null}else if(o.isEnum(s))a=new n.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach((function(e){a.addChild(new n.Enum.Value(this,a,e.name,e.id))}),this),this.ptr.addChild(a);else if(o.isService(s))a=new n.Service(this,this.ptr,s.name,s.options),Object.keys(s.rpc).forEach((function(e){var t=s.rpc[e];a.addChild(new n.Service.RPCMethod(this,a,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))}),this),this.ptr.addChild(a);else{if(!o.isExtend(s))throw Error("not a valid definition: "+JSON.stringify(s));if(a=this.ptr.resolve(s.ref,!0))s.fields.forEach((function(t){var r,i,o,s;if(null!==a.getChild(0|t.id))throw Error("duplicate extended field id in "+a.name+": "+t.id);if(a.extensions&&(r=!1,a.extensions.forEach((function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)})),!r))throw Error("illegal extended field id in "+a.name+": "+t.id+" (not within valid ranges)");i=t.name,this.options.convertFieldsToCamelCase&&(i=e.Util.toCamelCase(i)),o=new n.Message.ExtensionField(this,a,t.rule,t.type,this.ptr.fqn()+"."+i,t.id,t.options),s=new n.Extension(this,this.ptr,t.name,o),o.extension=s,this.ptr.addChild(s),a.addChild(o)}),this);else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("extended message "+s.ref+" is not defined")}s=null,a=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s.import=function(t,n){var o,s,a,c,u,d,l,h,f="/";if("string"==typeof n){if(e.Util.IS_NODE,!0===this.files[n])return this.reset();this.files[n]=!0}else if("object"===r(n)){if(o=n.root,e.Util.IS_NODE,(o.indexOf("\\")>=0||n.file.indexOf("\\")>=0)&&(f="\\"),s=o+f+n.file,!0===this.files[s])return this.reset();this.files[s]=!0}if(t.imports&&t.imports.length>0){for(c=!1,"object"===r(n)?(this.importRoot=n.root,c=!0,a=this.importRoot,n=n.file,(a.indexOf("\\")>=0||n.indexOf("\\")>=0)&&(f="\\")):"string"==typeof n?this.importRoot?a=this.importRoot:n.indexOf("/")>=0?""===(a=n.replace(/\/[^\/]*$/,""))&&(a="/"):n.indexOf("\\")>=0?(a=n.replace(/\\[^\\]*$/,""),f="\\"):a=".":a=null,u=0;u<t.imports.length;u++)if("string"==typeof t.imports[u]){if(!a)throw Error("cannot determine import root");if("google/protobuf/descriptor.proto"===(d=t.imports[u]))continue;if(d=a+f+d,!0===this.files[d])continue;if(/\.proto$/i.test(d)&&!e.DotProto&&(d=d.replace(/\.proto$/,".json")),null===(l=e.Util.fetch(d)))throw Error("failed to import '"+d+"' in '"+n+"': file not found");/\.json$/i.test(d)?this.import(JSON.parse(l+""),d):this.import(e.DotProto.Parser.parse(l),d)}else n?/\.(\w+)$/.test(n)?this.import(t.imports[u],n.replace(/^(.+)\.(\w+)$/,(function(e,t,n){return t+"_import"+u+"."+n}))):this.import(t.imports[u],n+"_import"+u):this.import(t.imports[u]);c&&(this.importRoot=null)}return t.package&&this.define(t.package),t.syntax&&i(t),h=this.ptr,t.options&&Object.keys(t.options).forEach((function(e){h.options[e]=t.options[e]})),t.messages&&(this.create(t.messages),this.ptr=h),t.enums&&(this.create(t.enums),this.ptr=h),t.services&&(this.create(t.services),this.ptr=h),t.extends&&this.create(t.extends),this.reset()},s.resolveAll=function(){var i;if(null==this.ptr||"object"===r(this.ptr.type))return this;if(this.ptr instanceof n.Namespace)this.ptr.children.forEach((function(e){this.ptr=e,this.resolveAll()}),this);else if(this.ptr instanceof n.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(i=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof n.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==i.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(i instanceof n.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((i=this.ptr.parent.resolve(this.ptr.requestName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,!((i=this.ptr.parent.resolve(this.ptr.responseName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=i}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+r(this.ptr)+": "+this.ptr);return this.reset()},s.build=function(e){var t,n,r;if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(t="string"==typeof e?e.split("."):e,n=this.result,r=0;r<t.length;r++){if(!n[t[r]]){n=null;break}n=n[t[r]]}return n},s.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},s.toString=function(){return"Builder"},o.Message=function(){},o.Enum=function(){},o.Service=function(){},o}(o,o.Lang,o.Reflect),o.Map=function(e,t){function n(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var r=function(e,n){var r,i,o,s;if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),n)for(r=Object.keys(n),i=0;i<r.length;i++)o=this.keyElem.valueFromString(r[i]),s=this.valueElem.verifyValue(n[r[i]]),this.map[this.keyElem.valueToString(o)]={key:o,value:s}},i=r.prototype;return i.clear=function(){this.map={}},i.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),n=t in this.map;return delete this.map[t],n},i.entries=function(){var e,t,r=[],i=Object.keys(this.map);for(t=0;t<i.length;t++)r.push([(e=this.map[i[t]]).key,e.value]);return n(r)},i.keys=function(){var e,t=[],r=Object.keys(this.map);for(e=0;e<r.length;e++)t.push(this.map[r[e]].key);return n(t)},i.values=function(){var e,t=[],r=Object.keys(this.map);for(e=0;e<r.length;e++)t.push(this.map[r[e]].value);return n(t)},i.forEach=function(e,t){var n,r,i=Object.keys(this.map);for(r=0;r<i.length;r++)e.call(t,(n=this.map[i[r]]).value,n.key,this)},i.set=function(e,t){var n=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(n)]={key:n,value:r},this},i.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));return t in this.map?this.map[t].value:void 0},i.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},r}(0,o.Reflect),o.loadProto=function(e,t,n){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(n=t,t=void 0),o.loadJson(o.DotProto.Parser.parse(e),t,n)},o.protoFromString=o.loadProto,o.loadProtoFile=function(e,t,n){if(t&&"object"===r(t)?(n=t,t=null):t&&"function"==typeof t||(t=null),t)return o.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null!==r)try{t(null,o.loadProto(r,n,e))}catch(e){t(e)}else t(Error("Failed to fetch file"))}));var i=o.Util.fetch("object"===r(e)?e.root+"/"+e.file:e);return null===i?null:o.loadProto(i,n,e)},o.protoFromFile=o.loadProtoFile,o.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=o.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=o.populateAccessors),new o.Builder(e)},o.loadJson=function(e,t,n){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(n=t,t=null),t&&"object"===r(t)||(t=o.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,n),t.resolveAll(),t},o.loadJsonFile=function(e,t,n){if(t&&"object"===r(t)?(n=t,t=null):t&&"function"==typeof t||(t=null),t)return o.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null!==r)try{t(null,o.loadJson(JSON.parse(r),n,e))}catch(e){t(e)}else t(Error("Failed to fetch file"))}));var i=o.Util.fetch("object"===r(e)?e.root+"/"+e.file:e);return null===i?null:o.loadJson(JSON.parse(i),n,e)},i=br,o.loadProto(i,void 0,"").build("Modules").probuf}(Pr,Lr),Dr);Br.getModule=function(e){var t=new Br[e];return t.getArrayData=function(){var e=t.toArrayBuffer();return e=$(e)?[].slice.call(new Int8Array(e)):e},t};var Gr,jr,qr="pgMsgP",Fr="chatMsg",Hr="pcMsgP",Kr={PRIVATE:"ppMsgS",GROUP:"pgMsgS",CHATROOM:"chatMsgS"},Yr="delMsg",Qr="joinChrm",Wr="joinChrmR",Jr="exitChrm",zr="setKV",Xr="delKV",Zr="setKVS",$r="delKVS",ei="qryRelationR",ti="delRelation",ni="setSeAtt",ri={PRIVATE:"cleanPMsg",GROUP:"cleanGMsg",ULTRA_GROUP:"cleanGMsg",CUSTOMER_SERVICE:"cleanCMsg",SYSTEM:"cleanSMsg"},ii="qryPMsg",oi="qryGMsg",si="qryCHMsg",ai="qryCMsg",ci="qrySMsg",ui=((xr={})["ppMsgP"]=Y.PRIVATE,xr[qr]=Y.GROUP,xr[Fr]=Y.CHATROOM,xr[Hr]=Y.CUSTOMER_SERVICE,xr),di=((Vr={})[Y.PRIVATE]=ii,Vr[Y.GROUP]=oi,Vr[Y.CHATROOM]=si,Vr[Y.CUSTOMER_SERVICE]=ai,Vr[Y.SYSTEM]=ci,Vr),li=((kr={})[Y.PRIVATE]=ri.PRIVATE,kr[Y.GROUP]=ri.GROUP,kr[Y.ULTRA_GROUP]=ri.ULTRA_GROUP,kr[Y.CUSTOMER_SERVICE]=ri.CUSTOMER_SERVICE,kr[Y.SYSTEM]=ri.SYSTEM,kr),hi="1",fi="0",gi=1,pi=2,mi=3,vi=function(){function e(e){this._codec="websocket"===e?Br:Mr,this._connectType=e}return e.prototype.decodeByPBName=function(e,t,n){var r,i=this,o=e,s=((r={})[Lt]=i._formatSyncMessages,r[bt]=i._formatReceivedMessage,r[wt]=i._formatSentMessage,r[Gt]=i._formatHistoryMessages,r[qt]=i._formatConversationList,r[$t]=i._formatChatRoomInfos,r[tn]=i._formatRTCUserList,r[dn]=i._formatRTCData,r[On]=i._formatChatRoomKVList,r[Dn]=i._formatUserSetting,r[kn]=i._formatConversationStatus,r[Wn]=i._formatGrpReadReceiptQryResp,r[Ln]=i._formatSetUserSettingOutput,r[xn]=i._formatUserSettingNotification,r[ar]=i._formatUltraMsgChangeList,r[hr]=i._formatUltraOperateStatusNotifyList,r[dr]=i._formatUltraMsgList,r[Xt]=i._formatChrmKVVersion,r[vr]=i._formatRTCRoomKVList,r[un]=i._formatRTCAuidenceJoinRoomData,r[yr]=i._formatRTCJoinedUserInfo,r)[t];try{o=e.length>0&&i._codec[t].decode(e),te(o)&&(o=function(e){for(var t in e)te(e[t])&&(e[t]=at(e[t]));return e}(o)),ne(s)&&(o=s.call(this,o,n))}catch(n){ge.error("PB parse error\n",n,e,t)}return o},e.prototype._readBytes=function(e){var t=e.offset,n=e.buffer,r=e.limit;if(t)try{var i=$(n)?new Uint8Array(n):n;return Ot.readUTF(i.subarray(t,r))}catch(e){ge.info("readBytes error\n",e)}return e},e.prototype._formatBytes=function(e){if(!e)return e;var t=this._readBytes(e);try{t=JSON.parse(t)}catch(e){ge.info("formatBytes error\n",e)}return t||e},e.prototype._formatSyncMessages=function(e,t){t=t||{};var n=this,r=e.list,i=e.syncTime,o=e.finished;return(re(o)||null===o)&&(e.finished=!0),e.syncTime=at(i),e.list=gt(r,(function(e){return n._formatReceivedMessage(e,t)})),e},e.prototype._formatReceivedMessage=function(e,t){if(!e)return e;var r=(t=t||{}).currentUserId,i=t.connectedTime,o=e.content,s=e.fromUserId,a=e.type,c=e.groupId,u=e.status,d=e.dataTime,l=e.classname,h=e.msgId,f=e.extraContent,g=e.pushContent,p=e.pushExt,m=e.configFlag,v=e.extStatus;e.toUserId,e.groupUnpush;var _=(e.direction||ve.RECEIVE)===ve.SEND,y=function(e){var t=n.READ;return{isPersited:!!(16&e),isCounted:!!(32&e),isMentioned:!!(64&e),disableNotification:!!(512&e),receivedStatus:t=2&e?n.RETRIEVED:t,canIncludeExpansion:!!(1024&e)}}(u),E=y.isPersited,T=y.isCounted,C=y.isMentioned,S=y.disableNotification,R=y.receivedStatus,N=y.canIncludeExpansion,O=!!(2&(v||0)),M=!!(4&(v||0)),U=[Y.GROUP,Y.CHATROOM,Y.RTC_ROOM,Y.ULTRA_GROUP].indexOf(a)>-1?c:s,w=_?r:s,A=at(d),b=A<i,L=a===Y.CHATROOM,P=this._formatBytes(o),D={};if(p&&(D=dt(p.pushConfigs,p.pushId)),P.user){var x=P.user,V=x.portrait,k=x.portraitUri,B=V||k;B&&(P.user.portrait=P.user.portraitUri=B)}var G,j=I(I({},D),{pushTitle:null==p?void 0:p.title,pushContent:g,pushData:g,disablePushTitle:!!m&&Boolean(4&m),forceShowDetailContent:!!m&&Boolean(8&m),templateId:null==p?void 0:p.templateId}),q=_?ve.SEND:ve.RECEIVE;L&&s===r&&(q=ve.SEND),f&&(G={},G=It(f));var F={conversationType:a,targetId:U,senderUserId:w,messageType:l,messageUId:h,isPersited:E,isCounted:T,isMentioned:C,sentTime:A,messageDirection:q,receivedTime:Ct.getTime(),disableNotification:S,receivedStatus:R,canIncludeExpansion:N,content:P,expansion:G,configFlag:m,pushConfig:j,channelId:e.busChannel||"",isInterrupt:O,isModifyMessage:M};return a!==Y.ULTRA_GROUP&&(F.isOffLineMessage=b),F},e.prototype._formatSentMessage=function(e,t){var n,r=e.content,i=e.classname,o=e.sessionId,s=e.msgId,a=e.extraContent,c=e.pushExt,u=e.pushContent,d=e.configFlag,l=e.extStatus,h=t.signal,f=t.currentUserId,g=h.date,p=h.topic,m=h.targetId,v=!!(2&(l||0)),_=function(e){return{isPersited:!!(1&e),isCounted:!!(2&e),disableNotification:!!(32&e),canIncludeExpansion:!!(64&e)}}(o),y=_.isPersited,E=_.isCounted,T=_.disableNotification,C=_.canIncludeExpansion,S=ui[p]||Y.PRIVATE,R=mt(Kr,p),N=this._formatBytes(r),O=m;i===Se.RECALL&&(S=N.conversationType||S,O=N.targetId||m),a&&(n={},n=It(a));var M={};c&&(M=dt(c.pushConfigs,c.pushId));var U=I(I({},M),{pushTitle:null==c?void 0:c.title,pushContent:u,pushData:u,disablePushTitle:!!d&&Boolean(4&d),forceShowDetailContent:!!d&&Boolean(8&d),templateId:null==c?void 0:c.templateId});return{conversationType:S,targetId:O,messageType:i,messageUId:s,isPersited:y,isCounted:E,isStatusMessage:R,senderUserId:f,content:this._formatBytes(r),sentTime:1e3*g,receivedTime:Ct.getTime(),messageDirection:ve.SEND,isOffLineMessage:!1,disableNotification:T,canIncludeExpansion:C,expansion:n,pushConfig:U,channelId:e.busChannel||"",isInterrupt:v}},e.prototype._formatHistoryMessages=function(e,t){var n=this,r=t.conversation||{},i=e.list,o=e.hasMsg,s=r.targetId,a=at(e.syncTime),c=[];return ft(i,(function(e){var i=n._formatReceivedMessage(e,t);r.conversationType===Y.ULTRA_GROUP?i.targetId=e.groupId||r.targetId:i.targetId=s,c.push(i)}),{isReverse:!0}),{syncTime:a,list:c,hasMore:!!o}},e.prototype._formatUltraMsgChangeList=function(e){var t=e.list,n=e.syncTime,r=e.hasNext;return{syncTime:n,list:t&&t.map((function(e){var t=e.targetId,n=e.type,r=e.time,i=e.changeType,o=e.msgUID,s=e.msgTime,a=e.busChannel,c=e.isAdmin,u=e.isDel,d=e.operatorId;return{targetId:t,conversationType:n,changeType:i,messageUId:o,changeTime:at(r),sendTime:at(s),channelId:a,isAdmin:c,isDel:u,operatorId:d}})),hasNext:r}},e.prototype._formatUltraOperateStatusNotifyList=function(e){var t=e.type,n=e.notifyType,r=e.info,i=e.summary,o=[],s=[],a=2==(2&n),c=1==(1&n);return c&&Array.isArray(r)&&r.forEach((function(e){var t=e.targetId,n=e.busChannel,r=e.userId,i=e.opType,s=e.optime,a=at(s);o.push({targetId:t,channelId:n,userId:r,operationType:i,operationTime:a})})),a&&Array.isArray(i)&&i.forEach((function(e){var t=e.targetId,n=e.busChannel,r=e.count,i=e.opType;s.push({targetId:t,channelId:n,count:r,operationType:i})})),{conversationType:t,info:o,summary:s,hasInfo:c,hasSummary:a}},e.prototype._formatUltraMsgList=function(e,t){var n=this,r=e.list;return{list:r&&r.map((function(e){return n._formatReceivedMessage(e,t)}))}},e.prototype._formatConversationList=function(e,t){var n=this,r=e.info,i=t.afterDecode||function(){},o={list:r=gt(r,(function(e){var r=e.msg,o=e.userId,s=e.type,a=e.unreadCount,c=e.busChannel,u=e.versionTime,d=e.remindCount,l=null;r&&((l=n._formatReceivedMessage(r,t)).targetId=o);var h={targetId:o,conversationType:s,unreadMessageCount:at(a)||0,latestMessage:l||{},channelId:c||""};return s===Y.ULTRA_GROUP&&(h.versionTime=at(u)||0,h.unreadMentionedCount=at(d)||0),i(h)||h}))};return((null==t?void 0:t.conversationType)||Y.NONE)===Y.ULTRA_GROUP&&(o.isFinished=e.isFinished),o},e.prototype._formatSetUserSettingOutput=function(e){return e},e.prototype._formatChatRoomInfos=function(e){var t=e.userTotalNums,n=e.userInfos;return{userCount:t,userInfos:gt(n,(function(e){var t=e.id,n=e.time;return{id:t,time:at(n)}}))}},e.prototype._formatChatRoomKVList=function(e){var t=e.entries,n=e.bFullUpdate,r=e.syncTime;return t=gt(t=t||[],(function(e){var t=e.key,n=e.value,r=e.status,i=e.timestamp,o=e.uid,s=e.version,a=function(e){return{isAutoDelete:!!(1&e),isOverwrite:!!(2&e),type:4&e?Pe.DELETE:Pe.UPDATE}}(r);return{key:t,value:n,isAutoDelete:a.isAutoDelete,isOverwrite:a.isOverwrite,type:a.type,userId:o,timestamp:at(i),version:at(s)}})),{kvEntries:t,isFullUpdate:n,syncTime:r}},e.prototype._formatUserSetting=function(e){var t=this,n=e.items,r=e.version,i={};return ft(n||[],(function(e){var n=e.key,r=e.version,o=e.value;e.version=at(r),e.value=t._readBytes(o),"Tag"===n&&e.tags.forEach((function(e){e.createdTime=at(e.createdTime),e.tagName=e.name})),i[n]=e})),{settings:i,version:r}},e.prototype._formatConversationStatus=function(e){var t=e.state,n=[];return ft(t,(function(e){var t=e.type,r=e.channelId,i=e.time,o=e.stateItem,s=e.busChannel,a=Ne.CLOSE,c=Me.NOT_SET,u=!1,d=[];ft(o,(function(e){var t=e.sessionStateType,n=e.value,r=e.tags;switch(t){case gi:a=n===hi?Ne.OPEN:Ne.CLOSE,c=Number(n)||Me.NOT_SET;break;case pi:u=n===hi;break;case mi:d=r}})),n.push({conversationType:t,type:t,targetId:r,notificationStatus:a,notificationLevel:c,isTop:u,updatedTime:at(i),tags:d,channelId:s||""})})),n},e.prototype._formatRTCUserList=function(e){var t=e.users,n=e.token,r=e.sessionId,i=e.roomInfo,o=e.entries,s={};return ft(t,(function(e){var t=e.userId,n=e.userData,r={};ft(n,(function(e){var t=e.key,n=e.value;r[t]=n})),s[t]=r})),{users:s,token:n,sessionId:r,roomInfo:i,kvEntries:o}},e.prototype._formatRTCData=function(e){var t=e.outInfo,n={};return ft(t,(function(e){n[e.key]=e.value})),n},e.prototype._formatRTCRoomInfo=function(e){var t=e.roomId,n=e.userCount,r=e.roomData,i={id:t,total:n};return ft(r,(function(e){i[e.key]=e.value})),i},e.prototype._formatGrpReadReceiptQryResp=function(e){var t=e.totalMemberNum,n=e.list;return n.forEach((function(e){e.readTime=at(e.readTime)})),{totalMemberCount:t,list:n}},e.prototype._formatUserSettingNotification=function(e){return e},e.prototype._formatRTCRoomKVList=function(e){var t=e.entries,n=e.bFullUpdate,r=e.syncTime;return{kvEntries:t=(t=t||[]).map((function(e){var t=e.timestamp;return Object.assign(e,{timestamp:at(t)})})),isFullUpdate:n,syncTime:r}},e.prototype._formatChrmKVVersion=function(e){return e},e.prototype._formatRTCAuidenceJoinRoomData=function(e){return e},e.prototype._formatRTCJoinedUserInfo=function(e){return(e.info||[]).map((function(e){return{deviceId:e.deviceId,roomId:e.roomId,joinTime:at(e.joinTime)}}))},e.prototype.encodeServerConfParams=function(){var e=this._codec.getModule(Pt);return e.setNothing(1),e.getArrayData()},e.prototype._getUpMsgModule=function(e,t){var n,r,i,o="comet"===this._connectType,s=e.conversationType,a=t.messageType,c=t.isMentioned,u=t.mentionedType,d=t.mentionedUserIdList,l=t.content,h=t.pushContent,f=t.pushData,g=t.directionalUserIdList,p=t.isFilerWhiteBlacklist,m=t.isVoipPush,v=t.canIncludeExpansion,_=t.expansion,y=t.pushConfig,E=t.channelId;[Y.GROUP,Y.ULTRA_GROUP].includes(s);var T=this._codec.getModule(wt),I=function(e){var t=e.isStatusMessage,n=e.isPersited,r=e.isCounted;t&&(n=r=!1);var i=0;return n&&(i|=1),r&&(i|=2),e.isMentioned&&(i|=4),e.disableNotification&&(i|=32),e.canIncludeExpansion&&(i|=64),i}(t),C=y||{},S=C.pushTitle,R=C.pushContent,N=C.pushData,O=C.iOSConfig,M=C.androidConfig,U=C.templateId,w=C.disablePushTitle,A=C.forceShowDetailContent,b=0;T.setSessionId(I),c&&l&&(l.mentionedInfo={userIdList:(null===(n=l.mentionedInfo)||void 0===n?void 0:n.userIdList)||d||[],type:(null===(r=l.mentionedInfo)||void 0===r?void 0:r.type)||u||we.ALL,mentionedContent:(null===(i=l.mentionedInfo)||void 0===i?void 0:i.mentionedContent)||""});var L=R||h||"",P=N||f||"";if(L&&T.setPushText(L),P&&T.setAppData(P),g&&T.setUserId(g),b|=m?1:0,b|=p?2:0,b|=w?4:0,b|=A?8:0,T.setConfigFlag(b),T.setClassname(a),l.user&&l.user.portraitUri&&(l.user.portrait=l.user.portraitUri),T.setContent(JSON.stringify(l)),v&&_){var D={};ft(_,(function(e,t){D[t]={v:e}})),T.setExtraContent(JSON.stringify(D))}if(y){var x=this._codec.getModule(At);if(S&&x.setTitle(S),O&&M){var V=ut(O,M);x.setPushConfigs(V)}(null==M?void 0:M.notificationId)&&x.setPushId(null==M?void 0:M.notificationId),x.setTemplateId(U||""),T.setPushExt(o?x.getArrayData():x)}return re(E)||T.setBusChannel(E),T},e.prototype.encodeUpMsg=function(e,t){return this._getUpMsgModule(e,t).getArrayData()},e.prototype.encodeSyncMsg=function(e){var t=e.sendboxTime,n=e.inboxTime,r=e.broadcastSyncTime,i=this._codec.getModule(xt);return i.setIspolling(!1),i.setIsPullSend(!0),i.setSendBoxSyncTime(t),i.setSyncTime(n),i.setBroadcastSyncTime(r),i.getArrayData()},e.prototype.encodeChrmSyncMsg=function(e,t){e=e||0,t=t||0;var n=this._codec.getModule(Vt);return n.setCount(t),n.setSyncTime(e),n.getArrayData()},e.prototype.encodeGetHistoryMsg=function(e,t){var n=t.count,r=t.order,i=t.timestamp,o=t.channelId,s=this._codec.getModule(Bt);return s.setTargetId(e),s.setTime(i),s.setCount(n),s.setOrder(r),s.setBusChannel(o||""),s.getArrayData()},e.prototype.encodeSuperSyncMsg=function(e){var t=this._codec.getModule(rr);return t.setSyncTime(e),t.getArrayData()},e.prototype.encodeGetConversationList=function(e){var t=(e=e||{}).count,n=e.startTime,r=this._codec.getModule(jt);return r.setType(1),r.setCount(t),r.setStartTime(n),r.getArrayData()},e.prototype.encodeOldConversationList=function(e){var t=(e=e||{}).count,n=e.type,r=e.startTime,i=e.order;t=t||0,r=r||0,i=i||0;var o=this._codec.getModule(jt);return o.setType(n),o.setCount(t),o.setStartTime(r),o.setOrder(i),o.getArrayData()},e.prototype.encodeRemoveOldConversationList=function(e){var t=(e=e||{}).conversationType,n=e.channelId,r=this._codec.getModule(Yt);return r.setType(t),n&&r.setBusChannel([n]),r.getArrayData()},e.prototype.encodeRemoveConversationList=function(e){var t=this,n=this._codec.getModule(Ft),r=[];return ft(e,(function(e){var n=e.conversationType,i=e.targetId,o=t._codec.getModule(Ht);o.setType(n),o.setChannelId(i),r.push(o)})),n.setSessions(r),n.getArrayData()},e.prototype.encodeDeleteMessages=function(e,t,n,r){var i=this._codec.getModule(Qt),o=[];return ft(n,(function(e){o.push({msgId:e.messageUId,msgDataTime:e.sentTime,direct:e.messageDirection})})),i.setType(e),i.setConversationId(t),i.setMsgs(o),i.setBusChannel(r),i.getArrayData()},e.prototype.encodeClearMessages=function(e,t,n,r){var i=this._codec.getModule(Wt);return t=t||(new Date).getTime(),i.setDataTime(t),i.setTargetId(e),i.setBusChannel(n),i.setConversationType(r),i.getArrayData()},e.prototype.encodeClearUnreadCount=function(e,t){var n=e.conversationType,r=e.targetId,i=e.channelId,o=t.timestamp,s=this._codec.getModule(Jt);return o=o||+new Date,s.setType(n),s.setChannelId(r),s.setMsgTime(o),s.setBusChannel(i),s.getArrayData()},e.prototype.encodeExpandUltraMessage=function(e,t){var n=e.targetId,r=e.conversationType,i=e.channelId,o=e.messageUId,s=e.sendTime,a=e.keys,c={mid:o,put:e.expansion,del:a,clear:e.removeAll?1:0},u=this._codec.getModule(ir);return u.setFromUserId(t),u.setTargetId(n),u.setType(r),u.setBusChannel(i||""),u.setMsgUID(o),u.setMsgTime(s),u.setContent(JSON.stringify(c)),u.getArrayData()},e.prototype.encodemodifyMessage=function(e,t){var n=e.targetId,r=e.conversationType,i=e.channelId,o=e.messageUId,s=e.sendTime,a=e.content,c=this._codec.getModule(ir);return c.setFromUserId(t),c.setTargetId(n),c.setType(r),c.setBusChannel(i||""),c.setMsgUID(o),c.setMsgTime(s),c.setContent(JSON.stringify(a)),c.getArrayData()},e.prototype.encodeQueryMsgChange=function(e){var t=this._codec.getModule(or);return t.setSyncTime(e),t.getArrayData()},e.prototype.encodeMsgQuery=function(e){var t=e.targetId,n=e.conversationType,r=e.messages,i=this._codec.getModule(cr),o=r.map((function(e){return{msgTime:e.sendTime,msgUID:e.messageUId,busChannel:e.channelId}}));return i.setTargetId(t),i.setType(n),i.setQuery(o),i.getArrayData()},e.prototype.encodeOperateStatus=function(e,t,n,r){var i=this._codec.getModule(lr);return i.setTargetId(e),i.setType(t),i.setBusChannel(n),i.setOpType(r),i.getArrayData()},e.prototype.encodeJoinOrQuitChatRoom=function(){var e=this._codec.getModule(zt);return e.setNothing(1),e.getArrayData()},e.prototype.encodeGetChatRoomInfo=function(e,t){var n=this._codec.getModule(Zt);return n.setCount(e),n.setOrder(t),n.getArrayData()},e.prototype.encodeSetUltraGroupDefaultNotificationLevel=function(e,t){var n=this._codec.getModule(Hn);return n.setUnpushLevel(e),n.setBusChannel(t),n.getArrayData()},e.prototype.encodeGetUltraGroupDefaultNotificationLevel=function(e){var t=this._codec.getModule(Fn);return t.setBusChannel(e),t.getArrayData()},e.prototype.encodeGetFileToken=function(e,t,n,r){var i=this._codec.getModule(vn);return i.setType(e),i.setKey(t),i.setHttpMethod(n),i.setQueryString(r),i.getArrayData()},e.prototype.encodeGetFileUrl=function(e,t,n,r){var i=this._codec.getModule(e);return i.setType(t),i.setKey(n),r&&i.setFileName(r),i.getArrayData()},e.prototype.encodeModifyChatRoomKV=function(e,t,n){var r="comet"===this._connectType,i=this._codec.getModule(Sn),o=t.key,s=t.value,a=t.notificationExtra,c=t.isSendNotification,u=t.type,d=t.timestamp,l=u||Pe.UPDATE,h=St(t,l),f={key:o,value:s||"",uid:n,version:d};if(re(h)||(f.status=h),i.setEntry(f),c){var g={conversationType:Y.CHATROOM,targetId:e},p={key:o,value:s,extra:a,type:l},m=this._getUpMsgModule(g,{messageType:Se.CHRM_KV_NOTIFY,content:p,isPersited:!1,isCounted:!1});r?i.setNotification(m.getArrayData()):i.setNotification(m),i.setBNotify(!0),i.setType(Y.CHATROOM)}return i.getArrayData()},e.prototype.encodeModifyChatRoomKVS=function(e,t,n){this._connectType;var r=this._codec.getModule(Rn),i=t.entries,o=t.type||Pe.UPDATE,s=St(t,o),a=[];return i.forEach((function(e){var t={key:e.key,value:e.value||"",uid:n,version:e.timestamp};re(s)||(t.status=s),a.push(t)})),r.setEntry(a),r.getArrayData()},e.prototype.encodePullChatRoomKV=function(e){var t=this._codec.getModule(An);return t.setTimestamp(e),t.getArrayData()},e.prototype.encodePullUserSetting=function(e){var t=this._codec.getModule(Pn);return t.setVersion(e),t.getArrayData()},e.prototype.encodeGetConversationStatus=function(e){var t=this._codec.getModule(Vn);return t.setTime(e),t.getArrayData()},e.prototype.encodeSetConversationStatus=function(e){var t=this,n="comet"===this._connectType,r=this._codec.getModule(jn),i=Ct.getTime(),o=[];return ft(e,(function(e){var r=t._codec.getModule(Bn),s=e.conversationType,a=e.targetId,c=e.notificationStatus,u=e.isTop,d=e.channelId,l=e.notificationLevel,h=[];r.setType(s),r.setChannelId(a),r.setTime(i),r.setBusChannel(d);var f=c===Ne.OPEN,g={};re(c)||(g[gi]=f),re(l)||(g[gi]=l),re(u)||(g[pi]=u),ft(g,(function(e,r){if(!re(e)){var i=t._codec.getModule(Gn);e=e?hi:fi,re(l)||Number(r)!==gi||(e=String(l)),i.setSessionStateType(Number(r)),i.setValue(e);var o=n?i.getArrayData():i;h.push(o)}})),r.setStateItem(h);var p=n?r.getArrayData():r;o.push(p)})),r.setVersion(i),r.setState(o),r.getArrayData()},e.prototype.encodeReadReceipt=function(e,t){var n=this._codec.getModule(Yn);return n.setMsgId(e),t&&n.setChannelId(t),n.getArrayData()},e.prototype.encodeCreateTag=function(e,t){var n=this,r="comet"===this._connectType,i=this._codec.getModule(zn),o=[];return e.forEach((function(e){var t=n._codec.getModule(Xn);t.setTagId(e.tagId),t.setName(e.tagName),o.push(r?t.getArrayData():t)})),i.setTags(o),i.setVersion(t),i.getArrayData()},e.prototype.encodeMessageReader=function(e,t){var n=this._codec.getModule(Yn);return n.setMsgId(e),t&&n.setChannelId(t),n.getArrayData()},e.prototype.encodeRemoveTag=function(e,t){var n=this,r="comet"===this._connectType,i=this._codec.getModule(Zn),o=[];return e.forEach((function(e){var t=n._codec.getModule(Xn);t.setTagId(e),o.push(r?t.getArrayData():t)})),i.setTags(o),i.setVersion(t),i.getArrayData()},e.prototype.encodeDisConversationTag=function(e){var t=this._codec.getModule($n);return t.setTagId(e),t.getArrayData()},e.prototype.encodeUpdateConversationTag=function(e,t){var n=this,r="comet"===this._connectType,i=this._codec.getModule(jn),o=[];return t.forEach((function(t){var i=n._codec.getModule(Bn),s=n._codec.getModule(Gn),a=[];e.forEach((function(e){var t=n._codec.getModule(Xn);t.setTagId(e.tagId),re(e.isTop)||t.setIsTop(e.isTop),a.push(r?t.getArrayData():t)})),s.setSessionStateType(mi),s.setValue(JSON.stringify(a)),s.setTags(a),i.setType(t.conversationType),i.setChannelId(t.targetId),i.setTime(Date.now()),i.setStateItem([r?s.getArrayData():s]),o.push(r?i.getArrayData():i)})),i.setState(o),i.setVersion(Ct.getTime()),i.getArrayData()},e.prototype.encodeReportSDKInfo=function(e){var t=this._codec.getModule(er);return t.setSdkInfo(e),t.getArrayData()},e.prototype.encodeUltraGroup=function(e,t){var n=this._codec.getModule(nr);return n.setSyncTime(e),n.setIsEraseMsgContent(t),n.getArrayData()},e.prototype.encodeJoinRTCRoom=function(e,t,n,r,i){var o=this,s="comet"===this._connectType,a=this._codec.getModule(en);if(e=e||0,a.setRoomType(e),re(t)||a.setBroadcastType(t),re(n)||a.setJoinType(n),r){var c=[],u=this._codec.getModule(pn);for(var d in r)u.setKey(d),u.setValue(r[d]),s?c.push(u.getArrayData()):c.push(u);a.setInnerDatas(c)}if(i){var l=[];Object.keys(i).forEach((function(e){var t=o._codec.getModule(pn);t.setKey(e),t.setValue(i[e]),s?l.push(t.getArrayData()):l.push(t)})),a.setOuterDatas(l)}return a.getArrayData()},e.prototype.encodeQuitRTCRoom=function(){return this._codec.getModule(nn).getArrayData()},e.prototype.encodeSetRTCData=function(e,t,n,r,i){var o=this._codec.getModule(rn);if(o.setInterior(n),o.setTarget(r),o.setKey(e),o.setValue(t),i){i.name&&o.setObjectName(i.name);var s=i.content;s&&(te(s)&&(s=JSON.stringify(s)),o.setContent(s))}return o.getArrayData()},e.prototype.encodeUserSetRTCData=function(e,t,n,r){var i=this,o="comet"===this._connectType,s=this._codec.getModule(on);s.setObjectName(n);var a=this._codec.getModule(pn);a.setKey(e.name),a.setValue(e.content),o?s.setContent(a.getArrayData()):s.setContent(a);var c=[];return["uris","mcu_uris"].forEach((function(e){var n=i._codec.getModule(pn);n.setKey(e);var s="uris"===e?t:r;n.setValue(s),o?c.push(n.getArrayData()):c.push(n)})),s.setValueInfo(c),s.getArrayData()},e.prototype.encodeUserSetRTCCDNUris=function(e,t){this._connectType;var n=this._codec.getModule(on);n.setObjectName(e);var r=this._codec.getModule(pn);return r.setKey("cdn_uris"),r.setValue(t),n.setValueInfo(r),n.getArrayData()},e.prototype.encodeGetRTCData=function(e,t,n){var r=this._codec.getModule(sn);return r.setInterior(t),r.setTarget(n),r.setKey(e),r.getArrayData()},e.prototype.encodeRemoveRTCData=function(e,t,n,r){var i=this._codec.getModule(sn);i.setInterior(t),i.setTarget(n),i.setKey(e);var o=(r=r||{}).name,s=r.content;return!re(o)&&i.setObjectName(o),re(s)||(te(s)&&(s=JSON.stringify(s)),i.setContent(s)),i.getArrayData()},e.prototype.encodeSetRTCOutData=function(e,t,n){var r=this._codec.getModule(an);r.setTarget(t),Z(e)||(e=[e]),ft(e,(function(t,n){t.key=t.key?t.key.toString():t.key,t.value=t.value?t.value.toString():t.value,e[n]=t})),r.setValueInfo(e);var i=(n=n||{}).name,o=n.content;return!re(i)&&r.setObjectName(i),re(o)||(te(o)&&(o=JSON.stringify(o)),r.setContent(o)),r.getArrayData()},e.prototype.ecnodeGetRTCOutData=function(e){var t=this._codec.getModule(ln);return t.setUserId(e),t.getArrayData()},e.prototype.encodeSetRTCState=function(e){var t=this._codec.getModule(cn);return t.setState(e),t.getArrayData()},e.prototype.encodeGetRTCRoomInfo=function(){var e=this._codec.getModule(fn);return e.setOrder(2),e.getArrayData()},e.prototype.encodeSetRTCUserInfo=function(e,t){var n=this._codec.getModule(pn);return n.setKey(e),n.setValue(t),n.getArrayData()},e.prototype.encodeRemoveRTCUserInfo=function(e){var t=this._codec.getModule(mn);return t.setKey(e),t.getArrayData()},e.prototype.encodeIdentityChangeInfo=function(e,t,n){void 0===n&&(n=!1);var r=this._codec.getModule(en);return r.setRoomType(Be.LIVE),t&&r.setBroadcastType(t),r.setIdentityChangeType(e),r.setNeedSysChatroom(n),r.getArrayData()},e.prototype.encodePullRTCRoomKV=function(e,t){var n=this._codec.getModule(mr);return n.setTimestamp(t),n.setRoomId(e),n.getArrayData()},e.prototype.encodeQueryUserJoinedInfo=function(e){var t=this._codec.getModule(_r);return t.setUserId(e),t.getArrayData()},e.prototype.encodeRequestRoomPK=function(e){var t=e.invitedRoomId,n=e.invitedUserId,r=e.inviteSessionId,i=e.inviteTimeout,o=e.inviteInfo,s=this._codec.getModule(Tr);return s.setInvitedRoomId(t),s.setInvitedUserId(n),s.setInviteSessionId(r),s.setTimeoutTime(i),s.setInviteInfo(o),s.getArrayData()},e.prototype.encodeCancelRoomPK=function(e){var t=e.invitedRoomId,n=e.invitedUserId,r=e.inviteSessionId,i=e.inviteInfo,o=this._codec.getModule(Ir);return o.setInvitedRoomId(t),o.setInvitedUserId(n),o.setInviteSessionId(r),o.setInviteInfo(i),o.getArrayData()},e.prototype.encodeResponseRoomPK=function(e){var t=e.inviteUserId,n=e.inviteRoomId,r=e.inviteSessionId,i=e.content,o=e.key,s=e.value,a=e.agree?1:0,c=this._codec.getModule(Cr);return c.setInviteUserId(t),c.setInviteRoomId(n),c.setInviteSessionId(r),c.setContent(i),c.setKey(o),c.setValue(s),c.setAnswerCode(a),c.getArrayData()},e.prototype.encodeEndRoomPK=function(e){var t=e.endRoomId,n=e.sessionId,r=e.content,i=e.keys,o=this._codec.getModule(Sr);return o.setInviteRoomId(t),o.setInviteSessionId(n),o.setInviteContent(r),o.setInviteRoomKeys(i),o.getArrayData()},e.prototype.encodebindRTCRoomForChatroom=function(e){var t=this._codec.getModule(Rr);return t.setRtcRoomId(e.rtcRoomId),t.getArrayData()},e}(),_i=function(e,t){this._watcher=t,this.codec=new vi(e)};!function(e){e.GET="GET",e.POST="POST"}(Gr||(Gr={})),function(e){e.WIFI="wifi",e.FOUR_G="4g",e.THREE_G="3g",e.TWO_G="2g",e.FIVE_G="2g",e.THREE_GENT="3gnet",e.UNKONWN="unknown"}(jr||(jr={}));var yi,Ei=function(e,t){return e&&t?t+"_"+e:e||Date.now()},Ti=function(){function e(e){this.header=e,this._name=null,this.lengthSize=0,this.messageId=0,this.timestamp=0,this.syncMsg=!1,this.identifier=""}return e.prototype.getIdentifier=function(){var e=this.messageId,t=this.identifier;return Ei(e,t)},e.prototype.read=function(e,t,n){this.readMessage(e,t,n)},e.prototype.readMessage=function(e,t,n){return{stream:e,length:t}},e}(),Ii=function(){function e(e){this.lengthSize=0,this.messageId=0,this.topic="",this.targetId="",this.identifier="",this._header=new Nt(e,!1,Xe.AT_MOST_ONCE,!1)}return e.prototype.getIdentifier=function(){var e=this.messageId,t=this.identifier;return Ei(e,t)},e.prototype.write=function(e){var t=this.getHeaderFlag();e.write(t),this.writeMessage(e)},e.prototype.setHeaderQos=function(e){this._header.qos=e},e.prototype.getHeaderFlag=function(){return this._header.encode()},e.prototype.getLengthSize=function(){return this.lengthSize},e.prototype.getBufferData=function(){var e=new Ut;this.write(e);var t=e.getBytesArray();return new Int8Array(t)},e.prototype.getCometData=function(){var e=this.data||{};return JSON.stringify(e)},e}(),Ci=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=$e.CONN_ACK,t.status=null,t.userId=null,t.timestamp=0,t}return T(t,e),t.prototype.readMessage=function(e,n,r){if(e.readByte(),this.status=+e.readByte(),n<=t.MESSAGE_LENGTH)return{stream:e,length:n};if(r===nt.V4){var i=e.readByte();1&i&&(this.userId=e.readUTF()),2&i&&e.readUTF(),4&i&&(this.timestamp=e.readLong()),8&i&&(this.messageId=e.read2Byte())}else{this.userId=e.readUTF();var o=e.readUTF();ge.debug("server sessionId -> "+o),this.timestamp=e.readLong()}return{stream:e,length:n}},t.MESSAGE_LENGTH=2,t}(Ti),Si=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=$e.DISCONNECT,t.status=0,t}return T(t,e),t.prototype.readMessage=function(e,t){return e.readByte(),this.status=+e.readByte(),{stream:e,length:t}},t.MESSAGE_LENGTH=2,t}(Ti),Ri=function(e){function t(){var t=e.call(this,Ze.PING_REQ)||this;return t._name=$e.PING_REQ,t}return T(t,e),t.prototype.writeMessage=function(e){},t}(Ii),Ni=function(e){function t(t){var n=e.call(this,t)||this;return n._name=$e.PING_RESP,n}return T(t,e),t}(Ti),Oi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.messageId=0,t}return T(t,e),t.prototype.readMessage=function(e,t){var n=256*e.readByte()+e.readByte();return this.messageId=parseInt(n.toString(),10),{stream:e,length:t}},t}(Ti),Mi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.messageId=0,t}return T(t,e),t.prototype.writeMessage=function(e){var t=this.messageId,n=255&t,r=(65280&t)>>8;e.write(r),e.write(n)},t}(Ii),Ui=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=$e.PUBLISH,t.topic="",t.targetId="",t.syncMsg=!1,t.identifier=et.PUB,t}return T(t,e),t.prototype.readMessage=function(t,n){return this.date=t.readInt(),this.topic=t.readUTF(),this.targetId=t.readUTF(),e.prototype.readMessage.call(this,t,n),this.data=t.readAll(),{stream:t,length:n}},t}(Oi),wi=function(e){function t(t,n,r){var i=e.call(this,Ze.PUBLISH)||this;return i._name=$e.PUBLISH,i.syncMsg=!1,i.identifier=et.PUB,i.topic=t,i.data=J(n)?Ot.writeUTF(n):n,i.targetId=r,i}return T(t,e),t.prototype.writeMessage=function(t){t.writeUTF(this.topic),t.writeUTF(this.targetId),e.prototype.writeMessage.call(this,t),t.write(this.data)},t}(Mi),Ai=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=$e.PUB_ACK,t.status=0,t.date=0,t.millisecond=0,t.messageUId="",t.timestamp=0,t.identifier=et.PUB,t.topic="",t.targetId="",t}return T(t,e),t.prototype.readMessage=function(t,n){return e.prototype.readMessage.call(this,t,n),this.date=t.readInt(),this.status=256*t.readByte()+t.readByte(),this.millisecond=256*t.readByte()+t.readByte(),this.timestamp=1e3*this.date+this.millisecond,this.messageUId=t.readUTF(),{stream:t,length:n}},t}(Oi),bi=function(e){function t(t){var n=e.call(this,Ze.PUB_ACK)||this;return n._name=$e.PUB_ACK,n.status=0,n.date=0,n.millisecond=0,n.messageUId="",n.timestamp=0,n.messageId=t,n}return T(t,e),t.prototype.writeMessage=function(t){e.prototype.writeMessage.call(this,t)},t}(Mi),Li=function(e){function t(t,n,r){var i=e.call(this,Ze.QUERY)||this;return i.name=$e.QUERY,i.identifier=et.QUERY,i.topic=t,i.data=J(n)?Ot.writeUTF(n):n,i.targetId=r,i}return T(t,e),t.prototype.writeMessage=function(t){t.writeUTF(this.topic),t.writeUTF(this.targetId),e.prototype.writeMessage.call(this,t),t.write(this.data)},t}(Mi),Pi=function(e){function t(t){var n=e.call(this,Ze.QUERY_CONFIRM)||this;return n._name=$e.QUERY_CON,n.messageId=t,n}return T(t,e),t}(Mi),Di=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=$e.QUERY_ACK,t.status=0,t.identifier=et.QUERY,t.topic="",t.targetId="",t}return T(t,e),t.prototype.readMessage=function(t,n){return e.prototype.readMessage.call(this,t,n),this.date=t.readInt(),this.status=256*t.readByte()+t.readByte(),this.data=t.readAll(),{stream:t,length:n}},t}(Oi),xi=function(e){var t,n=e.type;switch(n){case Ze.CONN_ACK:t=new Ci(e);break;case Ze.PUBLISH:(t=new Ui(e)).syncMsg=e.syncMsg;break;case Ze.PUB_ACK:t=new Ai(e);break;case Ze.QUERY_ACK:t=new Di(e);break;case Ze.SUB_ACK:case Ze.UNSUB_ACK:case Ze.PING_RESP:t=new Ni(e);break;case Ze.DISCONNECT:t=new Si(e);break;default:t=new Ti(e),ge.error("No support for deserializing "+n+" messages")}return t};!function(e){e[e.ppMsgP=1]="ppMsgP",e[e.ppMsgN=2]="ppMsgN",e[e.ppMsgS=3]="ppMsgS",e[e.pgMsgP=4]="pgMsgP",e[e.chatMsg=5]="chatMsg",e[e.pcMsgP=6]="pcMsgP",e[e.qryPMsg=7]="qryPMsg",e[e.qryGMsg=8]="qryGMsg",e[e.qryCHMsg=9]="qryCHMsg",e[e.qryCMsg=10]="qryCMsg",e[e.qrySMsg=11]="qrySMsg",e[e.recallMsg=12]="recallMsg",e[e.prMsgS=13]="prMsgS",e[e.rrMsg=14]="rrMsg",e[e.rrList=15]="rrList",e[e.s_ntf=16]="s_ntf",e[e.s_msg=17]="s_msg",e[e.s_stat=18]="s_stat",e[e.s_cmd=19]="s_cmd",e[e.s_us=20]="s_us",e[e.pullUS=21]="pullUS",e[e.pgMsgS=22]="pgMsgS",e[e.chatMsgS=23]="chatMsgS",e[e.qrySessionsAtt=24]="qrySessionsAtt",e[e.pullMsg=25]="pullMsg",e[e.qrySessions=26]="qrySessions",e[e.delSessions=27]="delSessions",e[e.delMsg=28]="delMsg",e[e.updRRTime=29]="updRRTime",e[e.chrmPull=30]="chrmPull",e[e.joinChrm=31]="joinChrm",e[e.joinChrmR=32]="joinChrmR",e[e.exitChrm=33]="exitChrm",e[e.queryChrmI=34]="queryChrmI",e[e.setKV=35]="setKV",e[e.delKV=36]="delKV",e[e.pullKV=37]="pullKV",e[e.qryRelation=38]="qryRelation",e[e.delRelation=39]="delRelation",e[e.pullSeAtts=40]="pullSeAtts",e[e.setSeAtt=41]="setSeAtt",e[e.qnTkn=42]="qnTkn",e[e.qnUrl=43]="qnUrl",e[e.aliUrl=44]="aliUrl",e[e.s3Url=45]="s3Url",e[e.stcUrl=46]="stcUrl",e[e.cleanPMsg=47]="cleanPMsg",e[e.cleanGMsg=48]="cleanGMsg",e[e.cleanCMsg=49]="cleanCMsg",e[e.cleanSMsg=50]="cleanSMsg",e[e.rtcRJoin_data=51]="rtcRJoin_data",e[e.rtcRExit=52]="rtcRExit",e[e.rtcPing=53]="rtcPing",e[e.rtcSetData=54]="rtcSetData",e[e.rtc_ntf=55]="rtc_ntf",e[e.viewerJoinR=56]="viewerJoinR",e[e.viewerExitR=57]="viewerExitR",e[e.rtcPullKv=58]="rtcPullKv",e[e.rtcIdentityChange=59]="rtcIdentityChange",e[e.userSetData=60]="userSetData",e[e.rtcQryData=61]="rtcQryData",e[e.rtcDelData=62]="rtcDelData",e[e.rtcSetOutData=63]="rtcSetOutData",e[e.rtcQryUserOutData=64]="rtcQryUserOutData",e[e.rtcToken=65]="rtcToken",e[e.rtcUserState=66]="rtcUserState",e[e.rtcRInfo=67]="rtcRInfo",e[e.rtcUData=68]="rtcUData",e[e.rtcUPut=69]="rtcUPut",e[e.rtcUDel=70]="rtcUDel",e[e.rtcUList=71]="rtcUList",e[e.rtcQueryJoined=72]="rtcQueryJoined",e[e.rtcInvite=73]="rtcInvite",e[e.rtcCancelInvite=74]="rtcCancelInvite",e[e.rtcInviteAnswer=75]="rtcInviteAnswer",e[e.rtcEndInvite=76]="rtcEndInvite",e[e.addSeTag=77]="addSeTag",e[e.delSeTag=78]="delSeTag",e[e.addTag=79]="addTag",e[e.delTag=80]="delTag",e[e.disTag=81]="disTag",e[e.reportsdk=82]="reportsdk",e[e.pullUgSes=83]="pullUgSes",e[e.pullUgMsg=84]="pullUgMsg",e[e.ugMsg=85]="ugMsg",e[e.qryUgMsg=86]="qryUgMsg",e[e.updUgRTime=87]="updUgRTime",e[e.upMsgEx=88]="upMsgEx",e[e.modifyMsg=89]="modifyMsg",e[e.qryMsgChange=90]="qryMsgChange",e[e.qryMsg=91]="qryMsg",e[e.operate=92]="operate",e[e.s_opNtf=93]="s_opNtf",e[e.ugUnpushQuery=94]="ugUnpushQuery",e[e.ugUnpushSet=95]="ugUnpushSet",e[e.setRtcRoomId=96]="setRtcRoomId"}(yi||(yi={}));var Vi,ki,Bi=yi,Gi=function(e,t,n,r){return C(void 0,void 0,void 0,(function(){var i;return S(this,(function(o){return i=0,e.forEach((function(o){return C(void 0,void 0,void 0,(function(){var s,a,c;return S(this,(function(u){switch(u.label){case 0:s="".concat(t,"://").concat(o,"/ping?r=").concat((l=9999,(d=1e3)+Math.floor(Math.random()*(l-d)))),ge.debug("start ping",s),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,n.httpReq({url:s,timeout:5e3})];case 2:return a=u.sent(),[3,4];case 3:return c=u.sent(),ge.error("ping error: ",c),i++,r({finished:i===e.length,code:-2,host:o}),[2];case 4:return i++,ge.debug("end ping",i,s,null==a?void 0:a.status),r({finished:i===e.length,code:a.status,host:o}),[2]}var d,l}))}))})),[2]}))}))},ji=function(e,t,n,r,i,o,s,a){return"".concat(e,"://").concat(t,"/websocket?appId=").concat(n,"&token=").concat(encodeURIComponent(r),"&sdkVer=").concat(o,"&pid=").concat(s,"&apiVer=").concat(i.isFromUniapp?"uniapp":"normal").concat(i.connectPlatform?"&platform="+i.connectPlatform:"").concat(a?"&protocolVer="+a:"")},qi=function(e){return[Bi.ppMsgS,Bi.pgMsgS,Bi.chatMsgS].map((function(e){return Bi[e]})).indexOf(e)>=0};!function(e){e[e.REDIRECT=0]="REDIRECT",e[e.OTHER_DEVICE_LOGIN=1]="OTHER_DEVICE_LOGIN",e[e.BLOCK=2]="BLOCK",e[e.REMOTE_CLOSE=3]="REMOTE_CLOSE",e[e.LOGOUT=4]="LOGOUT",e[e.BLOCK_NEW=5]="BLOCK_NEW",e[e.REDIRECT_NEW=6]="REDIRECT_NEW"}(Vi||(Vi={})),function(e){e.IM_NAVI="IM-stats_navi-S",e.IM_WEBSOCKET="IM-stats_websocket-S",e.IM_COMET="IM-stats_comet-S",e.IM_CONNECTION_DURATION="IM-stats_con_dur-S"}(ki||(ki={}));var Fi=function(e,t){ge.info("websocket send -> messageId: ".concat(e.messageId," topic: ").concat(e.topic));var n=e.getBufferData();t.send(n.buffer)};var Hi=function(e){function t(t,n){var r=e.call(this,"websocket",n)||this;return r._runtime=t,r._socket=null,r._messageIds={},r._syncMessageIds={},r._failedCount=0,r.ALLOW_FAILED_TIMES=2,r._timer=null,r._idCount=0,r._generateMessageId=function(){return r._idCount>=65535&&(r._idCount=0),++r._idCount},r}return T(t,e),t.prototype.connect=function(e,t,n,r,i,o){return C(this,void 0,void 0,(function(){var s=this;return S(this,(function(a){return[2,new Promise((function(a){var c=[],u=0,d=!1,l=!1,h=function n(){return C(s,void 0,void 0,(function(){var s,u,h;return S(this,(function(f){switch(f.label){case 0:return 0===c.length||d?[2]:(d=!0,s=c.shift(),ge.setStatisticsData(ki.IM_WEBSOCKET,{startTime:(new Date).getTime(),host:s,protocol:G.WS}),[4,this._connect(e,t,s,r,i,o)]);case 1:if(u=f.sent(),h=u===ye.SUCCESS||u===Ie.REDIRECT?u:yt(u),ge.setStatisticsData(ki.IM_WEBSOCKET,{endTime:(new Date).getTime(),code:h}),function(e){C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h,f,g,p;return S(this,(function(m){switch(m.label){case 0:t=ki.IM_WEBSOCKET,n=ge.getStatisticsBaseData(),r=n.sdkPrivate,i=n.serverPrivate,o=n.bundleId,s=ge.getStatisticsData(t),a=s.protocol,c=s.startTime,u=s.endTime,d=s.code,l=s.host,h=jr.UNKONWN,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,e.getNetworkType()];case 2:return h=m.sent(),[3,4];case 3:return f=m.sent(),ge.debug(f.message),[3,4];case 4:return g=0,X(c)&&X(u)&&u>c&&c&&(g=u-c),p={spr:r,pr:i,bid:o,ptc:a,dur:g,cod:d,hos:l,net:h},ge.reportStatisticsLog(t,p),[2]}}))}))}(this._runtime),u===ye.SUCCESS)this._checkAlive(),a(u);else if(u===Ie.REDIRECT)a(u);else{if(l&&0===c.length)return a(yt(u)),[2];d=!1,n()}return[2]}}))}))};i=w(i),s._watcher.status(Te.CONNECTING),Gi(n,r,s._runtime,(function(e){var t=e.code,n=e.finished,r=e.host;l=n,200===t&&(c.push(r),u++,h()),n&&0===u&&(ge.error("No valid websocket server hosts!"),a(ye.RC_SOCKET_NOT_CREATED))}))}))]}))}))},t.prototype._connect=function(e,t,n,r,i,o){return C(this,void 0,void 0,(function(){var s,c,u,d,l,h=this;return S(this,(function(f){switch(f.label){case 0:return s=r.replace("http","ws"),c=ji(s,n,e,t,this._runtime,i,"",o),ge.debug("conenct start -> ".concat(c)),this.sendConnectTime=Date.now(),u=this._runtime.createWebSocket(c),d=function(e){h._timer&&(clearTimeout(h._timer),h._timer=null),h._socket===u&&(h._socket=null,h._watcher.status(e))},[4,new Promise((function(e){u.onMessage((function(t){if("[object ArrayBuffer]"===Object.prototype.toString.call(t)){var n=function(e,t){var n=new Uint8Array(e),r=new Mt(n),i=r.readByte(),o=new Nt(i),s=xi(o);return s.read(r,n.length-1,t),s}(t,o);if(n instanceof Ni&&h._pingResolve)return h._pingResolve(ye.SUCCESS),void(h._pingResolve=void 0);if(n instanceof Ci)return ge.debug("recv connect ack -> ".concat(n.status)),n.status!==Ie.ACCEPTED?(ge.warn("connect failed: ".concat(n.status)),void e(n.status)):(ge.info("connect success -> ".concat(c)),h.connectedTime=n.timestamp,h.userId=n.userId||"",h._idCount=n.messageId,void e(ye.SUCCESS));if(n instanceof Si){var r=n.status;switch(ge.warn("recv disconnect signal -> status: ".concat(r)),r){case Vi.BLOCK_NEW:case Vi.BLOCK:h._watcher.status(Te.BLOCKED);break;case Vi.OTHER_DEVICE_LOGIN:h._watcher.status(Te.KICKED_OFFLINE_BY_OTHER_CLIENT);break;case Vi.REDIRECT_NEW:case Vi.REDIRECT:h._watcher.status(Te.REDIRECT);break;default:h._watcher.status(Te.DISCONNECT_BY_SERVER)}}else h._onReceiveSignal(n)}else ge.error("Socket received invalid data:",t)})),u.onClose((function(t,n){for(var r in ge.warn("websocket closed! code:",t,"reason:",n),d(Te.CONNECTION_CLOSED),h._messageIds){var i=h._messageIds[r];delete h._messageIds[r],i(ye.RC_NET_CHANNEL_INVALID)}e(t)})),u.onError((function(t){for(var n in ge.error("websocket error!",null==t?void 0:t.stack),d(Te.WEBSOCKET_ERROR),h._messageIds){var r=h._messageIds[n];delete h._messageIds[n],r(ye.RC_NET_CHANNEL_INVALID)}e(ye.NETWORK_ERROR)})),u.onOpen((function(){return ge.debug("websocket open =>",c)})),setTimeout((function(){e(ye.TIMEOUT)}),a)}))];case 1:return(l=f.sent())===ye.SUCCESS?this._socket=u:(ge.warn("connect result -> code: ".concat(l,", url: ").concat(c)),u.close()),[2,l]}}))}))},t.prototype._checkAlive=function(){var e;return C(this,void 0,void 0,(function(){var t,n=this;return S(this,(function(r){switch(r.label){case 0:return this._socket?(ge.debug("send ping ->"),this.sendOnly(new Ri),[4,new Promise((function(e){n._pingResolve=e,n._timer&&clearTimeout(n._timer),n._timer=setTimeout((function(){n._pingResolve=void 0,e(ye.TIMEOUT)}),15e3)}))]):[2];case 1:return(t=r.sent())!==ye.SUCCESS?(this._failedCount+=1,ge.warn("ping failed count: ".concat(this._failedCount,", code: ").concat(t)),this._failedCount>=this.ALLOW_FAILED_TIMES?(this._failedCount=0,ge.warn("ping timeout, close current websocket to reconnect!"),null===(e=this._socket)||void 0===e||e.close(),this._watcher.status(Te.NETWORK_UNAVAILABLE)):this._checkAlive(),[2]):(ge.debug("recv pong <-"),this._failedCount=0,setTimeout((function(){return n._checkAlive()}),15e3),[2])}}))}))},t.prototype._onReceiveSignal=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a=this;return S(this,(function(c){switch(c.label){case 0:return t=e.messageId,e.header&&e.header.qos!==Xe.AT_MOST_ONCE&&(e instanceof Ui&&!e.syncMsg&&(ge.info("send pubAck -> ".concat(t," ").concat(e.topic)),this.sendOnly(new bi(t))),e instanceof Di&&(ge.info("send queryCon -> ".concat(t," ").concat(e.topic)),this.sendOnly(new Pi(t)))),t>0&&(e instanceof Ai||e instanceof Di)&&(ge.info("recv ack -> messageId: ".concat(t," ").concat(e.topic)),(n=this._messageIds[t])&&(n(e),delete this._messageIds[t]),(r=this._syncMessageIds[t])&&(delete this._syncMessageIds[t],r(e))),e instanceof Ui?(i=e.syncMsg,o=e.topic,ge.info("recv PublishReader -> messageId: ".concat(t," ").concat(o)),o===Bi[Bi.userSetData]?[2]:!i||qi(o)?(this._watcher.signal(e),[2]):[4,new Promise((function(e){a._syncMessageIds[t]=e}))]):[3,2];case 1:s=c.sent(),delete this._syncMessageIds[t],this._watcher.signal(e,s),c.label=2;case 2:return[2]}}))}))},t.prototype.sendOnly=function(e){this._socket&&((e instanceof wi||e instanceof Li)&&(e.messageId=this._generateMessageId()),Fi(e,this._socket))},t.prototype.send=function(e,t,n,r){return void 0===r&&(r=l),C(this,void 0,void 0,(function(){var i,o,s,a,c=this;return S(this,(function(u){switch(u.label){case 0:return this._socket?(i=this._generateMessageId(),e.messageId=i,Fi(e,this._socket),[4,new Promise((function(e){c._messageIds[i]=e,setTimeout((function(){c._messageIds[i]&&delete c._messageIds[i],e()}),r)}))]):[3,2];case 1:return(o=u.sent())?o instanceof Di||o instanceof Ai?(s=t&&o.data&&[ye.SUCCESS,ye.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(o.status)>=0,a=s?this.codec.decodeByPBName(o.data,t,n):o,0!==o.status?(ge.warn("send failed -> message: ".concat(i,", respPBName: ").concat(t,", status: ").concat(o.status)),[2,{code:o.status,data:t&&o.data?a:null}]):[2,{code:ye.SUCCESS,data:a}]):[2,{code:o}]:(ge.warn("send timeout -> message: ".concat(i,", respPBName: ").concat(t,", timeout: ").concat(r)),[2,{code:ye.TIMEOUT}]);case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.close=function(){this._socket&&(this._socket.close(),this._socket=null,this._watcher.status(Te.DISCONNECTED))},t}(_i);var Ki=function(e){function t(t,n){var r=e.call(this,"comet",n)||this;return r._runtime=t,r._messageIds={},r._syncMessageIds={},r._idCount=0,r._generateMessageId=function(){return++r._idCount},r._pid=encodeURIComponent((new Date).getTime()+Math.random()+""),r}return T(t,e),t.prototype.handleCometRes=function(e){var t=this;if(200!==e.status&&202!==e.status)return!1;var n=J(e.data)?JSON.parse(e.data):e.data;return n?!Z(n)||(ft(n,(function(e){return C(t,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h=this;return S(this,(function(f){switch(f.label){case 0:if((t=e.sessionid)&&(this._sessionid=t),n=function(e){var t=e.headerCode,n=new Nt(t),r=xi(n);for(var i in e)r[i]=e[i];return r}(e),r=n.messageId,i=n._header,o=n.status,s=i&&i.qos!==Xe.AT_MOST_ONCE,r&&n.getIdentifier&&((a=this._messageIds[r])&&a(n),this._syncMessageIds[r]&&this._syncMessageIds[r](n)),s&&(n instanceof Ui&&!n.syncMsg&&(c=new bi(r),this.sendOnly(c)),n instanceof Di&&(c=new Pi(r),this.sendOnly(c))),n instanceof Si){switch(o){case Vi.OTHER_DEVICE_LOGIN:this._watcher.status(Te.KICKED_OFFLINE_BY_OTHER_CLIENT);break;case Vi.BLOCK:case Vi.BLOCK_NEW:this._watcher.status(Te.BLOCKED);break;case Vi.REDIRECT_NEW:case Vi.REDIRECT:this._watcher.status(Te.REDIRECT);break;default:this._watcher.status(Te.DISCONNECT_BY_SERVER)}return[2]}return n instanceof Ui?(u=n.syncMsg,d=n.topic,!u||qi(d)?(this._watcher.signal(n),[2,!1]):[4,new Promise((function(e){h._syncMessageIds[r]=e}))]):[3,2];case 1:l=f.sent(),delete this._syncMessageIds[r],this._watcher.signal(n,l),f.label=2;case 2:return[2]}}))}))})),!0):(ge.error("received data is not a validJson",n),!1)},t.prototype._startPullSignal=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return t=(new Date).getTime(),n="".concat(e,"://").concat(this._domain,"/pullmsg.js?sessionid=").concat(this._sessionid,"&timestrap=").concat(t,"&pid=").concat(this._pid),[4,this._runtime.httpReq({url:n,body:{pid:this._pid},timeout:45e3})];case 1:return r=o.sent(),i=this.handleCometRes(r),this._isDisconnected||(i?this._startPullSignal(e):(this._isDisconnected=!0,this._watcher.status(Te.NETWORK_UNAVAILABLE))),[2]}}))}))},t.prototype.connect=function(e,t,n,r,i,o){return C(this,void 0,void 0,(function(){var o,s,a,c,u=this;return S(this,(function(d){return i=w(i),this._protocol=r,this._isDisconnected=!1,this._watcher.status(Te.CONNECTING),o=[],s=0,a=!1,c=!1,[2,new Promise((function(d){var l=function n(){return C(u,void 0,void 0,(function(){var s,u,l;return S(this,(function(h){switch(h.label){case 0:return 0===o.length||a?[2]:(a=!0,s=o.shift(),ge.setStatisticsData(ki.IM_COMET,{startTime:(new Date).getTime(),host:s,protocol:G.NAVI}),[4,this._connect(e,t,s,r,i)]);case 1:if(u=h.sent(),l=u===ye.SUCCESS||u===Ie.REDIRECT?u:yt(u),ge.setStatisticsData(ki.IM_COMET,{endTime:(new Date).getTime(),code:l}),function(e){C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h,f,g,p;return S(this,(function(m){switch(m.label){case 0:t=ki.IM_COMET,n=ge.getStatisticsBaseData(),r=n.sdkPrivate,i=n.serverPrivate,o=n.bundleId,s=ge.getStatisticsData(t),a=s.protocol,c=s.startTime,u=s.endTime,d=s.code,l=s.host,h=jr.UNKONWN,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,e.getNetworkType()];case 2:return h=m.sent(),[3,4];case 3:return f=m.sent(),ge.debug(f.message),[3,4];case 4:return g=0,X(c)&&X(u)&&u>c&&c&&(g=u-c),p={spr:r,pr:i,bid:o,ptc:a,dur:g,cod:d,hos:l,net:h},ge.reportStatisticsLog(t,p),[2]}}))}))}(this._runtime),u===ye.SUCCESS)this._startPullSignal(r),d(u);else if(u===Ie.REDIRECT)d(u);else{if(c&&0===o.length)return d(yt(u)),[2];a=!1,n()}return[2]}}))}))};u._watcher.status(Te.CONNECTING),Gi(n,r,u._runtime,(function(e){var t=e.code,n=e.finished,r=e.host;c=n,200===t&&(o.push(r),s++,l()),n&&0===s&&(ge.error("No valid websocket server hosts!"),d(ye.RC_SOCKET_NOT_CREATED))}))}))]}))}))},t.prototype._connect=function(e,t,n,r,i){return C(this,void 0,void 0,(function(){var o,s,c,u;return S(this,(function(d){switch(d.label){case 0:return o=function(e){return 200!==e.status&&202!==e.status?(ge.error("handle comet res -> res: ".concat(JSON.stringify(e||{}))),!1):!!e.data&&(function(e){if(te(e))return!0;var t=!1;try{var n=JSON.parse(e);t=JSON.stringify(n)===e}catch(e){t=!1}return t}(e.data)?te(e.data)?e.data:JSON.parse(e.data):(ge.error("received data is not a validJson",e.data),!1))},s=ji(r,n,e,t,this._runtime,i,this._pid),this.sendConnectTime=Date.now(),ge.debug("conenct start -> ".concat(s)),[4,this._runtime.httpReq({url:s,body:{pid:this._pid},timeout:a})];case 1:return c=d.sent(),u=o(c),this._domain=n,u&&0===u.status?(this._sessionid=u.sessionid,this.userId=u.userId,this.connectedTime=u.timestamp):ge.warn("connect result -> code: ".concat(null==u?void 0:u.status,", url: ").concat(s)),[2,null==u?void 0:u.status]}}))}))},t.prototype.sendCometData=function(e,t){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return n=(t=this)._domain,r=t._sessionid,i=t._pid,o=e.messageId,s=e.topic,a=e.targetId,c=e.getHeaderFlag(),u=s?"".concat(this._protocol,"://").concat(n,"/websocket?messageid=").concat(o,"&header=").concat(c,"&sessionid=").concat(r,"&topic=").concat(s,"&targetid=").concat(a,"&pid=").concat(i):"".concat(this._protocol,"://").concat(n,"/websocket?messageid=").concat(o,"&header=").concat(c,"&sessionid=").concat(r,"&pid=").concat(i),[4,this._runtime.httpReq({url:u,method:Gr.POST,body:e.getCometData()})];case 1:return d=l.sent(),this.handleCometRes(d),[2]}}))}))},t.prototype.sendOnly=function(e){this.sendCometData(e)},t.prototype.send=function(e,t,n,r){return void 0===r&&(r=l),C(this,void 0,void 0,(function(){var i,o,s,a,c=this;return S(this,(function(u){switch(u.label){case 0:return i=this._generateMessageId(),e.messageId=i,this.sendCometData(e),[4,new Promise((function(e){c._messageIds[i]=e,setTimeout((function(){delete c._messageIds[i],e()}),r)}))];case 1:return(o=u.sent())?(s=t&&o.data&&[ye.SUCCESS,ye.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(o.status)>=0,a=s?this.codec.decodeByPBName(o.data,t,n):o,0!==o.status?[2,{code:o.status,data:t&&o.data?a:null}]:[2,{code:ye.SUCCESS,data:a}]):[2,{code:ye.TIMEOUT}]}}))}))},t.prototype.close=function(){this._isDisconnected=!0,this._watcher.status(Te.DISCONNECTED)},t}(_i),Yi=function(e,t,n){this.runtime=e,this._watcher=t,this._options=n,this.currentUserId="",this._appkey=this._options.appkey,this._apiVer=this._options.apiVersion,this.navi=this._createNavi()},Qi=function(e){return["navi",e].join("_")},Wi=function(){function e(e,t){this._runtime=e,this._options=t,this._naviInfo=null,this._appkey=this._options.appkey,this._apiVersion=w(this._options.apiVersion)}return e.prototype.getInfo=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o;return S(this,(function(a){switch(a.label){case 0:return n&&this._clear(e),i=function(e,t,n){var r,i,o=Qi(e);try{var a=n.getItem(o);i=a?JSON.parse(a):[]}catch(e){i=[]}var c=Date.now();return i.length>0&&(i=i.filter((function(e){return c-e.timestamp<s}))),0===i.length?n.removeItem(o):n.setItem(o,JSON.stringify(i)),(null===(r=i.find((function(e){return e.token===t})))||void 0===r?void 0:r.naviInfo)||null}(this._appkey,e,this._runtime.localStorage),i?(this._naviInfo=i,[2,i]):(o=this._options.navigators.slice(),t.length&&t.forEach((function(e){o.indexOf(e)<0&&o.unshift(e)})),[4,this._reqNavi(o,this._appkey,e,r)]);case 1:return(i=a.sent())?(this._naviInfo=i,this.setNaviInfo2Cache(e,i),[2,i]):[2,i]}}))}))},e.prototype.setNaviInfo2Cache=function(e,t){this._naviInfo=t,function(e,t,n,r){var i,o=Qi(e);try{var a=r.getItem(o);i=a?JSON.parse(a):[]}catch(e){i=[]}var c=Date.now();i.length>0&&(i=i.filter((function(e){return c-e.timestamp<s&&t!==e.token}))),i.push({timestamp:c,naviInfo:n,token:t}),r.setItem(o,JSON.stringify(i))}(this._appkey,e,t,this._runtime.localStorage)},e.prototype.getInfoFromCache=function(e){return this._naviInfo},e.prototype._clear=function(e){!function(e,t,n){var r,i=Qi(e);try{var o=n.getItem(i);r=o?JSON.parse(o):[]}catch(e){r=[]}var a=Date.now();r.length>0&&(r=r.filter((function(e){return a-e.timestamp<s&&t!==e.token}))),0===r.length?n.removeItem(i):n.setItem(i,JSON.stringify(r))}(this._appkey,e,this._runtime.localStorage)},e}(),Ji="outbox",zi="inbox",Xi="broadcastbox",Zi=function(e,t,n){return[e,t,n].join("_")},$i=function(){function e(e,t){this._runtime=e,this._appkey=t,this._users={}}return e.prototype._getMemData=function(e){return this._users[e]||(this._users[e]={inboxTime:0,outboxTime:0,broadcastSyncTime:0})},e.prototype.setInboxTime=function(e,t){var n=this._getMemData(t);if(!(n.inboxTime>e)){n.inboxTime=e;var r=Zi(zi,this._appkey,t);this._runtime.localStorage.setItem(r,e.toString())}},e.prototype.getInboxTime=function(e){var t=this._getMemData(e);if(0===t.inboxTime){var n=Zi(zi,this._appkey,e);t.inboxTime=parseInt(this._runtime.localStorage.getItem(n))||0}return t.inboxTime},e.prototype.setBroadcastSyncTime=function(e,t){var n=this._getMemData(t);if(!(n.broadcastSyncTime>=e)){n.broadcastSyncTime=e;var r=Zi(Xi,this._appkey,t);this._runtime.localStorage.setItem(r,e.toString())}},e.prototype.getBroadcastSyncTime=function(e){var t=this._getMemData(e);if(!t||0===t.broadcastSyncTime){var n=Zi(Xi,this._appkey,e);t.broadcastSyncTime=parseInt(this._runtime.localStorage.getItem(n))||1}return t.broadcastSyncTime},e.prototype.setOutboxTime=function(e,t){var n=this._getMemData(t);if(!(n.outboxTime>=e)){n.outboxTime=e;var r=Zi(Ji,this._appkey,t);this._runtime.localStorage.setItem(r,e.toString())}},e.prototype.getOutboxTime=function(e){var t=this._getMemData(e);if(0===t.outboxTime){var n=Zi(Ji,this._appkey,e);t.outboxTime=parseInt(this._runtime.localStorage.getItem(n))||0}return t.outboxTime},e}(),eo={_caches:{},set:function(e,t){this._caches[e]=t},get:function(e){return this._caches[e]||0},clear:function(e){this._caches[e]=0}},to=function(){function e(e,t){this._kvCaches={},this._chatroomId=e,this._currentUserId=t}return e.prototype._add=function(e){var t=e.key;e.isDeleted=!1,this._kvCaches[t]=e},e.prototype._remove=function(e){var t=e.key,n=this._kvCaches[t];n&&(n.isDeleted=!0,this._kvCaches[t]=n)},e.prototype._setEntry=function(e,t){var n=e.key,r=e.type,i=e.isOverwrite,o=e.userId,s=this._getSetUserId(n),a=r===Pe.DELETE,c=s===o,u=!this._isExisted(n),d=a?this._remove:this._add;(t||i||c||u)&&d.call(this,e)},e.prototype.getValue=function(e){var t=this._kvCaches[e]||{};return t.isDeleted?null:t.value},e.prototype.getVersion=function(e){var t=this._kvCaches[e]||{};return t.isDeleted?null:t.version},e.prototype.getAllValue=function(){var e={};for(var t in this._kvCaches)this._kvCaches[t].isDeleted||(e[t]=this._kvCaches[t].value);return e},e.prototype._getSetUserId=function(e){return(this._kvCaches[e]||{}).userId},e.prototype._isExisted=function(e){var t=this._kvCaches[e]||{},n=t.value,r=t.isDeleted;return n&&!r},e.prototype.setEntries=function(e){var t=this,n=e.kvEntries,r=e.isFullUpdate;n=n||[],(r=r||!1)&&this.clear(),n.forEach((function(e){t._setEntry(e,r)})),ge.debug("end setEntries")},e.prototype.clear=function(){this._kvCaches={}},e}(),no=function(){function e(e){this._pullQueue=[],this._isPulling=!1,this._storeCaches={},this._engine=e}return e.prototype._startPull=function(){return C(this,void 0,void 0,(function(){var e,t,n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],t=e.chrmId,n=e.timestamp,(r=eo.get(t))>n?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullChatroomEntry(t,r)]);case 1:return i=a.sent(),o=i.code,s=i.data,this._isPulling=!1,o===ye.SUCCESS?(eo.set(t,s.syncTime||0),this._startPull()):this._startPull(),[2]}}))}))},e.prototype.reset=function(e){eo.clear(e);var t=this._storeCaches[e];t&&t.clear()},e.prototype.pullEntry=function(e,t){this._pullQueue.push({chrmId:e,timestamp:t}),this._startPull()},e.prototype.setLocal=function(e,t,n){var r=this._storeCaches[e];se(r)||(r=new to(e,n)),r.setEntries(t),this._storeCaches[e]=r},e.prototype.getValue=function(e,t){var n=this._storeCaches[e];return n?n.getValue(t):null},e.prototype.getVersion=function(e,t){var n=this._storeCaches[e];return n?n.getVersion(t):null},e.prototype.getAll=function(e){var t=this._storeCaches[e],n={};return t&&(n=t.getAllValue()),n},e}(),ro=function(){function e(e,t,n,r){this._runtime=e,this._appkey=t,this._userId=n,this._canJoinMulipleChrm=r,this._sessionKey="",this._joinedChrmsInfo={},this._sessionKey="sync-chrm-".concat(this._appkey,"-").concat(this._userId)}return e.prototype.set=function(e,t){void 0===t&&(t=10),!this._canJoinMulipleChrm&&(this._joinedChrmsInfo={}),this._joinedChrmsInfo[e]=t,this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo))},e.prototype.get=function(){var e,t;try{t=this._runtime.sessionStorage.getItem(this._sessionKey),e=JSON.parse(t||"{}")}catch(n){ge.error("parse rejoined chrm infos error -> ".concat(t)),e={}}return e},e.prototype.remove=function(e){delete this._joinedChrmsInfo[e],se(this._joinedChrmsInfo)?this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo)):this.clear()},e.prototype.clear=function(){this._joinedChrmsInfo={},this._runtime.sessionStorage.removeItem(this._sessionKey)},e}(),io="converStatusChanged",oo=function(){function e(e,t,n){this._eventEmitter=new pe,this._pullQueue=[],this._isPulling=!1,this._storage=v(e.runtime),this._appkey=t,this._currentUserId=n,this._engine=e,this._storagePullTimeKey="con-s-".concat(t,"-").concat(n)}return e.prototype._set=function(e){var t=this;if(!re(e)&&Array.isArray(e)){var n=this._storage.get(this._storagePullTimeKey)||0,r=e.length;e.forEach((function(e,i){var o=e.updatedTime||0;n=o>n?o:n,e.conversationType=e.type,t._eventEmitter.emit(io,{statusItem:e,isLastPull:i===r-1})})),this._storage.set(this._storagePullTimeKey,n)}},e.prototype._startPull=function(){return C(this,void 0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],[4,this._engine.pullConversationStatus(e)]);case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?(this._isPulling=!1,this._set(r),this._startPull()):this._startPull(),[2]}}))}))},e.prototype.pull=function(e){var t=this._storage.get(this._storagePullTimeKey)||0;(e>t||0===e)&&(this._pullQueue.push(t),this._startPull())},e.prototype.watch=function(e){this._eventEmitter.on(io,(function(t){e(t)}))},e.prototype.unwatch=function(){this._eventEmitter.off(io,(function(e){}))},e}(),so={c:{keyName:"unreadMessageCount",defaultVal:0},hm:{keyName:"hasMentioned",defaultVal:!1},m:{keyName:"mentionedInfo",defaultVal:null},t:{keyName:"lastUnreadTime",defaultVal:0},nc:{keyName:"notificationStatus",defaultVal:2},nl:{keyName:"notificationLevel",defaultVal:0},to:{keyName:"isTop",defaultVal:!1},tg:{keyName:"tags",defaultVal:{}},mc:{keyName:"unreadMentionedCount",defaultVal:0}},ao={};for(var co in so){var uo=so[co].keyName;ao[uo]=co}var lo=function(){function e(e,t,n){this._appkey=t,this._currentUserId=n;var r="con-".concat(t,"-").concat(n);this.storage=new y(e,r),this._localStore=new y(e,"CONVER-".concat(t,"-").concat(n))}return e.prototype._getStoreKey=function(e,t,n){return"".concat(n,"_").concat(e,"_").concat(t)},e.prototype._getConOptionByKey=function(e){var t=(e=e||"").split("_");if(t.length>=2){var n=t.shift(),r=t.shift(),i=t.join("_");return{conversationType:Number(r),targetId:i,channelId:n}}return{conversationType:Y.PRIVATE,targetId:"",channelId:""}},e.prototype.updateMentionedData=function(e){var t=this,n=e.conversationType,r=e.targetId,i=e.messageType,o=e.isMentioned,s=e.content,a=e.senderUserId,c=e.channelId,u=this._getStoreKey(n,r,c),d=this._localStore.get(u)||{},l=ao.mentionedInfo,h=ao.hasMentioned,f=d[l]||{},g=f.userIdList||[],p=s.mentionedInfo;if(p){if(o&&n===Y.GROUP)(p.userIdList||[]).forEach((function(e){e===t._currentUserId&&g.indexOf(a)<0&&g.push(a)})),p.type===we.ALL&&g.indexOf(a)<0&&g.push(a);if(i===Se.RECALL&&n===Y.GROUP){var m=g.indexOf(a);m>=0&&g.splice(m,1)}p={userIdList:g,type:(null==p?void 0:p.type)||f.type},0!==g.length?(d[l]=p,d[h]=!0):(delete d[l],delete d[h]),se(d)?this._localStore.set(u,d):this._localStore.remove(u)}},e.prototype.set=function(e,t,n,r){var i=this._getStoreKey(e,t,r),o=this._localStore.get(i)||{};for(var s in n){var a=ao[s],c=n[s];if(!re(a)&&!re(c)&&"hasMentioned"!==s&&"MentionedInfo"!==s){if(c===so[a].defaultVal||"tags"===s&&!se(c))delete o[a];else if("tags"===s){var u=c;for(var d in u)u[d].isTop||delete u[d].isTop;o[a]=c}else o[a]=c;o.c||(delete o.t,delete o.hm,delete o.m,delete o.mc)}}se(o)?this._localStore.set(i,o):this._localStore.remove(i)},e.prototype.get=function(e,t,n){void 0===n&&(n="");var r=this._getStoreKey(e,t,n),i=this._localStore.get(r)||{},o={};for(var s in so){var a=so[s],c=a.keyName,u=a.defaultVal;o[c]=i[s]||vt(u)}return o},e.prototype.getValue=function(e){var t=this._localStore.getValues()||{},n=[];for(var r in t){var i=this._getConOptionByKey(r),o={conversationType:i.conversationType,targetId:i.targetId,channelId:i.channelId},s=t[r];for(var a in s){var c=so[a],u=c.keyName,d=c.defaultVal;o[u]=s[a]||vt(d)}o=e?e(o):o,n.push(o)}return n},e.prototype.getValueForTag=function(){var e=this._localStore.getValues()||{},t={};for(var n in e){var r=this._getConOptionByKey(n),i=r.conversationType,o=r.targetId,s={},a=e[n];for(var c in a){var u=so[c],d=u.keyName,l=u.defaultVal;s[d]=a[c]||vt(l)}for(var h in s.tags){re(t[h])&&(t[h]=[]);var f=Object.assign({},s,{conversationType:i,targetId:o});delete f.tags,t[h].push(f)}}return t},e.prototype.adaptOldStore=function(){try{var e=this.storage.getValues();if(0===Object.keys(e).length)return;for(var t in e){var n="_".concat(t);this._localStore.set(n,e[t])}}catch(e){ge.error("adaptOldStore error: ".concat(e.message))}},e}(),ho=[Y.PRIVATE,Y.GROUP,Y.SYSTEM,Y.PUBLIC_SERVICE,Y.APP_PUBLIC_SERVICE],fo="conversationChanged",go="conTagStatusChanged",po=function(){function e(e,t,n,r,i){var o=this;this._updatedConversations={},this._conTagStatusChanged=!1,this._eventEmitter=new pe,this._draftMap={},this._appkey=t,this._loginUserId=n,this._store=new lo(e.runtime,t,n),this._statusManager=new oo(e,t,n),this._statusManager.watch((function(e){var t=e.statusItem,n=e.isLastPull;o.addStatus(t,n)})),this._eventEmitter.on(fo,(function(e){r(e)})),this._eventEmitter.on(go,(function(){i()}))}return e.prototype._calcUnreadCount=function(e,t){var n=e.content,r=e.messageType,i=e.sentTime,o=e.isCounted,s=e.messageDirection,a=e.senderUserId,c=s===ve.SEND&&a===this._loginUserId,u=r===Se.RECALL,d=te(n),l=!1,h={},f=t.lastUnreadTime||0,g=t.unreadMessageCount||0;if(f>i||c)return{hasChanged:l,localConversation:t,updateItems:h};(o&&(t.unreadMessageCount=g+1,t.lastUnreadTime=i,l=!0),u&&d)&&(f>=n.sentTime&&g&&(t.unreadMessageCount=g-1,l=!0));return l&&(h.unreadMessageCount={val:t.unreadMessageCount,time:i}),{hasChanged:l,localConversation:t,updateItems:h}},e.prototype._calcMentionedInfo=function(e,t){var n=e.content,r=(e.messageDirection,e.isMentioned),i=e.sentTime;ve.SEND;var o=te(n),s=!1,a={};return r&&o&&n.mentionedInfo&&(t.hasMentioned=!0,s=!0,a.hasMentioned={val:!0,time:i},a.mentionedInfo={val:n.mentionedInfo,time:i}),{hasChanged:s,localConversation:t,updateItems:a}},e.prototype._calcMentionedCount=function(e,t){var n=e.content,r=e.messageDirection,i=!1;if(e.isMentioned&&r===ve.RECEIVE&&(null==n?void 0:n.mentionedInfo)){var o=n.mentionedInfo,s=o.type,a=o.userIdList;if(s===we.ALL||(a||[]).includes(this._loginUserId)){i=!0;var c=t.unreadMentionedCount||0;t.unreadMentionedCount=c+1}}return{hasChanged:i,localConversation:t}},e.prototype._setUpdatedConversation=function(e){if(te(e)){var t=e.conversationType,n=e.targetId,r=e.channelId,i="".concat(t,"_").concat(n),o=this._store.get(t,n,r)||{};this._updatedConversations[i]=Object.assign(o,e)}},e.prototype._setConTagStatusChanged=function(e,t,n,r){var i=(this._store.get(e,t,r)||{}).tags||{};if(Object.keys(i).length===Object.keys(n).length){for(var o in i)if(!n[o]||i[o].isTop!==n[o].isTop)return void(this._conTagStatusChanged=!0)}else this._conTagStatusChanged=!0},e.prototype.addStatus=function(e,t){var n=e.conversationType,r=e.targetId,i=e.updatedTime,o=e.notificationStatus,s=e.notificationLevel,a=e.isTop,c=e.tags,u=e.channelId,d={},l={};n!==Y.ULTRA_GROUP&&(re(o)||(l.notificationStatus={time:i,val:o}),re(s)||(l.notificationLevel={time:i,val:s}),re(a)||(l.isTop={time:i,val:a}),re(c)||(l.tags={time:i,val:c},null==c||c.forEach((function(e){d[e.tagId]={isTop:e.isTop}}))),this._setConTagStatusChanged(n,r,d,u),this._store.set(n,r,{notificationStatus:o,notificationLevel:s,isTop:a,tags:d},u),this._setUpdatedConversation({conversationType:n,targetId:r,updatedItems:l,channelId:u}),t&&this._notifyConversationChanged())},e.prototype._notifyConversationChanged=function(){var e=[];for(var t in this._updatedConversations)e.push(this._updatedConversations[t]);0!==e.length&&(this._eventEmitter.emit(fo,e),this._updatedConversations={},this._conTagStatusChanged&&(this._eventEmitter.emit(go),this._conTagStatusChanged=!1))},e.prototype.setConversationCacheByMessage=function(e,t){var n=this,r=e.conversationType,i=e.isPersited,o=e.targetId,s=e.channelId;if(ho.indexOf(r)>=0){var a=!1,c=this._store.get(r,o,s),u={};if([this._calcUnreadCount,this._calcMentionedInfo,this._calcMentionedCount].forEach((function(t){var r=t.call(n,e,c),i=r.hasChanged,o=r.localConversation,s=r.updateItems;a=a||i,u=I(I({},u),s),c=vt(o)})),a&&this._store.set(r,o,c,s),this._store.updateMentionedData(e),i){var d=this._store.get(r,o,s);d.updatedItems=I({latestMessage:{time:e.sentTime,val:e}},u),d.latestMessage=e;var l=Object.assign(d,{conversationType:r,targetId:o,channelId:s});this._setUpdatedConversation(l)}(a||i)&&this._notifyConversationChanged()}},e.prototype.get=function(e,t,n){return void 0===n&&(n=""),this._store.get(e,t,n)},e.prototype.getAllUnreadCount=function(e,t,n){var r=this._store.getValue(),i=0;return r.forEach((function(e){var r=e.unreadMessageCount,o=e.notificationStatus,s=e.notificationLevel,a=e.conversationType;r=r||0,(n||1!==o||s===Me.NOT_SET||s===Me.ALL_MESSAGE)&&(t.length>0?t.includes(Number(a))&&(i+=Number(r)):i+=Number(r))})),i},e.prototype.getUnreadCountByTag=function(e,t){var n=this._store.getValueForTag()[e]||[],r=0;return n.forEach((function(e){var n=e.unreadMessageCount,i=e.notificationStatus,o=e.notificationLevel;(t||1!==i||-1===o||0===o)&&(n=n||0,r+=Number(n))})),r},e.prototype.getUnreadCount=function(e,t,n){return this._store.get(e,t,n).unreadMessageCount||0},e.prototype.clearUnreadCount=function(e,t,n,r){void 0===r&&(r=!0);var i=this._store.get(e,t,n),o=i.unreadMessageCount,s=i.hasMentioned,a={};if(o&&(i.unreadMessageCount=0,a.unreadMessageCount={val:0,time:Date.now()}),s&&(i.hasMentioned=!1,i.unreadMentionedCount=0,i.mentionedInfo=void 0,a.hasMentioned={val:!1,time:Date.now()},a.mentionedInfo={val:void 0,time:Date.now()}),this._store.set(e,t,i,n),r&&0!==Object.keys(a).length){var c=Object.assign(i,{conversationType:e,targetId:t,channelId:n,updatedItems:a});this._setUpdatedConversation(c),this._notifyConversationChanged()}},e.prototype.clearAllUnreadCount=function(){var e=this;this._store.getValue().forEach((function(t){t.unreadMessageCount&&(t.unreadMessageCount=0,e._store.set(t.conversationType,t.targetId,t,t.channelId))}))},e.prototype.startPullConversationStatus=function(e){this._statusManager.pull(e)},e.prototype.setDraft=function(e,t,n,r){var i="".concat(e,"_").concat(t,"_").concat(r);this._draftMap[i]=n},e.prototype.getDraft=function(e,t,n){var r="".concat(e,"_").concat(t,"_").concat(n);return this._draftMap[r]},e.prototype.clearDraft=function(e,t,n){var r="".concat(e,"_").concat(t,"_").concat(n);delete this._draftMap[r]},e.prototype.addTagStatus=function(e,t,n,r){void 0===r&&(r="");var i=this._store.get(e,t,r).tags;i=Object.assign(i,n),this._store.set(e,t,{tags:i},r)},e.prototype.deleteTagStatus=function(e,t,n,r){void 0===r&&(r="");var i=this._store.get(e,t,r).tags;n.forEach((function(e){delete i[e]})),this._store.set(e,t,{tags:i},r)},e.prototype.getConversationListForTag=function(){return this._store.getValueForTag()},e.prototype.getBlockConversationList=function(){return this._store.getValue().filter((function(e){return e.notificationStatus===Ne.OPEN||-1!==e.notificationLevel&&0!==e.notificationLevel})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId}}))},e.prototype.getTopConversationList=function(){return(this._store.getValue()||{}).filter((function(e){return e.isTop})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId}}))},e.prototype.adaptOldStore=function(){this._store.adaptOldStore()},e.prototype.getUnreadMentionedCount=function(e,t,n){return void 0===e&&(e=""),this.get(t,n,e).unreadMentionedCount||0},e.prototype.getAllUnreadMentionedCount=function(){var e=this._store.getValue(),t=0;return e.forEach((function(e){var n=e.unreadMentionedCount;n=n||0,t+=Number(n)})),t},e.prototype.getAllConversationState=function(){return this._store.getValue().filter((function(e){return e.unreadMessageCount||e.unreadMentionedCount})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId,unreadCount:e.unreadMessageCount||0,unreadMentionedCount:e.unreadMentionedCount||0}}))},e}(),mo=function(){function e(e,t,n,r){this._pullQueue=[],this._isPulling=!1,this._storageTagKey="tag-".concat(t,"-").concat(n),this._storagePullTimeKey="us-s-".concat(t,"-").concat(n),this._storage=v(e.runtime),this._engine=e,this._tagWatcherFunc=r}return e.prototype._updateTag=function(e){var t=e.tags,n={};t.forEach((function(e){n[e.tagId]={tagName:e.tagName,createdTime:e.createdTime}})),this._storage.set(this._storageTagKey,n),this._tagWatcherFunc()},e.prototype.addTag=function(e,t){var n=this._storage.get(this._storageTagKey)||{};e.forEach((function(e){var t,r=(null===(t=n[e.tagId])||void 0===t?void 0:t.createdTime)||e.createdTime||0;n[e.tagId]={tagName:e.tagName,createdTime:r}})),this._storage.set(this._storageTagKey,n),this._storage.set(this._storagePullTimeKey,t)},e.prototype.deleteTag=function(e,t){var n=this._storage.get(this._storageTagKey)||{};e.forEach((function(e){delete n[e]})),this._storage.set(this._storageTagKey,n),this._storage.set(this._storagePullTimeKey,t)},e.prototype.getTagsInfo=function(){return this._storage.get(this._storageTagKey)||{}},e.prototype.getTags=function(){var e=this._storage.get(this._storageTagKey)||{},t=[];for(var n in e)t.push({tagId:n,tagName:e[n].tagName,createdTime:e[n].createdTime,conversationCount:0});return t.sort((function(e,t){return(e.createdTime||0)-(t.createdTime||0)}))},e.prototype.getTagById=function(e){var t=this._storage.get(this._storageTagKey)||{};return t[e]?{tagId:e,tagName:t[e].tagName,createdTime:t[e].createdTime,conversationCount:0}:null},e.prototype._startPull=function(){return C(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],[4,this._engine.pullUserSettings(e)]);case 1:return t=c.sent(),n=t.code,r=t.data,n!==ye.SUCCESS||re(r)?(this._isPulling=!1,this._startPull()):(o=(i=r).settings,s=i.version,a=o.Tag,re(a)||this._updateTag(a),this._storage.set(this._storagePullTimeKey,s),this._isPulling=!1,this._startPull()),[2]}}))}))},e.prototype.pullUserSettings=function(e){var t=this._storage.get(this._storagePullTimeKey)||0;(e>t||0===e)&&(this._pullQueue.push(t),this._startPull())},e.prototype.getVersion=function(){return this._storage.get(this._storagePullTimeKey)||0},e}();function vo(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h,f,g,p;return S(this,(function(m){switch(m.label){case 0:t=ki.IM_NAVI,n=ge.getStatisticsBaseData(),r=n.sdkPrivate,i=n.serverPrivate,o=n.bundleId,s=ge.getStatisticsData(t),a=s.protocol,c=s.startTime,u=s.endTime,d=s.code,l=s.host,h=jr.UNKONWN,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,e.getNetworkType()];case 2:return h=m.sent(),[3,4];case 3:return f=m.sent(),ge.debug(f.message),[3,4];case 4:return g=0,X(c)&&X(u)&&u>c&&c&&(g=u-c),p={spr:r,pr:i,bid:o,ptc:a,dur:g,cod:d,hos:l,net:h},ge.reportStatisticsLog(t,p),[2]}}))}))}var _o,yo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._miniConnectUrl="",r._connectType=n.connectionType,r}return T(t,e),t.prototype._formatJSONPUrl=function(e,t,n,r){var i=this._runtime.isSupportSocket()&&"websocket"===this._connectType?"navi":"cometnavi";return"".concat(e,"/").concat(i,".js?appId=").concat(n,"&token=").concat(encodeURIComponent(t),"&callBack=").concat(r,"&v=").concat(this._apiVersion,"&r=").concat(Date.now())},t.prototype.getInfo=function(t,n,r){var i;return C(this,void 0,void 0,(function(){var o;return S(this,(function(s){return this._runtime.useNavi||(o=void 0,o=this._runtime.isSupportSocket()&&"websocket"===this._connectType?u.join(","):d.join(","),this._miniConnectUrl=(null===(i=this._options.miniCMPProxy)||void 0===i?void 0:i.length)?this._options.miniCMPProxy.join(","):o||"",n=[]),[2,e.prototype.getInfo.call(this,t,n,r)]}))}))},t.prototype._reqNavi=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l,h,f;return S(this,(function(g){switch(g.label){case 0:r="getServerEndpoint",i=0,o=e.length,g.label=1;case 1:return i<o?(s=this._formatJSONPUrl(e[i],n,t,r),ge.debug("req navi => ".concat(s)),[4,this._runtime.httpReq({url:s,timeout:1e4,dataType:"text"})]):[3,4];case 2:if(a=g.sent(),c=(new Date).getTime(),ge.setStatisticsData(ki.IM_NAVI,{endTime:c}),200!==a.status)return u=void 0,403===a.status?(u=ye.RC_CONN_USER_OR_PASSWD_ERROR,ge.error("request navi error: "+u)):401===a.status&&(u=ye.RC_CONN_APP_BLOCKED_OR_DELETED,ge.error("request navi error: "+u)),ge.setStatisticsData(ki.IM_NAVI,{code:u}),vo(this._runtime),[3,3];try{return d=a.data.match(/{[\d\D]+}/),0===(l=d&&d[0]?d[0]:"").indexOf('{\\"code\\":')&&(l=JSON.parse('"'+l+'"')),f=JSON.parse(l),h=/^https/.test(s)?"https":"http",f.protocol=h,this._runtime.useNavi||(f.server="",f.backupServer=this._miniConnectUrl,f.logSwitch=0),ge.updateStatisticsBaseData({serverPrivate:f.type===B.PRIVATE?B.PRIVATE:B.OPEN}),ge.setStatisticsData(ki.IM_NAVI,{code:ye.SUCCESS}),f.userId&&(ge.updateUploadLogAttr({userId:f.userId}),fe.init(f.userId)),vo(this._runtime),[2,f]}catch(e){ge.error("parse navi err =>",e)}g.label=3;case 3:return i+=1,[3,1];case 4:return this._runtime.useNavi?[2,null]:(f={code:200,protocol:"https",server:"",voipCallInfo:"",kvStorage:0,openHttpDNS:!1,historyMsg:!1,chatroomMsg:!1,uploadServer:"https://upload.qiniup.com",bosAddr:"https://gz.bcebos.com",location:"",monitor:0,joinMChrm:!1,openMp:0,openUS:0,grpMsgLimit:0,isFormatted:0,gifSize:2048,logSwitch:0,logPolicy:"",compDays:0,msgAck:"",activeServer:"",qnAddr:"",extkitSwitch:0,alone:!1,voipServer:"",offlinelogserver:"",backupServer:this._miniConnectUrl},ge.setStatisticsData(ki.IM_NAVI,{code:f.code,startTime:0,endTime:0,host:""}),vo(this._runtime),[2,f])}}))}))},t}(Wi),Eo=function(){function e(e){this._pullQueue=[],this._isPulling=!1,this._pullTime=0,this._engine=e}return e.prototype._startPull=function(){return C(this,void 0,void 0,(function(){var e,t,n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],t=e.roomId,n=e.timestamp,(r=this._pullTime)>n?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullRTCRoomEntry(t,r)]);case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS?(this._isPulling=!1,this._pullTime=s.syncTime||0,this._startPull()):this._startPull(),[2]}}))}))},e.prototype.pullEntry=function(e,t){this._pullQueue.push({roomId:e,timestamp:t}),this._startPull()},e.prototype.reset=function(){this._pullTime=0,this._isPulling=!1},e}(),To=function(e,t){return["send_msg",e,t].join("_")},Io=function(){function e(e,t){this._runtime=e,this._appkey=t,this._sendMessageMap={},this._userId=""}return e.prototype.init=function(e){this._userId=e;var t=To(this._appkey,e);this._sendMessageMap=this._getLocalInfo(t)},e.prototype._getLocalInfo=function(e){var t=this._runtime.localStorage.getItem(e);try{return t?JSON.parse(t):{}}catch(e){return{}}},e.prototype.setMessage=function(e,t){this._sendMessageMap[e]=t;var n=To(this._appkey,this._userId),r=this._getLocalInfo(n);r[e]=t,this._runtime.localStorage.setItem(n,JSON.stringify(r))},e.prototype.getSendMessageMap=function(){return this._sendMessageMap},e.prototype.removeByUID=function(e){delete this._sendMessageMap[e]},e.prototype.removeByTimestamp=function(e){var t=To(this._appkey,this._userId),n=this._getLocalInfo(t);Object.keys(n).forEach((function(t){n[t]<e&&delete n[t]})),this._runtime.localStorage.setItem(t,JSON.stringify(n))},e}();(_o={})[Y.PRIVATE]=Bi.qryPMsg,_o[Y.GROUP]=Bi.qryGMsg,_o[Y.CHATROOM]=Bi.qryCHMsg,_o[Y.CUSTOMER_SERVICE]=Bi.qryCMsg,_o[Y.SYSTEM]=Bi.qrySMsg;var Co=[Bi[Bi.recallMsg],Bi[Bi.ppMsgS],Bi[Bi.pgMsgS],Bi[Bi.ppMsgP],Bi[Bi.pgMsgP],Bi[Bi.chatMsg],Bi[Bi.pcMsgP],Bi[Bi.prMsgS],Bi[Bi.updUgRTime]],So=function(){function e(e,t,n){this.ULTRA_GROUP_CONVERSATION="ultragroupconversation";var r="".concat(this.ULTRA_GROUP_CONVERSATION,"-").concat(t,"-").concat(n);this._localStore=new y(e,r)}return e.prototype.set=function(e,t,n,r){var i=this._getStoreKey(e,t,r),o=this._localStore.get(i)||{};for(var s in n){var a=No[s],c=n[s];if(!re(a)&&!re(c))c===Ro[a].defaultVal?delete o[a]:o[a]=c}se(o)?this._localStore.set(i,o):this._localStore.remove(i)},e.prototype.get=function(e,t,n){void 0===n&&(n="");var r=this._getStoreKey(e,t,n),i=this._localStore.get(r)||{},o={};for(var s in Ro){var a=Ro[s],c=a.keyName,u=a.defaultVal;o[c]=i[s]||vt(u)}return o},e.prototype._getStoreKey=function(e,t,n){return"".concat(n,"_").concat(e,"_").concat(t)},e}(),Ro={nc:{keyName:"notificationStatus",defaultVal:2},nl:{keyName:"notificationLevel",defaultVal:0}},No={};for(var Oo in Ro){var Mo=Ro[Oo].keyName;No[Mo]=Oo}var Uo=function(){function e(e,t,n){this._store=new So(e.runtime,t,n)}return e.prototype.addUltraGroupStatus=function(e){var t=e.conversationType,n=e.targetId,r=e.notificationStatus,i=e.notificationLevel,o=e.channelId;t===Y.ULTRA_GROUP&&this._store.set(t,n,{notificationStatus:r,notificationLevel:i},o)},e.prototype.get=function(e,t,n){return void 0===n&&(n=""),this._store.get(e,t,n)},e}(),wo=function(e,t,r,i,o,s){return{conversationType:e,targetId:t,senderUserId:s,messageDirection:ve.SEND,isCounted:!!r.isCounted,isMentioned:!!r.isMentioned,content:r.content,messageType:r.messageType,isOffLineMessage:!1,isPersited:!!r.isPersited,messageUId:i,sentTime:o,receivedTime:0,disableNotification:!!r.disableNotification,isStatusMessage:!!r.isStatusMessage,canIncludeExpansion:!!r.canIncludeExpansion,expansion:r.canIncludeExpansion?r.expansion:null,receivedStatus:n.UNREAD,pushConfig:r.pushConfig,channelId:r.channelId,isInterrupt:r.isInterrupt}},Ao=function(e){return e.sort((function(e,t){var n,r,i=(null===(n=e.latestMessage)||void 0===n?void 0:n.sentTime)||0;return((null===(r=t.latestMessage)||void 0===r?void 0:r.sentTime)||0)-i}))},bo=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i._customMessageType={},i._reconnectTimer=-1,i._pullOfflineFinished=!1,i._connectedTime=0,i._localConnectedTime=0,i._status=Te.DISCONNECTED,i._pullingMsg=!1,i._pullQueue=[],i._chrmsQueue={},i._latestSyncTimestamp=0,i._intervalTimer=-1,i._pullChatroomEntryTimestamp=0,i._lastSyncUltraMsgTimeStamp=0,i._lastSyncUltraMsgLocalTimeStamp=0,i._ultraGroupTimer=-1,i._isUltraPulling=!1,i._ultraGroupTimeQue=[],i._isUltraGroupListExist=!1,i._ultraGroupMap={},i._firstPullUltraGroupTime=0,i._ultraMsgMap={},i._pullUltraChangeMessageQue=[],i._isPullingUltraChangeMessage=!1,i._lastPullingUltraChangeMessageTime=0,i._ultraMsgChangeMap={},i._letterbox=new $i(t,r.appkey),i._sendMessageStore=new Io(t,r.appkey),i._chrmEntryHandler=new no(i),i}return T(t,e),t.prototype._createNavi=function(){return new yo(this.runtime,this._options)},t.prototype.getConnectedTime=function(){return this._connectedTime},t.prototype.connect=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a=this;return S(this,(function(c){switch(c.label){case 0:return n=[],this._naviInfo=t,t.server?n.push(t.server):ge.warn("navi.server is invalid"),(r=t.backupServer)&&r.split(",").forEach((function(e){n.indexOf(e)<0&&n.push(e)})),0===n.length?(ge.error("navi invaild.",n),[2,ye.UNKNOWN]):(i=this.runtime.createDataChannel({status:function(r){a._connectionStatusHandler(r,e,n,t.protocol)},signal:this._signalHandler.bind(this)},this._options.connectionType),o=nt.V3,1===t.openAnti&&(o=nt.V4),[4,i.connect(this._appkey,e,n,t.protocol,this._apiVer,o)]);case 1:return(s=c.sent())===ye.SUCCESS?(this._channel=i,this.currentUserId=i.userId,this._connectedTime=i.connectedTime,this._localConnectedTime=Math.floor((Date.now()+i.sendConnectTime)/2),this._watcher.status(Te.CONNECTED),this._status=Te.CONNECTED,this._pullOfflineFinished=!1,this._conversationManager=new po(this,this._appkey,this.currentUserId,this._watcher.conversation,this._watcher.conversationTag),this._ultraGroupManager=new Uo(this,this._appkey,this.currentUserId),this._conversationManager.startPullConversationStatus(0),this._userSettingManager=new mo(this,this._appkey,this.currentUserId,this._watcher.tag),this._userSettingManager.pullUserSettings(0),this._sendMessageStore.init(this.currentUserId),this._conversationManager.adaptOldStore(),this._rtcKVManager=new Eo(this),this._joinedChrmManager=new ro(this.runtime,this._appkey,this.currentUserId,t.joinMChrm),this._startSyncInterval(),1===t.ugMsg&&this._startUltraSyncInterval()):i.close(),[2,s]}}))}))},t.prototype._connectionStatusHandler=function(e,t,n,r){if(ge.warn("connection status changed:",e),this._status=e,e!==Te.CONNECTING)if(e!==Te.CONNECTED){if(this._channel&&e!==Te.DISCONNECTED)return e===Te.BLOCKED||e===Te.KICKED_OFFLINE_BY_OTHER_CLIENT||e===Te.DISCONNECT_BY_SERVER?(this.disconnect(),void this._watcher.status(e)):void(e!==Te.REDIRECT?(this._watcher.status(e),this._try2Reconnect(t,n,r)):this._watcher.status(e));this._watcher.status(e)}else this._watcher.status(e);else this._watcher.status(e)},t.prototype._try2Reconnect=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i=this;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=nt.V3,1===this._naviInfo.openAnti&&(r=nt.V4),[4,this._channel.connect(this._appkey,e,t,n,this._apiVer,r)]):[2];case 1:return o.sent()===ye.SUCCESS?(this._pullOfflineFinished=!1,this._startSyncInterval(),this._watcher.status(Te.CONNECTED),this._status=Te.CONNECTED,this._startUltraSyncInterval(),this._rejoinChrm(),ge.__insertLogIntoDatabase(),[2]):(this._watcher.status(Te.WEBSOCKET_UNAVAILABLE),this._status=Te.WEBSOCKET_UNAVAILABLE,this._reconnectTimer=setTimeout((function(){i._reconnectTimer=-1,i._try2Reconnect(e,t,n)}),5e3),[2])}}))}))},t.prototype._signalHandler=function(e,t){var n=e.syncMsg,r=e.topic;if(n)this._receiveSyncMsg(e,t);else{var i=Bi[r];if(i)switch(i){case Bi.s_ntf:ge.info("recv s_ntf -> signal.messageId: ".concat(e.messageId)),this._pullMsg(e);break;case Bi.s_msg:this._receiveMsg(e);break;case Bi.s_cmd:this._receiveStateNotify(e);break;case Bi.s_us:this._receiveSettingNotify(e);break;case Bi.rtc_ntf:this._receiveRtcKv(e);break;case Bi.s_opNtf:this._pullOperateStatusNotify(e)}else ge.error("unknown topic:",r)}},t.prototype._receiveStateNotify=function(e){var t,n=null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,kt),r=n.time,i=n.type,o=n.chrmId;switch(i){case 2:this._chrmEntryHandler.pullEntry(o,r);break;case 3:this._conversationManager.startPullConversationStatus(r);break;case 4:this._chrmEntryHandler.reset(o),this._watcher.chatroom({chatroomDestroyed:e.targetId});break;case 6:this._ultraGroupTimeQue.push(r),this._syncUltraMsg(this._lastSyncUltraMsgTimeStamp);break;case 7:this._pullUltraChangeMessageQue.push(r),this._pullUltraChangeMessageList(this._lastPullingUltraChangeMessageTime)}},t.prototype._receiveSettingNotify=function(e){var t,n=(null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,xn)).version;this._userSettingManager.pullUserSettings(n)},t.prototype._receiveRtcKv=function(e){var t,n=null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,pr),r=n.time,i=n.type,o=n.roomId;if(1===i)this._rtcKVManager.pullEntry(o,r)},t.prototype._receiveMessageExpansion=function(e){var t=e.content,n=t.put,r=t.del,i=t.mid;n&&this._watcher.expansion({updatedExpansion:{messageUId:i,expansion:n}}),r&&this._watcher.expansion({deletedExpansion:{messageUId:i,deletedKeys:r}})},t.prototype._receiveSyncMsg=function(e,t){var n,r;if(Co.includes(e.topic)){if(e.topic===Bi[Bi.updUgRTime]){var i=null===(n=this._channel)||void 0===n?void 0:n.codec.decodeByPBName(e.data,Jt),o=i.channelId,s=i.busChannel,a=this._ultraGroupMap[s+"_"+o];return a&&(a.unreadMessageCount=0,a.unreadMentionedCount=0,a.lastReadTime=t.timestamp,this._watcher.conversation(Tt([a]))),void(t&&(this._ultraMsgMap[t.messageUId]=t.timestamp))}var c=null===(r=this._channel)||void 0===r?void 0:r.codec.decodeByPBName(e.data,wt,{currentUserId:this.currentUserId,signal:e});c=this._handleMsgProperties(c),t&&(c.sentTime=t.timestamp,c.messageUId=t.messageUId),this._pullingMsg?this._pullQueue.push((null==t?void 0:t.timestamp)||c.sentTime):(t&&this._sendMessageStore.setMessage(t.messageUId,t.timestamp),c.messageType!==Se.EXPANSION_NOTIFY?(c.messageType===Se.SYNC_READ_STATUS&&this._conversationManager.clearUnreadCount(c.conversationType,c.targetId,c.channelId),this._conversationManager.setConversationCacheByMessage(c,!0),this._watcher.batchMessage([c])):this._receiveMessageExpansion(c))}},t.prototype._pullMsg=function(e){if(this._channel){var t=this._channel.codec.decodeByPBName(e.data,kt),n=t.type,r=t.chrmId,i=t.time;if(ge.info("s_ntf -> type: ".concat(n,", chrmId: ").concat(r,", time: ").concat(i)),2===n){var o=this._chrmsQueue[r];if(!o)return;o.queue.push(i),this._pullChrmMsg(r)}else this._pullQueue.push(i),this._syncMsg()}},t.prototype._startSyncInterval=function(){var e=this;this._stopSyncInterval();this._intervalTimer=setInterval((function(){Date.now()-e._latestSyncTimestamp>=18e4&&e._syncMsg()}),3e4),this._latestSyncTimestamp=Date.now(),this._syncMsg()},t.prototype._stopSyncInterval=function(){-1!==this._intervalTimer&&(clearInterval(this._intervalTimer),this._intervalTimer=-1)},t.prototype._syncMsg=function(){return C(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,c,u,d,l,h,f,g,p,m=this;return S(this,(function(v){switch(v.label){case 0:return this._pullingMsg?[2]:this._channel?(this._pullingMsg=!0,e=this._letterbox.getOutboxTime(this.currentUserId),t=this._letterbox.getInboxTime(this.currentUserId),n=this._letterbox.getBroadcastSyncTime(this.currentUserId),ge.info("pullMsg -> sendboxTime: ".concat(e,", inboxTime: ").concat(t,", broadcastSyncTime: ").concat(n)),r=this._channel.codec.encodeSyncMsg({sendboxTime:e,inboxTime:t,broadcastSyncTime:n}),i=new Li(Bi[Bi.pullMsg],r,this.currentUserId),[4,this._channel.send(i,Lt,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId})]):(this._pullingMsg=!1,[2]);case 1:return o=v.sent(),s=o.code,a=o.data,this._latestSyncTimestamp=Date.now(),s!==ye.SUCCESS||!a||re(a.finished)||re(a.list)||re(a.syncTime)?(ge.warn("pullMsg failed -> code:",s,", data: ",a),this._pullingMsg=!1,[2]):(c=a.list,u=a.finished,d=a.syncTime,l=a.broadcastSyncTime,ge.info("pullMsg success -> syncTime: ".concat(d,", finished: ").concat(u)),h=0,f=[],c.forEach((function(e){if(e.messageDirection===ve.SEND&&(h=Math.max(e.sentTime,h),m._sendMessageStore.getSendMessageMap()[e.messageUId]))return void m._sendMessageStore.removeByUID(e.messageUId);if(e.messageType!==Se.EXPANSION_NOTIFY){if(e.messageType===Se.SYNC_READ_STATUS){if(e.senderUserId!==m.currentUserId)return;m._conversationManager.clearUnreadCount(e.conversationType,e.targetId,e.channelId)}var t=m._handleMsgProperties(e);m._conversationManager.setConversationCacheByMessage(t,!0),f.push(t)}else m._receiveMessageExpansion(e)})),this._watcher.batchMessage(f),this._letterbox.setInboxTime(d,this.currentUserId),this._letterbox.setOutboxTime(h,this.currentUserId),this._letterbox.setBroadcastSyncTime(l,this.currentUserId),this._sendMessageStore.removeByTimestamp(h),this._pullingMsg=!1,g=this._pullQueue.filter((function(e){return e>d})),this._pullQueue.length=0,(p=this._pullQueue).push.apply(p,g),u&&!this._pullOfflineFinished&&(this._pullOfflineFinished=!0,this._watcher.pullFinished()),(!u||g.length>0)&&this._syncMsg(),[2])}}))}))},t.prototype._receiveMsg=function(e){if(this._channel&&!this._pullingMsg)if(this._pullQueue.length>0)this._syncMsg();else{var t=this._channel.codec.decodeByPBName(e.data,bt,{currentUserId:this.currentUserId,connectedTime:this._channel.connectedTime});(t=this._handleMsgProperties(t)).senderUserId===this.currentUserId&&this._sendMessageStore.setMessage(t.messageUId,t.sentTime),t.isStatusMessage||t.senderUserId===this.currentUserId||this._letterbox.setInboxTime(t.sentTime,this.currentUserId),t.messageType!==Se.EXPANSION_NOTIFY?t.messageType===Se.SYNC_READ_STATUS&&t.senderUserId!==this.currentUserId||(this._conversationManager.setConversationCacheByMessage(t,!0),this._watcher.batchMessage([t])):this._receiveMessageExpansion(t)}},t.prototype._handleMsgProperties=function(e,t){void 0===t&&(t=!1);var n,r=e.messageType,i=e.isCounted,o=e.isPersited,s=e.isStatusMessage,a=r in p,c=r in this._customMessageType;if(n=a?I(I({},p[r]),{isStatusMessage:m.includes(r)}):c?this._customMessageType[r]:{isCounted:!ie(i)&&i,isPersited:!ie(o)&&o,isStatusMessage:!1},Object.assign(e,n),t&&!re(s)&&(e.isStatusMessage=s),!t){var u=e.content.user;if(u){var d=u.portrait,l=u.portraitUri,h=d||l;h&&(u.portrait=u.portraitUri=h)}}return e},t.prototype.getHistoryMessage=function(e,t,n,r,i,o){return void 0===o&&(o=""),C(this,void 0,void 0,(function(){var s,a,c,u,d,l,h,f,g;return S(this,(function(p){switch(p.label){case 0:return a=(s=this).currentUserId,c=s._channel,u=di[e]||ii,d=1===r&&0===n,c?(l=c.codec.encodeGetHistoryMsg(t,{timestamp:n,count:d?2:r,order:i,channelId:o}),[4,c.send(new Li(u,l,a),Gt,{currentUserId:a,connectedTime:c.connectedTime,conversation:{targetId:t}})]):[3,2];case 1:return h=p.sent(),(f=h.code)!==ye.SUCCESS?[2,{code:f}]:(g=h.data,d&&2===g.list.length&&(g.hasMore=!0,0===i?g.list.shift():g.list.pop()),[2,{code:f,data:{list:g.list,hasMore:g.hasMore}}]);case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.reportSDKInfo=function(e){var t=this.currentUserId,n=this._channel;if(n){ge.info("reportSDKInfo ->",e);var r=n.codec.encodeReportSDKInfo(JSON.stringify(e)),i=new Li(Bi[Bi.reportsdk],r,t);n.send(i).then((function(e){var t=e.code;t!==ye.SUCCESS&&ge.warn("reportSDKInfo failed -> code: ".concat(t))}))}},t.prototype.deleteRemoteMessage=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return o=(i=this).currentUserId,(s=i._channel)?(a=s.codec.encodeDeleteMessages(e,t,n,r),c=new Li(Yr,a,o),[4,s.send(c)]):[3,2];case 1:return u=l.sent(),d=u.code,ye.SUCCESS,[2,d];case 2:return[2,ye.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.deleteRemoteMessageByTimestamp=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d,l;return S(this,(function(h){switch(h.label){case 0:return o=(i=this).currentUserId,(s=i._channel)?(a=s.codec.encodeClearMessages(t,n,r,e),c=li[e],u=new Li(c,a,o),[4,s.send(u)]):[3,2];case 1:return d=h.sent(),l=d.code,ye.SUCCESS,[2,l];case 2:return[2,ye.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.getConversationList=function(e,t,n,r,i){return void 0===e&&(e=300),C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d,l,h=this;return S(this,(function(f){switch(f.label){case 0:return o=(i=this).currentUserId,s=i._channel,t=t||Y.PRIVATE,s?(a=s.codec.encodeOldConversationList({count:e,type:t,startTime:n,order:r}),c=new Li(ei,a,o),[4,s.send(c,qt,{currentUserId:o,connectedTime:s.connectedTime,afterDecode:function(e){var t=e.conversationType,n=e.targetId,r=e.channelId,i=h._conversationManager.get(t,n,r);return Object.assign(e,i),e}})]):[3,2];case 1:return u=f.sent(),d=u.code,l=u.data,d!==ye.SUCCESS?[2,{code:d}]:[2,{code:d,data:null==l?void 0:l.list}];case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.removeConversation=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return(r=this._channel)?(i=r.codec.encodeRemoveOldConversationList({conversationType:e,channelId:n,targetId:t}),o=new Li(ti,i,t),[4,r.send(o)]):[3,2];case 1:return s=c.sent(),ge.info("RemoveConversation =>",s),a=s.code,ye.SUCCESS,[2,a];case 2:return[2,ye.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.getConversation=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return e!==Y.ULTRA_GROUP?[3,1]:(r=this._ultraGroupMap[n+"_"+t])?[3,3]:[2,{code:ye.CONVER_GET_ERROR}];case 1:return(i=this._conversationManager.get(e,t,n))?[4,this.getHistoryMessage(e,t,0,1,0)]:[2,{code:ye.CONVER_GET_ERROR}];case 2:if(o=u.sent(),s=o.code,a=o.data,s!==ye.SUCCESS)return[2,{code:ye.CONVER_GET_ERROR}];c=(null==a?void 0:a.list[0])||null,r={conversationType:e,targetId:t,channelId:n,unreadMessageCount:i.unreadMessageCount||0,latestMessage:c,notificationStatus:i.notificationStatus||Ne.CLOSE,notificationLevel:i.notificationLevel||Me.NOT_SET,isTop:i.isTop||!1,lastUnreadTime:i.lastUnreadTime||0,unreadMentionedCount:i.unreadMentionedCount||0},u.label=3;case 3:return[2,{code:ye.SUCCESS,data:r}]}}))}))},t.prototype.getAllConversationUnreadCount=function(e,t,n){var r=this._conversationManager.getAllUnreadCount(e,t,n);return Promise.resolve({code:ye.SUCCESS,data:r})},t.prototype.getConversationUnreadCount=function(e,t,n){var r,i;return i=e===Y.ULTRA_GROUP?(null===(r=this._ultraGroupMap[n+"_"+t])||void 0===r?void 0:r.unreadMessageCount)||0:this._conversationManager.getUnreadCount(e,t,n),Promise.resolve({code:ye.SUCCESS,data:i})},t.prototype.clearConversationUnreadCount=function(e,t,n){return this._conversationManager.clearUnreadCount(e,t,n,!1),Promise.resolve(ye.SUCCESS)},t.prototype.clearAllUnreadCount=function(){return this._conversationManager.clearAllUnreadCount(),Promise.resolve(ye.SUCCESS)},t.prototype.getFirstUnreadMessage=function(e,t){throw new Error("Method not implemented.")},t.prototype.saveConversationMessageDraft=function(e,t,n,r){return this._conversationManager.setDraft(e,t,n,r),Promise.resolve(ye.SUCCESS)},t.prototype.getConversationMessageDraft=function(e,t,n){var r=this._conversationManager.getDraft(e,t,n);return Promise.resolve({code:ye.SUCCESS,data:r})},t.prototype.clearConversationMessageDraft=function(e,t,n){return this._conversationManager.clearDraft(e,t,n),Promise.resolve(ye.SUCCESS)},t.prototype.pullConversationStatus=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d=this;return S(this,(function(l){switch(l.label){case 0:return n=(t=this)._channel,r=t.currentUserId,n?(i=n.codec.encodeGetConversationStatus(e),o=new Li(Bi[Bi.pullSeAtts],i,r),[4,n.send(o,kn)]):[3,2];case 1:return s=l.sent(),a=s.code,c=s.data,a!==ye.SUCCESS?[2,{code:a}]:(u=[],Array.isArray(c)&&c.forEach((function(e){var t=e.conversationType,n=e.targetId,r=e.notificationStatus,i=e.channelId,o=e.isTop,s=e.notificationLevel,a=d._ultraGroupMap[i+"_"+n];t===Y.ULTRA_GROUP?a&&(void 0!==r&&(a.notificationStatus=r),void 0!==s&&(a.notificationLevel=s),void 0===s&&void 0===r||d._ultraGroupManager.addUltraGroupStatus(e),"boolean"==typeof o&&(a.isTop=o)):u.push(e)})),[2,{code:a,data:u}]);case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.batchSetConversationStatus=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h=this;return S(this,(function(f){switch(f.label){case 0:return n=(t=this).currentUserId,(r=t._channel)?(i=r.codec.encodeSetConversationStatus(e),o=new Li(ni,i,n),[4,r.send(o,qn)]):[3,2];case 1:return s=f.sent(),a=s.code,c=s.data,a===ye.SUCCESS?(u=c,d=[],e.forEach((function(e){var t=e.conversationType,n=e.targetId,r=e.notificationStatus,i=e.notificationLevel,o=e.channelId,s=e.isTop;if(t===Y.ULTRA_GROUP){var a=h._ultraGroupMap[o+"_"+n];a&&(void 0!==r&&(a.notificationStatus=r),void 0!==i&&(a.notificationLevel=i),void 0===i&&void 0===r||h._ultraGroupManager.addUltraGroupStatus(a),void 0!==s&&(a.isTop=s),d.push(a))}else h._conversationManager.addStatus(I(I({},e),{updatedTime:u.version}),!0)})),d.length>0&&(l=Tt(d),l=Ao(l),this._watcher.conversation(l)),[2,a]):[2,a];case 2:return[2,ye.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype._joinChrm=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return(r=this._channel)?(i=r.codec.encodeJoinOrQuitChatRoom(),o=new Li(n?Wr:Qr,i,e),[4,r.send(o,Xt)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return s=d.sent(),a=s.code,c=s.data,a===ye.SUCCESS&&(u=c.joinTime,this._chrmsQueue[e]||(this._chrmsQueue[e]={pulling:!1,queue:[],timestamp:0}),this._pullChrmMsg(e,t,u),this._naviInfo.kvStorage&&this._chrmEntryHandler.pullEntry(e,0),this._joinedChrmManager.set(e,t)),[2,a]}}))}))},t.prototype._rejoinChrm=function(){return C(this,void 0,void 0,(function(){var e,t,n,r,i,o;return S(this,(function(s){switch(s.label){case 0:for(n in e=this._joinedChrmManager.get(),t=[],e)t.push(n);r=0,s.label=1;case 1:return r<t.length?(i=t[r],[4,this._joinChrm(i,e[i]||10,!0)]):[3,4];case 2:(o=s.sent())===ye.SUCCESS?this._watcher.chatroom({rejoinedRoom:{chatroomId:i,count:e[i]}}):this._watcher.chatroom({rejoinedRoom:{chatroomId:i,errorCode:o}}),s.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype._pullChrmMsg=function(e,t,n){return void 0===t&&(t=10),void 0===n&&(n=0),C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l,h,f,g;return S(this,(function(p){switch(p.label){case 0:return this._channel?(r=this._chrmsQueue[e],i=r.pulling,o=r.timestamp,i?[2]:(r.pulling=!0,s=this._channel.codec.encodeChrmSyncMsg(o,t),a=new Li(Bi[Bi.chrmPull],s,e),[4,this._channel.send(a,Lt,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId})])):[2];case 1:return c=p.sent(),u=c.code,d=c.data,r.pulling=!1,u===ye.SUCCESS&&d?(l=d.list,h=d.syncTime,f=d.finished,r.timestamp=n?Math.max(h,n):h,r.queue=r.queue.filter((function(e){return e>h})),g=[],l.forEach((function(e){e.sentTime<o||g.push(e)})),this._watcher.batchMessage(g),(!f||r.queue.length>0)&&this._pullChrmMsg(e),[2]):(ge.warn("pull chatroom msg failed, code:",u,", data:",d),[2])}}))}))},t.prototype.joinChatroom=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._joinChrm(e,t,!1)]}))}))},t.prototype.joinExistChatroom=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._joinChrm(e,t,!0)]}))}))},t.prototype.quitChatroom=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return(t=this._channel)?(n=t.codec.encodeJoinOrQuitChatRoom(),r=new Li(Jr,n,e),[4,t.send(r)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return i=s.sent(),(o=i.code)===ye.SUCCESS&&(delete this._chrmsQueue[e],this._chrmEntryHandler.reset(e),this._joinedChrmManager.remove(e)),[2,o]}}))}))},t.prototype.getChatroomInfo=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return(r=this._channel)?(i=r.codec.encodeGetChatRoomInfo(t,n),o=new Li(Bi[Bi.queryChrmI],i,e),[4,r.send(o,$t)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return s=u.sent(),a=s.code,c=s.data,a!==ye.SUCCESS?[2,{code:a}]:[2,{code:a,data:c}]}}))}))},t.prototype.getChatroomHistoryMessages=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return(i=this._channel)?(o=i.codec.encodeGetHistoryMsg(e,{timestamp:t,count:n,order:r}),s=new Li(si,o,e),[4,i.send(s,Gt,{conversation:{targetId:e}})]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return a=d.sent(),c=a.code,u=a.data,c!==ye.SUCCESS?[2,{code:c}]:[2,{code:c,data:{list:u.list,hasMore:u.hasMore}}]}}))}))},t.prototype._modifyChatroomKV=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return r=(n=this)._channel,i=n.currentUserId,r?(o=this._chrmEntryHandler.getVersion(e,t.key),t.version=null==o?this.getServerTime():o,s=r.codec.encodeModifyChatRoomKV(e,t,i),a=t.type===Pe.UPDATE?zr:Xr,c=new Li(a,s,e),[4,r.send(c,Xt)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return u=l.sent(),(d=u.code)===ye.SUCCESS?(this._chrmEntryHandler.setLocal(e,{kvEntries:[t],syncTime:(new Date).getTime()},i),[2,d]):[2,d]}}))}))},t.prototype._modifyChatroomKVS=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l,h,f,g=this;return S(this,(function(p){switch(p.label){case 0:return r=(n=this)._channel,i=n.currentUserId,r?(t.entries.forEach((function(t){var n=g._chrmEntryHandler.getVersion(e,t.key);t.version=null==n?g.getServerTime():n})),o=r.codec.encodeModifyChatRoomKVS(e,t,i),s=t.type===Pe.UPDATE?Zr:$r,a=new Li(s,o,e),[4,r.send(a,Mn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return c=p.sent(),u=c.code,-1!==[ye.SUCCESS,ye.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(u)&&(l=[],delete(h=Object.assign({},t)).entries,t.entries.forEach((function(e){l.push(Object.assign({},e,h))})),u===ye.CHATROOM_KV_STORE_NOT_ALL_SUCCESS&&(f=c.data,ge.warn("设置失败的属性：",f.errorKeys),d=f.errorKeys,f&&Array.isArray(f.errorKeys)&&f.errorKeys.forEach((function(e){var t=l.findIndex((function(t){return e.key===t.key}));-1!==t&&l.splice(t,1)}))),ge.warn("设置成功的属性：",l),this._chrmEntryHandler.setLocal(e,{kvEntries:l,syncTime:(new Date).getTime()},i)),[2,{code:u,data:d}]}}))}))},t.prototype.setChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.UPDATE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.setChatroomEntries=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.UPDATE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,t)]}))}))},t.prototype.forceSetChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.UPDATE,t.isOverwrite=!0,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.removeChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.DELETE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.removeChatroomEntries=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.DELETE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,t)]}))}))},t.prototype.forceRemoveChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.type=Pe.DELETE,t.isOverwrite=!0,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.getChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return(n=this._chrmEntryHandler.getValue(e,t))?[2,Promise.resolve({code:ye.SUCCESS,data:n})]:[3,1];case 1:return(r=this._channel)?(i=r.codec.encodePullChatRoomKV(0),o=new Li(Bi[Bi.pullKV],i,e),[4,r.send(o,On)]):[2,Promise.reject({code:ye.RC_NET_CHANNEL_INVALID})];case 2:return s=u.sent(),(a=s.data||{})&&a.kvEntries&&a.kvEntries.length&&(c=a.kvEntries.find((function(e){return e.key===t})),void 0!==c)?[2,Promise.resolve({code:ye.SUCCESS,data:null==c?void 0:c.value})]:[2,Promise.resolve({code:ye.CHATROOM_KEY_NOT_EXIST})]}}))}))},t.prototype.getAllChatroomEntry=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return(t=this._chrmEntryHandler.getAll(e))&&Object.keys(t).length?[2,Promise.resolve({code:ye.SUCCESS,data:t})]:[3,1];case 1:return(n=this._channel)?(r={},i=n.codec.encodePullChatRoomKV(0),o=new Li(Bi[Bi.pullKV],i,e),[4,n.send(o,On)]):[2,Promise.reject({code:ye.RC_NET_CHANNEL_INVALID})];case 2:return s=c.sent(),(a=s.data||{})&&a.kvEntries&&a.kvEntries.length&&a.kvEntries.forEach((function(e){e.key&&(r[e.key]=e.value||"")})),[2,Promise.resolve({code:ye.SUCCESS,data:r})]}}))}))},t.prototype.pullChatroomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l,h,f;return S(this,(function(g){switch(g.label){case 0:return r=(n=this)._channel,i=n.currentUserId,r?(t||(t=this._pullChatroomEntryTimestamp),o=r.codec.encodePullChatRoomKV(t),s=new Li(Bi[Bi.pullKV],o,e),[4,r.send(s,On)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return a=g.sent(),c=a.code,u=a.data,c===ye.SUCCESS?(ge.info("Pull success ChrmKV, "+JSON.stringify(a)),this._chrmEntryHandler.setLocal(e,u,i),ge.info("Save into cache success!"),l=(d=u).kvEntries,h=d.syncTime,this._pullChatroomEntryTimestamp=h||0,f=[],l.length>0&&(l.forEach((function(t){var n=t.key,r=t.value,i=t.type,o=t.timestamp;f.push({key:n,value:r,type:i,timestamp:o,chatroomId:e})})),this._watcher.chatroom({updatedEntries:f})),[2,{code:c,data:u}]):[2,{code:c}]}}))}))},t.prototype.sendMessage=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l,h;return S(this,(function(f){switch(f.label){case 0:return this._channel?(n=function(e,t){return"RC:SRSMsg"===e.messageType&&Object.assign(e,{directionalUserIdList:[t]}),e}(n,this.currentUserId),n=this._handleMsgProperties(n,!0),r=!![Y.PRIVATE,Y.GROUP].includes(e)&&n.isStatusMessage,i=r?function(e){var t;return(t={},t[Y.PRIVATE]=Bi.ppMsgS,t[Y.GROUP]=Bi.pgMsgS,t)[e]}(e):function(e){var t;return(t={},t[Y.PRIVATE]=Bi.ppMsgP,t[Y.GROUP]=Bi.pgMsgP,t[Y.CHATROOM]=Bi.chatMsg,t[Y.CUSTOMER_SERVICE]=Bi.pcMsgP,t[Y.RTC_ROOM]=Bi.prMsgS,t)[e]}(e)||Bi.ppMsgP,r&&(n.isPersited=!1,n.isCounted=!1),o=this._channel.codec.encodeUpMsg({conversationType:e,targetId:t},n),(s=new wi(Bi[i],o,t)).setHeaderQos(Xe.AT_LEAST_ONCE),r?(this._channel.sendOnly(s),[2,{code:ye.SUCCESS,data:wo(e,t,I({},n),"",0,this.currentUserId)}]):(a=Date.now()-this._localConnectedTime+this._connectedTime,c=wo(e,t,I({},n),"",a,this.currentUserId),[4,this._channel.send(s)])):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return u=f.sent(),d=u.code,l=u.data,d!==ye.SUCCESS?[2,{code:d,data:c}]:(h=l,this._sendMessageStore.setMessage(h.messageUId,h.timestamp),c.sentTime=h.timestamp,c.messageUId=h.messageUId,this._conversationManager.setConversationCacheByMessage(c,!0),[2,{code:ye.SUCCESS,data:c}])}}))}))},t.prototype.recallMsg=function(e,t,n,r,i){var o;return C(this,void 0,void 0,(function(){var s,a,c,u,d,l,h,f,g,p,m,v;return S(this,(function(_){switch(_.label){case 0:return this._channel?(s=i.user,a=i.extra,c={conversationType:e,targetId:t,messageUId:n,sentTime:r,channelId:i.channelId||""},s&&(c.user=s),a&&(c.extra=a),u={content:c,messageType:"RC:RcCmd",disableNotification:null==i?void 0:i.disableNotification,pushConfig:null==i?void 0:i.pushConfig,pushContent:(null===(o=i.pushConfig)||void 0===o?void 0:o.pushContent)||i.pushContent||"",channelId:i.channelId},d=Bi[Bi.recallMsg],l=this._channel.codec.encodeUpMsg({conversationType:e,targetId:t},u),(h=new wi(d,l,this.currentUserId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(h)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return f=_.sent(),g=f.code,p=f.data,g!==ye.SUCCESS?[2,{code:g}]:(m=p,e===Y.ULTRA_GROUP?(this._ultraMsgMap[m.messageUId]=m.timestamp,[2,{code:ye.SUCCESS}]):(this._sendMessageStore.setMessage(m.messageUId,m.timestamp),v=wo(e,t,I(I({},u),{isPersited:!0}),m.messageUId,m.timestamp,this.currentUserId),this._conversationManager.setConversationCacheByMessage(v,!0),[2,{code:ye.SUCCESS,data:v}]))}}))}))},t.prototype.sendReadReceiptMessage=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=this._channel.codec.encodeReadReceipt(t,n),i=new Li(Bi[Bi.rrMsg],r,e),[4,this._channel.send(i)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return[2,o.sent()]}}))}))},t.prototype.getMessageReader=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=this._channel.codec.encodeMessageReader(t,n),i=new Li(Bi[Bi.rrList],r,e),[4,this._channel.send(i,Wn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return[2,o.sent()]}}))}))},t.prototype.pullUserSettings=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){return this._channel?(t=this._channel.codec.encodePullUserSetting(e),n=new Li(Bi[Bi.pullUS],t,this.currentUserId),[2,this._channel.send(n,Dn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.getFileToken=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return this._channel?(i=r&&"uploads"!==r?t||"":ct(e,t),o=this._channel.codec.encodeGetFileToken(e,i,n||"",r||""),s=new Li(Bi[Bi.qnTkn],o,this.currentUserId),[4,this._channel.send(s,_n)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return a=d.sent(),c=a.code,u=a.data,u=Object.assign(u,{fileName:i}),c===ye.SUCCESS?[2,{code:c,data:u}]:[2,{code:c}]}}))}))},t.prototype.getFileUrl=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d,l,h;return S(this,(function(f){switch(f.label){case 0:return this._channel?(i="",o="",s="",t===be.QINIU?(o=yn,s=Tn):(o=En,s=In),i=t===be.QINIU?Bi[Bi.qnUrl]:t===be.AWS?Bi[Bi.s3Url]:t===be.STC?Bi[Bi.stcUrl]:Bi[Bi.aliUrl],a=this._channel.codec.encodeGetFileUrl(o,e,n,r),c=new Li(i,a,this.currentUserId),[4,this._channel.send(c,s)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return u=f.sent(),d=u.code,l=u.data,h=l,d===ye.SUCCESS?[2,{code:d,data:h}]:[2,{code:d}]}}))}))},t.prototype.disconnect=function(){-1!==this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=-1),this._channel&&(this._channel.close(),this._channel=void 0),this._pullQueue.length=0,this._stopSyncInterval(),this.resetUltraGroupData()},t.prototype.resetUltraGroupData=function(){this._stopUltraSyncInterval(),this._lastSyncUltraMsgTimeStamp=0,this._lastSyncUltraMsgLocalTimeStamp=0,this._isUltraPulling=!1,this._ultraGroupTimeQue=[],this._isUltraGroupListExist=!1,this._ultraGroupMap={}},t.prototype.destroy=function(){throw new Error("JSEngine's method not implemented.")},t.prototype.registerMessageType=function(e,t,n,r,i){this._customMessageType[e]={isPersited:t,isCounted:n,isStatusMessage:i}},t.prototype.getServerTime=function(){return Date.now()-this._localConnectedTime+this._connectedTime},t.prototype.getCurrentUserId=function(){return this.currentUserId},t.prototype.createTag=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeCreateTag([e],t),r=new Li(Bi[Bi.addSeTag],n,this.currentUserId),[4,this._channel.send(r,Ln)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return i=c.sent(),o=i.code,s=i.data,o!==ye.SUCCESS?[2,{code:o}]:(a=s.version,this._userSettingManager.addTag([I(I({},e),{createdTime:a})],a),[2,{code:ye.SUCCESS,data:s}])}}))}))},t.prototype.removeTag=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeRemoveTag([e],t),r=new Li(Bi[Bi.delSeTag],n,this.currentUserId),[4,this._channel.send(r,Ln)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return i=c.sent(),o=i.code,s=i.data,o!==ye.SUCCESS?[2,{code:o}]:(a=s.version,this._userSettingManager.deleteTag([e],a),[2,{code:ye.SUCCESS}])}}))}))},t.prototype.updateTag=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeCreateTag([e],t),r=new Li(Bi[Bi.addSeTag],n,this.currentUserId),[4,this._channel.send(r,Ln)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return i=c.sent(),o=i.code,s=i.data,o!==ye.SUCCESS?[2,{code:o}]:(a=s.version,this._userSettingManager.addTag([e],a),[2,{code:ye.SUCCESS,data:s}])}}))}))},t.prototype.getTagList=function(){return C(this,void 0,void 0,(function(){var e,t;return S(this,(function(n){return e=this._userSettingManager.getTags(),t=this._conversationManager.getConversationListForTag(),e.forEach((function(e){e.conversationCount=t[e.tagId]?t[e.tagId].length:0})),[2,{code:ye.SUCCESS,data:e}]}))}))},t.prototype.addTagForConversations=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s=this;return S(this,(function(a){switch(a.label){case 0:return this._channel?this._userSettingManager.getTagById(e)?(n=this._channel.codec.encodeUpdateConversationTag([{tagId:e}],t),r=new Li(Bi[Bi.addTag],n,this.currentUserId),[4,this._channel.send(r)]):[2,{code:ye.TAG_NOT_EXIST}]:[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return(i=a.sent().code)!==ye.SUCCESS?[2,{code:i}]:((o={})[e]={},t.forEach((function(e){s._conversationManager.addTagStatus(e.conversationType,e.targetId,o,e.channelId)})),[2,{code:ye.SUCCESS}])}}))}))},t.prototype.removeTagForConversations=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o=this;return S(this,(function(s){switch(s.label){case 0:return this._channel?(n=this._channel.codec.encodeUpdateConversationTag([{tagId:e}],t),r=new Li(Bi[Bi.delTag],n,this.currentUserId),[4,this._channel.send(r)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return(i=s.sent().code)!==ye.SUCCESS?[2,{code:i}]:(t.forEach((function(t){o._conversationManager.deleteTagStatus(t.conversationType,t.targetId,[e],t.channelId)})),[2,{code:ye.SUCCESS}])}}))}))},t.prototype.removeTagsForConversation=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return this._channel?(n=e.conversationType,r=e.targetId,i=e.channelId,o=t.map((function(e){return{tagId:e}})),s=this._channel.codec.encodeUpdateConversationTag(o,[e]),a=new Li(Bi[Bi.delTag],s,this.currentUserId),[4,this._channel.send(a)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return(c=u.sent().code)!==ye.SUCCESS?[2,{code:c}]:(this._conversationManager.deleteTagStatus(n,r,t,i),[2,{code:ye.SUCCESS}])}}))}))},t.prototype.getConversationListByTag=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l;return S(this,(function(h){switch(h.label){case 0:return i=(r=this).currentUserId,(o=r._channel)?(s=o.codec.encodeOldConversationList({count:n,type:Y.PRIVATE,startTime:t}),a=new Li(ei,s,i),[4,o.send(a,qt,{currentUserId:i,connectedTime:o.connectedTime})]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return c=h.sent(),u=c.code,d=c.data,l=this._conversationHasTagFilter(e,null==d?void 0:d.list),ge.info("GetConversationListByTag",l),u!==ye.SUCCESS?[2,{code:u}]:[2,{code:u,data:l}]}}))}))},t.prototype._conversationHasTagFilter=function(e,t){var n=this,r=[],i=[];function o(e,t){return e.latestMessage&&t.latestMessage?e.latestMessage.sentTime-t.latestMessage.sentTime:0}return t.forEach((function(t){var o=t.conversationType,s=t.targetId,a=t.channelId,c=n._conversationManager.get(o,s,a),u=c.hasMentioned,d=c.mentionedInfo,l=c.lastUnreadTime,h=c.notificationStatus,f=c.isTop,g=c.tags,p=c.unreadMessageCount,m=g&&g[e];if(m){var v=I(I({},t),{hasMentioned:u,mentionedInfo:d,lastUnreadTime:l,notificationStatus:h,isTop:f,unreadMessageCount:p});m.isTop?r.push(I(I({},v),{isTopInTag:!0})):i.push(I(I({},v),{isTopInTag:!1}))}})),R(R([],r.sort(o),!0),i.sort(o),!0)},t.prototype.getUnreadCountByTag=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){return this._channel?(n=this._conversationManager.getUnreadCountByTag(e,t),[2,{code:ye.SUCCESS,data:n}]):[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.setConversationStatusInTag=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l,h;return S(this,(function(f){switch(f.label){case 0:return this._channel?(r=t.targetId,i=t.conversationType,o=t.channelId,s=n.isTop,a=[{tagId:e,isTop:s}],(c=this._conversationManager.get(i,r,o)).tags&&Object.hasOwnProperty.call(c.tags,e)?(u=this._channel.codec.encodeUpdateConversationTag(a,[t]),d=new Li(Bi[Bi.addTag],u,this.currentUserId),[4,this._channel.send(d)]):[2,{code:ye.NO_TAG_IN_CONVER}]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return(l=f.sent().code)!==ye.SUCCESS?[2,{code:l}]:((h={})[e]={},s&&(h[e].isTop=!0),this._conversationManager.addTagStatus(i,r,h,o),[2,{code:ye.SUCCESS}])}}))}))},t.prototype.getTagsForConversation=function(e){var t;return C(this,void 0,void 0,(function(){var n,r,i,o;return S(this,(function(s){if(!this._channel)return[2,{code:ye.RC_NET_CHANNEL_INVALID}];if(n=this._conversationManager.get(e.conversationType,e.targetId,e.channelId),r=this._userSettingManager.getTagsInfo(),i=[],n.tags)for(o in n.tags)i.push({tagId:o,tagName:null===(t=r[o])||void 0===t?void 0:t.tagName});return[2,{code:ye.SUCCESS,data:i}]}))}))},t.prototype.getBlockConversationList=function(){var e=this._conversationManager.getBlockConversationList();return Promise.resolve({code:ye.SUCCESS,data:e})},t.prototype.getTopConversationList=function(){var e=this._conversationManager.getTopConversationList();return Promise.resolve({code:ye.SUCCESS,data:e})},t.prototype.getUnreadMentionedCount=function(e){var t,n;return n=e.conversationType===Y.ULTRA_GROUP?(null===(t=this._ultraGroupMap[e.channelId+"_"+e.targetId])||void 0===t?void 0:t.unreadMentionedCount)||0:this._conversationManager.getUnreadMentionedCount(e.channelId,e.conversationType,e.targetId),Promise.resolve({code:ye.SUCCESS,data:n})},t.prototype.getAllUnreadMentionedCount=function(){var e=this._conversationManager.getAllUnreadMentionedCount();return Promise.resolve({code:ye.SUCCESS,data:e})},t.prototype.getUltraGroupList=function(){return C(this,void 0,void 0,(function(){var e,t;return S(this,(function(n){return this._isUltraGroupListExist?(e=Object.values(this._ultraGroupMap),e=Ao(e),t=Tt(e),[2,{code:ye.SUCCESS,data:t}]):[2,{code:ye.METHOD_NOT_AVAILABLE}]}))}))},t.prototype.getBlockUltraGroupList=function(){if(!this._isUltraGroupListExist)return Promise.resolve({code:ye.METHOD_NOT_AVAILABLE});var e=Object.values(this._ultraGroupMap),t=[];return e.forEach((function(e){e.notificationStatus===Ne.OPEN&&t.push({conversationType:Y.ULTRA_GROUP,targetId:e.targetId,channelId:e.channelId})})),Promise.resolve({code:ye.SUCCESS,data:t})},t.prototype.getTopUltraGroupList=function(){if(!this._isUltraGroupListExist)return Promise.resolve({code:ye.METHOD_NOT_AVAILABLE});var e=Object.values(this._ultraGroupMap),t=[];return e.forEach((function(e){!0===e.isTop&&t.push({conversationType:Y.ULTRA_GROUP,targetId:e.targetId,channelId:e.channelId})})),Promise.resolve({code:ye.SUCCESS,data:t})},t.prototype.getUltraGroupUnreadMentionedCountByTargetId=function(e){if(!this._isUltraGroupListExist)return Promise.resolve({code:ye.METHOD_NOT_AVAILABLE});var t=0;for(var n in this._ultraGroupMap){n.match(/_.*/g)[0].substring(1)===e&&(t+=this._ultraGroupMap[n].unreadMentionedCount)}return Promise.resolve({code:ye.SUCCESS,data:t})},t.prototype.getUltraGroupUnreadCountByTargetId=function(e){var t=0;for(var n in this._ultraGroupMap){var r=this._ultraGroupMap[n];r.targetId===e&&(t+=r.unreadMessageCount||0)}return Promise.resolve({code:ye.SUCCESS,data:t})},t.prototype.getAllUltraGroupUnreadCount=function(e){if(void 0===e&&(e=!1),!this._isUltraGroupListExist)return Promise.resolve({code:ye.METHOD_NOT_AVAILABLE});var t=0;for(var n in this._ultraGroupMap)t+=e?this._ultraGroupMap[n].unreadMentionedCount||0:this._ultraGroupMap[n].unreadMessageCount||0;return Promise.resolve({code:ye.SUCCESS,data:t})},t.prototype.clearUltraUnreadcount=function(e,t){return void 0===t&&(t=""),C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._isUltraGroupListExist?this._channel?this._status!==Te.CONNECTED?[2,ye.RC_NET_UNAVAILABLE]:(n=Date.now(),r=this._channel.codec.encodeClearUnreadCount({conversationType:Y.ULTRA_GROUP,targetId:e,channelId:t},{timestamp:n}),(i=new wi(Bi[Bi.updUgRTime],r,this.currentUserId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(i)]):[2,ye.RC_NET_CHANNEL_INVALID]:[2,Promise.resolve(ye.METHOD_NOT_AVAILABLE)];case 1:return(o=a.sent().code)===ye.SUCCESS&&(s=this._ultraGroupMap[t+"_"+e])&&(s.unreadMessageCount=0,s.unreadMentionedCount=0,s.lastReadTime=n),[2,o]}}))}))},t.prototype._getUltraGroupList=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h,f,g=this;return S(this,(function(p){switch(p.label){case 0:return this._channel&&this._status===Te.CONNECTED?(!1,t=this._channel.codec.encodeUltraGroup(e,false),n=new Li(Bi[Bi.pullUgSes],t,this.currentUserId),[4,this._channel.send(n,qt,{currentUserId:this.currentUserId,conversationType:Y.ULTRA_GROUP})]):[2];case 1:return r=p.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?(a=(null==o?void 0:o.list)||[],c=null==o?void 0:o.isFinished,a.forEach((function(e){e.notificationStatus=Ne.CLOSE,e.notificationLevel=Me.NOT_SET,e.isTop=!1,g._ultraGroupMap[e.channelId+"_"+e.targetId]=e,g._ultraGroupManager.addUltraGroupStatus(e)})),!1!==c?[3,2]:(u=a.length>0&&a[a.length-1].versionTime||0,this._getUltraGroupList(u),[3,4])):(ge.warn("pull super conversation  failed, code:",i,", data:",o,"retrying..."),s=setTimeout((function(){g._firstPullUltraGroupTime=e,g._getUltraGroupList(e),clearTimeout(s)}),3e3),[2]);case 2:return[4,this.pullConversationStatus(this._firstPullUltraGroupTime)];case 3:d=p.sent(),l=d.code,h=d.data,l!==ye.SUCCESS&&ge.warn("pullConversationStatus fail code: ".concat(l,", data: ").concat(h)),f=Object.values(this._ultraGroupMap),f=Ao(f),this._isUltraGroupListExist=!0,this._watcher.ultraGroupEnable(Tt(f)),0===this._firstPullUltraGroupTime&&this._syncUltraMsg(this._lastSyncUltraMsgTimeStamp),p.label=4;case 4:return[2]}}))}))},t.prototype._startUltraSyncInterval=function(){var e=this;this._lastSyncUltraMsgLocalTimeStamp=Date.now(),this._syncUltraMsg(0),function t(){e._ultraGroupTimer=setTimeout((function(){Date.now()-e._lastSyncUltraMsgLocalTimeStamp>=18e4&&e._syncUltraMsg(e._lastSyncUltraMsgTimeStamp),e._stopUltraSyncInterval(),t()}),3e4)}()},t.prototype._stopUltraSyncInterval=function(){-1!==this._ultraGroupTimer&&(clearTimeout(this._ultraGroupTimer),this._ultraGroupTimer=-1)},t.prototype._syncUltraMsg=function(e){var t;return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l,h,f,g=this;return S(this,(function(p){switch(p.label){case 0:return this._channel&&this._status===Te.CONNECTED?this._isUltraPulling?[2]:(ge.info("start pull ultra msg, time: ".concat(e)),this._isUltraPulling=!0,n=this._channel.codec.encodeSuperSyncMsg(e),r=new Li(Bi[Bi.pullUgMsg],n,this.currentUserId),[4,this._channel.send(r,Lt,{currentUserId:this.currentUserId,conversation:{conversationType:Y.ULTRA_GROUP}})]):[2];case 1:if(i=p.sent(),o=i.code,s=i.data,ge.info("end pull ultra msg, code: ".concat(o,", syncTime: ").concat(null==s?void 0:s.syncTime,", count: ").concat(null===(t=null==s?void 0:s.list)||void 0===t?void 0:t.length)),this._lastSyncUltraMsgLocalTimeStamp=Date.now(),o!==ye.SUCCESS||!s)return ge.warn("sync super  message  failed, code:",o,", data:",s),this._isUltraPulling=!1,[2];if(this._isUltraPulling=!1,a=s.list,c=s.syncTime,u=s.finished,!this._isUltraGroupListExist)return ge.info("init getUltraGroupList"),this._firstPullUltraGroupTime=0,this._getUltraGroupList(0),this._lastSyncUltraMsgTimeStamp=c,[2];for(f in d={},l=[],a.forEach((function(e){var t,n,r,i=e.targetId,o=e.content,s=e.messageType,a=e.messageUId,u=e.channelId,h=e.isCounted;if(g._ultraMsgMap[a])delete g._ultraMsgMap[a];else{var f=0;((null===(t=null==o?void 0:o.mentionedInfo)||void 0===t?void 0:t.type)===we.ALL||(null===(r=null===(n=null==o?void 0:o.mentionedInfo)||void 0===n?void 0:n.userIdList)||void 0===r?void 0:r.includes(g.currentUserId)))&&(f=1);var p=g._ultraGroupMap[u+"_"+i];if(p)h&&(s===Se.RECALL?p.unreadMessageCount>0&&(p.unreadMessageCount-=1):(p.unreadMessageCount+=1,p.unreadMentionedCount+=f)),p.versionTime=c,p.latestMessage=e,d[u+"_"+i]=p,g._ultraGroupManager.addUltraGroupStatus(p);else{var m={conversationType:Y.ULTRA_GROUP,targetId:i,channelId:u,unreadMessageCount:1,unreadMentionedCount:f,versionTime:c,latestMessage:e,notificationStatus:Ne.CLOSE,notificationLevel:Me.NOT_SET,isTop:!1};g._ultraGroupMap[u+"_"+i]=m,d[u+"_"+i]=m,g._ultraGroupManager.addUltraGroupStatus(m)}l.push(e)}})),Object.keys(d).length>0&&(ge.info("notice ultragroups"),h=Object.values(d),h=Ao(h),this._watcher.conversation(Tt(h))),ge.info("notice ultragroup message"),this._watcher.batchMessage(l),this._ultraGroupTimeQue=this._ultraGroupTimeQue.filter((function(e){return e>c})),this._ultraMsgMap)this._ultraMsgMap[f]<c&&delete this._ultraMsgMap[f];return!1===u?this._syncUltraMsg(c):a&&a.length>0&&(this._lastSyncUltraMsgTimeStamp=c),this._ultraGroupTimeQue.length>0&&this._syncUltraMsg(this._lastSyncUltraMsgTimeStamp),[2]}}))}))},t.prototype.sendUltraMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l;return S(this,(function(h){switch(h.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:("RC:SRSMsg"===t.messageType&&ge.warn("ultra group -> direction message convert to message"),t=this._handleMsgProperties(t,!0),n=this._channel.codec.encodeUpMsg({conversationType:Y.ULTRA_GROUP,targetId:e},t),(r=new wi(Bi[Bi.ugMsg],n,e)).setHeaderQos(Xe.AT_LEAST_ONCE),i=Date.now()-this._localConnectedTime+this._connectedTime,o=wo(Y.ULTRA_GROUP,e,I({},t),"",i,this.currentUserId),[4,this._channel.send(r)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return s=h.sent(),a=s.code,c=s.data,a!==ye.SUCCESS?[2,{code:a,data:o}]:(u=c,o.sentTime=u.timestamp,o.messageUId=u.messageUId,this._ultraMsgMap[u.messageUId]=u.timestamp,d=t.channelId||"",(l=this._ultraGroupMap[d+"_"+e])?l.latestMessage=o:(l={conversationType:Y.ULTRA_GROUP,targetId:e,channelId:d,unreadMessageCount:0,unreadMentionedCount:0,versionTime:o.sentTime,latestMessage:o,notificationStatus:Ne.CLOSE,notificationLevel:Me.NOT_SET,isTop:!1},this._ultraGroupMap[d+"_"+e]=l,this._ultraGroupManager.addUltraGroupStatus(l)),this._watcher.conversation(Tt([l])),[2,{code:a,data:o}])}}))}))},t.prototype.sendUltraGroupTypingStatus=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:(n=e.conversationType,r=e.channelId,i=e.targetId,o=this._channel.codec.encodeOperateStatus(i,n,r||"",t||0),(s=new wi(Bi[Bi.operate],o,i)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(s)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return(a=c.sent().code)!==ye.SUCCESS?[2,{code:a,msg:ye[a]}]:[2,{code:a}]}}))}))},t.prototype.getUltraGroupMessageListByMessageUId=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:e.messages&&e.messages.length<1||e.messages&&e.messages.length>20?[2,{code:ye.MSG_LIMIT_ERROR}]:(t={},e.messages.forEach((function(e){t[e.messageUId]=void 0})),n=this._channel.codec.encodeMsgQuery(e),(r=new Li(Bi[Bi.qryMsg],n,this.currentUserId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(r,dr)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return i=c.sent(),o=i.code,s=i.data,o!==ye.SUCCESS?[2,{code:o,msg:ye[o]}]:(a=(s||{}).list,Array.isArray(a)&&a.forEach((function(e){var n=e.messageUId;t[n]=e})),[2,{code:0,data:t}])}}))}))},t.prototype._pullOperateStatusNotify=function(e){if(this._channel){var t=this._channel.codec.decodeByPBName(e.data,hr),n=t.conversationType,r=t.info,i=t.summary;ge.info("s_opNtf -> type: ".concat(n,", info: ").concat(r,", summary: ").concat(i)),this._watcher.operateStatus(t)}},t.prototype.expandUltraMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:(t=this._channel.codec.encodeExpandUltraMessage(e,this.currentUserId),(n=new wi(Bi[Bi.upMsgEx],t,e.targetId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(n)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return r=a.sent(),i=r.code,o=r.data,i!==ye.SUCCESS?[2,{code:i,msg:ye[i]}]:(s=o,this._ultraMsgMap[s.messageUId]=s.timestamp,[2,{code:i}])}}))}))},t.prototype.modifyMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:(t=this._channel.codec.encodemodifyMessage(e,this.currentUserId),(n=new wi(Bi[Bi.modifyMsg],t,e.targetId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(n)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return r=a.sent(),i=r.code,o=r.data,i!==ye.SUCCESS?[2,{code:i,msg:ye[i]}]:(s=o,this._ultraMsgMap[s.messageUId]=s.timestamp,[2,{code:i}])}}))}))},t.prototype._pullUltraChangeMessageList=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l,h,f,g,p,m,v,_=this;return S(this,(function(y){switch(y.label){case 0:return this._channel?this._status!==Te.CONNECTED||this._isPullingUltraChangeMessage?[2]:(this._isPullingUltraChangeMessage=!0,t=this._channel.codec.encodeQueryMsgChange(e),(n=new wi(Bi[Bi.qryMsgChange],t,this.currentUserId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(n,ar)]):[2];case 1:if(r=y.sent(),i=r.code,o=r.data,this._isPullingUltraChangeMessage=!1,i!==ye.SUCCESS)return[2];for(g in a=(s=o||{}).hasNext,c=s.list,u=(null==o?void 0:o.syncTime)||0,d=[],l={},Array.isArray(c)&&c.forEach((function(e){var t=e,n=t.targetId,r=t.conversationType,i=t.sendTime,o=t.messageUId,s=t.changeType,a=t.operatorId,c=e.channelId||"",u=r+"_"+n,h=o+"_"+c+"_"+i,f=l[u];if(f)f.add(h);else{var g=new Set([h]);l[u]=g}3!==s?_._ultraMsgChangeMap[o]=s:d.push({targetId:n,conversationType:r,sendTime:i,messageUId:o,senderUserId:a,channelId:c})})),Array.isArray(d)&&d.length>0&&this._watcher.ultraGroupMessageRecalled(d),h=function(e){var t=e.split("_"),n=t.shift(),r=t.join("_"),i=l[e],o=[];i.forEach((function(e){var t=e.split("_"),n=t[0],r=t[1],i=t[2];o.push({sendTime:Number(i),messageUId:n,channelId:r})}));var s={targetId:r,conversationType:Number(n),messages:o};f._pullUltraMessageList(s)},f=this,l)h(g);for(m in p=this._pullUltraChangeMessageQue.filter((function(e){return e>u})),this._pullUltraChangeMessageQue.length=0,(v=this._pullUltraChangeMessageQue).push.apply(v,p),this._ultraMsgMap)this._ultraMsgMap[m]<u&&delete this._ultraMsgMap[m];return a?this._pullUltraChangeMessageList(u):this._lastPullingUltraChangeMessageTime=u,[2]}}))}))},t.prototype._pullUltraMessageList=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u=this;return S(this,(function(d){switch(d.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:(t=this._channel.codec.encodeMsgQuery(e),(n=new Li(Bi[Bi.qryMsg],t,this.currentUserId)).setHeaderQos(Xe.AT_LEAST_ONCE),[4,this._channel.send(n,dr)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return r=d.sent(),i=r.code,o=r.data,i!==ye.SUCCESS?[2,{code:i,msg:ye[i]}]:(s=(o||{}).list,a=[],c=[],Array.isArray(s)&&s.forEach((function(e){var t=e.targetId,n=e.channelId,r=e.messageUId,i=u._ultraGroupMap[n+"_"+t];i&&i.latestMessage.messageUId===e.messageUId&&(i.latestMessage=e);var o=u._ultraMsgChangeMap[r+""];1===o?a.push(e):2===o&&c.push(e)})),a.length>0&&this._watcher.ultraGroupMessageExpansionUpdated(a||[]),c.length>0&&this._watcher.ultraGroupMessageModified(c||[]),[2])}}))}))},t.prototype.getUltraHistoryMsg=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:(n=this._channel.codec.encodeGetHistoryMsg(e,t),r=new Li(Bi[Bi.qryUgMsg],n,this.currentUserId),[4,this._channel.send(r,Gt,{currentUserId:this.currentUserId,conversation:{conversationType:Y.ULTRA_GROUP,targetId:e}})]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS&&s?[2,{code:o,data:s}]:(ge.warn("get super history message  failed, code:",o,", data:",s),[2,{code:o}])}}))}))},t.prototype.searchUltraGroupMessages=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(e){return this._channel?this._status!==Te.CONNECTED?[2,{code:ye.RC_NET_UNAVAILABLE}]:[2,{code:ye.SUCCESS}]:[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.getAllConversationState=function(){return Promise.resolve({code:ye.SUCCESS,data:this._conversationManager.getAllConversationState()})},t.prototype.joinRTCRoom=function(e,t,n,r,i,o){return C(this,void 0,void 0,(function(){var s,a;return S(this,(function(c){return this._channel?(s=this._channel.codec.encodeJoinRTCRoom(t,n,r,i,o),a=new Li(Bi[Bi.rtcRJoin_data],s,e),[2,this._channel.send(a,tn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.quitRTCRoom=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeQuitRTCRoom(),n=new Li(Bi[Bi.rtcRExit],t,e),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,r.sent().code]}}))}))},t.prototype.rtcPing=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=this._channel.codec.encodeJoinRTCRoom(t,n),i=new Li(Bi[Bi.rtcPing],r,e),[4,this._channel.send(i)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,o.sent().code]}}))}))},t.prototype.getRTCRoomInfo=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){return this._channel?(t=this._channel.codec.encodeGetRTCRoomInfo(),n=new Li(Bi[Bi.rtcRInfo],t,e),[2,this._channel.send(n,gn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.getRTCUserInfoList=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return this._channel?(t=this._channel.codec.encodeGetRTCRoomInfo(),n=new Li(Bi[Bi.rtcUData],t,e),[4,this._channel.send(n,tn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return r=s.sent(),i=r.code,o=r.data,[2,{code:i,data:o?{users:o.users}:o}]}}))}))},t.prototype.setRTCUserInfo=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=this._channel.codec.encodeSetRTCUserInfo(t,n),i=new Li(Bi[Bi.rtcUPut],r,e),[4,this._channel.send(i)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,o.sent().code]}}))}))},t.prototype.removeRTCUserInfo=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(n=this._channel.codec.encodeRemoveRTCUserInfo(t),r=new wi(Bi[Bi.rtcUDel],n,e),[4,this._channel.send(r)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,i.sent().code]}}))}))},t.prototype.setRTCData=function(e,t,n,r,i,o){return C(this,void 0,void 0,(function(){var s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?(s=this._channel.codec.encodeSetRTCData(t,n,r,i,o),a=new wi(Bi[Bi.rtcSetData],s,e),[4,this._channel.send(a)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,c.sent().code]}}))}))},t.prototype.setRTCTotalRes=function(e,t,n,r,i){return C(this,void 0,void 0,(function(){var o,s;return S(this,(function(a){switch(a.label){case 0:return this._channel?(o=this._channel.codec.encodeUserSetRTCData(t,n,r,i),s=new Li(Bi[Bi.userSetData],o,e),[4,this._channel.send(s)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,a.sent().code]}}))}))},t.prototype.setRTCCDNUris=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(r=this._channel.codec.encodeUserSetRTCCDNUris(t,n),i=new Li(Bi[Bi.userSetData],r,e),[4,this._channel.send(i)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,o.sent().code]}}))}))},t.prototype.getRTCData=function(e,t,n,r){if(!this._channel)return Promise.resolve({code:ye.RC_NET_CHANNEL_INVALID});var i=this._channel.codec.encodeGetRTCData(t,n,r),o=new Li(Bi[Bi.rtcQryData],i,e);return this._channel.send(o,dn)},t.prototype.removeRTCData=function(e,t,n,r,i){return C(this,void 0,void 0,(function(){var o,s;return S(this,(function(a){switch(a.label){case 0:return this._channel?(o=this._channel.codec.encodeRemoveRTCData(t,n,r,i),s=new wi(Bi[Bi.rtcDelData],o,e),[4,this._channel.send(s)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,a.sent().code]}}))}))},t.prototype.setRTCOutData=function(e,t,n,r){throw new Error("JSEngine's method not implemented.")},t.prototype.getRTCOutData=function(e,t){throw new Error("JSEngine's method not implemented.")},t.prototype.getRTCToken=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){return this._channel?(r=this._channel.codec.encodeJoinRTCRoom(t,n),i=new Li(Bi[Bi.rtcToken],r,e),[2,this._channel.send(i,un)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.setRTCState=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(n=this._channel.codec.encodeSetRTCState(t),r=new Li(Bi[Bi.rtcUserState],n,e),[4,this._channel.send(r)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return[2,i.sent().code]}}))}))},t.prototype.getRTCUserInfo=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(e){throw new Error("Method not implemented.")}))}))},t.prototype.getRTCUserList=function(e){if(!this._channel)return Promise.resolve({code:ye.RC_NET_CHANNEL_INVALID});var t=this._channel.codec.encodeGetRTCRoomInfo(),n=new Li(Bi[Bi.rtcUList],t,e);return this._channel.send(n,tn)},t.prototype.joinLivingRoomAsAudience=function(e,t,n){return void 0===t&&(t=Be.LIVE),C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return this._channel?(r=this._channel.codec.encodeJoinRTCRoom(t,n),i=new Li(Bi[Bi.viewerJoinR],r,e),[4,this._channel.send(i,Er)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return o=l.sent(),s=o.code,a=o.data,s!==ye.SUCCESS?[2,{code:s}]:(u=(c=a).rtcToken,d=c.entries,[2,{code:s,data:{token:u,kvEntries:d}}])}}))}))},t.prototype.quitLivingRoomAsAudience=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeQuitRTCRoom(),n=new Li(Bi[Bi.viewerExitR],t,e),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return r=i.sent().code,this._rtcKVManager.reset(),[2,r]}}))}))},t.prototype.rtcIdentityChange=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._channel?(r=this._channel.codec.encodeIdentityChangeInfo(t,n),i=new Li(Bi[Bi.rtcIdentityChange],r,e),[4,this._channel.send(i,tn)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return o=c.sent(),s=o.code,a=o.data,s!==ye.SUCCESS?[2,{code:s}]:[2,{code:s,data:a}]}}))}))},t.prototype.pullRTCRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return n=(t=this)._channel,r=t.currentUserId,n?(ge.info("audience in room start pull KV"),i=n.codec.encodePullRTCRoomKV(e,0),o=new Li(Bi[Bi.rtcPullKv],i,r),[4,n.send(o,vr)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return s=d.sent(),a=s.code,c=s.data,ge.info("audience in room end pull KV, code: ".concat(a,", data: ").concat(JSON.stringify(c||{}))),a===ye.SUCCESS?(u=c.kvEntries,this._watcher.onRTCDataChange(u,e),[2,{code:a,data:c}]):[2,{code:a}]}}))}))},t.prototype.getRTCJoinedUserInfo=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return n=(t=this)._channel,r=t.currentUserId,n?(i=n.codec.encodeQueryUserJoinedInfo(e),o=new Li(Bi[Bi.rtcQueryJoined],i,r),[4,n.send(o,yr)]):[2,{code:ye.RC_NET_CHANNEL_INVALID}];case 1:return s=u.sent(),a=s.code,c=s.data,a===ye.SUCCESS?[2,{code:a,data:c}]:[2,{code:a}]}}))}))},t.prototype.getDeviceId=function(){return P(this.runtime)},t.prototype.requestRoomPK=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeRequestRoomPK(e),n=new Li(Bi[Bi.rtcInvite],t,e.roomId),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return r=i.sent().code,this._rtcKVManager.reset(),[2,r]}}))}))},t.prototype.cancelRoomPK=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeCancelRoomPK(e),n=new Li(Bi[Bi.rtcCancelInvite],t,e.roomId),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return r=i.sent().code,this._rtcKVManager.reset(),[2,r]}}))}))},t.prototype.responseRoomPK=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeResponseRoomPK(e),n=new Li(Bi[Bi.rtcInviteAnswer],t,e.roomId),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return r=i.sent().code,this._rtcKVManager.reset(),[2,r]}}))}))},t.prototype.endRoomPK=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeEndRoomPK(e),n=new Li(Bi[Bi.rtcEndInvite],t,e.roomId),[4,this._channel.send(n)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return r=i.sent().code,this._rtcKVManager.reset(),[2,r]}}))}))},t.prototype.bindRTCRoomForChatroom=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return this._channel?(t=e.chatRoomId,n=this._channel.codec.encodebindRTCRoomForChatroom(e),r=new Li(Bi[Bi.setRtcRoomId],n,t),[4,this._channel.send(r)]):[2,ye.RC_NET_CHANNEL_INVALID];case 1:return i=o.sent(),[2,i.code]}}))}))},t.prototype.callExtra=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return Promise.resolve({code:ye.EXTRA_METHOD_UNDEFINED})},t.prototype.getConversationListWithAllChannel=function(){throw new Error("Method not implemented.")},t.prototype.getConversationListWithAllChannelByPage=function(e,t){throw new Error("Method not implemented.")},t.prototype.clearConversations=function(){throw new Error("Method not implemented.")},t.prototype.setUserStatusListener=function(e,t){throw new Error("Method not implemented.")},t.prototype.setUserStatus=function(e){throw new Error("Method not implemented.")},t.prototype.subscribeUserStatus=function(e){throw new Error("Method not implemented.")},t.prototype.getUserStatus=function(e){throw new Error("Method not implemented.")},t.prototype.addToBlacklist=function(e){throw new Error("Method not implemented.")},t.prototype.removeFromBlacklist=function(e){throw new Error("Method not implemented.")},t.prototype.getBlacklist=function(){throw new Error("Method not implemented.")},t.prototype.getBlacklistStatus=function(e){throw new Error("Method not implemented.")},t.prototype.insertMessage=function(e,t,n){throw new Error("Method not implemented.")},t.prototype.deleteMessages=function(e){throw new Error("Method not implemented.")},t.prototype.deleteMessagesByTimestamp=function(e,t,n,r,i){throw new Error("Method not implemented.")},t.prototype.clearMessages=function(e,t,n){throw new Error("Method not implemented.")},t.prototype.getMessage=function(e){throw new Error("Method not implemented.")},t.prototype.setMessageContent=function(e,t,n){throw new Error("Method not implemented.")},t.prototype.setMessageSearchField=function(e,t,n){throw new Error("Method not implemented.")},t.prototype.searchConversationByContent=function(e,t,n,r){throw new Error("Method not implemented.")},t.prototype.searchMessageByContent=function(e,t,n,r,i,o){throw new Error("Method not implemented.")},t.prototype.getUnreadMentionedMessages=function(e,t){throw new Error("Method not implemented.")},t.prototype.setMessageSentStatus=function(e,t){throw new Error("Method not implemented.")},t.prototype.setMessageReceivedStatus=function(e,t){throw new Error("Method not implemented.")},t.prototype.clearUnreadCountByTimestamp=function(e,t,n,r){throw new Error("Method not implemented.")},t.prototype.setUltraGroupDefaultNotificationLevel=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return this._isUltraGroupListExist?(r=this._channel)?(i=r.codec.encodeSetUltraGroupDefaultNotificationLevel(t,n),o=new Li(Bi[Bi.ugUnpushSet],i,e),[4,r.send(o)]):[3,2]:[2,Promise.resolve({code:ye.METHOD_NOT_AVAILABLE})];case 1:return s=c.sent(),a=s.code,ye.SUCCESS,[2,{code:a}];case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.getUltraGroupDefaultNotificationLevel=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return this._isUltraGroupListExist?(n=this._channel)?(r=n.codec.encodeGetUltraGroupDefaultNotificationLevel(t),i=new Li(Bi[Bi.ugUnpushQuery],r,e),[4,n.send(i,Kn)]):[3,2]:[2,Promise.resolve({code:ye.METHOD_NOT_AVAILABLE})];case 1:return o=u.sent(),s=o.code,a=o.data,s===ye.SUCCESS&&a?(c=a.unpushLevel,[2,{code:s,data:c}]):[2,{code:s}];case 2:return[2,{code:ye.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.getConversationNotificationLevel=function(e,t,n){if(!this._isUltraGroupListExist&&e===Y.ULTRA_GROUP)return Promise.resolve({code:ye.METHOD_NOT_AVAILABLE});var r;if(!(r=e===Y.ULTRA_GROUP?this._ultraGroupManager.get(Y.ULTRA_GROUP,t,n):this._conversationManager.get(e,t,n)))return Promise.resolve({code:ye.SUCCESS,data:Me.NOT_SET});var i=r.notificationLevel;return re(r.notificationLevel)&&!re(r.notificationStatus)&&(i=Ne.OPEN===r.notificationStatus?1:0),Promise.resolve({code:ye.SUCCESS,data:i})},t.prototype.getConversationNotificationStatus=function(e,t,n){var r;return(r=e===Y.ULTRA_GROUP?this._ultraGroupManager.get(Y.ULTRA_GROUP,t,n):this._conversationManager.get(e,t,n))?Promise.resolve({code:ye.SUCCESS,data:r.notificationStatus}):Promise.resolve({code:ye.SUCCESS,data:Ne.CLOSE})},t.prototype.getRemoteHistoryMessages=function(e,t,n,r,i,o){return this.getHistoryMessage(e,t,n,r,i,o)},t}(Yi),Lo=function(){function e(e){this._context=e}return e.prototype.__getContext=function(){return this._context},e.prototype.getNaviInfo=function(){return this._context.getInfoFromCache()},e.prototype.getCoreVersion=function(){return this._context.coreVersion},e.prototype.getAPIVersion=function(){return this._context.apiVersion},e.prototype.getAppkey=function(){return this._context.appkey},e.prototype.getCurrentId=function(){return this._context.getCurrentUserId()},e.prototype.getConnectionStatus=function(){return this._context.getConnectionStatus()},e.prototype.getDeviceId=function(){return this._context.getDeviceId()},e.prototype.sendMessage=function(e,t,n){return this._context.sendMessage(e,t,n)},e.prototype.registerMessageType=function(e,t,n,r){void 0===r&&(r=[]),this._context.registerMessageType(e,t,n,r)},e.prototype.getServerTime=function(){return this._context.getServerTime()},e.prototype.getRTCJoinedUserInfo=function(e){return this._context.getRTCJoinedUserInfo(e)},e}(),Po=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.getNaviInfo=function(){return this._context.getInfoFromCache()},t.prototype.joinRTCRoom=function(e,t,n,r,i,o){return this._context.joinRTCRoom(e,t,n,r,i,o)},t.prototype.quitRTCRoom=function(e){return this._context.quitRTCRoom(e)},t.prototype.rtcPing=function(e,t,n){return this._context.rtcPing(e,t,n)},t.prototype.getRTCRoomInfo=function(e){return this._context.getRTCRoomInfo(e)},t.prototype.getRTCUserInfoList=function(e){return this._context.getRTCUserInfoList(e)},t.prototype.getRTCUserInfo=function(e){return this._context.getRTCUserInfo(e)},t.prototype.setRTCUserInfo=function(e,t,n){return this._context.setRTCUserInfo(e,t,n)},t.prototype.removeRTCUserInfo=function(e,t){return this._context.removeRTCUserInfo(e,t)},t.prototype.setRTCData=function(e,t,n,r,i,o){return this._context.setRTCData(e,t,n,r,i,o)},t.prototype.setRTCTotalRes=function(e,t,n,r,i){return this._context.setRTCTotalRes(e,t,n,r,i)},t.prototype.setRTCCDNUris=function(e,t,n){return this._context.setRTCCDNUris(e,t,n)},t.prototype.getRTCData=function(e,t,n,r){return this._context.getRTCData(e,t,n,r)},t.prototype.removeRTCData=function(e,t,n,r,i){return this._context.removeRTCData(e,t,n,r,i)},t.prototype.setRTCOutData=function(e,t,n,r){return this._context.setRTCOutData(e,t,n,r)},t.prototype.getRTCOutData=function(e,t){return this._context.getRTCOutData(e,t)},t.prototype.getRTCToken=function(e,t,n){return this._context.getRTCToken(e,t,n)},t.prototype.setRTCState=function(e,t){return this._context.setRTCState(e,t)},t.prototype.getRTCUserList=function(e){return this._context.getRTCUserList(e)},t.prototype.joinLivingRoomAsAudience=function(e,t,n){return this._context.joinLivingRoomAsAudience(e,t,n)},t.prototype.quitLivingRoomAsAudience=function(e){return this._context.quitLivingRoomAsAudience(e)},t.prototype.rtcIdentityChange=function(e,t,n){return this._context.rtcIdentityChange(e,t,n)},t.prototype.requestRoomPK=function(e){return this._context.requestRoomPK(e)},t.prototype.cancelRoomPK=function(e){return this._context.cancelRoomPK(e)},t.prototype.responseRoomPK=function(e){return this._context.responseRoomPK(e)},t.prototype.endRoomPK=function(e){return this._context.endRoomPK(e)},t}(Lo);function Do(e){return Object.assign({},e)}var xo,Vo=function(){function e(e,t){var n;this._runtime=e,this._token="",this._pluginContextQueue=[],this._pluginInstanseMap={},this.coreVersion="5.3.0",this._versionInfo={},this._typingInfo={},this._isInternalConnected=!1,this._connectionStatus=Te.DISCONNECTED,this._canRedirectConnect=!1,this._watcher={message:void 0,batchMessage:void 0,conversationState:void 0,chatroomState:void 0,connectionState:void 0,rtcInnerWatcher:void 0,expansion:void 0,tag:void 0,conversationTagChanged:void 0,pullFinished:void 0,onConnecting:void 0,onConnected:void 0,onDisconnect:void 0,onSuspend:void 0,readReceiptReceived:void 0,messageReceiptRequest:void 0,messageReceiptResponse:void 0,typingState:void 0,messageBlocked:void 0,ultraGroupEnable:void 0,operateStatus:void 0,ultraGroupMessageExpansionUpdated:void 0,ultraGroupMessageModified:void 0,ultraGroupMessageRecalled:void 0},this._typingInternalTimer=-1,this._typingExpireTime=2e3,this._typingChangedList=[],this.getChatRoomHistoryMessages=this.getChatroomHistoryMessages,this._options=Object.assign({},t),this.appkey=this._options.appkey,this.apiVersion=this._options.apiVersion,this.apiPKGName=this._options.apiPKGName||"",this._options.typingExpireTime&&(this._options.typingExpireTime<2e3?this._typingExpireTime=2e3:this._options.typingExpireTime>6e3?this._typingExpireTime=6e3:this._typingExpireTime=this._options.typingExpireTime),this._options.navigators=this._options.navigators.filter((function(e){return/^https?:\/\//.test(e)})),this._options.navigators=this._options.navigators.map((function(e){return e.replace(/\/$/g,"")})),0===this._options.navigators.length&&(n=this._options.navigators).push.apply(n,c),ge.updateStatisticsBaseData({bundleId:this.apiPKGName}),ge.initReportLog({runtime:this._runtime,logSwitch:1,logPolicy:JSON.parse("{}"),appkey:this.appkey,version:this.apiVersion});var r={status:this._connectionStatusListener.bind(this),batchMessage:this._batchMessageReceiver.bind(this),chatroom:this._chatroomInfoListener.bind(this),conversation:this._conversationInfoListener.bind(this),expansion:this._expansionInfoListener.bind(this),tag:this._tagListener.bind(this),conversationTag:this._conversationTagListener.bind(this),onRTCDataChange:this._rtcDataChange.bind(this),pullFinished:this._pullFinishedListener.bind(this),ultraGroupEnable:this._ultraGroupEnableListener.bind(this),operateStatus:this._operateStatusListener.bind(this),ultraGroupMessageExpansionUpdated:this._ultraGroupMessageExpansionUpdatedListener.bind(this),ultraGroupMessageModified:this._ultraGroupMessageModifiedListener.bind(this),ultraGroupMessageRecalled:this._ultraGroupMessageRecalledListener.bind(this)};this._engine=_t()?new RCCppEngine(e,r,this._options):new bo(e,r,this._options)}return e.init=function(t,n){return ge.setLogLevel(n.logLevel),ge.setLogStdout(n.logStdout),(n.indexDBSwitch||re(n.indexDBSwitch))&&q.init(),ge.debug("APIContext.init =>",n.appkey,n.navigators),this._context?(ge.error("Repeat initialize!"),this._context):(ge.warn("RCEngine Commit:","aff769db9320955c717db9d318fbee662473dbcb"),this._context=new e(t,n),ge.__insertLogIntoDatabase(),this._context)},e.destroy=function(){this._context&&(this._context._destroy(),this._context=void 0)},e.prototype.install=function(e,t){if(this._pluginInstanseMap[e.tag])return ge.warn("Repeat install plugin: ".concat(e.tag)),this._pluginInstanseMap[e.tag];var n="RCRTC"===e.tag?new Po(this):new Lo(this),r=null;try{if(!e.verify(this._runtime))return null;r=e.setup(n,this._runtime,t)}catch(e){ge.error("install plugin error!\n",e)}return["RCRTC","RCCall"].includes(e.tag)&&e.version&&e.name&&(this._versionInfo[e.name]=e.version),r&&this._pluginContextQueue.push(n),r&&(this._pluginInstanseMap[e.tag]=r),r},e.prototype._handleRedirect=function(){return C(this,void 0,void 0,(function(){var e,t=this;return S(this,(function(n){switch(n.label){case 0:return ge.debug("_handleRedirct",this._token),[4,this.connect(this._token,!0)];case 1:return(e=n.sent().code)!==ye.SUCCESS&&this._canRedirectConnect&&(this._handleSuspend(e),setTimeout((function(){t._handleRedirect()}),5e3)),[2]}}))}))},e.prototype._connectionStatusListener=function(e){var t;return C(this,void 0,void 0,(function(){return S(this,(function(n){return[Te.REDIRECT,Te.BLOCKED,Te.KICKED_OFFLINE_BY_OTHER_CLIENT,Te.DISCONNECT_BY_SERVER,Te.DISCONNECTED,Te.NETWORK_UNAVAILABLE].includes(e)&&(ge.setStatisticsData(ki.IM_CONNECTION_DURATION,{endTime:(new Date).getTime(),code:e}),function(e){C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:t=ki.IM_CONNECTION_DURATION,n=ge.getStatisticsBaseData().bundleId,r=ge.getStatisticsData(t),i=r.startTime,o=r.endTime,s=r.code,a=jr.UNKONWN,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.getNetworkType()];case 2:return a=l.sent(),[3,4];case 3:return c=l.sent(),ge.debug(c.message),[3,4];case 4:return u=0,X(i)&&X(o)&&o>i&&i&&(u=o-i),d={bid:n,cod:s,dur:u,net:a},ge.reportStatisticsLog(t,d),[2]}}))}))}(this._runtime)),e===Te.REDIRECT?(this._canRedirectConnect=!0,this._handleSuspend(e),this._handleRedirect()):e===Te.BLOCKED||e===Te.KICKED_OFFLINE_BY_OTHER_CLIENT||e===Te.DISCONNECT_BY_SERVER?(this._canRedirectConnect=!1,this._handleDisconnect(e)):e===Te.CONNECTING?this._handleConnecting():e===Te.CONNECTED?this._handleConnected():e===Te.DISCONNECTED?this._handleDisconnect(e):e===Te.NETWORK_UNAVAILABLE&&this._handleSuspend(e),this._connectionStatus=e,(null===(t=this._watcher.rtcInnerWatcher)||void 0===t?void 0:t.status)&&this._watcher.rtcInnerWatcher.status(e),this._pluginContextQueue.forEach((function(t){t.onconnectionstatechange&&t.onconnectionstatechange(e)})),this._watcher.connectionState&&this._watcher.connectionState(e),[2]}))}))},e.prototype._handleConnecting=function(){this._watcher.onConnecting&&this._watcher.onConnecting()},e.prototype._handleConnected=function(){this._watcher.onConnected&&this._watcher.onConnected()},e.prototype._handleDisconnect=function(e){this._watcher.onDisconnect&&this._watcher.onDisconnect(e)},e.prototype._handleSuspend=function(e){this._watcher.onSuspend&&this._watcher.onSuspend(e)},e.prototype._messageReceiver=function(e,t,n){var r,i,o;if((e.conversationType===Y.RTC_ROOM||Object.prototype.hasOwnProperty.call(Ye,e.messageType))&&this._watcher.rtcInnerWatcher&&this._watcher.rtcInnerWatcher.message)this._watcher.rtcInnerWatcher.message(Do(e));else if(-1===["RC:ChrmJoinNtf","RC:ChrmQuitNtf"].indexOf(e.messageType)||"function"!=typeof this._watcher.chatroomState){if("RC:ChrmMemChange"!==e.messageType){if(e.messageType!==Se.TYPING_STATUS||(this._addTypingInfo(Do(e)),!this._watcher.typingState))if(e.messageType!==Se.LOG_COMMAND||"rongcloudsystem"!==e.senderUserId)if(e.messageType!==Se.INTERCEPT){if(!this._pluginContextQueue.some((function(t){if(!t.onmessage)return!1;try{return t.onmessage(Do(e))}catch(e){return ge.error("plugin error =>",e),!1}})))if(this._watcher.message&&this._watcher.message(Do(e),t,n),"RC:ReadNtf"!==e.messageType)if("RC:RRReqMsg"!==e.messageType){if("RC:RRRspMsg"!==e.messageType)return e;var s=null===(o=e.content)||void 0===o?void 0:o.receiptMessageDic;s&&Array.isArray(s[this._engine.currentUserId])&&"function"==typeof this._watcher.messageReceiptResponse&&this._watcher.messageReceiptResponse({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.senderUserId,s[this._engine.currentUserId])}else"function"==typeof this._watcher.messageReceiptRequest&&this._watcher.messageReceiptRequest({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.content.messageUId,e.senderUserId);else"function"==typeof this._watcher.readReceiptReceived&&this._watcher.readReceiptReceived({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.content.messageUId,e.content.lastMessageSendTime)}else this._MessageBlockedListener({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId||"",blockType:e.content.interceptType,blockedMessageUId:e.content.msgUId});else{var a=e.content,c=a.startTime,u=a.endTime,d=a.platform,l=a.logId,h=a.uri,f=a.packageName,g={startTime:parseInt(c),endTime:parseInt(u),platform:d,logId:l,uri:h,packageName:f};null===(i=H.getInstance())||void 0===i||i.reportFullLog(g)}}else if("function"==typeof this._watcher.chatroomState){var p={};Array.isArray(e.content.userList)&&e.content.userList.forEach((function(e){p[e.userId]=e.status})),this._watcher.chatroomState({userChange:{users:p,chatroomId:e.targetId}})}}else this._watcher.chatroomState({userChange:{users:(r={},r[e.senderUserId]="RC:ChrmQuitNtf"===e.messageType?xe.QUIT:xe.JOIN,r),chatroomId:e.targetId}})},e.prototype._batchMessageReceiver=function(e,t,n){var r=this,i=[];e.forEach((function(e){var o=r._messageReceiver(e,t,n);o&&i.push(o)})),i.length&&this._watcher.batchMessage&&this._watcher.batchMessage(i)},e.prototype._chatroomInfoListener=function(e){this._watcher.chatroomState&&this._watcher.chatroomState(e)},e.prototype._conversationInfoListener=function(e){this._watcher.conversationState&&this._watcher.conversationState(e)},e.prototype._expansionInfoListener=function(e){this._watcher.expansion&&this._watcher.expansion(e)},e.prototype._tagListener=function(){this._watcher.tag&&this._watcher.tag()},e.prototype._conversationTagListener=function(){this._watcher.conversationTagChanged&&this._watcher.conversationTagChanged()},e.prototype._typingStatusListener=function(e){this._watcher.typingState&&this._watcher.typingState(e)},e.prototype._pullFinishedListener=function(){this._watcher.pullFinished&&this._watcher.pullFinished()},e.prototype._MessageBlockedListener=function(e){this._watcher.messageBlocked&&this._watcher.messageBlocked(e)},e.prototype._ultraGroupEnableListener=function(e){this._watcher.ultraGroupEnable&&this._watcher.ultraGroupEnable(e)},e.prototype._operateStatusListener=function(e){this._watcher.operateStatus&&this._watcher.operateStatus(e)},e.prototype._ultraGroupMessageExpansionUpdatedListener=function(e){this._watcher.ultraGroupMessageExpansionUpdated&&this._watcher.ultraGroupMessageExpansionUpdated(e)},e.prototype._ultraGroupMessageModifiedListener=function(e){this._watcher.ultraGroupMessageModified&&this._watcher.ultraGroupMessageModified(e)},e.prototype._ultraGroupMessageRecalledListener=function(e){this._watcher.ultraGroupMessageRecalled&&this._watcher.ultraGroupMessageRecalled(e)},e.prototype._rtcDataChange=function(e,t){this._pluginContextQueue.forEach((function(n){n.onrtcdatachange&&n.onrtcdatachange(e,t)}))},e.prototype.assignWatcher=function(e){var t=this;Object.keys(this._watcher).forEach((function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];t._watcher[n]=ne(r)||te(r)?r:void 0}}))},e.prototype.resetWatcher=function(){var e=this;Object.keys(this._watcher).forEach((function(t){e._watcher[t]=void 0}))},e.prototype._addTypingInfo=function(e){var t=e.senderUserId,n=e.conversationType,r=e.targetId,i=e.content,o=e.channelId,s=i.typingContentType,a=o||"",c="".concat(n,"#").concat(r,"#").concat(a);this._typingInfo[c]||(this._typingInfo[c]=[]);var u=this._typingInfo[c].findIndex((function(e){return e.userId===t}));u>=0&&this._typingInfo[c][u].messageType===s?this._typingInfo[c][u].timestamp=Date.now():(u>=0&&this._typingInfo[c].splice(u,1),this._typingInfo[c].push({userId:t,messageType:s,timestamp:Date.now()}),this._typingChangedList.includes(c)||this._typingChangedList.push(c),this._startCheckTypingInfo())},e.prototype._startCheckTypingInfo=function(){var e=this;-1===this._typingInternalTimer&&0!==Object.keys(this._typingInfo).length&&(this._typingInternalTimer=setInterval((function(){for(var t in e._typingInfo){var n=e._typingInfo[t].length;e._typingInfo[t]=e._typingInfo[t].filter((function(t){return Date.now()-t.timestamp<e._typingExpireTime})),e._typingInfo[t].length===n||e._typingChangedList.includes(t)||e._typingChangedList.push(t),0===e._typingInfo[t].length&&delete e._typingInfo[t]}if(e._typingChangedList.length>0){var r=e._typingChangedList.map((function(t){return{conversationType:Number(t.split("#")[0]),targetId:t.split("#")[1],channelId:t.split("#")[2],list:e._typingInfo[t]||[]}}));e._typingStatusListener(r),e._typingChangedList=[]}0===Object.keys(e._typingInfo).length&&(clearInterval(e._typingInternalTimer),e._typingInternalTimer=-1)}),500))},e.prototype.getConnectedTime=function(){return this._engine.getConnectedTime()},e.prototype.getServerTime=function(){return this._engine.getServerTime()},e.prototype.getDeviceId=function(){return this._engine.getDeviceId()},e.prototype.getCurrentUserId=function(){return this._engine.currentUserId},e.prototype.getConnectionStatus=function(){return this._connectionStatus},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),e.prototype.connect=function(e,t,n){return void 0===t&&(t=!1),C(this,void 0,void 0,(function(){var r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return this._connectionStatus===Te.CONNECTED?[2,{code:ye.SUCCESS,userId:this._engine.currentUserId}]:this._connectionStatus===Te.CONNECTING?[2,{code:ye.BIZ_ERROR_CONNECTING}]:"string"!=typeof e||0===e.length?[2,{code:ye.RC_CONN_USER_OR_PASSWD_ERROR}]:(this._token=e,r=e.split("@"),i=r[1],o=i?i.split(";").map((function(e){return/^https?:/.test(e)?e:"https://".concat(e)})):[],[4,this._engine.navi.getInfo(this._getTokenWithoutNavi(),o,t,this._options.checkCA)]);case 1:return(s=u.sent())?1===(null==s?void 0:s.type)?[2,{code:ye.PACKAGE_ENVIRONMENT_ERROR}]:(a=ze.getInfo(),[4,this._engine.connect(this._getTokenWithoutNavi(),s,n)]):[2,{code:ye.RC_NAVI_RESOURCE_ERROR}];case 2:return c=u.sent(),ge.__insertLogIntoDatabase(),c!==Ie.REDIRECT?[3,4]:(this._connectionStatus=Te.REDIRECT,[4,this.connect(e,!0)]);case 3:return[2,u.sent()];case 4:return c===ye.SUCCESS&&(ge.setStatisticsData(ki.IM_CONNECTION_DURATION,{startTime:(new Date).getTime()},!0),ge.info("connect success, userId: ".concat(this._engine.currentUserId)),1!==(null==s?void 0:s.type)&&this._engine.reportSDKInfo&&this._engine.reportSDKInfo(a),ge.updateUploadLogAttr({runtime:this._runtime,logSwitch:(null==s?void 0:s.logSwitch)||0,logPolicy:JSON.parse((null==s?void 0:s.logPolicy)||"{}"),appkey:this.appkey,version:this.apiVersion,userId:this._engine.currentUserId}),fe.init(this._engine.currentUserId),this._isInternalConnected=!0),c!==ye.SUCCESS||_t()||1===s.openUS&&this._pullUserSettings(),c!==ye.SUCCESS&&(this._connectionStatus=Te.CONNECTION_CLOSED),[2,{code:c,userId:this._engine.currentUserId}]}}))}))},e.prototype._pullUserSettings=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.disconnect=function(){var e;return this._isInternalConnected=!1,clearInterval(this._typingInternalTimer),this._typingInternalTimer=-1,this._typingInfo={},null===(e=H.getInstance())||void 0===e||e.distroy(),ge.__insertLogIntoDatabase(),fe.reset(),this._engine.disconnect(),this._pluginContextQueue.forEach((function(e){if(e.ondisconnect)try{e.ondisconnect()}catch(e){ge.error("plugin error =>",e)}})),Promise.resolve()},e.prototype.reconnect=function(e){return this._isInternalConnected?Promise.resolve({code:ye.CAN_NOT_RECONNECT}):this.connect(this._getTokenWithoutNavi(),!1,e)},e.prototype._getTokenWithoutNavi=function(){return this._token.replace(/@.+$/,"@")},e.prototype.getInfoFromCache=function(){return this._engine.navi.getInfoFromCache(this._getTokenWithoutNavi())},e.prototype.registerMessageType=function(e,t,n,r,i){void 0===r&&(r=[]),void 0===i&&(i=!1),this._engine.registerMessageType(e,t,n,r,i)},e.prototype.sendMessage=function(e,t,n,r){if(e!==Y.ULTRA_GROUP){var i=this.getInfoFromCache();if(1===((null==i?void 0:i.grpRRVer)||0)&&n.messageType===Se.READ_RECEIPT_RESPONSE)return Promise.resolve({code:ye.READ_RECEIPT_ERROR})}var o=n.canIncludeExpansion,s=void 0!==o&&o,a=n.expansion;if(s){var c=ue(a),u=c.isIllgalEx,d=c.isExKeyOrValLengthExceedLimit;if(c.isExceedLimit||d)return Promise.resolve({code:ye.EXPANSION_LIMIT_EXCEET});if(u)return Promise.resolve({code:ye.BIZ_ERROR_INVALID_PARAMETER})}var l=JSON.stringify(n.content);return M(l)>h?Promise.resolve({code:ye.RC_MSG_CONTENT_EXCEED_LIMIT}):e===Y.ULTRA_GROUP?this._engine.sendUltraMessage(t,n):this._engine.sendMessage(e,t,n,r)},e.prototype.sendExpansionMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u,d,l;return S(this,(function(h){switch(h.label){case 0:return t=e.channelId,n=e.conversationType,r=e.targetId,i=e.messageUId,o=e.keys,s=e.expansion,a=e.removeAll,e.canIncludeExpansion?(c=ue(s),u=c.isIllgalEx,d=c.isExKeyOrValLengthExceedLimit,c.isExceedLimit||d?[2,Promise.resolve({code:ye.EXPANSION_LIMIT_EXCEET})]:u?[2,Promise.resolve({code:ye.BIZ_ERROR_INVALID_PARAMETER})]:(l={mid:i},s&&(l.put=s),o&&(l.del=o),a&&(l.removeAll=1),[4,this._engine.sendMessage(n,r,{content:l,messageType:Se.EXPANSION_NOTIFY,channelId:t})])):[2,{code:ye.MESSAGE_KV_NOT_SUPPORT}];case 1:return[2,{code:h.sent().code}]}}))}))},e.prototype.sendReadReceiptMessage=function(e,t,n){return C(this,void 0,void 0,(function(){var r;return S(this,(function(i){return r=this.getInfoFromCache(),0===((null==r?void 0:r.grpRRVer)||0)?[2,{code:ye.READ_RECEIPT_ERROR,data:"The read receipt switch is not on, please call the sendMessage method!"}]:[2,this._engine.sendReadReceiptMessage(e,t,n)]}))}))},e.prototype.getMessageReader=function(e,t,n){return C(this,void 0,void 0,(function(){var r;return S(this,(function(i){return r=this.getInfoFromCache(),0===((null==r?void 0:r.grpRRVer)||0)?[2,{code:ye.READ_RECEIPT_ERROR}]:[2,this._engine.getMessageReader(e,t,n)]}))}))},e.prototype._destroy=function(){var e;this._isInternalConnected=!1,this._watcher={batchMessage:void 0,message:void 0,conversationState:void 0,chatroomState:void 0,connectionState:void 0,rtcInnerWatcher:void 0,expansion:void 0,tag:void 0,conversationTagChanged:void 0,typingState:void 0,pullFinished:void 0,onConnecting:void 0,onConnected:void 0,onDisconnect:void 0,onSuspend:void 0},this._engine.disconnect(),this._pluginContextQueue.forEach((function(e){if(e.ondestroy)try{e.ondestroy()}catch(e){ge.error("plugin error =>",e)}})),this._pluginContextQueue.length=0,this._pluginInstanseMap={},null===(e=H.getInstance())||void 0===e||e.distroy(),fe.reset()},e.prototype.getHistoryMessage=function(e,t,n,r,i,o,s){if(void 0===n&&(n=0),void 0===r&&(r=20),void 0===i&&(i=0),void 0===o&&(o=""),void 0===s&&(s=""),e===Y.ULTRA_GROUP){var a={timestamp:n,count:r,order:i,channelId:o};return this._engine.getUltraHistoryMsg(t,a)}return this._engine.getHistoryMessage(e,t,n,r,i,o,s||"")},e.prototype.getConversationList=function(e,t,n,r,i){if(void 0===e&&(e=300),void 0===i&&(i=""),t===Y.ULTRA_GROUP){var o=ye.METHOD_NOT_SUPPORT;return Promise.resolve({code:o,msg:ye[o]})}return this._engine.getConversationList(e,t,n,r,i)},e.prototype.getConversation=function(e,t,n){return this._engine.getConversation(e,t,n)},e.prototype.removeConversation=function(e,t,n){return void 0===n&&(n=""),e===Y.ULTRA_GROUP?Promise.resolve(ye.METHOD_NOT_SUPPORT):this._engine.removeConversation(e,t,n)},e.prototype.getUltraGroupList=function(){return this._engine.getUltraGroupList()},e.prototype.getBlockUltraGroupList=function(){return this._engine.getBlockUltraGroupList()},e.prototype.getTopUltraGroupList=function(){return this._engine.getTopUltraGroupList()},e.prototype.clearUnreadCount=function(e,t,n){return void 0===n&&(n=""),e===Y.ULTRA_GROUP?this._engine.clearUltraUnreadcount(t,n):this._engine.clearConversationUnreadCount(e,t,n)},e.prototype.clearAllUnreadCount=function(){return this._engine.clearAllUnreadCount()},e.prototype.getUnreadCount=function(e,t,n){return void 0===n&&(n=""),this._engine.getConversationUnreadCount(e,t,n)},e.prototype.getTotalUnreadCount=function(e,t,n){if(t&&t.includes(Y.ULTRA_GROUP)){var r=ye.METHOD_NOT_SUPPORT;return Promise.resolve({code:r,msg:ye[r]})}return this._engine.getAllConversationUnreadCount(e,t&&t.length>0?t:[Y.PRIVATE,Y.GROUP,Y.SYSTEM,Y.PUBLIC_SERVICE],!!n)},e.prototype.getFirstUnreadMessage=function(e,t,n){return void 0===n&&(n=""),this._engine.getFirstUnreadMessage(e,t,n)},e.prototype.setConversationNotificationLevel=function(e,t,n,r){return void 0===r&&(r=""),C(this,void 0,void 0,(function(){var i;return S(this,(function(o){return i=[{conversationType:e,targetId:t,notificationLevel:n,channelId:r}],[2,this._engine.batchSetConversationStatus(i)]}))}))},e.prototype.setConversationStatus=function(e,t,n,r,i){if(void 0===i&&(i=""),e===Y.ULTRA_GROUP&&void 0!==n)return Promise.resolve(ye.METHOD_NOT_SUPPORT);var o=[{conversationType:e,targetId:t,isTop:n,notificationStatus:r,channelId:i}];return this._engine.batchSetConversationStatus(o)},e.prototype.saveConversationMessageDraft=function(e,t,n,r){return void 0===r&&(r=""),this._engine.saveConversationMessageDraft(e,t,n,r)},e.prototype.getConversationMessageDraft=function(e,t,n){return void 0===n&&(n=""),this._engine.getConversationMessageDraft(e,t,n)},e.prototype.clearConversationMessageDraft=function(e,t,n){return void 0===n&&(n=""),this._engine.clearConversationMessageDraft(e,t,n)},e.prototype.recallMessage=function(e,t,n,r,i){return this._engine.recallMsg(e,t,n,r,i)},e.prototype.deleteRemoteMessage=function(e,t,n,r){return void 0===r&&(r=""),e===Y.ULTRA_GROUP?Promise.resolve(ye.METHOD_NOT_SUPPORT):this._engine.deleteRemoteMessage(e,t,n,r)},e.prototype.deleteRemoteMessageByTimestamp=function(e,t,n,r){return void 0===r&&(r=""),this._engine.deleteRemoteMessageByTimestamp(e,t,n,r)},e.prototype.joinChatroom=function(e,t){return void 0===t&&(t=10),this._engine.joinChatroom(e,t)},e.prototype.joinExistChatroom=function(e,t){return void 0===t&&(t=10),this._engine.joinExistChatroom(e,t)},e.prototype.quitChatroom=function(e){return this._engine.quitChatroom(e)},e.prototype.getChatroomInfo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this._engine.getChatroomInfo(e,t,n)},e.prototype.setChatroomEntry=function(e,t){var n=t.key,r=t.value;return lt(n)&&ht(r)?this._engine.setChatroomEntry(e,t):Promise.resolve(ye.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.setChatroomEntries=function(e,t){for(var n=0;n<t.entries.length;n++){var r=t.entries[n],i=r.key,o=r.value;if(!lt(i)||!ht(o))return Promise.resolve({code:ye.BIZ_ERROR_INVALID_PARAMETER})}return this._engine.setChatroomEntries(e,t)},e.prototype.forceSetChatroomEntry=function(e,t){var n=t.key,r=t.value;return lt(n)&&ht(r)?this._engine.forceSetChatroomEntry(e,t):Promise.resolve(ye.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.removeChatroomEntry=function(e,t){var n=t.key;return lt(n)?this._engine.removeChatroomEntry(e,t):Promise.resolve(ye.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.removeChatroomEntries=function(e,t){for(var n=0;n<t.entries.length;n++){var r=t.entries[n].key;if(!lt(r))return Promise.resolve({code:ye.BIZ_ERROR_INVALID_PARAMETER})}return this._engine.removeChatroomEntries(e,t)},e.prototype.forceRemoveChatroomEntry=function(e,t){var n=t.key;return lt(n)?this._engine.forceRemoveChatroomEntry(e,t):Promise.resolve(ye.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.getChatroomEntry=function(e,t){return this._engine.getChatroomEntry(e,t)},e.prototype.getAllChatroomEntries=function(e){return this._engine.getAllChatroomEntry(e)},e.prototype.getChatroomHistoryMessages=function(e,t,n,r){return void 0===t&&(t=20),void 0===n&&(n=0),void 0===r&&(r=0),this._engine.getChatroomHistoryMessages(e,r,t,n)},e.prototype.getFileToken=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return i=this.getInfoFromCache(),o=(null==i?void 0:i.bosAddr)||"",s=(null==i?void 0:i.uploadServer)||"",a=(null==i?void 0:i.ossConfig)||"",[4,this._engine.getFileToken(e,t,n,r)];case 1:return c=l.sent(),u=c.code,d=c.data,u===ye.SUCCESS?[2,Promise.resolve(Object.assign(d,{bos:o,qiniu:s,ossConfig:a}))]:[2,Promise.reject(u)]}}))}))},e.prototype.getFileUrl=function(e,t,n,r,i){return void 0===i&&(i=be.QINIU),C(this,void 0,void 0,(function(){var o,s,a;return S(this,(function(c){switch(c.label){case 0:return(null==r?void 0:r.isBosRes)?[2,Promise.resolve(r)]:[4,this._engine.getFileUrl(e,i,t,n)];case 1:return o=c.sent(),s=o.code,a=o.data,s===ye.SUCCESS?[2,Promise.resolve(a)]:[2,Promise.reject(s)]}}))}))},e.prototype.createTag=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.createTag(e)]}))}))},e.prototype.removeTag=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.removeTag(e)]}))}))},e.prototype.updateTag=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.updateTag(e)]}))}))},e.prototype.getTagList=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return[2,this._engine.getTagList()]}))}))},e.prototype.addTagForConversations=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return t.length>1e3?[2,Promise.reject(ye.CONVER_OUT_LIMIT_ERROR)]:[2,this._engine.addTagForConversations(e,t)]}))}))},e.prototype.removeTagForConversations=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._engine.removeTagForConversations(e,t)]}))}))},e.prototype.removeTagsForConversation=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._engine.removeTagsForConversation(e,t)]}))}))},e.prototype.getConversationListByTag=function(e,t,n,r){return C(this,void 0,void 0,(function(){return S(this,(function(i){return[2,this._engine.getConversationListByTag(e,t,n,r)]}))}))},e.prototype.getUnreadCountByTag=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._engine.getUnreadCountByTag(e,t)]}))}))},e.prototype.setConversationStatusInTag=function(e,t,n){return C(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this._engine.setConversationStatusInTag(e,t,n)]}))}))},e.prototype.getTagsForConversation=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.getTagsForConversation(e)]}))}))},e.prototype.getBlockConversationList=function(){return this._engine.getBlockConversationList()},e.prototype.getTopConversationList=function(){return this._engine.getTopConversationList()},e.prototype.getUnreadMentionedCount=function(e){return this._engine.getUnreadMentionedCount(e)},e.prototype.getAllUnreadMentionedCount=function(){return this._engine.getAllUnreadMentionedCount()},e.prototype.sendUltraGroupTypingStatus=function(e){if(e.conversationType!==Y.ULTRA_GROUP){var t=ye.METHOD_ONLY_SUPPORT_ULTRA_GROUP;return Promise.resolve({code:t,msg:ye[t]})}return this._engine.sendUltraGroupTypingStatus(e)},e.prototype.getUltraGroupMessageListByMessageUId=function(e){return this._engine.getUltraGroupMessageListByMessageUId(e)},e.prototype.expandUltraMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return t=e.conversationType,n=e.expansion,r=e.canIncludeExpansion,t!==Y.ULTRA_GROUP?[2,{code:i=ye.METHOD_ONLY_SUPPORT_ULTRA_GROUP,msg:ye[i]}]:r?(o=ue(n),s=o.isIllgalEx,a=o.isExKeyOrValLengthExceedLimit,o.isExceedLimit||a?[2,{code:ye.EXPANSION_LIMIT_EXCEET}]:s?[2,{code:ye.BIZ_ERROR_INVALID_PARAMETER}]:[4,this._engine.expandUltraMessage(e)]):[2,{code:ye.MESSAGE_KV_NOT_SUPPORT}];case 1:return[2,{code:c.sent().code}]}}))}))},e.prototype.modifyMessage=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return e.conversationType!==Y.ULTRA_GROUP?[2,{code:t=ye.METHOD_ONLY_SUPPORT_ULTRA_GROUP,msg:ye[t]}]:[4,this._engine.modifyMessage(e)];case 1:return[2,{code:n.sent().code}]}}))}))},e.prototype.getUltraGroupUnreadMentionedCountByTargetId=function(e){return this._engine.getUltraGroupUnreadMentionedCountByTargetId(e)},e.prototype.getUltraGroupUnreadCountByTargetId=function(e){return this._engine.getUltraGroupUnreadCountByTargetId(e)},e.prototype.getAllUltraGroupUnreadCount=function(e){return void 0===e&&(e=!1),this._engine.getAllUltraGroupUnreadCount(e)},e.prototype.getAllConversationState=function(){return this._engine.getAllConversationState()},e.prototype.callExtra=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this._engine).callExtra.apply(t,R([e],n,!1))},e.prototype.clearConversations=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._engine.clearConversations(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.setUserStatusListener=function(e,t){return this._engine.setUserStatusListener(e,(function(e){try{t(e)}catch(e){ge.error(e)}}))},e.prototype.addToBlacklist=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.addToBlacklist(e)]}))}))},e.prototype.removeFromBlacklist=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.removeFromBlacklist(e)]}))}))},e.prototype.getBlacklist=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return[2,this._engine.getBlacklist()]}))}))},e.prototype.getBlacklistStatus=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.getBlacklistStatus(e)]}))}))},e.prototype.insertMessage=function(e,t,n){return C(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this._engine.insertMessage(e,t,n)]}))}))},e.prototype.deleteMessages=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.deleteMessages(e)]}))}))},e.prototype.deleteMessagesByTimestamp=function(e,t,n,r,i){return void 0===i&&(i=""),C(this,void 0,void 0,(function(){return S(this,(function(o){return[2,this._engine.deleteMessagesByTimestamp(e,t,n,r,i)]}))}))},e.prototype.clearMessages=function(e,t,n){return void 0===n&&(n=""),C(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this._engine.clearMessages(e,t,n)]}))}))},e.prototype.getMessage=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.getMessage(e)]}))}))},e.prototype.setMessageContent=function(e,t,n){return C(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this._engine.setMessageContent(e,t,n)]}))}))},e.prototype.setMessageSearchField=function(e,t,n){return C(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this._engine.setMessageSearchField(e,t,n)]}))}))},e.prototype.setMessageSentStatus=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._engine.setMessageSentStatus(e,t)]}))}))},e.prototype.setMessageReceivedStatus=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return[2,this._engine.setMessageReceivedStatus(e,t)]}))}))},e.prototype.setUserStatus=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.setUserStatus(e)]}))}))},e.prototype.subscribeUserStatus=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.subscribeUserStatus(e)]}))}))},e.prototype.getUserStatus=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return[2,this._engine.getUserStatus(e)]}))}))},e.prototype.searchConversationByContent=function(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=""),C(this,void 0,void 0,(function(){return S(this,(function(i){return[2,this._engine.searchConversationByContent(e,t,n,r)]}))}))},e.prototype.searchMessageByContent=function(e,t,n,r,i,o,s){return void 0===s&&(s=""),C(this,void 0,void 0,(function(){return S(this,(function(a){return[2,this._engine.searchMessageByContent(e,t,n,r,i,o,s)]}))}))},e.prototype.getUnreadMentionedMessages=function(e,t,n){return void 0===n&&(n=""),this._engine.getUnreadMentionedMessages(e,t,n)},e.prototype.clearUnreadCountByTimestamp=function(e,t,n,r){return void 0===r&&(r=""),this._engine.clearUnreadCountByTimestamp(e,t,n,r)},e.prototype.getUltraGroupDefaultNotificationLevel=function(e,t){return void 0===t&&(t=""),this._engine.getUltraGroupDefaultNotificationLevel(e,t)},e.prototype.setUltraGroupDefaultNotificationLevel=function(e,t,n){return void 0===n&&(n=""),this._engine.setUltraGroupDefaultNotificationLevel(e,t,n)},e.prototype.getConversationNotificationLevel=function(e,t,n){return void 0===n&&(n=""),this._engine.getConversationNotificationLevel(e,t,n)},e.prototype.getConversationNotificationStatus=function(e,t,n){return void 0===n&&(n=""),this._engine.getConversationNotificationStatus(e,t,n)},e.prototype.getRemoteHistoryMessages=function(e,t,n,r,i,o){return this._engine.getRemoteHistoryMessages(e,t,n,r,i,o)},e.prototype.getConversationListWithAllChannel=function(){return this._engine.getConversationListWithAllChannel()},e.prototype.getConversationListWithAllChannelByPage=function(e,t){return this._engine.getConversationListWithAllChannelByPage(e,t)},e.prototype.joinRTCRoom=function(e,t,n,r,i,o){return this._engine.joinRTCRoom(e,t,n,r,i,o)},e.prototype.quitRTCRoom=function(e){return this._engine.quitRTCRoom(e)},e.prototype.rtcPing=function(e,t,n){return this._engine.rtcPing(e,t,n)},e.prototype.getRTCRoomInfo=function(e){return this._engine.getRTCRoomInfo(e)},e.prototype.getRTCUserInfoList=function(e){return this._engine.getRTCUserInfoList(e)},e.prototype.getRTCUserInfo=function(e){return this._engine.getRTCUserInfo(e)},e.prototype.setRTCUserInfo=function(e,t,n){return this._engine.setRTCUserInfo(e,t,n)},e.prototype.removeRTCUserInfo=function(e,t){return this._engine.removeRTCUserInfo(e,t)},e.prototype.setRTCData=function(e,t,n,r,i,o){return this._engine.setRTCData(e,t,n,r,i,o)},e.prototype.setRTCTotalRes=function(e,t,n,r,i){return void 0===i&&(i=""),this._engine.setRTCTotalRes(e,t,n,r,i)},e.prototype.setRTCCDNUris=function(e,t,n){return this._engine.setRTCCDNUris(e,t,n)},e.prototype.getRTCData=function(e,t,n,r){return this._engine.getRTCData(e,t,n,r)},e.prototype.removeRTCData=function(e,t,n,r,i){return this._engine.removeRTCData(e,t,n,r,i)},e.prototype.setRTCOutData=function(e,t,n,r){return this._engine.setRTCOutData(e,t,n,r)},e.prototype.getRTCOutData=function(e,t){return this._engine.getRTCOutData(e,t)},e.prototype.getRTCToken=function(e,t,n){return this._engine.getRTCToken(e,t,n)},e.prototype.setRTCState=function(e,t){return this._engine.setRTCState(e,t)},e.prototype.getRTCUserList=function(e){return this._engine.getRTCUserList(e)},e.prototype.joinLivingRoomAsAudience=function(e,t,n){return this._engine.joinLivingRoomAsAudience(e,t,n)},e.prototype.quitLivingRoomAsAudience=function(e){return this._engine.quitLivingRoomAsAudience(e)},e.prototype.rtcIdentityChange=function(e,t,n){return this._engine.rtcIdentityChange(e,t,n)},e.prototype.getRTCJoinedUserInfo=function(e){return this._engine.getRTCJoinedUserInfo(e)},e.prototype.requestRoomPK=function(e){return this._engine.requestRoomPK(e)},e.prototype.cancelRoomPK=function(e){return this._engine.cancelRoomPK(e)},e.prototype.responseRoomPK=function(e){return this._engine.responseRoomPK(e)},e.prototype.endRoomPK=function(e){return this._engine.endRoomPK(e)},e.prototype.bindRTCRoomForChatroom=function(e){return this._engine.bindRTCRoomForChatroom(e)},e}();!function(e){e[e.add=1]="add",e[e.update=2]="update",e[e.delete=3]="delete"}(xo||(xo={}));var ko=Object.freeze({__proto__:null,DelayTimer:Ct,CometChannel:Ki,WebSocketChannel:Hi,AEngine:Yi,ANavi:Wi,version:"5.3.0",APIContext:Vo,PluginContext:Lo,RTCPluginContext:Po,get RTCMode(){return Be},get LiveType(){return Ge},get LiveRole(){return je},CallLibMsgType:Ye,get RTCApiType(){return Fe},get RTCIdentityChangeType(){return He},get RTCJoinType(){return Ke},FileType:W,MessageDirection:ve,ErrorCode:ye,ConversationType:Y,ConnectionStatus:Te,ReceivedStatus:n,ConnectResultCode:Ie,MessageType:Se,NotificationStatus:Ne,NotificationLevel:Me,MentionedType:we,UploadMethod:be,ChatroomEntryType:Pe,get LogLevel(){return e.LogLevel},get LogType(){return k},ChatroomMemberChangeType:xe,MessageBlockType:ke,OperateStatus:qe,get HttpMethod(){return Gr},get NetworkType(){return jr},get TagChangeType(){return xo},isString:J,isBoolean:z,isNumber:X,isArray:Z,isArrayBuffer:$,notEmptyString:ee,notEmptyArray:function(e){return Z(e)&&e.length>0},isObject:te,isFunction:ne,isUndefined:re,isNull:ie,isHttpUrl:oe,notEmptyObject:se,isValidConversationType:ae,isValidFileType:ce,isValidExpansion:ue,get AssertRules(){return Je},RCAssertError:it,assert:ot,validate:st,getUploadFileName:ct,getMimeKey:function(e){var t="application/octet-stream";switch(e){case W.IMAGE:t="image/jpeg";break;case W.AUDIO:t="audio/amr";break;case W.VIDEO:t="video/3gpp";break;case W.SIGHT:t="video/mpeg4";break;case W.COMBINE_HTML:t="text/html"}return t},pushConfigsToJSON:ut,pushJSONToConfigs:dt,isValidChrmEntryKey:lt,isValidChrmEntryValue:ht,Logger:fe,AppStorage:y,todo:function(e){return new N(e)},appendUrl:U,EventEmitter:pe,VersionManage:ze,forEach:ft,map:gt,indexOf:pt,isInclude:function(e,t){return-1!==pt(e,t)},isInObject:mt,cloneByJSON:vt,usingCppEngine:_t,getBrowser:function(e){if("browser"!==e.tag)return{type:e.tag,version:"UnKonw"};var t,n,r=navigator.userAgent,i={IE:/rv:([\d.]+)\) like Gecko|MSIE ([\d.]+)/,Edge:/Edge\/([\d.]+)/,Firefox:/Firefox\/([\d.]+)/,Opera:/(?:OPERA|OPR).([\d.]+)/,WeChat:/MicroMessenger\/([\d.]+)/,QQBrowser:/QQBrowser\/([\d.]+)/,Chrome:/Chrome\/([\d.]+)/,Safari:/Version\/([\d.]+).*Safari/,iOSChrome:/Mobile\/([\d.]+).*Safari/};for(var o in i)if(i.hasOwnProperty(o)){var s=r.match(i[o]);if(s){n=o,t=s[1]||s[2];break}}return{type:n||"UnKonw",version:t||"UnKonw"}},formatConnectResponseCode:yt,clone:Tt,NAVI_CACHE_DURATION:s,NAVI_REQ_TIMEOUT:1e4,PING_REQ_TIMEOUT:5e3,WEB_SOCKET_TIMEOUT:a,PUBLIC_CLOUD_NAVI_URIS:c,MINI_SOCKET_CONNECT_URIS:u,MINI_COMET_CONNECT_URIS:d,IM_SIGNAL_TIMEOUT:l,IM_PING_INTERVAL_TIME:15e3,IM_PING_TIMEOUT:15e3,IM_PING_MIN_TIMEOUT:2e3,MAX_MESSAGE_CONTENT_BYTES:h,IM_COMET_PULLMSG_TIMEOUT:45e3,STORAGE_ROOT_KEY:f,MAX_MESSAGE_EXPANSION_KEY_LENGTH:32,MAX_MESSAGE_EXPANSION_VAL_LENGTH:4096,SEND_MESSAGE_TYPE_OPTION:p,CPP_PROTOCAL_MSGTYPE_OPTION:{"RC:DizNtf":{isCounted:!1,isPersited:!1}},STATUS_MESSAGE:m,get CONNECTION_TYPE(){return i}});("undefined"!=typeof globalThis?globalThis:global||self).RCEngine=ko;var Bo=new fe("RCIM"),Go=function(){return!("undefined"==typeof uni||!function(e){for(var t=["canIUse","getSystemInfo"],n=0,r=t.length;n<r;n++)if(!e[t[n]])return!1;return!0}(uni))},jo=Go();var qo,Fo={tag:"browser",httpReq:function(e){var t=e.method||Gr.GET,n=e.timeout||6e4,i=e.headers,o=e.query,s=e.body,a=U(e.url,o);return new Promise((function(e){var o,c=(o="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,"undefined"!=typeof XMLHttpRequest&&o?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject("Microsoft.XMLHTTP")),u="[object XDomainRequest]"===Object.prototype.toString.call(c);if(c.open(t,a),i&&c.setRequestHeader)for(var d in i)c.setRequestHeader(d,i[d]);if(u){c.timeout=n,c.onload=function(){e({data:c.responseText,status:c.status||200})},c.onerror=function(){e({status:c.status||0})},c.ontimeout=function(){e({status:c.status||0})};var l="object"===r(s)?JSON.stringify(s):s;c.send(l)}else c.onreadystatechange=function(){4===c.readyState&&e({data:c.responseText,status:c.status})},c.onerror=function(){e({status:c.status||0})},setTimeout((function(){return e({status:c.status||0})}),n),c.send(s)}))},localStorage:null===window||void 0===window?void 0:window.localStorage,sessionStorage:null===window||void 0===window?void 0:window.sessionStorage,isSupportSocket:function(){var e="undefined"!=typeof WebSocket;return e||console.warn("websocket not support"),e},useNavi:!0,connectPlatform:"",isFromUniapp:jo,createWebSocket:function(e,t){var n=new WebSocket(e,t);return n.binaryType="arraybuffer",{onClose:function(e){n.onclose=function(t){var n=t.code,r=t.reason;e(n,r)}},onError:function(e){n.onerror=e},onMessage:function(e){n.onmessage=function(t){e(t.data)}},onOpen:function(e){n.onopen=e},send:function(e){n.send(e)},close:function(e,t){n.close()}}},createDataChannel:function(e,t){return this.isSupportSocket()&&"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t=e.type,n=e.effectiveType,r=t||n||jr.UNKONWN;return new Promise((function(e){e(r)}))}},Ho=Go(),Ko=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return wx[e].apply(wx,t)}catch(e){console.error(e)}}},Yo={setItem:Ko("setStorageSync"),getItem:Ko("getStorageSync"),removeItem:Ko("removeStorageSync"),clear:Ko("clearStorageSync")},Qo={tag:"wechat",httpReq:function(e){var t=e.method||Gr.GET,n=e.timeout||6e4,r=e.headers,i=e.query,o=e.body,s=U(e.url,i);return new Promise((function(e){wx.request({url:s,method:t,headers:r,timeout:n,data:o,success:function(t){e({data:t.data,status:t.statusCode})},fail:function(){e({status:ye.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:Yo,sessionStorage:Yo,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Ho,createWebSocket:function(e,t){var n=wx.connectSocket({url:e,protocols:t});return{onClose:function(e){n.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){e(t.data)}))},onOpen:function(e){n.onOpen(e)},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,t){return"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){return new Promise((function(e){wx.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e(jr.UNKONWN)}})}))}},Wo=Go(),Jo=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return my[e].apply(my,t)}catch(e){console.error(e)}}},zo={setItem:Jo("setStorageSync"),getItem:Jo("getStorageSync"),removeItem:Jo("removeStorageSync"),clear:Jo("clearStorageSync")},Xo={tag:"alipay",httpReq:function(e){var t=e.method||Gr.GET,n=e.timeout||6e4,r=e.headers,i=e.query,o=e.body,s=U(e.url,i),a=e.dataType||"json";return new Promise((function(e){my.request({url:s,method:t,headers:r,timeout:n,data:o,dataType:a,success:function(t){e({data:t.data,status:t.status})},fail:function(){e({status:ye.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:zo,sessionStorage:zo,isSupportSocket:function(){return!1},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Wo,createDataChannel:function(e,t){return"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){return new Promise((function(e){my.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e(jr.UNKONWN)}})}))}},Zo=Go(),$o=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log("tt",tt),tt[e].apply(tt,t)}catch(e){console.error(e)}}},es={setItem:$o("setStorageSync"),getItem:$o("getStorageSync"),removeItem:$o("removeStorageSync"),clear:$o("clearStorageSync")},ts={tag:"toutiao",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Zo,localStorage:es,sessionStorage:es,httpReq:function(e){return new Promise((function(t,n){tt.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log("调用成功",e.data);var n=(null==e?void 0:e.data)||{},r={data:JSON.stringify(n),status:e.statusCode};t(r)},fail:function(e){console.log("调用失败",e.errMsg),n({data:e.errMsg})}})}))},createWebSocket:function(e,t){var n=tt.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,t){return"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){return new Promise((function(e){tt.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e(jr.UNKONWN)}})}))}},ns=Go(),rs=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log("swan",swan),swan[e].apply(swan,t)}catch(e){console.error(e)}}},is={setItem:rs("setStorageSync"),getItem:rs("getStorageSync"),removeItem:rs("removeStorageSync"),clear:rs("clearStorageSync")},os={tag:"baidu",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:ns,localStorage:is,sessionStorage:is,httpReq:function(e){return new Promise((function(t,n){swan.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log("调用成功",e.data);var n=(null==e?void 0:e.data)||{},r={data:JSON.stringify(n),status:e.statusCode};t(r)},fail:function(e){console.log("调用失败",e.errorCode),n({data:e.errorCode})}})}))},createWebSocket:function(e,t){var n=swan.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,t){return"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return[2,new Promise((function(e){swan.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e(jr.UNKONWN)}})}))]}))}))}},ss=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return uni[e].apply(uni,t)}catch(e){console.error(e)}}},as={setItem:ss("setStorageSync"),getItem:ss("getStorageSync"),removeItem:ss("removeStorageSync"),clear:ss("clearStorageSync")},cs={tag:"uniapp",httpReq:function(e){var t=e.method||Gr.GET,n=e.timeout||6e4,r=e.headers,i=e.query,o=e.body,s=U(e.url,i);return new Promise((function(e){uni.request({url:s,method:t,headers:r,timeout:n,data:o,success:function(t){e({data:t.data,status:t.statusCode})},fail:function(){e({status:ye.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:as,sessionStorage:as,isSupportSocket:function(){return!0},useNavi:!0,connectPlatform:"",isFromUniapp:!0,createWebSocket:function(e,t){var n={complete:function(){},url:e,protocols:t},r=uni.connectSocket(n);return{onClose:function(e){r.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){r.onError((function(t){e(t.errMsg)}))},onMessage:function(e){r.onMessage((function(t){e(t.data)}))},onOpen:function(e){r.onOpen(e)},send:function(e){r.send({data:e})},close:function(e,t){r.close({code:e,reason:t})}}},createDataChannel:function(e,t){return"websocket"===t?new Hi(this,e):new Ki(this,e)},getNetworkType:function(){return new Promise((function(e){uni.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e(jr.UNKONWN)}})}))}},us=function(e){return e&&e.canIUse&&e.getSystemInfo},ds="undefined"!=typeof uni&&us(uni)?function(){switch(process.env.VUE_APP_PLATFORM){case"app-plus":return cs;case"mp-baidu":return os;case"mp-toutiao":return ts;case"mp-alipay":return Xo;case"mp-weixin":return Qo;default:return Fo}}():"undefined"!=typeof my&&us(my)?Xo:"undefined"!=typeof tt&&us(tt)?ts:"undefined"!=typeof swan&&us(swan)?os:"undefined"!=typeof wx&&us(wx)?Qo:Fo;function ls(e){var t=e.conversationType,r=e.channelId,i=e.messageType,o=e.content,s=e.senderUserId,a=e.targetId,c=e.sentTime,u=e.receivedTime,d=e.messageUId,l=e.messageDirection,h=e.isPersited,f=e.isCounted,g=e.isOffLineMessage,p=e.canIncludeExpansion,m=e.expansion,v=e.receivedStatus,_=e.disableNotification,y=e.isMentioned,E=e.isStatusMessage,T=e.readReceiptInfo,I=e.pushConfig,C=e.messageId,S=e.isInterrupt,R=e.isModifyMessage;v||(v=n.UNREAD);var N={messageType:i,channelId:r||"",content:o,senderUserId:s,targetId:a,conversationType:t,sentTime:c,receivedTime:u,messageUId:d,messageDirection:l,isPersited:h,isCounted:f,isMentioned:y,disableNotification:_,isStatusMessage:E,canIncludeExpansion:p,expansion:m,receivedStatus:v,readReceiptInfo:T,pushConfig:I,messageId:C,isInterrupt:S,isModifyMessage:R};return t!==Y.ULTRA_GROUP&&(N.isOffLineMessage=g),N}function hs(e){var t=e.conversationType,n=e.targetId,r=e.latestMessage,i=e.unreadMessageCount,o=e.hasMentioned,s=e.mentionedInfo,a=e.lastUnreadTime,c=e.notificationStatus,u=e.isTop,d=e.channelId,l=e.unreadMentionedCount;return{conversationType:t,targetId:n,latestMessage:r&&ls(r),unreadMessageCount:i,hasMentioned:o,mentionedInfo:o?{type:null==s?void 0:s.type,userIdList:null==s?void 0:s.userIdList}:void 0,lastUnreadTime:a,notificationStatus:c,isTop:u,channelId:d,unreadMentionedCount:l}}e.Events=void 0,(qo=e.Events||(e.Events={})).CONNECTING="CONNECTING",qo.CONNECTED="CONNECTED",qo.DISCONNECT="DISCONNECT",qo.SUSPEND="SUSPEND",qo.MESSAGES="MESSAGES",qo.READ_RECEIPT_RECEIVED="READ_RECEIPT_RECEIVED",qo.MESSAGE_RECEIPT_REQUEST="MESSAGE_RECEIPT_REQUEST",qo.MESSAGE_RECEIPT_RESPONSE="MESSAGE_RECEIPT_RESPONSE",qo.CONVERSATION="CONVERSATION",qo.CHATROOM="CHATROOM",qo.EXPANSION="EXPANSION",qo.PULL_OFFLINE_MESSAGE_FINISHED="PULL_OFFLINE_MESSAGE_FINISHED",qo.TAG="TAG",qo.CONVERSATION_TAG="CONVERSATION_TAG",qo.TYPING_STATUS="TYPING_STATUS",qo.MESSAGE_BLOCKED="MESSAGE_BLOCKED",qo.ULTRA_GROUP_ENABLE="ULTRA_GROUP_ENABLE",qo.OPERATE_STATUS="OPERATE_STATUS",qo.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED="ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED",qo.ULTRA_GROUP_MESSAGE_MODIFIED="ULTRA_GROUP_MESSAGE_MODIFIED",qo.ULTRA_GROUP_MESSAGE_RECALLED="ULTRA_GROUP_MESSAGE_RECALLED";var fs,gs=function(t){function n(e){var r=t.call(this)||this;if(n.imClient)return Bo.error("Please do not repeatedly perform the init method"),n.imClient;ot("options.navigators",e.navigators,(function(e){return Z(e)&&(0===e.length||e.every(oe))}));var o=null==e?void 0:e.connectType;return o?i.WEBSOCKET!==o&&i.COMET!==o&&(Bo.warn("RongIMLib connectionType must be ".concat(i.WEBSOCKET," or ").concat(i.COMET)),o=i.WEBSOCKET):o=i.WEBSOCKET,r._context=Vo.init(ds,{appkey:e.appkey,apiVersion:"5.3.0",navigators:e.navigators||[],miniCMPProxy:e.customCMP||[],connectionType:o,logLevel:e.logLevel,logStdout:e.logStdout,indexDBSwitch:e.indexDBSwitch,checkCA:e.checkCA}),r.watch(),n.imClient=r,r}return T(n,t),Object.defineProperty(n.prototype,"context",{get:function(){if(!this._context)throw new Error("Please perform the init method!");return this._context},enumerable:!1,configurable:!0}),n.prototype.watch=function(){var t=this,n={onConnecting:function(){t.emit(e.Events.CONNECTING)},onConnected:function(){t.emit(e.Events.CONNECTED)},onDisconnect:function(n){t.emit(e.Events.DISCONNECT,n)},onSuspend:function(n){t.emit(e.Events.SUSPEND,n)},batchMessage:function(n){t.emit(e.Events.MESSAGES,{messages:n.map((function(e){return ls(e)}))})},typingState:function(n){t.emit(e.Events.TYPING_STATUS,{status:n})},readReceiptReceived:function(n,r,i){t.emit(e.Events.READ_RECEIPT_RECEIVED,{conversation:n,messageUId:r,sentTime:i})},messageReceiptRequest:function(n,r,i){t.emit(e.Events.MESSAGE_RECEIPT_REQUEST,{conversation:n,messageUId:r,senderUserId:i})},messageReceiptResponse:function(n,r,i){t.emit(e.Events.MESSAGE_RECEIPT_RESPONSE,{conversation:n,receivedUserId:r,messageUIdList:i})},conversationState:function(n){var r=n.map((function(e){var t=e.conversationType;return t===Y.ULTRA_GROUP?{conversation:{conversationType:t,latestMessage:e.latestMessage?ls(e.latestMessage):null,targetId:e.targetId,unreadMessageCount:e.unreadMessageCount,unreadMentionedCount:e.unreadMentionedCount,versionTime:e.versionTime,notificationStatus:e.notificationStatus,notificationLevel:e.notificationLevel,lastUnreadTime:e.lastUnreadTime,channelId:e.channelId}}:{conversation:{conversationType:t,latestMessage:e.latestMessage?ls(e.latestMessage):null,targetId:e.targetId,unreadMessageCount:e.unreadMessageCount,hasMentioned:e.hasMentioned,mentionedInfo:e.mentionedInfo,lastUnreadTime:e.lastUnreadTime,notificationStatus:e.notificationStatus,notificationLevel:e.notificationLevel,isTop:e.isTop,channelId:e.channelId,unreadMentionedCount:e.unreadMentionedCount},updatedItems:e.updatedItems}}));t.emit(e.Events.CONVERSATION,{conversationList:r})},chatroomState:function(n){t.emit(e.Events.CHATROOM,n)},expansion:function(n){t.emit(e.Events.EXPANSION,n)},pullFinished:function(){t.emit(e.Events.PULL_OFFLINE_MESSAGE_FINISHED)},tag:function(){t.emit(e.Events.TAG)},conversationTagChanged:function(){t.emit(e.Events.CONVERSATION_TAG)},messageBlocked:function(n){t.emit(e.Events.MESSAGE_BLOCKED,n)},ultraGroupEnable:function(n){t.emit(e.Events.ULTRA_GROUP_ENABLE,n)},operateStatus:function(n){t.emit(e.Events.OPERATE_STATUS,n)},ultraGroupMessageExpansionUpdated:function(n){t.emit(e.Events.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED,n)},ultraGroupMessageModified:function(n){t.emit(e.Events.ULTRA_GROUP_MESSAGE_MODIFIED,n)},ultraGroupMessageRecalled:function(n){t.emit(e.Events.ULTRA_GROUP_MESSAGE_RECALLED,n)}};this.context.assignWatcher(n)},n}(pe),ps={TIMEOUT:{code:-1,msg:"Network timeout"},SDK_INTERNAL_ERROR:{code:-2,msg:"SDK internal error"},PARAMETER_ERROR:{code:-3,msg:"Please check the parameters, the {param} expected a value of {expect} but received {current}"},REJECTED_BY_BLACKLIST:{code:405,msg:"Blacklisted by the other party"},SEND_TOO_FAST:{code:20604,msg:"Sending messages too quickly"},NOT_IN_GROUP:{code:22406,msg:"Not in group"},FORBIDDEN_IN_GROUP:{code:22408,msg:"Forbbiden from speaking in the group"},NOT_IN_CHATROOM:{code:23406,msg:"Not in chatRoom"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:"Forbbiden from speaking in the chatRoom"},KICKED_FROM_CHATROOM:{code:23409,msg:"Kicked out and forbbiden from joining the chatRoom"},CHATROOM_NOT_EXIST:{code:23410,msg:"ChatRoom does not exist"},CHATROOM_IS_FULL:{code:23411,msg:"ChatRoom members exceeded"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:"Invalid chatRoom parameters"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:"ChatRoom message roaming service is not open, Please go to the developer to open this service"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:"Invalid recall message parameter"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:"Single group chat roaming service is not open, Please go to the developer to open this service"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:"Invalid push parameter"},OPERATION_BLOCKED:{code:20605,msg:"Operation is blocked"},OPERATION_NOT_SUPPORT:{code:20606,msg:"Operation is not supported"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:"The sent message contains sensitive words"},REPLACED_SENSITIVE_WORD:{code:21502,msg:"Sensitive words in the message have been replaced"},NOT_CONNECTED:{code:30001,msg:"Please connect successfully first"},NAVI_REQUEST_ERROR:{code:30007,msg:"Navigation http request failed"},CMP_REQUEST_ERROR:{code:30010,msg:"CMP sniff http request failed"},CONN_APPKEY_FAKE:{code:31002,msg:"Your appkey is fake"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:"Mini program service is not open, Please go to the developer to open this service"},CONN_ACK_TIMEOUT:{code:31e3,msg:"Connection ACK timeout"},CONN_TOKEN_INCORRECT:{code:31004,msg:"Your token is not valid or expired"},CONN_NOT_AUTHRORIZED:{code:31005,msg:"AppKey and Token do not match"},CONN_REDIRECTED:{code:31006,msg:"Connection redirection"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:"AppKey is banned or deleted"},CONN_USER_BLOCKED:{code:31009,msg:"User blocked"},CONN_DOMAIN_INCORRECT:{code:31012,msg:"Connect domain error, Please check the set security domain"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:"Roaming service cloud is not open, Please go to the developer to open this service"},RC_CONNECTION_EXIST:{code:34001,msg:"Connection already exists"},CHATROOM_KV_EXCEED:{code:23423,msg:"ChatRoom KV setting exceeds maximum"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:"ChatRoom KV already exists"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:"ChatRoom KV storage service is not open, Please go to the developer to open this service"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:"ChatRoom key does not exist"},MSG_KV_NOT_SUPPORT:{code:34008,msg:"The message cannot be extended"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:"Sending RC expansion message fail"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:"The message expansion size is beyond the limit"},ILLGAL_PARAMS:{code:33003,msg:"Incorrect parameters passed in while calling the interface"},UPLOAD_FILE_FAILED:{code:35020,msg:"File upload failed"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:"Chatroom kv store not all success"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:"Chatroom kv's length is out of limit"},TAG_EXISTS:{code:33101,msg:"The tag already exists"},TAG_NOT_EXIST:{code:33100,msg:"The tag does not exist"},NOT_SUPPORT:{code:ye.NOT_SUPPORT,msg:"The method is not supported in a browser!"}},ms={},vs={};for(var _s in ps){var ys=ps[_s],Es=ys.code;ms[Es]=_s,vs[Es]=ys}ps.ROAMING_SERVICE_UNAVAILABLE.code;var Ts=function(e,t){void 0===t&&(t=""),ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID);var n="conversationType:"+e.conversationType+",targetId:"+e.targetId;return Bo.debug("".concat(t," -> ").concat(n)),n},Is=function(e,t,n){return void 0===n&&(n=""),C(void 0,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return r=Ts(e,n),[4,t()];case 1:return(i=o.sent())!==ye.SUCCESS?(Bo.warn("".concat(n," fail -> ").concat(i," : ").concat(ms[i]," , ").concat(r)),[2,{code:i,msg:ms[i]}]):[2,{code:i}]}}))}))};var Cs=function(e){ot("options.key",e.key,Je.STRING,!0),ot("options.value",e.value,Je.STRING,!0),ot("options.isAutoDelete",e.isAutoDelete,Je.BOOLEAN),ot("options.isSendNotification",e.isSendNotification,Je.BOOLEAN),ot("options.notificationExtra",e.notificationExtra,Je.STRING)},Ss=function(e){ot("options.key",e.key,Je.STRING,!0),ot("options.isSendNotification",e.isSendNotification,Je.BOOLEAN),ot("options.notificationExtra",e.notificationExtra,Je.STRING)};var Rs=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0),this.messageType=e,this.content=t,this.isPersited=n,this.isCounted=r};function Ns(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);return function(r){return new Rs(e,r,t,n)}}var Os,Ms,Us=Ns("RC:ImgMsg"),ws=Ns("RC:HQVCMsg"),As=Ns("RC:SightMsg"),bs=Ns("RC:TxtMsg"),Ls=Ns("RC:CombineMsg"),Ps=Ns("RC:FileMsg"),Ds=Ns("RC:GIFMsg"),xs=Ns("RC:VcMsg"),Vs=Ns("RC:LBSMsg"),ks=Ns("RC:ReferenceMsg"),Bs=Ns("RC:ImgTextMsg"),Gs={qiniu:function(e,t,n,r){var i,o=Fs+t.uploadHost.qiniu;i=Ks()+js[0][1]||o,js.shift();var s=new XMLHttpRequest;s.upload&&t.support_options&&(s.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});s.onreadystatechange=function(){if(4===s.readyState){var i=JSON.parse(s.responseText||"{}");i.filename=t.uniqueValue,i.uploadMethod=be?be.QINIU:"",200===s.status?n.onCompleted(i):js.length?Gs[js[0][0]](e,t,n,r):n.onError("upload fail")}},t.isChunk&&(i=function(e,t){var n="";Hs(t,(function(e,t){"token"!==e&&(n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t))})),n&&(e+=(e.indexOf("?")>0?"&":"?")+n);return e}(i+="/mkblk/"+e.size,t.multi_parmas));s.open(t.method,i,!0),n.onOpen(s),t.stream&&s.setRequestHeader("authorization","UpToken "+t.multi_parmas.token);Hs(t.headers,(function(e,t){s.setRequestHeader(e,t)})),s.send(e)},baidu:function(e,t,n,r){if(r.size>qs)throw new Error("the file size is over 5GB!");var i=t||{};t=t||Ms;var o=new XMLHttpRequest,s=Ks();if(!i.uploadHost.bos&&!i.bosUploadPath)return;var a=s+js[0][1]+i.bosUploadPath;js.shift();var c=i.bosHeader||{},u={filename:t.uniqueValue||r.uniqueName,name:r.name,downloadUrl:a,isBosRes:!0};o.upload&&t.support_options&&(o.upload.onprogress=function(e){n.onProgress(e.loaded,e.total,!0)});o.onreadystatechange=function(){if(4===o.readyState)if(JSON.parse(o.responseText||"{}").filename=t.uniqueValue,200===o.status){n.onCompleted(u,!0)}else js.length?Gs[js[0][0]](e,t,n,r):n.onError("upload fail")},o.open(t.method,a,!0),o.setRequestHeader("authorization",c.bosToken),o.setRequestHeader("x-bce-date",c.bosDate),o.send(r)},aliyun:function(e,t,n,r){if(r.size>qs)throw new Error("the file size is over 5GB!");var i=new FormData;i.set("file",e.get("file")),i.set("key",e.get("key")),i.set("token",e.get("token"));var o=js[0][1];js.shift(),e=e||Os,t=(t=t||{})||Ms;var s=new XMLHttpRequest,a=Ks()+t.ossBucketName+"."+o;s.upload&&t.support_options&&(s.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});s.onreadystatechange=function(){if(4===s.readyState){var e=JSON.parse(s.responseText||"{}");e.name=t.uniqueValue,e.filename=t.uploadFileName,e.uploadMethod=be?be.ALI:"",200===s.status?n.onCompleted(e):js.length?Gs[js[0][0]](i,t,n,r):n.onError("upload fail")}},s.open(t.method,a,!0),console.log("ali:url",a);var c=t.aliHeader||{};e.set("OSSAccessKeyId",c.osskeyId),e.set("policy",c.ossPolicy),e.set("Signature",c.ossSign),e.set("success_action_status",200),e.delete("key"),e.append("key",t.uploadFileName),e.delete("file"),e.append("file",r),s.send(e)},s3:function(e,t,n,r){var i=new FormData,o=new XMLHttpRequest,s=Ks(),a=t.contentDisposition,c=js[0][1],u=s+t.s3BucketName+"."+c;console.log("uploadS3:url",u),js.shift(),o.upload&&t.support_options&&(o.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});o.onreadystatechange=function(){if(4===o.readyState){var i=JSON.parse(o.responseText||"{}");if(i.name=t.uniqueValue,i.filename=t.uploadFileName,i.uploadMethod=be.AWS,200===o.status||204===o.status)n.onCompleted(i);else if(js.length){var s=new FormData;s.set("file",e.get("file")),s.set("key",e.get("key")),s.set("token",e.get("token")),Gs[js[0][0]](s,t,n,r)}else n.onError("upload fail")}},o.open(t.method,u,!0);var d=t?t.s3Header:{},l=r&&r.type;a?i.set("Content-Disposition",a+";"):i.set("Content-Disposition","text/html"===l?"inline;":"attachment;");i.set("Content-Type",l),i.set("x-amz-credential",d.s3Credential),i.set("x-amz-algorithm",d.s3Algorithm),i.set("x-amz-date",d.s3Date),i.set("policy",d.s3Policy),i.set("x-amz-signature",d.s3Signature),i.set("key",t.uploadFileName),i.set("file",r),o.send(i)},stc:function(e,t,n,r){var i=new XMLHttpRequest,o=t.contentDisposition,s="https://"+js[0][1]+"/"+t.stcBucketName+"/"+t.uploadFileName;js.shift(),i.upload&&t.support_options&&(i.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});i.onreadystatechange=function(){if(4===i.readyState){var o=JSON.parse(i.responseText||"{}");if(o.name=t.uniqueValue,o.filename=t.uploadFileName,o.uploadMethod=be?be.STC:"",200===i.status||204===i.status)n.onCompleted(o);else if(js.length){var s=new FormData;s.set("file",e.get("file")),s.set("key",e.get("key")),s.set("token",e.get("token")),Gs[js[0][0]](s,t,n,r)}else n.onError("upload fail")}},i.open("PUT",s,!0);var a=t?t.stcHeader:{};i.setRequestHeader("Content-Type",r.type),o?i.setRequestHeader("Content-Disposition",o+";"):i.setRequestHeader("Content-Disposition","text/html"===r.type?"inline;":"attachment;");i.setRequestHeader("Authorization",a.stcAuthorization),i.setRequestHeader("x-amz-content-sha256",a.stcContentSha256),i.setRequestHeader("x-amz-date",a.stcDate),i.send(r)}},js=[],qs=5368709120,Fs="https://";function Hs(e,t){for(var n in e)t(n,e[n])}function Ks(){var e=Fs;return"http:"!==location.protocol&&"file:"!==location.protocol||(e="http://"),e}function Ys(e,t,n){var r,i,o=e&&e.type||"text/plain",s=o.indexOf("image")>-1?1:4,a=t.contentDisposition,c=Math.ceil(e.size/t.stc_chunk_size),u=t&&JSON.parse(t.ossConfig?t.ossConfig:"");Array.isArray(u)||(u=[]);var d=u.find((function(e){return Object.keys(e).includes("stc")})),l="uploads";gs.imClient.context.getFileToken(s,r,"POST",l).then((function(s){r=s.fileName,i="https://"+d.stc+"/"+t.stcBucketName+"/"+r,console.log("uploadStcMultipart:url",i);var u=new XMLHttpRequest;u.open("POST",i+"?"+l,!0),a?u.setRequestHeader("Content-Disposition",a+";"):u.setRequestHeader("Content-Disposition","text/html"===e.type?"inline;":"attachment;"),u.setRequestHeader("Authorization",s&&s.stcAuthorization),u.setRequestHeader("x-amz-content-sha256",s&&s.stcContentSha256),u.setRequestHeader("x-amz-date",s&&s.stcDate),u.setRequestHeader("Content-Type",o),u.send(),u.onreadystatechange=function(){if(4===u.readyState){var e=u.response.match(/(?:<UploadId>)(\S*?)(?:<\/UploadId>)/);console.log("uploadId",e),200===u.status||204===u.status?function(e){for(var t=[],n=1;n<=c;n++)t.push(p(e,n));g(e,t)}(Array.isArray(e)&&e[1]):n.onError("uploadStcMultipart:did not get uploadId")}}}),(function(e){n.onError("uploadStcMultipart:"+e)}));var h=[],f=new Map;function g(a,u){u&&Array.isArray(u)&&0!==u.length&&Promise.all(u).then((function(){var u="uploadId="+a;if(f.size===c)gs.imClient.context.getFileToken(s,r,"POST",u).then((function(r){console.log("onSuccess",r),console.log("onSuccess:uploadId",a);var s=new XMLHttpRequest;s.open("POST",i+"?"+u,!0),s.setRequestHeader("Authorization",r&&r.stcAuthorization),s.setRequestHeader("x-amz-content-sha256",r&&r.stcContentSha256),s.setRequestHeader("x-amz-date",r&&r.stcDate),s.setRequestHeader("Content-Type",o);var c="<CompleteMultipartUpload xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>",d=Array.from(f.keys()||[]).sort((function(e,t){return e-t}));console.log("keys",d),d.forEach((function(e){c+="<Part><ETag>".concat(f.get(e),"</ETag><PartNumber>").concat(e,"</PartNumber></Part>")})),c+="</CompleteMultipartUpload>",s.send(c),console.log("xml",c),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||204===s.status){var r={name:e.name,filename:t.uploadFileName,uploadMethod:be.STC};n.onCompleted(r)}else n.onError("uploadStcMultipart:upload does not end")}}),(function(e){n.onError("uploadStcMultipart:"+e)}));else{for(var d=[],l=0,m=h;l<m.length;l++){var v=m[l];d.push(p(a,v))}g(a,d)}}),(function(e){console.error(e),n.onError("uploadStcMultipart: chunkFiles upload failed and those will reupload");for(var t=[],r=0,i=h;r<i.length;r++){var o=i[r];t.push(p(a,o))}g(a,t)}))}function p(n,a){return new Promise((function(c,u){var d="partNumber="+a+"&uploadId="+n;gs.imClient.context.getFileToken(s,r,"PUT",d).then((function(n){console.log("signature "+a+" onSuccess",n);var r=e&&e.slice((a-1)*t.stc_chunk_size,a*t.stc_chunk_size);console.log("fileChunk:size",r.size);var s=new XMLHttpRequest;s.open("PUT",i+"?"+d,!0),s.setRequestHeader("Authorization",n&&n.stcAuthorization),s.setRequestHeader("x-amz-content-sha256",n&&n.stcContentSha256),s.setRequestHeader("x-amz-date",n&&n.stcDate),s.setRequestHeader("Content-Type",o),s.send(r),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||204===s.status){var e=s.getResponseHeader("etag");console.log("etag:"+a,e),f.set(a,e),c(e)}else h.includes(a)||h.push(a),u(a)}}),(function(e){console.log("getETags:签名验证失败"),h.includes(a)||h.push(a),u(a)}))}))}}var Qs={form:function(e,t){var n=new FormData;if(t.unique_key){var r=e.name.substr(e.name.lastIndexOf(".")),i=Ws()+r;n.append(t.unique_key,i),t.uniqueValue=i}return n.append(t.file_data_name,e),Js(t.multi_parmas,(function(e,t){n.append(e,t)})),n},json:function(e,t){var n={};if(t.unique_key){var r=e.name.substr(e.name.lastIndexOf(".")),i=Ws()+r;n[t.unique_key]=i,t.uniqueValue=i}return n[t.file_data_name]=e,Js(t.multi_parmas,(function(e,t){n[e]=t})),JSON.stringify(n)},data:function(e,t){return e}};function Ws(){var e=(new Date).getTime(),t="xxxxxx4xxxyxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}));return t}function Js(e,t){for(var n in e)t(n,e[n])}var zs,Xs=0,Zs=function(){function e(e){this.options=function(e){var t={domain:"",method:"POST",file_data_name:"file",unique_key:"key",base64_size:4194304,chunk_size:4194304,bos_chunk_size:4294967296,stc_chunk_size:10485760,headers:{},multi_parmas:{},query:{},support_options:!0,data:Qs.form,genUId:Ws};if(!e||!e.domain)throw new Error("domain is null");for(var n in e)t[n]=e[n];return t}(e)}return e.prototype.setOptions=function(e){var t=this;Js(e,(function(e,n){t.options[e]=n}))},e.prototype.upload=function(e,t){if(e){var n=this;!function(e,t,n){if(Os=e,Ms=t,js=[],t.ossConfig){var r,i,o=JSON.parse(t.ossConfig),s="",a=[];o.forEach((function(e){var t=Number(e.p)-1;for(var n in e)"aliyun"===n&&(s=e[n]),"s3"===n&&(r=e[n]),"stc"===n&&(i=e[n]),"p"!==n&&(a[t]=[n,e[n]])})),a.forEach((function(e){e&&js.push(e)})),o.length!==js.length&&(js=[["qiniu",t.domain],["baidu",t.uploadHost.bos],["aliyun",s],["s3",r],["stc",i]])}else js=[["qiniu",t.domain],["baidu",t.uploadHost.bos]];var c;if(t.ossConfig){var u=t&&JSON.parse(t.ossConfig);Array.isArray(u)||(u=[]),c=u.find((function(e){return Object.keys(e).includes("stc")}))}if(c&&1===parseInt(c.p)&&e.size>=4194304)Ys(e,t,n);else{var d=t.data(e,t);Gs[js[0][0]](d,t,n,e)}}(e,this.options,{onProgress:function(e,n,r){(zs=e,r)?zs=Xs+e/n*(n-Xs):Xs=zs;t.onProgress(zs,n)},onCompleted:function(e){t.onCompleted(e)},onError:function(e){t.onError(e)},onOpen:function(e){n.xhr=e}})}else t.onError("upload file is null.")},e.prototype.cancel=function(){this.xhr&&this.xhr.abort()},e}();var $s,ea,ta={init:function(e){return new Zs(e)},dataType:Qs,resize:function(e,t,n){e.type;var r=document.createElement("canvas"),i=new FileReader;i.readAsDataURL(e),i.onload=function(e){var i=e.target.result,o=new Image;o.src=i;var s=o.width,a=o.height,c=function(e,t){var n=1,r=e.width,i=t.maxWidth||0;i>0&&r>i&&(n=i/r);var o=e.height,s=t.maxHeight||0;if(s>0&&o>s){var a=s/o;n=Math.min(n,a)}var c=t.maxSize||0,u=Math.ceil(e.size/1e3);if(u>c){var d=c/u;n=Math.min(n,d)}return n}({width:s,height:a,size:e.total},t),u=i;c<1&&(u=function(e,t,n){return r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),r.toDataURL("image/jpg")}(o,s*c,a*c)),n(u)}}},na=function(e,t,n){var r=document.createElement("canvas"),i=r.getContext("2d"),o=new Image,s="string"==typeof e;o.onload=function(s){var a=function(e,t,n){var r,i,o,s=e<t,a=0,c=0;return(s?t/e:e/t)>n.scale?(s?(i=100,c=((o=t/(r=e/100))-n.maxHeight)/2):(o=100,a=((i=e/(r=t/100))-n.maxWidth)/2),{w:i,h:o,x:-a,y:-c}):(s?(r=t/n.maxHeight,o=n.maxHeight,i=e/r):(r=e/n.maxWidth,i=n.maxWidth,o=t/r),{w:i,h:o,x:-a,y:-c})}(o.width,o.height,t);r.width=a.w>t.maxWidth?t.maxWidth:a.w,r.height=a.h>t.maxHeight?t.maxHeight:a.h,i.drawImage(o,a.x,a.y,a.w,a.h);var c=r.toDataURL("string"==typeof e?"image/jpg":e.type,t.quality);c=c.replace(/data:image\/[^;]+;base64,/,""),n(c)},o.src=s?"data:image/jpg;base64,"+e:function(e){var t=window.URL||window.webkitURL;return t?t.createObjectURL(e):""}(e)},ra=function(e,t){var n=e.file,r=e.compress;na(n,r,t)},ia=function(e,t){if(e.getToken)e.getToken((function(n,r){r=r||{},e.multi_parmas||(e.multi_parmas={}),e.multi_parmas.token=n,e.uploadHost||(e.uploadHost={}),e.uploadHost.bos=r.bos,e.ossConfig=r.ossConfig,e.bosHeader||(e.bosHeader={}),e.bosHeader.bosDate=r.bosDate,e.bosHeader.bosToken=r.bosToken,e.bosUploadPath=r.path,e.aliHeader={},e.aliHeader.osskeyId=r.osskeyId,e.aliHeader.ossPolicy=r.ossPolicy,e.aliHeader.ossSign=r.ossSign,e.ossBucketName=r.ossBucketName,e.uploadFileName=r.fileName,e.s3Header={},e.s3Header.s3Credential=r.s3Credential,e.s3Header.s3Algorithm=r.s3Algorithm,e.s3Header.s3Date=r.s3Date,e.s3Header.s3Policy=r.s3Policy,e.s3Header.s3Signature=r.s3Signature,e.s3BucketName=r.s3BucketName,e.stcHeader={},e.stcHeader.stcAuthorization=r.stcAuthorization,e.stcHeader.stcContentSha256=r.stcContentSha256,e.stcHeader.stcDate=r.stcDate,e.stcBucketName=r.stcBucketName,e.headers||(e.headers={}),e.base64&&(e.headers["Content-type"]="application/octet-stream",e.headers.Authorization="UpToken "+n),console.log("data",r);var i=ta.init(e);t(i)}));else{e.headers||(e.headers={}),e.base64&&(e.headers["Content-type"]="application/octet-stream");var n=ta.init(e);t(n)}},oa=function(e,t,n){t.upload(e.file,{onError:function(e){n.onError(e)},onProgress:function(e,t){n.onProgress(e,t)},onCompleted:function(t){t.filename||(t.filename=t.hash);var r=e.compressThumbnail||ra;e.compress?r(e,(function(e){t.thumbnail=e,n.onCompleted(t)})):n.onCompleted(t)}})},sa=function(){function e(e){this.instance=e}return e.prototype.upload=function(e,t){oa({file:e},this.instance,t)},e.prototype.cancel=function(){this.instance.cancel()},e}(),aa=function(){function e(e,t){this.instance=e,this.cfg=t}return e.prototype.upload=function(e,t){var n={file:e,compress:this.cfg};oa(n,this.instance,t)},e.prototype.cancel=function(){this.instance.cancel()},e}(),ca=function(e,t){ia(e,(function(n){var r,i,o,s,a={maxHeight:(null===(r=e.thumbnailConfig)||void 0===r?void 0:r.maxHeight)||160,maxWidth:(null===(i=e.thumbnailConfig)||void 0===i?void 0:i.maxWidth)||160,quality:(null===(o=e.thumbnailConfig)||void 0===o?void 0:o.quality)||.5,scale:(null===(s=e.thumbnailConfig)||void 0===s?void 0:s.scale)||2.4},c=new aa(n,a);t(c)}))},ua=function(e,t){ia(e,(function(e){var n=new sa(e);t(n)}))},da=ca;ta.dataType;function la(e){return $s=$s||new AudioContext,new Promise((function(t,n){$s.decodeAudioData(e,(function(e){t({duration:e.duration,length:e.length})}),n)}))}function ha(e,t,n,r,i){return ot("fileType",e,ce,!0),ot("filename",t,Je.STRING),ot("saveName",n,Je.STRING),ot("serverType",i,Je.NUMBER),new Promise((function(o){gs.imClient.context.getFileUrl(e,t,n,r,i).then((function(e){o({code:ye.SUCCESS,data:e})})).catch((function(e){o({code:e})}))}))}function fa(e,t,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c,u,d,l,h,f;return S(this,(function(g){switch(g.label){case 0:return r=r||{},t instanceof Rs==!1?(Bo.warn("send message fail -> message parameter is not an instance of BaseMessage"),[2,ps.ILLGAL_PARAMS]):(ot("conversation",e,Je.OBJECT,!0),i=e.conversationType,o=e.targetId,s=e.channelId,ot("conversation.targetId",o,Je.STRING,!0),ot("conversation.conversationType",i,Je.NUMBER),ot("conversation.channelId",s,Je.CHANNEL_ID),ot("options.isStatusMessage",null==r?void 0:r.isStatusMessage,Je.BOOLEAN),ot("options.disableNotification",null==r?void 0:r.disableNotification,Je.BOOLEAN),ot("options.pushContent",null==r?void 0:r.pushContent,Je.STRING),ot("options.pushData",null==r?void 0:r.pushData,Je.STRING),ot("options.isMentioned",null==r?void 0:r.isMentioned,Je.BOOLEAN),ot("options.mentionedType",null==r?void 0:r.mentionedType,Je.NUMBER),ot("options.mentionedUserIdList",null==r?void 0:r.mentionedUserIdList,Je.ARRAY),ot("options.directionalUserIdList",null==r?void 0:r.directionalUserIdList,Je.ARRAY),ot("options.isVoipPush",null==r?void 0:r.isVoipPush,Je.BOOLEAN),ot("options.canIncludeExpansion",null==r?void 0:r.canIncludeExpansion,Je.BOOLEAN),ot("options.expansion",null==r?void 0:r.expansion,Je.OBJECT),ot("options.pushConfig",null==r?void 0:r.pushConfig,Je.OBJECT),a="conversationType:"+i+",targetId:"+o,Bo.debug("send message  ->"+a),(c=Object.assign(r,t)).channelId=s||"",[4,gs.imClient.context.sendMessage(i,o,c)]);case 1:return u=g.sent(),d=u.code,l=u.data,d===ye.SUCCESS?(h=ls(l),[2,{code:d,data:h}]):(Bo.warn("send message fail ->"+d+":"+ms[d]+","+a),f={isMentioned:!!r.isMentioned,content:t.content,messageType:t.messageType,isPersited:t.isPersited||!1,isCounted:t.isCounted||!1,disableNotification:!!(null==r?void 0:r.disableNotification),canIncludeExpansion:!!(null==r?void 0:r.canIncludeExpansion),expansion:(null==r?void 0:r.expansion)||null,conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId,senderUserId:gs.imClient.context.getCurrentUserId(),messageUId:"",messageDirection:ve.SEND,sentTime:(null==l?void 0:l.sentTime)||0,receivedTime:0,isStatusMessage:r.isStatusMessage||!1,receivedStatus:n.UNREAD,isOffLineMessage:!1},i!==Y.ULTRA_GROUP&&(f.isOffLineMessage=!1),[2,{code:d,msg:ms[d],data:ls(f)}])}}))}))}function ga(e,t){return function(n,r,i,o){ot("sendOptions.contentDisposition",null==o?void 0:o.contentDisposition,(function(e){return["inline","attachment"].includes(e)}));var s={contentDisposition:null==o?void 0:o.contentDisposition};if(o&&"thumbnailConfig"in o){var a=null==o?void 0:o.thumbnailConfig;ot("sendOptions.maxHeight",null==a?void 0:a.maxHeight,Je.NUMBER),ot("sendOptions.maxWidth",null==a?void 0:a.maxWidth,Je.NUMBER),ot("sendOptions.quality",null==a?void 0:a.quality,Je.NUMBER),ot("sendOptions.scale",null==a?void 0:a.scale,Je.NUMBER),s.thumbnailConfig=a}return new Promise((function(a){!function(e,t,n,r){var i,o=this;if(void 0===t&&(t=W.FILE),i=t===W.IMAGE?W.IMAGE:W.FILE,!ea){ea="upload.qiniup.com";var s=gs.imClient.context.getInfoFromCache();if(s&&s.ossConfig)try{var a=JSON.parse(s.ossConfig).find((function(e){return void 0!==e.qiniu}));a&&(ea=a.qiniu)}catch(e){}}var c=I({domain:ea,getToken:function(e){gs.imClient.context.getFileToken(i).then((function(t){e(t.token,t)})).catch((function(e){n.onFail(e)}))}},r);(i===W.IMAGE?da:ua)(c,(function(r){r.upload(e,{onProgress:function(e,t){var r,i=Math.floor(e/t*100);null===(r=n.onProgress)||void 0===r||r.call(n,i)},onCompleted:function(r){return C(o,void 0,void 0,(function(){var o=this;return S(this,(function(s){return ha(i,r.filename,r.name,r,r.uploadMethod).then((function(s){return C(o,void 0,void 0,(function(){var o,a;return S(this,(function(c){return 0!==s.code?(n.onFail(s),[2]):((o=s.data).type=e.type,o.name=r.name||r.filename,t===W.AUDIO?("function"==typeof e.arrayBuffer?e.arrayBuffer().then(la).then((function(e){Object.assign(o,e),n.onSuccess(o)}),(function(){n.onSuccess(o)})):((a=new FileReader).onload=function(){a.result?la(a.result).then((function(e){Object.assign(o,e),n.onSuccess(o)}),(function(){n.onSuccess(o)})):n.onSuccess(o)},a.onerror=function(){o.duration=0,n.onSuccess(o)},a.readAsArrayBuffer(e)),[2]):(i===W.IMAGE&&(o.thumbnail=r.thumbnail),n.onSuccess(o),[2]))}))}))})).catch((function(e){n.onFail(e)})),[2]}))}))},onError:function(e){n.onFail(e)}})}))}(r.file,e,{onProgress:null==i?void 0:i.onProgress,onSuccess:function(e){var s,c=(null===(s=null==i?void 0:i.onComplete)||void 0===s?void 0:s.call(i,{url:e.downloadUrl}))||t(e,r);fa(n,c,o).then(a)},onFail:function(e){a({code:ye.UPLOAD_FILE_FAILED,msg:e||ye[ye.UPLOAD_FILE_FAILED]})}},s)}))}}var pa=ga(W.FILE,(function(e,t){return new Ps({name:e.name,size:t.file.size,type:t.file.type,fileUrl:e.downloadUrl,user:t.user,extra:t.extra})})),ma=ga(W.IMAGE,(function(e,t){return new Us({content:e.thumbnail,imageUri:e.downloadUrl,user:t.user,extra:t.extra})})),va=ga(W.AUDIO,(function(e,t){return new ws({remoteUrl:e.downloadUrl,duration:e.duration,type:e.type,user:t.user,extra:t.extra})})),_a=ga(W.SIGHT,(function(e,t){return new As({sightUrl:e.downloadUrl,content:t.thumbnail,duration:t.duration,size:t.file.size||e.size,name:t.name||e.name,user:t.user,extra:t.extra})}));ga(W.COMBINE_HTML,(function(e,t){return new Ls({remoteUrl:e.downloadUrl,nameList:t.nameList,summaryList:t.summaryList,conversationType:t.conversationType,user:t.user,extra:t.extra})}));ze.add("imlib-next","5.3.0"),e.BaseMessage=Rs,e.CombineMessage=Ls,e.ConnectType={COMET:"comet",WEBSOCKET:"websocket"},e.ConnectionStatus=Te,e.ConversationType=Y,e.ErrorCode=ye,e.FileMessage=Ps,e.GIFMessage=Ds,e.HQVoiceMessage=ws,e.ImageMessage=Us,e.LocationMessage=Vs,e.MentionedType=we,e.MessageBlockType=ke,e.MessageDirection=ve,e.MessageType={TEXT:"RC:TxtMsg",VOICE:"RC:VcMsg",HQ_VOICE:"RC:HQVCMsg",IMAGE:"RC:ImgMsg",GIF:"RC:GIFMsg",RICH_CONTENT:"RC:ImgTextMsg",LOCATION:"RC:LBSMsg",FILE:"RC:FileMsg",SIGHT:"RC:SightMsg",COMBINE:"RC:CombineMsg",CHRM_KV_NOTIFY:"RC:chrmKVNotiMsg",LOG_COMMAND:"RC:LogCmdMsg",EXPANSION_NOTIFY:"RC:MsgExMsg",REFERENCE:"RC:ReferenceMsg",RECALL_MESSAGE_TYPE:"RC:RcCmd"},e.NotificationLevel=Me,e.NotificationStatus=Ne,e.ReceivedStatus=n,e.ReferenceMessage=ks,e.RichContentMessage=Bs,e.SightMessage=As,e.TextMessage=bs,e.UploadMethod=be,e.VoiceMessage=xs,e.__addSDKVersion=function(e,t){ze.add(e,t)},e.addConversationsToTag=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("conversations",t,Je.ARRAY,!0),t.forEach((function(e){ot("conversation.conversationType",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("conversation.channelId",e.channelId,Je.CHANNEL_ID)})),Bo.info("addTagForConversations ->tagId:"+e),[4,gs.imClient.context.addTagForConversations(e,t)];case 1:return(n=r.sent().code)===ye.SUCCESS?[2,{code:n}]:(Bo.warn("addTagForConversations ->code:"+n+",tagId:"+e),[2,{code:n,msg:ms[n]}])}}))}))},e.addEventListener=function(e,t,n){fs.on(e,t,n)},e.addTag=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return ot("tag.tagId",e.tagId,Je.STRING,!0),ot("tag.tagId",e.tagId,(function(e){return e.length<=10})),ot("tag.tagName",e.tagName,(function(e){return e.length<=15})),ot("tag.tagName",e.tagName,Je.STRING,!0),Bo.info("createTag ->tagId:"+e.tagId+",tagName:"+e.tagName),[4,gs.imClient.context.createTag(e)];case 1:return(t=n.sent().code)===ye.SUCCESS?[2,{code:t}]:(Bo.warn("createTag ->code:"+t+",tagId:"+e.tagId),[2,{code:t,msg:ms[t]}])}}))}))},e.bindRTCRoomForChatroom=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,gs.imClient.context.bindRTCRoomForChatroom(e)];case 1:return[2,{code:t=n.sent(),msg:ms[t]}]}}))}))},e.clearAllMessagesUnreadStatus=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,gs.imClient.context.clearAllUnreadCount()];case 1:return[2,{code:e.sent()}]}}))}))},e.clearEventListeners=function(){fs.clear()},e.clearHistoryMessages=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.timestamp",t,Je.NUMBER,!0),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("clear message ->"+n),[4,gs.imClient.context.deleteRemoteMessageByTimestamp(e.conversationType,e.targetId,t,e.channelId)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("clear message ->"+r+":"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:ye.SUCCESS}]}}))}))},e.clearMessages=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return _t()?(Bo.info("clearMessages ->targetId:"+e.targetId+",conversationType:"+e.conversationType),[4,gs.imClient.context.clearMessages(e.conversationType,e.targetId,e.channelId)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return(t=n.sent())===ye.SUCCESS?[2,{code:t}]:(Bo.warn("clearMessages ->code:"+t+",targetId:"+e.targetId),[2,{code:t,msg:ms[t]}])}}))}))},e.clearMessagesUnreadStatus=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.clearUnreadCount(e.conversationType,e.targetId,e.channelId)];case 1:return t=r.sent(),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("clear unreadMsgNum ->"+n),t!==ye.SUCCESS?(Bo.warn("clear unreadMsgNum fail ->"+t+":"+ms[t]+","+n),[2,{code:t,msg:ms[t]}]):[2,{code:t}]}}))}))},e.clearTextMessageDraft=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),t="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("delete draft  ->"+t),[4,gs.imClient.context.clearConversationMessageDraft(e.conversationType,e.targetId,e.channelId)];case 1:return(n=r.sent())===ye.SUCCESS?[2,{code:n}]:(Bo.warn("delete draft fail ->"+n+":"+ms[n]+","+t),[2,{code:n,msg:ms[n]}])}}))}))},e.clearUnreadCountByTimestamp=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return _t()?(Bo.info("clearUnreadCountByTimestamp ->targetId:"+e.targetId+",conversationType:"+e.conversationType),[4,gs.imClient.context.clearUnreadCountByTimestamp(e.conversationType,e.targetId,t,e.channelId)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return(n=r.sent())===ye.SUCCESS?[2,{code:n}]:(Bo.warn("clearUnreadCountByTimestamp ->code:"+n+",targetId:"+e.targetId),[2,{code:n,msg:ms[n]}])}}))}))},e.connect=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return ot("token",e,Je.STRING,!0),Bo.warn("RongIMLib Version: ".concat("5.3.0",", Commit: ").concat("aff769db9320955c717db9d318fbee662473dbcb")),[4,fs.context.connect(e,!1,t)];case 1:return(n=r.sent()).code===ye.SUCCESS?[2,{code:n.code,data:{userId:n.userId}}]:[2,{code:n.code,msg:ms[n.code]}]}}))}))},e.deleteLocalMessagesByTimestamp=function(e,t,n){return C(this,void 0,void 0,(function(){var r;return S(this,(function(i){switch(i.label){case 0:return _t()?(ot("conversationType",e.conversationType,Je.NUMBER,!0),ot("targetId",e.targetId,Je.STRING,!0),ot("timestamp",t,Je.NUMBER,!0),ot("cleanSpace",n,Je.BOOLEAN),[4,gs.imClient.context.deleteMessagesByTimestamp(e.conversationType,e.targetId,t,n,e.channelId)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return(r=i.sent())===ye.SUCCESS?[2,{code:r}]:(Bo.warn("deleteLocalMessagesByTimestamp ->code:"+r+",targetId:"+e.targetId),[2,{code:r,msg:ms[r]}])}}))}))},e.deleteMessages=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options",t,(function(e){return Z(e)&&e.length}),!0),t.forEach((function(e){ot("options.messageUId",e.messageUId,Je.STRING,!0),ot("options.sentTime",e.sentTime,Je.NUMBER,!0),ot("options.messageDirection",e.messageDirection,(function(e){return 1===e||2===e}),!0)})),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("delete messages ->"+n),[4,gs.imClient.context.deleteRemoteMessage(e.conversationType,e.targetId,t,e.channelId)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("delete message fail ->"+r+":"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:ye.SUCCESS}]}}))}))},e.disconnect=function(){return fs.context.disconnect()},e.forceRemoveChatRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("targetId",e,Je.STRING,!0),Ss(t),n="id:"+e,Bo.debug("force remove chatroom entry ->"+n),[4,gs.imClient.context.forceRemoveChatroomEntry(e,t)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("force remove chatroom entry fail ->code+:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.forceSetChatRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("targetId",e,Je.STRING,!0),Cs(t),n="id:"+e,Bo.debug("force set chatroom entry ->"+n),[4,gs.imClient.context.forceSetChatroomEntry(e,t)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("force set chatroom entry fail ->code+:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.getAllChatRoomEntries=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return t="id:"+e,Bo.debug("get all chatroom entries->"+t),[4,gs.imClient.context.getAllChatroomEntries(e)];case 1:return n=o.sent(),r=n.code,i=n.data,r===ye.SUCCESS&&i?[2,{code:r,data:i}]:(Bo.warn("get all chatroom entries fail ->code+:"+ms[r]+","+t),[2,{code:r,msg:ms[r]}])}}))}))},e.getAllConversationState=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return[2,gs.imClient.context.getAllConversationState()]}))}))},e.getAllUltraGroupUnreadCount=function(){return C(this,void 0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e="getAllUltraGroupUnreadCount",[4,gs.imClient.context.getAllUltraGroupUnreadCount()];case 1:return t=i.sent(),n=t.code,r=t.data,Bo.debug(e),n===ye.SUCCESS?[2,{code:n,data:r}]:(Bo.warn("".concat(e," fail ->").concat(n,": ").concat(ms[n])),[2,{code:n,msg:ms[n]}])}}))}))},e.getAllUltraGroupUnreadMentionedCount=function(){return C(this,void 0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e="getAllUltraGroupUnreadMentionedCount",!0,[4,gs.imClient.context.getAllUltraGroupUnreadCount(true)];case 1:return t=i.sent(),n=t.code,r=t.data,Bo.debug(e),n===ye.SUCCESS?[2,{code:n,data:r}]:(Bo.warn("".concat(e," fail ->").concat(n,": ").concat(ms[n])),[2,{code:n,msg:ms[n]}])}}))}))},e.getAllUnreadMentionedCount=function(){return C(this,void 0,void 0,(function(){return S(this,(function(e){return Bo.debug("getAllUnreadMentionedCount"),[2,gs.imClient.context.getAllUnreadMentionedCount()]}))}))},e.getBlockUltraGroupList=function(){return C(this,void 0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,gs.imClient.context.getBlockUltraGroupList()];case 1:return e=r.sent(),t=e.code,n=e.data,t===ye.SUCCESS?[2,{code:ye.SUCCESS,data:n}]:(Bo.warn("get block ultragroup  ->"+t+":"+ms[t]),[2,{code:t,msg:ms[t]}])}}))}))},e.getBlockedConversationList=function(){return C(this,void 0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,gs.imClient.context.getBlockConversationList()];case 1:return e=r.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))},e.getChatRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("key",t,(function(e){return J(e)&&/[\w+=-]+/.test(e)&&e.length<=128}),!0),n="id:"+e,Bo.debug("get chatroom entry->"+n),[4,gs.imClient.context.getChatroomEntry(e,t)];case 1:return r=s.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?[2,{code:i,data:o}]:(Bo.warn("get chatroom entry fail ->code+:"+ms[i]+","+n),[2,{code:i,msg:ms[i]}])}}))}))},e.getChatRoomInfo=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("options.count",t.count,Je.NUMBER),ot("options.order",t.order,(function(e){return[0,1,2].includes(e)})),n="id:"+e,Bo.debug("get chatroom info ->"+n),[4,gs.imClient.context.getChatroomInfo(e,t.count,t.order)];case 1:return r=s.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?[2,{code:i,data:o}]:(Bo.warn("get chatroom info fail ->code+:"+ms[i]+","+n),[2,{code:i,msg:ms[i]}])}}))}))},e.getChatroomHistoryMessages=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("options.timestamp",t.timestamp,Je.NUMBER),ot("options.count",t.count,Je.NUMBER),ot("options.order",t.order,(function(e){return 0===e||1===e})),n="id:"+e,Bo.debug("get chatroom history message->"+n),[4,gs.imClient.context.getChatRoomHistoryMessages(e,t.count,t.order,t.timestamp)];case 1:return r=a.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?(s=o.list.map((function(e){return ls(e)})),[2,{code:i,data:{list:s,hasMore:!!o.hasMore}}]):(Bo.warn("get chatroom history message fail ->code+:"+ms[i]+","+n),[2,{code:i,msg:ms[i]}])}}))}))},e.getConnectionStatus=function(){return fs.context.getConnectionStatus()},e.getConversation=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.getConversation(e.conversationType,e.targetId,e.channelId||"")];case 1:return t=i.sent(),n=t.code,r=t.data,n!==ye.SUCCESS?(Bo.warn("getConversation ->code:"+n+", targetId:"+e.targetId),[2,{code:n,msg:ms[n]}]):[2,{code:n,data:r?hs(r):null}]}}))}))},e.getConversationList=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i;return S(this,(function(o){switch(o.label){case 0:return Bo.debug("get conversation list ->"),[4,gs.imClient.context.getConversationList(null==e?void 0:e.count,void 0,null==e?void 0:e.startTime,null==e?void 0:e.order,t)];case 1:return n=o.sent(),r=n.code,i=n.data,r===ye.SUCCESS&&i?[2,{code:0,data:i.map((function(e){return hs(e)}))}]:(Bo.warn("get conversation list fail ->"+r+":"+ms[r]),[2,{code:r,msg:ms[r]}])}}))}))},e.getConversationNotificationLevel=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return t=Ts(e,"getConversationNotificationLevel"),[4,gs.imClient.context.getConversationNotificationLevel(e.conversationType,e.targetId,e.channelId)];case 1:return n=o.sent(),r=n.code,i=n.data,r===ye.SUCCESS?[2,{code:r,data:i}]:(Bo.warn("getConversationNotificationLevel fail -> ".concat(r," : ").concat(ms[r]," , ").concat(t)),[2,{code:r,msg:ms[r]}])}}))}))},e.getConversationNotificationStatus=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),Bo.info("getConversationNotificationStatus ->targetId:"+e.targetId+",conversationType:"+e.conversationType),[4,gs.imClient.context.getConversationNotificationStatus(e.conversationType,e.targetId,e.channelId)];case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?[2,{code:n,data:r}]:(Bo.warn("getConversationNotificationStatus ->code:"+n+",targetId:"+e.targetId),[2,{code:n,msg:ms[n]}])}}))}))},e.getConversationsFromTagByPage=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("count",t,Je.NUMBER,!0),ot("startTime",n,Je.NUMBER,!0),Bo.info("getConversationListByTag ->tagId:"+e),[4,gs.imClient.context.getConversationListByTag(e,n,t)];case 1:return r=s.sent(),i=r.code,o=r.data,i===ye.SUCCESS?[2,{code:i,data:o}]:(Bo.warn("getConversationListByTag ->code:"+i+",tagId:"+e),[2,{code:i,msg:ms[i]}])}}))}))},e.getCurrentUserId=function(){return fs.context.getCurrentUserId()},e.getFileToken=function(e,t,n,r){return new Promise((function(i){gs.imClient.context.getFileToken(e,t,n,r).then((function(e){i({code:ye.SUCCESS,data:e})})).catch((function(e){i({code:e,msg:ms[e]})}))}))},e.getFileUrl=ha,e.getFirstUnreadMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return _t()?(ot("conversation.conversationType",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.getFirstUnreadMessage(e.conversationType,e.targetId,e.channelId)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?[2,{code:n,data:r}]:(Bo.warn("insertMessage ->code:"+n+",targetId:"+e.targetId),[2,{code:n,msg:ms[n]}])}}))}))},e.getHistoryMessages=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("options.timestamp",null==t?void 0:t.timestamp,Je.NUMBER),ot("options.count",null==t?void 0:t.count,Je.NUMBER),ot("options.order",null==t?void 0:t.order,(function(e){return 0===e||1===e})),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("get history message ->"+n),[4,gs.imClient.context.getHistoryMessage(e.conversationType,e.targetId,null==t?void 0:t.timestamp,null==t?void 0:t.count,null==t?void 0:t.order,null==e?void 0:e.channelId)];case 1:return r=a.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?(s=o.list.map((function(e){return ls(e)})),[2,{code:i,data:{list:s,hasMore:o.hasMore}}]):(Bo.warn("get history message fail ->"+i+":"+ms[i]+","+n),[2,{code:i,msg:ms[i]}])}}))}))},e.getMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return _t()?[4,gs.imClient.context.getMessage(e)]:[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?[2,{code:n,data:ls(r)}]:(Bo.warn("getMessage ->code:"+n+",messageId:"+e),[2,{code:n,msg:ms[n]}])}}))}))},e.getMessageReader=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("messageUId",t,Je.STRING,!0),r="messageUId:"+t+",targetId:"+e,Bo.debug("get message reader ->"+r),[4,gs.imClient.context.getMessageReader(e,t,n)];case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS?[2,{code:o,data:s}]:(Bo.warn("get message reader fail ->"+o+":"+ms[o]+","+r),[2,{code:o,msg:ms[o]}])}}))}))},e.getRemoteHistoryMessages=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("options.timestamp",null==t?void 0:t.timestamp,Je.NUMBER),ot("options.count",null==t?void 0:t.count,Je.NUMBER),ot("options.order",null==t?void 0:t.order,(function(e){return 0===e||1===e})),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("get history message ->"+n),[4,gs.imClient.context.getRemoteHistoryMessages(e.conversationType,e.targetId,(null==t?void 0:t.timestamp)||0,(null==t?void 0:t.count)||20,(null==t?void 0:t.order)||0,e.channelId||"")];case 1:return r=a.sent(),i=r.code,o=r.data,i===ye.SUCCESS&&o?(s=o.list.map((function(e){return ls(e)})),[2,{code:i,data:{list:s,hasMore:o.hasMore}}]):(Bo.warn("get history message fail ->"+i+":"+ms[i]+","+n),[2,{code:i,msg:ms[i]}])}}))}))},e.getServerTime=function(){return fs.context.getServerTime()},e.getTags=function(){return C(this,void 0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,gs.imClient.context.getTagList()];case 1:return e=r.sent(),t=e.code,n=e.data,t===ye.SUCCESS?[2,{code:ye.SUCCESS,data:n}]:(Bo.warn("getTagList ->code:"+t),[2,{code:t,msg:ms[t]}])}}))}))},e.getTagsFromConversation=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return ot("conversationType",e.conversationType,Je.NUMBER),ot("targetId",e.targetId,Je.STRING),ot("channelId",e.channelId,Je.CHANNEL_ID),Bo.info("getTagsForConversation ->targetId:"+e.targetId+",conversationType:"+e.conversationType),[4,gs.imClient.context.getTagsForConversation(e)];case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?[2,{code:n,data:r}]:[2,{code:n,msg:ms[n]}]}}))}))},e.getTextMessageDraft=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.getConversationMessageDraft(e.conversationType,e.targetId,e.channelId)];case 1:return t=o.sent(),n=t.code,r=t.data,i="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("get draft ->"+i),n===ye.SUCCESS?[2,{code:n,data:r||""}]:(Bo.warn("get draft fail ->"+n+":"+ms[n]+","+i),[2,{code:n,msg:ms[n]}])}}))}))},e.getTopConversationList=function(){return C(this,void 0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,gs.imClient.context.getTopConversationList()];case 1:return e=r.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))},e.getTotalUnreadCount=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:if(Bo.debug("get total unread count -> ConversationType:"+JSON.stringify(t)+" includeMuted:"+e),ot("includeMuted",e,Je.BOOLEAN,!1),ot("conversationTypes",t,Je.ARRAY,!1),t)for(n=0,r=t;n<r.length;n++)i=r[n],ot("conversationType",i,ae);return[4,gs.imClient.context.getTotalUnreadCount("",t,e)];case 1:return o=c.sent(),s=o.code,a=o.data,s===ye.SUCCESS?[2,{code:s,data:a}]:(Bo.warn("getTotalUnreadCount fail ->"+s+":"+ms[s]),[2,{code:s,msg:ms[s]}])}}))}))},e.getUltraGroupDefaultNotificationLevel=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),t="getUltraGroupDefaultNotificationLevel",n="targetId: ".concat(e.targetId,", channelId: ").concat(e.channelId),Bo.debug("".concat(t," -> ").concat(n)),[4,gs.imClient.context.getUltraGroupDefaultNotificationLevel(e.targetId,e.channelId)];case 1:return r=s.sent(),i=r.code,o=r.data,i===ye.SUCCESS?[2,{code:i,data:o}]:(Bo.warn("".concat(t," fail -> ").concat(i," : ").concat(ms[i]," , ").concat(n)),[2,{code:i,msg:ms[i]}])}}))}))},e.getUltraGroupList=function(){return C(this,void 0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,gs.imClient.context.getUltraGroupList()];case 1:return e=r.sent(),t=e.code,n=e.data,t===ye.SUCCESS?[2,{code:ye.SUCCESS,data:n}]:(Bo.warn("get ultragroup  ->"+t+":"+ms[t]),[2,{code:t,msg:ms[t]}])}}))}))},e.getUltraGroupMessageListByMessageUId=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),ot("options.conversationType",e.conversationType,ae,!0),ot("msgs",t,Je.ARRAY,!0),n=e.targetId,r=e.conversationType,i=e.channelId,o=[],t.forEach((function(e){var t=e.sendTime,n=e.messageUId;o.push({sendTime:t,messageUId:n,channelId:i})})),s={targetId:n,conversationType:r,messages:o},[4,gs.imClient.context.getUltraGroupMessageListByMessageUId(s)];case 1:return a=d.sent(),c=a.code,u=a.data,c===ye.SUCCESS?[2,{code:ye.SUCCESS,data:u}]:(Bo.warn("get UltraGroup MessageList by messageUId   ->"+c+":"+ms[c]),[2,{code:c,msg:ms[c]}])}}))}))},e.getUltraGroupUnreadCountByTargetId=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("options.targetId",e,Je.STRING,!0),t="getUltraGroupUnreadCountByTargetId",[4,gs.imClient.context.getUltraGroupUnreadCountByTargetId(e)];case 1:return n=s.sent(),r=n.code,i=n.data,o="targetId: ".concat(e),Bo.debug("".concat(t," -> ").concat(o)),r===ye.SUCCESS?[2,{code:r,data:i}]:(Bo.warn("".concat(t," fail -> ").concat(r,": ").concat(ms[r],", ").concat(o)),[2,{code:r,msg:ms[r]}])}}))}))},e.getUltraGroupUnreadMentionedCountByTargetId=function(e){return C(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return ot("cotargetIdntent",e,Je.STRING,!0),Bo.debug("get UltraGroup unreadMentionedCount by targetId:"+e),[4,gs.imClient.context.getUltraGroupUnreadMentionedCountByTargetId(e)];case 1:return t=i.sent(),n=t.code,r=t.data,n===ye.SUCCESS?[2,{code:ye.SUCCESS,data:r}]:(Bo.warn("get UltraGroup unreadMentionedCount by targetId error ->"+n+":"+ms[n]),[2,{code:n,msg:ms[n]}])}}))}))},e.getUnreadCount=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i;return S(this,(function(o){switch(o.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.getUnreadCount(e.conversationType,e.targetId,e.channelId)];case 1:return t=o.sent(),n=t.code,r=t.data,i="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("get unreadCount ->"+i),n===ye.SUCCESS?[2,{code:n,data:r}]:(Bo.warn("get unreadCount fail ->"+n+":"+ms[n]+","+i),[2,{code:n,msg:ms[n]}])}}))}))},e.getUnreadCountByTag=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i;return S(this,(function(o){switch(o.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("containMuted",t,Je.BOOLEAN,!0),Bo.info("getUnreadCountByTag ->tagId:"+e),[4,gs.imClient.context.getUnreadCountByTag(e,t)];case 1:return n=o.sent(),r=n.code,i=n.data,Bo.info(r,i),r===ye.SUCCESS?[2,{code:r,data:i}]:(Bo.warn("getUnreadCountByTag ->code:"+r+",tagId:"+e),[2,{code:r,msg:ms[r]}])}}))}))},e.getUnreadMentionedCount=function(e){return C(this,void 0,void 0,(function(){return S(this,(function(t){return ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),Bo.debug("getUnreadMentionedCount"+e.targetId+",channelId:"+e.channelId),[2,gs.imClient.context.getUnreadMentionedCount(e)]}))}))},e.getUnreadMentionedMessages=function(e){if(!_t())return{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]};ot("conversationType",e.conversationType,Je.NUMBER,!0),ot("targetId",e.targetId,Je.STRING,!0);var t=gs.imClient.context.getUnreadMentionedMessages(e.conversationType,e.targetId),n=[];return t&&t.length&&t.forEach((function(e){return n.push(ls(e))})),{code:ye.SUCCESS,data:n}},e.init=function(e){fs=fs||new gs(e)},e.insertMessage=function(e,t,n){return void 0===n&&(n={}),C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u,d,l,h,f,g,p,m,v,_;return S(this,(function(y){switch(y.label){case 0:return _t()?(r=t.senderUserId,i=t.messageType,o=t.content,s=t.messageDirection,a=t.messageUId,c=t.canIncludeExpansion,u=t.expansion,d=t.disableNotification,l=t.sentTime,h=t.sentStatus,Bo.info("insertMessage ->targetId:"+e.targetId+",conversationType:"+e.conversationType),f=n.isUnread,g=n.searchContent,p={senderUserId:r,messageType:i,content:o,messageDirection:s,sentTime:l,sentStatus:h,searchContent:g,isUnread:f,messageUId:a,disableNotification:d,canIncludeExpansion:c,expansionMsg:JSON.stringify(u),channelId:e.channelId||""},[4,gs.imClient.context.insertMessage(e.conversationType,e.targetId,p)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return m=y.sent(),v=m.code,_=m.data,v===ye.SUCCESS?[2,{code:v,data:ls(_)}]:(Bo.warn("insertMessage ->code:"+v+",targetId:"+e.targetId),[2,{code:v,msg:ms[v]}])}}))}))},e.installPlugin=function(e,t){return null==fs?void 0:fs.context.install(e,t)},e.joinChatRoom=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.count",t.count,Je.NUMBER,!0),n="id:"+e,Bo.debug("join chatroom ->"+n),[4,gs.imClient.context.joinChatroom(e,t.count)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("join chatroom fail ->code+:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.joinExistChatRoom=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.count",t.count,Je.NUMBER,!0),n="id:"+e,Bo.debug("join exist chatroom ->"+n),[4,gs.imClient.context.joinExistChatroom(e,t.count)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("join exist chatroom fail ->code:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.modifyMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d,l;return S(this,(function(h){switch(h.label){case 0:return ot("content",e,Je.OBJECT,!0),ot("message",t,Je.OBJECT,!0),n=t.conversationType,r=t.targetId,i=t.messageUId,o=t.senderUserId,s=t.sentTime,a=t.canIncludeExpansion,c=t.channelId,u="conversationType:"+n+",targetId:"+r+",channelId:"+c+",messageUId:"+i,Bo.debug("update ultragroup message expansion ->"+u),d={targetId:r,channelId:c,conversationType:n,fromUserId:o,sendTime:s,canIncludeExpansion:a,messageUId:i,content:e},[4,gs.imClient.context.modifyMessage(d)];case 1:return(l=h.sent().code)===ye.SUCCESS?[2,{code:ye.SUCCESS}]:(Bo.warn("modify ultraGroup message   ->"+l+":"+ms[l]),[2,{code:l,msg:ms[l]}])}}))}))},e.onceEventListener=function(e,t,n){fs.once(e,t,n)},e.quitChatRoom=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t="id:"+e,Bo.debug("quit chatroom ->"+t),[4,gs.imClient.context.quitChatroom(e)];case 1:return(n=r.sent())!==ye.SUCCESS?(Bo.warn("quit chatroom fail ->code+:"+ms[n]+","+t),[2,{code:n,msg:ms[n]}]):[2,{code:n}]}}))}))},e.recallMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("options.messageUId",t.messageUId,Je.STRING,!0),ot("options.sentTime",t.sentTime,Je.NUMBER,!0),ot("options.disableNotification",null==t?void 0:t.disableNotification,Je.BOOLEAN),ot("options.pushConfig",null==t?void 0:t.pushConfig,Je.OBJECT),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n={user:t.user,channelId:e.channelId||"",disableNotification:null==t?void 0:t.disableNotification,pushConfig:null==t?void 0:t.pushConfig,extra:t.extra},r="conversationType:"+e.conversationType+",targetId:"+e.targetId+",messageUId:"+t.messageUId,Bo.debug("recall message ->"+r),[4,gs.imClient.context.recallMessage(e.conversationType,e.targetId,t.messageUId,t.sentTime,n)];case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS&&s?[2,{code:o,data:ls(s)}]:o===ye.SUCCESS?[2,{code:o}]:(Bo.warn("recall message fail ->"+o+":"+ms[o]+","+r),[2,{code:o,msg:ms[o]}])}}))}))},e.registerMessageType=function(e,t,n,r,i){return ot("messageType",e,Je.STRING,!0),ot("isPersited",t,Je.BOOLEAN,!0),ot("isCounted",n,Je.BOOLEAN,!0),ot("isStatusMessage",i,Je.BOOLEAN,!1),gs.imClient.context.registerMessageType(e,t,n,r,i),Ns(e,t,n)},e.removeAllExpansionForUltraGroupMessage=function(e){return C(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return ot("message",e,Je.OBJECT,!0),t=e.conversationType,n=e.targetId,r=e.messageUId,i=e.sentTime,o=e.canIncludeExpansion,s=e.channelId,a="conversationType:"+t+",targetId:"+n+",channelId:"+s+",messageUId:"+r,Bo.debug("remove all expansion for ultraGroup message ->"+a),c={targetId:n,channelId:s,conversationType:t,sendTime:i,canIncludeExpansion:o,messageUId:r,removeAll:!0},[4,gs.imClient.context.expandUltraMessage(c)];case 1:return(u=d.sent().code)===ye.SUCCESS?[2,{code:ye.SUCCESS}]:(Bo.warn("remove all expansion for ultraGroup message   ->"+u+":"+ms[u]),[2,{code:u,msg:ms[u]}])}}))}))},e.removeChatRoomEntries=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("targetId",e,Je.STRING,!0),function(e){e.entries.forEach((function(e){ot("key",e,Je.STRING,!0)})),ot("options.notificationExtra",e.notificationExtra,Je.STRING)}(t),n="id:"+e,Bo.debug("remove chatroom entry->"+n),(r=Object.assign({},t)).entries=t.entries.map((function(e){return{key:e}})),[4,gs.imClient.context.removeChatroomEntries(e,r)];case 1:return i=a.sent(),o=i.code,s=i.data,o!==ye.SUCCESS?(Bo.warn("remove chatroom entry fail ->code+:"+ms[o]+","+n),[2,{code:o,msg:ms[o],data:s}]):[2,{code:o}]}}))}))},e.removeChatRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("targetId",e,Je.STRING,!0),Ss(t),n="id:"+e,Bo.debug("remove chatroom entry->"+n),[4,gs.imClient.context.removeChatroomEntry(e,t)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("remove chatroom entry fail ->code+:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.removeConversation=function(e){return C(this,void 0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),[4,gs.imClient.context.removeConversation(e.conversationType,e.targetId,e.channelId)];case 1:return t=r.sent(),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("destroy conversation ->"+n),t!==ye.SUCCESS?(Bo.warn("destroy conversation fail ->"+t+":"+ms[t]+","+n),[2,{code:t,msg:ms[t]}]):[2,{code:t}]}}))}))},e.removeConversationsFromTag=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("conversations",t,Je.ARRAY,!0),t.forEach((function(e){ot("conversation.conversationType",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("conversation.channelId",e.channelId,Je.CHANNEL_ID)})),Bo.info("removeTagForConversations ->tagId:"+e),[4,gs.imClient.context.removeTagForConversations(e,t)];case 1:return(n=r.sent().code)===ye.SUCCESS?[2,{code:n}]:(Bo.warn("removeTagForConversations ->code:"+n+",tagId:"+e),[2,{code:n,msg:ms[n]}])}}))}))},e.removeEventListener=function(e,t,n){fs.off(e,t,n)},e.removeEventListeners=function(e){fs.removeAll(e)},e.removeExpansionForUltraGroupMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return ot("expansion",e,Je.ARRAY,!0),ot("message",t,Je.OBJECT,!0),n=t.conversationType,r=t.targetId,i=t.messageUId,o=t.sentTime,s=t.canIncludeExpansion,a=t.channelId,c="conversationType:"+n+",targetId:"+r+",channelId:"+a+",messageUId:"+i,Bo.debug("remove expansion for ultragroup message  ->"+c),u={targetId:r,channelId:a,conversationType:n,sendTime:o,canIncludeExpansion:s,messageUId:i,keys:e},[4,gs.imClient.context.expandUltraMessage(u)];case 1:return(d=l.sent().code)===ye.SUCCESS?[2,{code:ye.SUCCESS}]:(Bo.warn("remove expansion for ultraGroup message   ->"+d+":"+ms[d]),[2,{code:d,msg:ms[d]}])}}))}))},e.removeMessageExpansionForKey=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return ot("keys",e,Je.ARRAY,!0),ot("message",t,Je.OBJECT,!0),n=t.conversationType,r=t.targetId,i=t.messageUId,o=t.canIncludeExpansion,s=t.channelId,a="conversationType:"+n+",targetId:"+r+",messageUId:"+i,Bo.debug("remove message expansion ->"+a),[4,gs.imClient.context.sendExpansionMessage({conversationType:n,targetId:r,messageUId:i,canIncludeExpansion:o,keys:e,channelId:s})];case 1:return(c=u.sent().code)!==ye.SUCCESS?(Bo.warn("remove message expansion fail ->"+c+":"+ms[c]+","+a),[2,{code:c,msg:ms[c]}]):[2,{code:c}]}}))}))},e.removeTag=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return ot("tagId",e,Je.STRING,!0),Bo.info("removeTag ->tagId:"+e),[4,gs.imClient.context.removeTag(e)];case 1:return(t=n.sent().code)===ye.SUCCESS?[2,{code:t}]:(Bo.warn("removeTag ->code:"+t+",tagId:"+e),[2,{code:t,msg:ms[t]}])}}))}))},e.removeTagFromConversations=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("conversations",t,Je.ARRAY,!0),t.forEach((function(e){ot("conversation.conversationType",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("conversation.channelId",e.channelId,Je.CHANNEL_ID)})),Bo.info("removeTagForConversations ->tagId:"+e),[4,gs.imClient.context.removeTagForConversations(e,t)];case 1:return(n=r.sent().code)===ye.SUCCESS?[2,{code:n}]:(Bo.warn("removeTagForConversations ->code:"+n+",tagId:"+e),[2,{code:n,msg:ms[n]}])}}))}))},e.removeTagsFromConversation=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return ot("conversation.conversationType",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("conversation.channelId",e.channelId,Je.CHANNEL_ID),ot("tagIds",t,Je.ARRAY,!0),t.forEach((function(e){ot("tagId",e,Je.STRING,!0)})),Bo.info("removeTagsForConversation ->tagIds:"+t+",targetId:"+e.targetId+",conversationType:"+e.conversationType),[4,gs.imClient.context.removeTagsForConversation(e,t)];case 1:return(n=r.sent().code)===ye.SUCCESS?[2,{code:n}]:(Bo.warn("removeTagsForConversation ->code:"+n+",tagIds:"+t),[2,{code:n,msg:ms[n]}])}}))}))},e.saveTextMessageDraft=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.conversationType",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),ot("draft",t,Je.STRING,!0),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("set draft ->"+n),[4,gs.imClient.context.saveConversationMessageDraft(e.conversationType,e.targetId,t,e.channelId)];case 1:return(r=i.sent())===ye.SUCCESS?[2,{code:r}]:(Bo.warn("set draft fail ->"+r+":"+ms[r]+","+n),[2,{code:r,msg:ms[r]}])}}))}))},e.searchConversationByContent=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s;return S(this,(function(a){switch(a.label){case 0:return _t()?(Bo.info("searchConversationByContent ->keyword:"+e),[4,gs.imClient.context.searchConversationByContent(e,n,r,t)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS?[2,{code:o,data:s}]:(Bo.warn("searchConversationByContent ->code:"+o+",keyword:"+e),[2,{code:o,msg:ms[o]}])}}))}))},e.searchMessages=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return _t()?(ot("conversationType",e.conversationType,Je.NUMBER,!0),ot("targetId",e.targetId,Je.STRING,!0),ot("keyword",t,Je.STRING,!0),ot("timestamp",n,Je.NUMBER),ot("count",r,Je.NUMBER),1,[4,gs.imClient.context.searchMessageByContent(e.conversationType,e.targetId,t,n,r,1,e.channelId)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return i=c.sent(),o=i.code,s=i.data,o===ye.SUCCESS?(a=[],(null==s?void 0:s.messages)&&s.messages.length&&s.messages.forEach((function(e){return a.push(ls(e))})),[2,{code:o,data:{messages:a,count:null==s?void 0:s.count}}]):(Bo.warn("searchMessages ->code:"+o+",targetId:"+e.targetId),[2,{code:o,msg:ms[o]}])}}))}))},e.sendFileMessage=pa,e.sendHQVoiceMessage=va,e.sendImageMessage=ma,e.sendMessage=fa,e.sendReadReceiptMessage=function(e,t,n,r){return C(this,void 0,void 0,(function(){var i,o,s,a,c;return S(this,(function(u){switch(u.label){case 0:return i={targetId:e,conversationType:Y.PRIVATE,channelId:r},o=new Rs("RC:ReadNtf",{messageUId:t,lastMessageSendTime:n,type:1}),[4,fa(i,o)];case 1:return s=u.sent(),a=s.code,c=s.msg,0===a?[2,{code:a}]:[2,{code:a,msg:c}]}}))}))},e.sendReadReceiptRequest=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a;return S(this,(function(c){switch(c.label){case 0:return ot("messageUId",t,Je.STRING,!0),ot("channelId",n,Je.CHANNEL_ID),r="messageUId:"+t+",targetId:"+e,Bo.debug("send read receipt message ->"+r),i=new Rs("RC:RRReqMsg",{messageUId:t}),[4,fa({targetId:e,conversationType:Y.GROUP,channelId:n},i)];case 1:return o=c.sent(),s=o.code,a=o.msg,0===s?[2,{code:s}]:[2,{code:s,msg:a}]}}))}))},e.sendReadReceiptResponse=function(e,t,n){return C(this,void 0,void 0,(function(){return S(this,(function(e){throw new Error("This method is deprecated, please use method sendReadReceiptResponseV2.")}))}))},e.sendReadReceiptResponseV2=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return ot("targetId",e,Je.STRING,!0),ot("messageList",t,Je.OBJECT,!0),ot("channelId",n,Je.CHANNEL_ID),Object.keys(t).forEach((function(e){ot(e,t[e],Je.ARRAY)})),r={targetId:e,conversationType:Y.GROUP,channelId:n},o=gs.imClient.context.getInfoFromCache(),0!==(s=(null==o?void 0:o.grpRRVer)||0)?[3,2]:(a=new Rs("RC:RRRspMsg",{receiptMessageDic:t}),[4,fa(r,a)]);case 1:return i=d.sent(),[3,4];case 2:return 1!==s?[3,4]:(c=[],Object.keys(t).forEach((function(e){t[e].forEach((function(e){-1===c.indexOf(e)&&c.push(e)}))})),c.length?[4,gs.imClient.context.sendReadReceiptMessage(e,c,n)]:(Bo.warn("Error in parameter messageList."),[2,{code:ye.PARAMETER_ERROR}]));case 3:i=d.sent(),d.label=4;case 4:return(u=i.code)===ye.SUCCESS?[2,{code:u}]:(Bo.warn("send read receipt message fail ->"+u+":"+ms[u]),[2,{code:u,msg:ms[u]}])}}))}))},e.sendSightMessage=_a,e.sendSyncReadStatusMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("conversation.type",e.conversationType,Je.NUMBER,!0),ot("conversation.targetId",e.targetId,Je.STRING,!0),ot("lastMessageSendTime",t,Je.NUMBER,!0),ot("conversation.channelId",null==e?void 0:e.channelId,Je.CHANNEL_ID),n=new Rs("RC:SRSMsg",{lastMessageSendTime:t}),[4,fa(e,n)];case 1:return r=s.sent(),i=r.code,o=r.msg,0===i?[2,{code:i}]:[2,{code:i,msg:o}]}}))}))},e.sendTextMessage=function(e,t,n){return fa(e,new bs(t),n)},e.sendTypingStatusMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s;return S(this,(function(a){switch(a.label){case 0:return ot("typingContentType",t,Je.STRING,!0),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("send typing status message ->"+n),r={messageType:"RC:TypSts",content:{typingContentType:t},isStatusMessage:!0,channelId:e.channelId},[4,gs.imClient.context.sendMessage(e.conversationType,e.targetId,r)];case 1:return i=a.sent(),o=i.code,s=i.data,o===ye.SUCCESS?[2,{code:o,data:ls(s)}]:(Bo.warn("send typing status message fail ->"+o+":"+ms[o]+","+n),[2,{code:o,msg:ms[o]}])}}))}))},e.sendUltraGroupTypingStatus=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),ot("options.conversationType",e.conversationType,ae,!0),[4,gs.imClient.context.sendUltraGroupTypingStatus(e)];case 1:return(t=n.sent().code)===ye.SUCCESS?[2,{code:ye.SUCCESS}]:(Bo.warn("send ultraGroup OperateStatus   ->"+t+":"+ms[t]),[2,{code:t,msg:ms[t]}])}}))}))},e.setChatRoomEntries=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o;return S(this,(function(s){switch(s.label){case 0:return ot("targetId",e,Je.STRING,!0),function(e){e.entries.forEach((function(e){ot("entry.key",e.key,Je.STRING,!0),ot("entry.value",e.value,Je.STRING,!0)})),ot("options.isAutoDelete",e.isAutoDelete,Je.BOOLEAN),ot("options.notificationExtra",e.notificationExtra,Je.STRING)}(t),t.entries.length>10?[2,ps.CHATROOM_KV_STORE_OUT_LIMIT]:(n="id:"+e,Bo.debug("set chatroom entry->"+n),[4,gs.imClient.context.setChatroomEntries(e,t)]);case 1:return r=s.sent(),i=r.code,o=r.data,i!==ye.SUCCESS?(Bo.warn("set chatroom entry fail ->code+:"+ms[i]+","+n),[2,{code:i,msg:ms[i],data:o}]):[2,{code:i}]}}))}))},e.setChatRoomEntry=function(e,t){return C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("targetId",e,Je.STRING,!0),Cs(t),n="id:"+e,Bo.debug("set chatroom entry->"+n),[4,gs.imClient.context.setChatroomEntry(e,t)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("set chatroom entry fail ->code+:"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.setConversationNotificationLevel=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return ot("notificationLevel",t,(function(t){return e.conversationType===Y.PRIVATE?[Me.ALL_MESSAGE,Me.NOT_SET,Me.AT_MESSAGE_NOTIFICATION].includes(t):void 0!==Me[t]}),!0),[2,Is(e,(function(){return gs.imClient.context.setConversationNotificationLevel(e.conversationType,e.targetId,t,e.channelId)}),"setConversationNotificationLevel")]}))}))},e.setConversationNotificationStatus=function(e,t){return C(this,void 0,void 0,(function(){return S(this,(function(n){return ot("notificationStatus",t,(function(e){return 1===e||2===e}),!0),[2,Is(e,(function(){return gs.imClient.context.setConversationStatus(e.conversationType,e.targetId,void 0,t,e.channelId)}),"setConversationNotificationStatus")]}))}))},e.setConversationToTop=function(e,t){return void 0===t&&(t=!0),C(this,void 0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return ot("options.type",e.conversationType,ae,!0),ot("options.targetId",e.targetId,Je.STRING,!0),ot("options.channelId",e.channelId,Je.CHANNEL_ID),n="conversationType:"+e.conversationType+",targetId:"+e.targetId,Bo.debug("set conversation status ->"+n),[4,gs.imClient.context.setConversationStatus(e.conversationType,e.targetId,t,void 0,e.channelId)];case 1:return(r=i.sent())!==ye.SUCCESS?(Bo.warn("set conversation status fail ->"+r+":"+ms[r]+","+n),[2,{code:r,msg:ms[r]}]):[2,{code:r}]}}))}))},e.setConversationToTopInTag=function(e,t,n){return C(this,void 0,void 0,(function(){var r,i;return S(this,(function(o){switch(o.label){case 0:return ot("tagId",e,Je.STRING,!0),ot("conversation.targetId",t.targetId,Je.STRING,!0),ot("conversation.conversationType",t.conversationType,Je.NUMBER,!0),ot("conversation.channelId",t.channelId,Je.CHANNEL_ID),ot("status.isTop",n,Je.BOOLEAN,!0),Bo.info("setConversationStatusInTag ->tagId:"+e+",targetId:"+t.targetId+",conversationType"+t.conversationType),[4,gs.imClient.context.setConversationStatusInTag(e,t,{isTop:n})];case 1:return r=o.sent(),(i=r.code)===ye.SUCCESS?[2,{code:i}]:(Bo.warn("setConversationStatusInTag ->code:"+i+",tagId:"+e),[2,{code:i,msg:ms[i]}])}}))}))},e.setMessageReceivedStatus=function(e,t){return C(this,void 0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return _t()?(ot("messageId",e,Je.NUMBER,!0),ot("receivedStatus",t,Je.NUMBER,!0),Bo.info("setMessageReceivedStatus ->messageId:"+e+",receivedStatus:"+t),[4,gs.imClient.context.setMessageReceivedStatus(e,t)]):[2,{code:ye.NOT_SUPPORT,msg:ms[ye.NOT_SUPPORT]}];case 1:return(n=r.sent())===ye.SUCCESS?[2,{code:n}]:(Bo.warn("setMessageReceivedStatus ->code:"+n+",messageId:"+e),[2,{code:n,msg:ms[n]}])}}))}))},e.setUltraGroupDefaultNotificationLevel=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i;return S(this,(function(o){switch(o.label){case 0:return ot("options.targetId",e.targetId,Je.STRING,!0),e.channelId=e.channelId||"",ot("options.channelId",e.channelId,Je.ONLY_STRING,!0),ot("notificationLevel",t,(function(e){return void 0!==Me[e]}),!0),n="setUltraGroupDefaultNotificationLevel",r="targetId: ".concat(e.targetId,", channelId: ").concat(e.channelId),Bo.debug("".concat(n," -> ").concat(r)),[4,gs.imClient.context.setUltraGroupDefaultNotificationLevel(e.targetId,t,e.channelId)];case 1:return(i=o.sent().code)===ye.SUCCESS?[2,{code:i}]:(Bo.warn("".concat(n," fail -> ").concat(i," : ").concat(ms[i]," , ").concat(r)),[2,{code:i,msg:ms[i]}])}}))}))},e.updateExpansionForUltraGroupMessage=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u,d;return S(this,(function(l){switch(l.label){case 0:return ot("expansion",e,Je.OBJECT,!0),ot("message",t,Je.OBJECT,!0),n=t.conversationType,r=t.targetId,i=t.messageUId,o=t.sentTime,s=t.canIncludeExpansion,a=t.channelId,c="conversationType:"+n+",targetId:"+r+",channelId:"+a+",messageUId:"+i,Bo.debug("update expansion for ultragroup message  ->"+c),u={targetId:r,channelId:a,conversationType:n,sendTime:o,canIncludeExpansion:s,messageUId:i,expansion:e},[4,gs.imClient.context.expandUltraMessage(u)];case 1:return(d=l.sent().code)===ye.SUCCESS?[2,{code:ye.SUCCESS}]:(Bo.warn("update expansion for ultragroup message   ->"+d+":"+ms[d]),[2,{code:d,msg:ms[d]}])}}))}))},e.updateMessageExpansion=function(e,t){return C(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,u;return S(this,(function(d){switch(d.label){case 0:return ot("expansion",e,Je.OBJECT,!0),ot("message",t,Je.OBJECT,!0),n=t.conversationType,r=t.targetId,i=t.messageUId,o=t.canIncludeExpansion,s=t.expansion,a=t.channelId,c="conversationType:"+n+",targetId:"+r+",messageUId:"+i,Bo.debug("update message expansion ->"+c),[4,gs.imClient.context.sendExpansionMessage({conversationType:n,targetId:r,messageUId:i,expansion:e,canIncludeExpansion:o,originExpansion:s,channelId:a})];case 1:return(u=d.sent().code)!==ye.SUCCESS?(Bo.warn("update message expansion fail ->"+u+":"+ms[u]+","+c),[2,{code:u,msg:ms[u]}]):[2,{code:u}]}}))}))},e.updateTag=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return ot("tag.tagId",e.tagId,Je.STRING,!0),ot("tag.tagName",e.tagName,Je.STRING,!0),ot("tag.tagName",e.tagName,(function(e){return e.length<=15})),Bo.info("updateTag ->tagId:"+e.tagId+",tagName:"+e.tagName),[4,gs.imClient.context.updateTag(e)];case 1:return(t=n.sent().code)===ye.SUCCESS?[2,{code:t}]:(Bo.warn("updateTag ->code:"+t+",tagId:"+e.tagId),[2,{code:t,msg:ms[t]}])}}))}))},Object.defineProperty(e,"__esModule",{value:!0})}));
